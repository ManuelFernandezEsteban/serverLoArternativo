(self.webpackChunkapp_lo_alternativo=self.webpackChunkapp_lo_alternativo||[]).push([[166],{8166:(Yh,Go,Bt)=>{"use strict";Bt.r(Go),Bt.d(Go,{DashboardModule:()=>Hr});var Ds={};Bt.r(Ds),Bt.d(Ds,{Decoder:()=>ce,Encoder:()=>ue,PacketType:()=>Q,protocol:()=>Y});var zt=Bt(6895),Rc=Bt(4466),a=Bt(4154),h=Bt(8256),Cn=Bt(7848),rn=Bt(7579);const lt=Object.create(null);lt.open="0",lt.close="1",lt.ping="2",lt.pong="3",lt.message="4",lt.upgrade="5",lt.noop="6";const _t=Object.create(null);Object.keys(lt).forEach(T=>{_t[lt[T]]=T});const wi={type:"error",data:"parser error"},Ai="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),An="function"==typeof ArrayBuffer,on=(T,S)=>{const x=new FileReader;return x.onload=function(){const A=x.result.split(",")[1];S("b"+A)},x.readAsDataURL(T)},or=({type:T,data:S},x,A)=>Ai&&S instanceof Blob?x?A(S):on(S,A):An&&(S instanceof ArrayBuffer||(T=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(T):T&&T.buffer instanceof ArrayBuffer)(S))?x?A(S):on(new Blob([S]),A):A(lt[T]+(S||"")),sn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Oe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let T=0;T<sn.length;T++)Oe[sn.charCodeAt(T)]=T;const $o="function"==typeof ArrayBuffer,li=(T,S)=>{if($o){const x=(T=>{let A,Ie,et,ti,ji,S=.75*T.length,x=T.length,X=0;"="===T[T.length-1]&&(S--,"="===T[T.length-2]&&S--);const Rn=new ArrayBuffer(S),Oi=new Uint8Array(Rn);for(A=0;A<x;A+=4)Ie=Oe[T.charCodeAt(A)],et=Oe[T.charCodeAt(A+1)],ti=Oe[T.charCodeAt(A+2)],ji=Oe[T.charCodeAt(A+3)],Oi[X++]=Ie<<2|et>>4,Oi[X++]=(15&et)<<4|ti>>2,Oi[X++]=(3&ti)<<6|63&ji;return Rn})(T);return Xo(x,S)}return{base64:!0,data:T}},Xo=(T,S)=>"blob"===S&&T instanceof ArrayBuffer?new Blob([T]):T,po=(T,S)=>{if("string"!=typeof T)return{type:"message",data:Xo(T,S)};const x=T.charAt(0);return"b"===x?{type:"message",data:li(T.substring(1),S)}:_t[x]?T.length>1?{type:_t[x],data:T.substring(1)}:{type:_t[x]}:wi},Ir=String.fromCharCode(30);function Gt(T){if(T)return function Nn(T){for(var S in Gt.prototype)T[S]=Gt.prototype[S];return T}(T)}Gt.prototype.on=Gt.prototype.addEventListener=function(T,S){return this._callbacks=this._callbacks||{},(this._callbacks["$"+T]=this._callbacks["$"+T]||[]).push(S),this},Gt.prototype.once=function(T,S){function x(){this.off(T,x),S.apply(this,arguments)}return x.fn=S,this.on(T,x),this},Gt.prototype.off=Gt.prototype.removeListener=Gt.prototype.removeAllListeners=Gt.prototype.removeEventListener=function(T,S){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var x=this._callbacks["$"+T];if(!x)return this;if(1==arguments.length)return delete this._callbacks["$"+T],this;for(var A,X=0;X<x.length;X++)if((A=x[X])===S||A.fn===S){x.splice(X,1);break}return 0===x.length&&delete this._callbacks["$"+T],this},Gt.prototype.emitReserved=Gt.prototype.emit=function(T){this._callbacks=this._callbacks||{};for(var S=new Array(arguments.length-1),x=this._callbacks["$"+T],A=1;A<arguments.length;A++)S[A-1]=arguments[A];if(x){A=0;for(var X=(x=x.slice(0)).length;A<X;++A)x[A].apply(this,S)}return this},Gt.prototype.listeners=function(T){return this._callbacks=this._callbacks||{},this._callbacks["$"+T]||[]},Gt.prototype.hasListeners=function(T){return!!this.listeners(T).length};const pi=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function Kt(T,...S){return S.reduce((x,A)=>(T.hasOwnProperty(A)&&(x[A]=T[A]),x),{})}const kr=pi.setTimeout,mo=pi.clearTimeout;function Xi(T,S){S.useNativeTimers?(T.setTimeoutFn=kr.bind(pi),T.clearTimeoutFn=mo.bind(pi)):(T.setTimeoutFn=pi.setTimeout.bind(pi),T.clearTimeoutFn=pi.clearTimeout.bind(pi))}function ar(T){return"string"==typeof T?function lr(T){let S=0,x=0;for(let A=0,X=T.length;A<X;A++)S=T.charCodeAt(A),S<128?x+=1:S<2048?x+=2:S<55296||S>=57344?x+=3:(A++,x+=4);return x}(T):Math.ceil(1.33*(T.byteLength||T.size))}class Wi extends Error{constructor(S,x,A){super(S),this.description=x,this.context=A,this.type="TransportError"}}class Sn extends Gt{constructor(S){super(),this.writable=!1,Xi(this,S),this.opts=S,this.query=S.query,this.socket=S.socket}onError(S,x,A){return super.emitReserved("error",new Wi(S,x,A)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(S){"open"===this.readyState&&this.write(S)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(S){const x=po(S,this.socket.binaryType);this.onPacket(x)}onPacket(S){super.emitReserved("packet",S)}onClose(S){this.readyState="closed",super.emitReserved("close",S)}pause(S){}}const zr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),_o={};let wt,Jt=0,di=0;function Hi(T){let S="";do{S=zr[T%64]+S,T=Math.floor(T/64)}while(T>0);return S}function un(){const T=Hi(+new Date);return T!==wt?(Jt=0,wt=T):T+"."+Hi(Jt++)}for(;di<64;di++)_o[zr[di]]=di;function cr(T){let S="";for(let x in T)T.hasOwnProperty(x)&&(S.length&&(S+="&"),S+=encodeURIComponent(x)+"="+encodeURIComponent(T[x]));return S}let In=!1;try{In=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Ho=In;function Ei(T){const S=T.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!S||Ho))return new XMLHttpRequest}catch{}if(!S)try{return new(pi[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function Vn(){}const Pr=null!=new Ei({xdomain:!1}).responseType;let Mn=(()=>{class T extends Gt{constructor(x,A){super(),Xi(this,A),this.opts=A,this.method=A.method||"GET",this.uri=x,this.async=!1!==A.async,this.data=void 0!==A.data?A.data:null,this.create()}create(){const x=Kt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");x.xdomain=!!this.opts.xd,x.xscheme=!!this.opts.xs;const A=this.xhr=new Ei(x);try{A.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){A.setDisableHeaderCheck&&A.setDisableHeaderCheck(!0);for(let X in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(X)&&A.setRequestHeader(X,this.opts.extraHeaders[X])}}catch{}if("POST"===this.method)try{A.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{A.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in A&&(A.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(A.timeout=this.opts.requestTimeout),A.onreadystatechange=()=>{4===A.readyState&&(200===A.status||1223===A.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof A.status?A.status:0)},0))},A.send(this.data)}catch(X){return void this.setTimeoutFn(()=>{this.onError(X)},0)}typeof document<"u"&&(this.index=T.requestsCount++,T.requests[this.index]=this)}onError(x){this.emitReserved("error",x,this.xhr),this.cleanup(!0)}cleanup(x){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=Vn,x)try{this.xhr.abort()}catch{}typeof document<"u"&&delete T.requests[this.index],this.xhr=null}}onLoad(){const x=this.xhr.responseText;null!==x&&(this.emitReserved("data",x),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return T.requestsCount=0,T.requests={},T})();function kn(){for(let T in Mn.requests)Mn.requests.hasOwnProperty(T)&&Mn.requests[T].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",kn):"function"==typeof addEventListener&&addEventListener("onpagehide"in pi?"pagehide":"unload",kn,!1));const Dr="function"==typeof Promise&&"function"==typeof Promise.resolve?S=>Promise.resolve().then(S):(S,x)=>x(S,0),zn=pi.WebSocket||pi.MozWebSocket,ur=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),qn={websocket:class jn extends Sn{constructor(S){super(S),this.supportsBinary=!S.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const S=this.uri(),x=this.opts.protocols,A=ur?{}:Kt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(A.headers=this.opts.extraHeaders);try{this.ws=ur?new zn(S,x,A):x?new zn(S,x):new zn(S)}catch(X){return this.emitReserved("error",X)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=S=>this.onClose({description:"websocket connection closed",context:S}),this.ws.onmessage=S=>this.onData(S.data),this.ws.onerror=S=>this.onError("websocket error",S)}write(S){this.writable=!1;for(let x=0;x<S.length;x++){const X=x===S.length-1;or(S[x],this.supportsBinary,Ie=>{try{this.ws.send(Ie)}catch{}X&&Dr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let S=this.query||{};const x=this.opts.secure?"wss":"ws";let A="";this.opts.port&&("wss"===x&&443!==Number(this.opts.port)||"ws"===x&&80!==Number(this.opts.port))&&(A=":"+this.opts.port),this.opts.timestampRequests&&(S[this.opts.timestampParam]=un()),this.supportsBinary||(S.b64=1);const X=cr(S);return x+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+A+this.opts.path+(X.length?"?"+X:"")}check(){return!!zn}},polling:class yo extends Sn{constructor(S){if(super(S),this.polling=!1,typeof location<"u"){const A="https:"===location.protocol;let X=location.port;X||(X=A?"443":"80"),this.xd=typeof location<"u"&&S.hostname!==location.hostname||X!==S.port,this.xs=S.secure!==A}this.supportsBinary=Pr&&!(S&&S.forceBase64)}get name(){return"polling"}doOpen(){this.poll()}pause(S){this.readyState="pausing";const x=()=>{this.readyState="paused",S()};if(this.polling||!this.writable){let A=0;this.polling&&(A++,this.once("pollComplete",function(){--A||x()})),this.writable||(A++,this.once("drain",function(){--A||x()}))}else x()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(S){((T,S)=>{const x=T.split(Ir),A=[];for(let X=0;X<x.length;X++){const Ie=po(x[X],S);if(A.push(Ie),"error"===Ie.type)break}return A})(S,this.socket.binaryType).forEach(A=>{if("opening"===this.readyState&&"open"===A.type&&this.onOpen(),"close"===A.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(A)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const S=()=>{this.write([{type:"close"}])};"open"===this.readyState?S():this.once("open",S)}write(S){this.writable=!1,((T,S)=>{const x=T.length,A=new Array(x);let X=0;T.forEach((Ie,et)=>{or(Ie,!1,ti=>{A[et]=ti,++X===x&&S(A.join(Ir))})})})(S,x=>{this.doWrite(x,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let S=this.query||{};const x=this.opts.secure?"https":"http";let A="";!1!==this.opts.timestampRequests&&(S[this.opts.timestampParam]=un()),!this.supportsBinary&&!S.sid&&(S.b64=1),this.opts.port&&("https"===x&&443!==Number(this.opts.port)||"http"===x&&80!==Number(this.opts.port))&&(A=":"+this.opts.port);const X=cr(S);return x+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+A+this.opts.path+(X.length?"?"+X:"")}request(S={}){return Object.assign(S,{xd:this.xd,xs:this.xs},this.opts),new Mn(this.uri(),S)}doWrite(S,x){const A=this.request({method:"POST",data:S});A.on("success",x),A.on("error",(X,Ie)=>{this.onError("xhr post error",X,Ie)})}doPoll(){const S=this.request();S.on("data",this.onData.bind(this)),S.on("error",(x,A)=>{this.onError("xhr poll error",x,A)}),this.pollXhr=S}}},vo=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Jo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Gn(T){const S=T,x=T.indexOf("["),A=T.indexOf("]");-1!=x&&-1!=A&&(T=T.substring(0,x)+T.substring(x,A).replace(/:/g,";")+T.substring(A,T.length));let X=vo.exec(T||""),Ie={},et=14;for(;et--;)Ie[Jo[et]]=X[et]||"";return-1!=x&&-1!=A&&(Ie.source=S,Ie.host=Ie.host.substring(1,Ie.host.length-1).replace(/;/g,":"),Ie.authority=Ie.authority.replace("[","").replace("]","").replace(/;/g,":"),Ie.ipv6uri=!0),Ie.pathNames=function $n(T,S){const A=S.replace(/\/{2,9}/g,"/").split("/");return("/"==S.slice(0,1)||0===S.length)&&A.splice(0,1),"/"==S.slice(-1)&&A.splice(A.length-1,1),A}(0,Ie.path),Ie.queryKey=function Lr(T,S){const x={};return S.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(A,X,Ie){X&&(x[X]=Ie)}),x}(0,Ie.query),Ie}let hr=(()=>{class T extends Gt{constructor(x,A={}){super(),this.writeBuffer=[],x&&"object"==typeof x&&(A=x,x=null),x?(x=Gn(x),A.hostname=x.host,A.secure="https"===x.protocol||"wss"===x.protocol,A.port=x.port,x.query&&(A.query=x.query)):A.host&&(A.hostname=Gn(A.host).host),Xi(this,A),this.secure=null!=A.secure?A.secure:typeof location<"u"&&"https:"===location.protocol,A.hostname&&!A.port&&(A.port=this.secure?"443":"80"),this.hostname=A.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=A.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=A.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},A),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function go(T){let S={},x=T.split("&");for(let A=0,X=x.length;A<X;A++){let Ie=x[A].split("=");S[decodeURIComponent(Ie[0])]=decodeURIComponent(Ie[1])}return S}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(x){const A=Object.assign({},this.opts.query);A.EIO=4,A.transport=x,this.id&&(A.sid=this.id);const X=Object.assign({},this.opts.transportOptions[x],this.opts,{query:A,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new qn[x](X)}open(){let x;if(this.opts.rememberUpgrade&&T.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))x="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);x=this.transports[0]}this.readyState="opening";try{x=this.createTransport(x)}catch{return this.transports.shift(),void this.open()}x.open(),this.setTransport(x)}setTransport(x){this.transport&&this.transport.removeAllListeners(),this.transport=x,x.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",A=>this.onClose("transport close",A))}probe(x){let A=this.createTransport(x),X=!1;T.priorWebsocketSuccess=!1;const Ie=()=>{X||(A.send([{type:"ping",data:"probe"}]),A.once("packet",je=>{if(!X)if("pong"===je.type&&"probe"===je.data){if(this.upgrading=!0,this.emitReserved("upgrading",A),!A)return;T.priorWebsocketSuccess="websocket"===A.name,this.transport.pause(()=>{X||"closed"!==this.readyState&&(Jr(),this.setTransport(A),A.send([{type:"upgrade"}]),this.emitReserved("upgrade",A),A=null,this.upgrading=!1,this.flush())})}else{const xi=new Error("probe error");xi.transport=A.name,this.emitReserved("upgradeError",xi)}}))};function et(){X||(X=!0,Jr(),A.close(),A=null)}const ti=je=>{const xi=new Error("probe error: "+je);xi.transport=A.name,et(),this.emitReserved("upgradeError",xi)};function ji(){ti("transport closed")}function Rn(){ti("socket closed")}function Oi(je){A&&je.name!==A.name&&et()}const Jr=()=>{A.removeListener("open",Ie),A.removeListener("error",ti),A.removeListener("close",ji),this.off("close",Rn),this.off("upgrading",Oi)};A.once("open",Ie),A.once("error",ti),A.once("close",ji),this.once("close",Rn),this.once("upgrading",Oi),A.open()}onOpen(){if(this.readyState="open",T.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let x=0;const A=this.upgrades.length;for(;x<A;x++)this.probe(this.upgrades[x])}}onPacket(x){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",x),this.emitReserved("heartbeat"),x.type){case"open":this.onHandshake(JSON.parse(x.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const A=new Error("server error");A.code=x.data,this.onError(A);break;case"message":this.emitReserved("data",x.data),this.emitReserved("message",x.data)}}onHandshake(x){this.emitReserved("handshake",x),this.id=x.sid,this.transport.query.sid=x.sid,this.upgrades=this.filterUpgrades(x.upgrades),this.pingInterval=x.pingInterval,this.pingTimeout=x.pingTimeout,this.maxPayload=x.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const x=this.getWritablePackets();this.transport.send(x),this.prevBufferLen=x.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let A=1;for(let X=0;X<this.writeBuffer.length;X++){const Ie=this.writeBuffer[X].data;if(Ie&&(A+=ar(Ie)),X>0&&A>this.maxPayload)return this.writeBuffer.slice(0,X);A+=2}return this.writeBuffer}write(x,A,X){return this.sendPacket("message",x,A,X),this}send(x,A,X){return this.sendPacket("message",x,A,X),this}sendPacket(x,A,X,Ie){if("function"==typeof A&&(Ie=A,A=void 0),"function"==typeof X&&(Ie=X,X=null),"closing"===this.readyState||"closed"===this.readyState)return;(X=X||{}).compress=!1!==X.compress;const et={type:x,data:A,options:X};this.emitReserved("packetCreate",et),this.writeBuffer.push(et),Ie&&this.once("flush",Ie),this.flush()}close(){const x=()=>{this.onClose("forced close"),this.transport.close()},A=()=>{this.off("upgrade",A),this.off("upgradeError",A),x()},X=()=>{this.once("upgrade",A),this.once("upgradeError",A)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?X():x()}):this.upgrading?X():x()),this}onError(x){T.priorWebsocketSuccess=!1,this.emitReserved("error",x),this.onClose("transport error",x)}onClose(x,A){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",x,A),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(x){const A=[];let X=0;const Ie=x.length;for(;X<Ie;X++)~this.transports.indexOf(x[X])&&A.push(x[X]);return A}}return T.protocol=4,T})();const Yo="function"==typeof ArrayBuffer,pr=Object.prototype.toString,Ri="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===pr.call(Blob),dr="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===pr.call(File);function fr(T){return Yo&&(T instanceof ArrayBuffer||(T=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(T):T.buffer instanceof ArrayBuffer)(T))||Ri&&T instanceof Blob||dr&&T instanceof File}function pn(T,S){if(!T||"object"!=typeof T)return!1;if(Array.isArray(T)){for(let x=0,A=T.length;x<A;x++)if(pn(T[x]))return!0;return!1}if(fr(T))return!0;if(T.toJSON&&"function"==typeof T.toJSON&&1===arguments.length)return pn(T.toJSON(),!0);for(const x in T)if(Object.prototype.hasOwnProperty.call(T,x)&&pn(T[x]))return!0;return!1}function $(T){const S=[],A=T;return A.data=P(T.data,S),A.attachments=S.length,{packet:A,buffers:S}}function P(T,S){if(!T)return T;if(fr(T)){const x={_placeholder:!0,num:S.length};return S.push(T),x}if(Array.isArray(T)){const x=new Array(T.length);for(let A=0;A<T.length;A++)x[A]=P(T[A],S);return x}if("object"==typeof T&&!(T instanceof Date)){const x={};for(const A in T)Object.prototype.hasOwnProperty.call(T,A)&&(x[A]=P(T[A],S));return x}return T}function R(T,S){return T.data=q(T.data,S),T.attachments=void 0,T}function q(T,S){if(!T)return T;if(T&&!0===T._placeholder){if("number"==typeof T.num&&T.num>=0&&T.num<S.length)return S[T.num];throw new Error("illegal attachments")}if(Array.isArray(T))for(let x=0;x<T.length;x++)T[x]=q(T[x],S);else if("object"==typeof T)for(const x in T)Object.prototype.hasOwnProperty.call(T,x)&&(T[x]=q(T[x],S));return T}const Y=5;var Q=(()=>{return(T=Q||(Q={}))[T.CONNECT=0]="CONNECT",T[T.DISCONNECT=1]="DISCONNECT",T[T.EVENT=2]="EVENT",T[T.ACK=3]="ACK",T[T.CONNECT_ERROR=4]="CONNECT_ERROR",T[T.BINARY_EVENT=5]="BINARY_EVENT",T[T.BINARY_ACK=6]="BINARY_ACK",Q;var T})();class ue{constructor(S){this.replacer=S}encode(S){return S.type!==Q.EVENT&&S.type!==Q.ACK||!pn(S)?[this.encodeAsString(S)]:(S.type=S.type===Q.EVENT?Q.BINARY_EVENT:Q.BINARY_ACK,this.encodeAsBinary(S))}encodeAsString(S){let x=""+S.type;return(S.type===Q.BINARY_EVENT||S.type===Q.BINARY_ACK)&&(x+=S.attachments+"-"),S.nsp&&"/"!==S.nsp&&(x+=S.nsp+","),null!=S.id&&(x+=S.id),null!=S.data&&(x+=JSON.stringify(S.data,this.replacer)),x}encodeAsBinary(S){const x=$(S),A=this.encodeAsString(x.packet),X=x.buffers;return X.unshift(A),X}}class ce extends Gt{constructor(S){super(),this.reviver=S}add(S){let x;if("string"==typeof S){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");x=this.decodeString(S),x.type===Q.BINARY_EVENT||x.type===Q.BINARY_ACK?(this.reconstructor=new se(x),0===x.attachments&&super.emitReserved("decoded",x)):super.emitReserved("decoded",x)}else{if(!fr(S)&&!S.base64)throw new Error("Unknown type: "+S);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");x=this.reconstructor.takeBinaryData(S),x&&(this.reconstructor=null,super.emitReserved("decoded",x))}}decodeString(S){let x=0;const A={type:Number(S.charAt(0))};if(void 0===Q[A.type])throw new Error("unknown packet type "+A.type);if(A.type===Q.BINARY_EVENT||A.type===Q.BINARY_ACK){const Ie=x+1;for(;"-"!==S.charAt(++x)&&x!=S.length;);const et=S.substring(Ie,x);if(et!=Number(et)||"-"!==S.charAt(x))throw new Error("Illegal attachments");A.attachments=Number(et)}if("/"===S.charAt(x+1)){const Ie=x+1;for(;++x&&","!==S.charAt(x)&&x!==S.length;);A.nsp=S.substring(Ie,x)}else A.nsp="/";const X=S.charAt(x+1);if(""!==X&&Number(X)==X){const Ie=x+1;for(;++x;){const et=S.charAt(x);if(null==et||Number(et)!=et){--x;break}if(x===S.length)break}A.id=Number(S.substring(Ie,x+1))}if(S.charAt(++x)){const Ie=this.tryParse(S.substr(x));if(!ce.isPayloadValid(A.type,Ie))throw new Error("invalid payload");A.data=Ie}return A}tryParse(S){try{return JSON.parse(S,this.reviver)}catch{return!1}}static isPayloadValid(S,x){switch(S){case Q.CONNECT:return"object"==typeof x;case Q.DISCONNECT:return void 0===x;case Q.CONNECT_ERROR:return"string"==typeof x||"object"==typeof x;case Q.EVENT:case Q.BINARY_EVENT:return Array.isArray(x)&&x.length>0;case Q.ACK:case Q.BINARY_ACK:return Array.isArray(x)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class se{constructor(S){this.packet=S,this.buffers=[],this.reconPack=S}takeBinaryData(S){if(this.buffers.push(S),this.buffers.length===this.reconPack.attachments){const x=R(this.reconPack,this.buffers);return this.finishedReconstruction(),x}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function he(T,S,x){return T.on(S,x),function(){T.off(S,x)}}const Ae=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class qe extends Gt{constructor(S,x,A){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=S,this.nsp=x,A&&A.auth&&(this.auth=A.auth),this._opts=Object.assign({},A),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const S=this.io;this.subs=[he(S,"open",this.onopen.bind(this)),he(S,"packet",this.onpacket.bind(this)),he(S,"error",this.onerror.bind(this)),he(S,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...S){return S.unshift("message"),this.emit.apply(this,S),this}emit(S,...x){if(Ae.hasOwnProperty(S))throw new Error('"'+S.toString()+'" is a reserved event name');if(x.unshift(S),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(x),this;const A={type:Q.EVENT,data:x,options:{}};if(A.options.compress=!1!==this.flags.compress,"function"==typeof x[x.length-1]){const et=this.ids++,ti=x.pop();this._registerAckCallback(et,ti),A.id=et}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(A),this.packet(A)):this.sendBuffer.push(A)),this.flags={},this}_registerAckCallback(S,x){var A;const X=null!==(A=this.flags.timeout)&&void 0!==A?A:this._opts.ackTimeout;if(void 0===X)return void(this.acks[S]=x);const Ie=this.io.setTimeoutFn(()=>{delete this.acks[S];for(let et=0;et<this.sendBuffer.length;et++)this.sendBuffer[et].id===S&&this.sendBuffer.splice(et,1);x.call(this,new Error("operation has timed out"))},X);this.acks[S]=(...et)=>{this.io.clearTimeoutFn(Ie),x.apply(this,[null,...et])}}emitWithAck(S,...x){const A=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((X,Ie)=>{x.push((et,ti)=>A?et?Ie(et):X(ti):X(et)),this.emit(S,...x)})}_addToQueue(S){let x;"function"==typeof S[S.length-1]&&(x=S.pop());const A={id:this._queueSeq++,tryCount:0,pending:!1,args:S,flags:Object.assign({fromQueue:!0},this.flags)};S.push((X,...Ie)=>A!==this._queue[0]?void 0:(null!==X?A.tryCount>this._opts.retries&&(this._queue.shift(),x&&x(X)):(this._queue.shift(),x&&x(null,...Ie)),A.pending=!1,this._drainQueue())),this._queue.push(A),this._drainQueue()}_drainQueue(S=!1){if(!this.connected||0===this._queue.length)return;const x=this._queue[0];x.pending&&!S||(x.pending=!0,x.tryCount++,this.flags=x.flags,this.emit.apply(this,x.args))}packet(S){S.nsp=this.nsp,this.io._packet(S)}onopen(){"function"==typeof this.auth?this.auth(S=>{this._sendConnectPacket(S)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(S){this.packet({type:Q.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},S):S})}onerror(S){this.connected||this.emitReserved("connect_error",S)}onclose(S,x){this.connected=!1,delete this.id,this.emitReserved("disconnect",S,x)}onpacket(S){if(S.nsp===this.nsp)switch(S.type){case Q.CONNECT:S.data&&S.data.sid?this.onconnect(S.data.sid,S.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Q.EVENT:case Q.BINARY_EVENT:this.onevent(S);break;case Q.ACK:case Q.BINARY_ACK:this.onack(S);break;case Q.DISCONNECT:this.ondisconnect();break;case Q.CONNECT_ERROR:this.destroy();const A=new Error(S.data.message);A.data=S.data.data,this.emitReserved("connect_error",A)}}onevent(S){const x=S.data||[];null!=S.id&&x.push(this.ack(S.id)),this.connected?this.emitEvent(x):this.receiveBuffer.push(Object.freeze(x))}emitEvent(S){if(this._anyListeners&&this._anyListeners.length){const x=this._anyListeners.slice();for(const A of x)A.apply(this,S)}super.emit.apply(this,S),this._pid&&S.length&&"string"==typeof S[S.length-1]&&(this._lastOffset=S[S.length-1])}ack(S){const x=this;let A=!1;return function(...X){A||(A=!0,x.packet({type:Q.ACK,id:S,data:X}))}}onack(S){const x=this.acks[S.id];"function"==typeof x&&(x.apply(this,S.data),delete this.acks[S.id])}onconnect(S,x){this.id=S,this.recovered=x&&this._pid===x,this._pid=x,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(S=>this.emitEvent(S)),this.receiveBuffer=[],this.sendBuffer.forEach(S=>{this.notifyOutgoingListeners(S),this.packet(S)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(S=>S()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Q.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(S){return this.flags.compress=S,this}get volatile(){return this.flags.volatile=!0,this}timeout(S){return this.flags.timeout=S,this}onAny(S){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(S),this}prependAny(S){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(S),this}offAny(S){if(!this._anyListeners)return this;if(S){const x=this._anyListeners;for(let A=0;A<x.length;A++)if(S===x[A])return x.splice(A,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(S){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(S),this}prependAnyOutgoing(S){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(S),this}offAnyOutgoing(S){if(!this._anyOutgoingListeners)return this;if(S){const x=this._anyOutgoingListeners;for(let A=0;A<x.length;A++)if(S===x[A])return x.splice(A,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(S){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const x=this._anyOutgoingListeners.slice();for(const A of x)A.apply(this,S.data)}}}function Me(T){this.ms=(T=T||{}).min||100,this.max=T.max||1e4,this.factor=T.factor||2,this.jitter=T.jitter>0&&T.jitter<=1?T.jitter:0,this.attempts=0}Me.prototype.duration=function(){var T=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var S=Math.random(),x=Math.floor(S*this.jitter*T);T=0==(1&Math.floor(10*S))?T-x:T+x}return 0|Math.min(T,this.max)},Me.prototype.reset=function(){this.attempts=0},Me.prototype.setMin=function(T){this.ms=T},Me.prototype.setMax=function(T){this.max=T},Me.prototype.setJitter=function(T){this.jitter=T};class Ke extends Gt{constructor(S,x){var A;super(),this.nsps={},this.subs=[],S&&"object"==typeof S&&(x=S,S=void 0),(x=x||{}).path=x.path||"/socket.io",this.opts=x,Xi(this,x),this.reconnection(!1!==x.reconnection),this.reconnectionAttempts(x.reconnectionAttempts||1/0),this.reconnectionDelay(x.reconnectionDelay||1e3),this.reconnectionDelayMax(x.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(A=x.randomizationFactor)&&void 0!==A?A:.5),this.backoff=new Me({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(x.timeout??2e4),this._readyState="closed",this.uri=S;const X=x.parser||Ds;this.encoder=new X.Encoder,this.decoder=new X.Decoder,this._autoConnect=!1!==x.autoConnect,this._autoConnect&&this.open()}reconnection(S){return arguments.length?(this._reconnection=!!S,this):this._reconnection}reconnectionAttempts(S){return void 0===S?this._reconnectionAttempts:(this._reconnectionAttempts=S,this)}reconnectionDelay(S){var x;return void 0===S?this._reconnectionDelay:(this._reconnectionDelay=S,null===(x=this.backoff)||void 0===x||x.setMin(S),this)}randomizationFactor(S){var x;return void 0===S?this._randomizationFactor:(this._randomizationFactor=S,null===(x=this.backoff)||void 0===x||x.setJitter(S),this)}reconnectionDelayMax(S){var x;return void 0===S?this._reconnectionDelayMax:(this._reconnectionDelayMax=S,null===(x=this.backoff)||void 0===x||x.setMax(S),this)}timeout(S){return arguments.length?(this._timeout=S,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(S){if(~this._readyState.indexOf("open"))return this;this.engine=new hr(this.uri,this.opts);const x=this.engine,A=this;this._readyState="opening",this.skipReconnect=!1;const X=he(x,"open",function(){A.onopen(),S&&S()}),Ie=he(x,"error",et=>{A.cleanup(),A._readyState="closed",this.emitReserved("error",et),S?S(et):A.maybeReconnectOnOpen()});if(!1!==this._timeout){const et=this._timeout;0===et&&X();const ti=this.setTimeoutFn(()=>{X(),x.close(),x.emit("error",new Error("timeout"))},et);this.opts.autoUnref&&ti.unref(),this.subs.push(function(){clearTimeout(ti)})}return this.subs.push(X),this.subs.push(Ie),this}connect(S){return this.open(S)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const S=this.engine;this.subs.push(he(S,"ping",this.onping.bind(this)),he(S,"data",this.ondata.bind(this)),he(S,"error",this.onerror.bind(this)),he(S,"close",this.onclose.bind(this)),he(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(S){try{this.decoder.add(S)}catch(x){this.onclose("parse error",x)}}ondecoded(S){Dr(()=>{this.emitReserved("packet",S)},this.setTimeoutFn)}onerror(S){this.emitReserved("error",S)}socket(S,x){let A=this.nsps[S];return A?this._autoConnect&&!A.active&&A.connect():(A=new qe(this,S,x),this.nsps[S]=A),A}_destroy(S){const x=Object.keys(this.nsps);for(const A of x)if(this.nsps[A].active)return;this._close()}_packet(S){const x=this.encoder.encode(S);for(let A=0;A<x.length;A++)this.engine.write(x[A],S.options)}cleanup(){this.subs.forEach(S=>S()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(S,x){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",S,x),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const S=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const x=this.backoff.duration();this._reconnecting=!0;const A=this.setTimeoutFn(()=>{S.skipReconnect||(this.emitReserved("reconnect_attempt",S.backoff.attempts),!S.skipReconnect&&S.open(X=>{X?(S._reconnecting=!1,S.reconnect(),this.emitReserved("reconnect_error",X)):S.onreconnect()}))},x);this.opts.autoUnref&&A.unref(),this.subs.push(function(){clearTimeout(A)})}}onreconnect(){const S=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",S)}}const He={};function Je(T,S){"object"==typeof T&&(S=T,T=void 0);const x=function Rr(T,S="",x){let A=T;x=x||typeof location<"u"&&location,null==T&&(T=x.protocol+"//"+x.host),"string"==typeof T&&("/"===T.charAt(0)&&(T="/"===T.charAt(1)?x.protocol+T:x.host+T),/^(https?|wss?):\/\//.test(T)||(T=typeof x<"u"?x.protocol+"//"+T:"https://"+T),A=Gn(T)),A.port||(/^(http|ws)$/.test(A.protocol)?A.port="80":/^(http|ws)s$/.test(A.protocol)&&(A.port="443")),A.path=A.path||"/";const Ie=-1!==A.host.indexOf(":")?"["+A.host+"]":A.host;return A.id=A.protocol+"://"+Ie+":"+A.port+S,A.href=A.protocol+"://"+Ie+(x&&x.port===A.port?"":":"+A.port),A}(T,(S=S||{}).path||"/socket.io"),A=x.source,X=x.id;let ji;return S.forceNew||S["force new connection"]||!1===S.multiplex||He[X]&&x.path in He[X].nsps?ji=new Ke(A,S):(He[X]||(He[X]=new Ke(A,S)),ji=He[X]),x.query&&!S.query&&(S.query=x.queryKey),ji.socket(x.path,S)}Object.assign(Je,{Manager:Ke,Socket:qe,io:Je,connect:Je});var Qe=Bt(2340);const pt=Qe.N.url_socket;let Tt=(()=>{class T{constructor(){this.socketStatus=!1,this.socket=Je(pt),this.checkStatus()}listen(x){return this.newMessage?.complete(),this.newMessage=new rn.x,console.log(x),this.socket.on(x,A=>{console.log(A),this.newMessage.next(A)}),this.newMessage.asObservable()}checkStatus(){this.socket.on("connect",()=>{this.socketStatus=!0}),this.socket.on("disconnect",()=>{this.socketStatus=!1})}emit(x,A,X){console.log("emitiendo",x),this.socket.emit(x,A,X)}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();var it=Bt(6526),Mt=Bt(8134);const Dt=["header"],Xn=["menuIcon"],Pn=["navLinks"],ve=function(){return["/home"]},Ci=function(){return["active"]},oi=function(){return["eventos"]},Wn=function(){return["cursos"]},Ca=function(){return["especialistas"]},dn=function(){return["nosotros"]},Or=function(){return["donde"]},Aa=function(){return["contacto"]},Fr=function(){return["/auth"]};let Ve=(()=>{class T{constructor(x){this.route=x,this.instagram={nombre:"",enlace:"https://www.instagram.com/nativostierra_/",icono:"../../../assets/images/icons-svg/instagram.svg"},this.facebook={nombre:"",enlace:"https://www.facebook.com/100089059505165",icono:"../../../assets/images/icons-svg/facebook.svg"},this.youtube={nombre:"",enlace:"https://www.youtube.com/channel/UCMzJ0PPoQhcKkNZvnyBc3gA",icono:"../../../assets/images/icons-svg/youtube.svg"}}ngOnInit(){}menuIconClick(){this.navLinks.nativeElement.classList.toggle("menu-active"),document.querySelectorAll(".nav-links li").forEach(A=>{A.classList.toggle("liMostrado")}),this.menuIcon.nativeElement.classList.toggle("span-anime")}scroll(){this.navLinks.nativeElement.classList.toggle("menu-active"),this.menuIcon.nativeElement.classList.toggle("span-anime"),window.scrollTo(0,0)}irANewsletter(){this.route.navigate(["/newsletter"])}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(a.F0))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-header-responsive"]],viewQuery:function(x,A){if(1&x&&(h.Gf(Dt,5),h.Gf(Xn,5),h.Gf(Pn,5)),2&x){let X;h.iGM(X=h.CRH())&&(A.header=X.first),h.iGM(X=h.CRH())&&(A.menuIcon=X.first),h.iGM(X=h.CRH())&&(A.navLinks=X.first)}},decls:54,vars:38,consts:[[1,"fila"],[1,"columna"],[1,"logo-header"],["src","./../../../../assets/images/logo/logo.svg","alt","Nativos tierra"],[1,"menu-icon",3,"click"],["menuIcon",""],[1,"columa","jStart"],[1,"fila","aCenter"],[1,"title-xxl-accent","color-accent"],[1,"columna","jEnd"],["id","social",1,"fila","gap-10"],[3,"redSocial"],[1,"boton","btn-info","news",3,"click"],[1,"sub-title-xxl","color-accent"],["id","social-movil",1,"fila","jEnd","gap-10"],[1,"nav-links"],["navLinks",""],[1,"option-menu",3,"routerLink","routerLinkActive","click"]],template:function(x,A){1&x&&(h.TgZ(0,"header",0)(1,"div",1)(2,"div",2),h._UZ(3,"img",3),h.qZA(),h.TgZ(4,"div",4,5),h.NdJ("click",function(){return A.menuIconClick()}),h._UZ(6,"span")(7,"span")(8,"span"),h.qZA()(),h.TgZ(9,"div",6)(10,"div",7)(11,"h1",8),h._uU(12,"Nativos tierra"),h.qZA(),h.TgZ(13,"div",9)(14,"div",10),h._UZ(15,"app-red-social",11)(16,"app-red-social",11)(17,"app-red-social",11),h.qZA(),h.TgZ(18,"button",12),h.NdJ("click",function(){return A.irANewsletter()}),h._uU(19,"Suscr\xedbete a nuestra newsletter"),h.qZA()()(),h.TgZ(20,"div",0)(21,"h2",13),h._uU(22," Comunidad de especialistas, eventos y cursos "),h.qZA(),h.TgZ(23,"div",14),h._UZ(24,"app-red-social",11)(25,"app-red-social",11)(26,"app-red-social",11),h.qZA()(),h.TgZ(27,"nav")(28,"ul",15,16)(30,"li")(31,"a",17),h.NdJ("click",function(){return A.scroll()}),h._uU(32,"Inicio"),h.qZA()(),h.TgZ(33,"li")(34,"a",17),h.NdJ("click",function(){return A.scroll()}),h._uU(35,"Eventos"),h.qZA()(),h.TgZ(36,"li")(37,"a",17),h.NdJ("click",function(){return A.scroll()}),h._uU(38,"Cursos"),h.qZA()(),h.TgZ(39,"li")(40,"a",17),h.NdJ("click",function(){return A.scroll()}),h._uU(41,"Especialistas"),h.qZA()(),h.TgZ(42,"li")(43,"a",17),h.NdJ("click",function(){return A.scroll()}),h._uU(44,"Nosotros"),h.qZA()(),h.TgZ(45,"li")(46,"a",17),h.NdJ("click",function(){return A.scroll()}),h._uU(47,"Donde estamos"),h.qZA()(),h.TgZ(48,"li")(49,"a",17),h.NdJ("click",function(){return A.scroll()}),h._uU(50,"Contacto"),h.qZA()(),h.TgZ(51,"li")(52,"a",17),h.NdJ("click",function(){return A.scroll()}),h._uU(53,"Zona especialistas"),h.qZA()()()()()()),2&x&&(h.xp6(15),h.Q6J("redSocial",A.instagram),h.xp6(1),h.Q6J("redSocial",A.facebook),h.xp6(1),h.Q6J("redSocial",A.youtube),h.xp6(7),h.Q6J("redSocial",A.instagram),h.xp6(1),h.Q6J("redSocial",A.facebook),h.xp6(1),h.Q6J("redSocial",A.youtube),h.xp6(5),h.Q6J("routerLink",h.DdM(22,ve))("routerLinkActive",h.DdM(23,Ci)),h.xp6(3),h.Q6J("routerLink",h.DdM(24,oi))("routerLinkActive",h.DdM(25,Ci)),h.xp6(3),h.Q6J("routerLink",h.DdM(26,Wn))("routerLinkActive",h.DdM(27,Ci)),h.xp6(3),h.Q6J("routerLink",h.DdM(28,Ca))("routerLinkActive",h.DdM(29,Ci)),h.xp6(3),h.Q6J("routerLink",h.DdM(30,dn))("routerLinkActive",h.DdM(31,Ci)),h.xp6(3),h.Q6J("routerLink",h.DdM(32,Or))("routerLinkActive",h.DdM(33,Ci)),h.xp6(3),h.Q6J("routerLink",h.DdM(34,Aa))("routerLinkActive",h.DdM(35,Ci)),h.xp6(3),h.Q6J("routerLink",h.DdM(36,Fr))("routerLinkActive",h.DdM(37,Ci)))},dependencies:[a.yS,a.Od,Mt.g]}),T})(),dt=(()=>{class T{constructor(x,A){this.ccService=x,this.sck=A}ngOnInit(){this.popupOpenSubscription=this.ccService.popupOpen$.subscribe(()=>{}),this.popupCloseSubscription=this.ccService.popupClose$.subscribe(()=>{}),this.initializingSubscription=this.ccService.initializing$.subscribe(x=>{console.log(`initializing: ${JSON.stringify(x)}`)}),this.initializedSubscription=this.ccService.initialized$.subscribe(()=>{console.log(`initialized: ${JSON.stringify(event)}`)}),this.initializationErrorSubscription=this.ccService.initializationError$.subscribe(x=>{console.log(`initializationError: ${JSON.stringify(x.error?.message)}`)}),this.statusChangeSubscription=this.ccService.statusChange$.subscribe(x=>{}),this.revokeChoiceSubscription=this.ccService.revokeChoice$.subscribe(()=>{}),this.noCookieLawSubscription=this.ccService.noCookieLaw$.subscribe(x=>{})}ngOnDestroy(){this.popupOpenSubscription.unsubscribe(),this.popupCloseSubscription.unsubscribe(),this.initializingSubscription.unsubscribe(),this.initializedSubscription.unsubscribe(),this.initializationErrorSubscription.unsubscribe(),this.statusChangeSubscription.unsubscribe(),this.revokeChoiceSubscription.unsubscribe(),this.noCookieLawSubscription.unsubscribe()}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Cn.ZC),h.Y36(Tt))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-dashboard"]],decls:4,vars:0,consts:[[1,"content"]],template:function(x,A){1&x&&(h._UZ(0,"app-header-responsive"),h.TgZ(1,"main",0),h._UZ(2,"router-outlet"),h.qZA(),h._UZ(3,"app-footer"))},dependencies:[it.c,Ve,a.lC]}),T})();class fn{constructor(S,x,A,X,Ie){this.evento=S,this.fecha=x,this.precio=A,this.organizador=X,this.descripcion=Ie}}var Ii=Bt(529);let gt=(()=>{class T{constructor(x){this.http=x,this.eventos_especialista=[]}getEventos(){return this.http.get("./../../assets/data/eventosEsoterismo.json")}getEventosAlernativo(){return this.http.get("./../../assets/data/eventos-loalternativo.json")}setEventosEspecialistaRegistro(x){this.eventos_especialista=[]}setEventosEspecialistaLogin(x){this.eventos_especialista=[]}agregarEvento(x){this.eventos_especialista.push(x)}eliminarEvento(x){const A=this.eventos_especialista.findIndex(X=>{});this.eventos_especialista.splice(A,1)}setEvento(x,A){let X=new fn(x.evento,x.fecha,x.precio,A,x.descripcion);X.codigo_postal=x.cp,X.direccion=x.direccion,X.email=x.email,X.id=this.eventos_especialista.length+1,X.imagen=x.img,X.online=x.online,X.localidad=x.poblacion,X.pdf=X.pdf,X.provincia=x.provincia,X.telefono=x.telefono,X.web=x.web,this.agregarEvento(X)}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();var Ji=Bt(7638);const Ur=Qe.N.base_url;let Zr=(()=>{class T{constructor(x){this.http=x}getSponsors(){return this.http.get(`${Ur}/sponsors/sponsors/2`)}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})(),Vi=(()=>{class T{constructor(){this.sponsor={id:0,mombre:"",imagen:"",url:""},this.clase=""}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-sponsor"]],inputs:{sponsor:"sponsor",clase:"clase"},decls:3,vars:2,consts:[[1,"wrp-imagen-sponsor"],["target","_blank",3,"href"],["alt","",3,"src"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"a",1),h._UZ(2,"img",2),h.qZA()()),2&x&&(h.xp6(1),h.s9C("href",A.sponsor.url,h.LSH),h.xp6(1),h.s9C("src",A.sponsor.imagen,h.LSH))},styles:[".wrp-imagen-sponsor[_ngcontent-%COMP%]{max-width:250px}@media (max-width: 800px){.wrp-imagen-sponsor[_ngcontent-%COMP%]{max-width:100px}}.wrp-imagen-sponsor[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;object-fit:contain;overflow:hidden;object-fit:cover}.wrp-imagen-sponsor-ppal[_ngcontent-%COMP%]{max-width:400px}@media (max-width: 1440px){.wrp-imagen-sponsor-ppal[_ngcontent-%COMP%]{max-width:300px}}.wrp-imagen-sponsor-ppal[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;object-fit:contain;overflow:hidden;object-fit:cover}"]}),T})();function Nt(T,S){if(1&T&&(h.ynx(0),h._UZ(1,"app-sponsor",4),h.BQk()),2&T){const x=S.$implicit;h.xp6(1),h.Q6J("sponsor",x)}}let kl=(()=>{class T{constructor(x,A,X){this.http=x,this.renderer=A,this.sponsorsService=X,this.sponsors=[]}ngOnDestroy(){}ngAfterViewInit(){}ngOnInit(){this.sponsorsService.getSponsors().subscribe(x=>{this.sponsors=x.sponsors,console.log()})}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Ii.eN),h.Y36(h.Qsj),h.Y36(Zr))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-banner-publicidad"]],decls:6,vars:1,consts:[[1,"title-xl-primary","color-accent","pad-20","center"],[1,"encabezado","color-accent"],[1,"fila","gap-20"],[4,"ngFor","ngForOf"],[3,"sponsor"]],template:function(x,A){1&x&&(h.TgZ(0,"h3",0),h._uU(1,"Colaboradores de Nativos tierra"),h.qZA(),h.TgZ(2,"p",1),h._uU(3,"Forma parte de nuestra Comunidad de Patrocinadores con tu imagen de empresa y ayudanos a crecer juntos."),h.qZA(),h.TgZ(4,"div",2),h.YNc(5,Nt,2,1,"ng-container",3),h.qZA()),2&x&&(h.xp6(5),h.Q6J("ngForOf",A.sponsors))},dependencies:[zt.sg,Vi]}),T})();var Se=Bt(433),Qo=Bt(5226),$t=Bt.n(Qo);const Ls=Qe.N.base_url;let bo=(()=>{class T{constructor(x){this.http=x}startEventoCheckoutSession(x,A){let X=this.buildCallbackUrl();return console.log(X),this.http.post(`${Ls}/checkout/`,{eventoId:x,clienteId:A,callbackUrl:X})}buildCallbackUrl(){const x=window.location.protocol,A=window.location.hostname,X=window.location.port;let Ie=`${x}//${A}`;return X&&(Ie+=":"+X),Ie+"/stripe-checkout"}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();const Ko=Qe.N.base_url;let wo=(()=>{class T{constructor(x){this.http=x}darAltaCliente(x){return this.http.post(`${Ko}/clientes`,x)}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();const To=function(){return["/privacidad"]};let mn=(()=>{class T{constructor(){}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-proteccion-datos-personales"]],decls:8,vars:2,consts:[[1,"columna"],[1,"option-menu","color-accent"],[1,"caption","color-accent"],["target","_blank",3,"routerLink"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h5",1),h._uU(2,"PROTECCI\xd3N DE DATOS PERSONALES:"),h.qZA(),h.TgZ(3,"p",2),h._uU(4," La entidad responsable del tratamiento de sus datos es D. David Jesus Molina Retuerto -NATIVOS TIERRRA. Los datos se tratar\xe1n para atender su solicitud, consulta o petici\xf3n. En las condiciones legales, tiene derecho a acceder, rectificar y suprimir los datos, a la limitaci\xf3n de su tratamiento, a oponerse al mismo y a su portabilidad. Puede ampliar la informaci\xf3n sobre el tratamiento de sus datos personales consultando nuestra "),h.TgZ(5,"a",3),h._uU(6,"Pol\xedtica de Privacidad"),h.qZA(),h._uU(7,". "),h.qZA()()),2&x&&(h.xp6(5),h.Q6J("routerLink",h.DdM(1,To)))},dependencies:[a.yS]}),T})(),fi=(()=>{class T{constructor(){}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-info-modal"]],inputs:{info:"info"},decls:8,vars:3,consts:[[1,"columna","gap-10"],[1,"fila","gap-20"],[1,"encabezado","color-accent"],["alt","",3,"src"],[1,"texto-regular","color-accent"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"div",1)(2,"span",2),h._uU(3),h.qZA(),h.TgZ(4,"span"),h._UZ(5,"img",3),h.qZA()(),h.TgZ(6,"span",4),h._uU(7),h.qZA()()),2&x&&(h.xp6(3),h.Oqu(A.info.title),h.xp6(2),h.s9C("src",A.info.icono,h.LSH),h.xp6(2),h.Oqu(A.info.info))},styles:[".fila[_ngcontent-%COMP%]{align-items:baseline}span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px;height:24px}@media (max-width: 730px){span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:16px;height:16px}}"]}),T})();function ri(T,S){if(1&T&&(h.TgZ(0,"span",5),h._uU(1),h.qZA()),2&T){const x=h.oxw();h.xp6(1),h.Oqu(x.infoDireccion.pais)}}let Eo=(()=>{class T{constructor(){}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-info-direccion-modal"]],inputs:{infoDireccion:"infoDireccion"},decls:16,vars:7,consts:[[1,"columna","gap-10"],[1,"fila","gap-10"],[1,"encabezado","color-accent"],[1,"accent-color"],["alt","",3,"src"],[1,"texto-regular","color-accent"],["class","texto-regular color-accent",4,"ngIf"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"div",1)(2,"span",2),h._uU(3),h.qZA(),h.TgZ(4,"span",3),h._UZ(5,"img",4),h.qZA()(),h.TgZ(6,"span",5),h._uU(7),h.qZA(),h.TgZ(8,"span",5),h._uU(9),h.qZA(),h.TgZ(10,"div",1)(11,"span",5),h._uU(12),h.qZA(),h.TgZ(13,"span",5),h._uU(14),h.qZA(),h.YNc(15,ri,2,1,"span",6),h.qZA()()),2&x&&(h.xp6(3),h.Oqu(A.infoDireccion.title),h.xp6(2),h.s9C("src",A.infoDireccion.icono,h.LSH),h.xp6(2),h.Oqu(A.infoDireccion.direccion),h.xp6(2),h.Oqu(A.infoDireccion.localidad),h.xp6(3),h.Oqu(A.infoDireccion.codigo_postal),h.xp6(2),h.Oqu(A.infoDireccion.provincia),h.xp6(1),h.Q6J("ngIf",A.infoDireccion.pais))},dependencies:[zt.O5],styles:[".fila[_ngcontent-%COMP%]{align-items:baseline}.fila[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px;height:24px}@media (max-width: 730px){.fila[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:16px;height:16px}}"]}),T})(),es=(()=>{class T{constructor(){}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-info-modal-enlace"]],inputs:{info:"info"},decls:9,vars:4,consts:[[1,"columna","gap-10"],[1,"fila","gap-20"],[1,"encabezado","color-accent"],["alt","",3,"src"],[1,"texto-regular","color-accent"],["target","_blank",3,"href"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"div",1)(2,"span",2),h._uU(3),h.qZA(),h.TgZ(4,"span"),h._UZ(5,"img",3),h.qZA()(),h.TgZ(6,"span",4)(7,"a",5),h._uU(8),h.qZA()()()),2&x&&(h.xp6(3),h.Oqu(A.info.title),h.xp6(2),h.s9C("src",A.info.icono,h.LSH),h.xp6(2),h.s9C("href",A.info.info,h.LSH),h.xp6(1),h.Oqu(A.info.info))},styles:["a[_ngcontent-%COMP%]{color:#525020}span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px;height:24px}@media (max-width: 730px){span[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:16px;height:16px}}"]}),T})();function Mi(T,S){1&T&&(h.TgZ(0,"span",10),h._uU(1,"No es un email v\xe1lido"),h.qZA())}let Bi=(()=>{class T{constructor(x,A){this.serviceModalEventoService=x,this.fb=A,this.close=new h.vpe,this.submitted=!1,this.formEmail=this.fb.group({email:["",[Se.kI.required,Se.kI.email]]})}ngOnInit(){}get email(){return this.formEmail.get("email")?.invalid||!1}onSubmit(){if(this.submitted=!0,!this.formEmail.valid)return;const x=this.formEmail.get("email")?.value?.trim()||"";this.close.emit({ok:!0,mail:x})}cancelar(){this.submitted=!1,this.close.emit({ok:!0,mail:""})}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Ji.Y),h.Y36(Se.qu))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-modal-email"]],outputs:{close:"close"},decls:15,vars:2,consts:[[1,"wrapper-modal-email"],[1,"option-menu","color-accent"],[3,"formGroup","ngSubmit","reset"],[1,"columna","gap-10"],["for","email",1,"encabezado","color-accent"],["type","email","name","email","id","","formControlName","email","placeholder","tuemail@email.es"],["class","caption color-red",4,"ngIf"],[1,"fila","gap-20","end"],["type","submit",1,"boton","btn-login"],["type","reset",1,"boton","btn-cancelar"],[1,"caption","color-red"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h4",1),h._uU(2,"D\xe9janos tu email para descargar la revista"),h.qZA(),h.TgZ(3,"form",2),h.NdJ("ngSubmit",function(){return A.onSubmit()})("reset",function(){return A.cancelar()}),h.TgZ(4,"div",3)(5,"label",4),h._uU(6,"Email:"),h.qZA(),h.TgZ(7,"div",3),h._UZ(8,"input",5),h.YNc(9,Mi,2,0,"span",6),h.qZA()(),h.TgZ(10,"div",7)(11,"button",8),h._uU(12,"Enviar"),h.qZA(),h.TgZ(13,"button",9),h._uU(14,"Cancelar"),h.qZA()()()()),2&x&&(h.xp6(3),h.Q6J("formGroup",A.formEmail),h.xp6(6),h.Q6J("ngIf",A.email&&A.submitted))},dependencies:[zt.O5,Se._Y,Se.Fj,Se.JJ,Se.JL,Se.sg,Se.u],styles:[".wrapper-modal-email[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;position:absolute;inset:0;margin:auto;width:40%;height:32%;background-color:#ccc;border-radius:4px;border-color:2px solid black;padding:20px;gap:20px}@media (max-width: 1080px){.wrapper-modal-email[_ngcontent-%COMP%]{width:80%;height:30%}}@media (max-width: 375px){.wrapper-modal-email[_ngcontent-%COMP%]{width:95%;height:30%}}.columna[_ngcontent-%COMP%]{width:100%}form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:20px}form[_ngcontent-%COMP%]   .fila[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}.fila[_ngcontent-%COMP%]{justify-content:end}input[_ngcontent-%COMP%]{width:100%}"]}),T})(),Sa=(()=>{class T{transform(x,A,...X){return 0===x?"Gratis":2===A?x+" $":x+" \u20ac"}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275pipe=h.Yjl({name:"euros",type:T,pure:!0}),T})();var mr=Bt(1481);let ei=(()=>{class T{constructor(x){this.sanitizer=x}transform(x,A){let X=x;return(""===x||null==x)&&(X=A?"./../../../../assets/images/especialista_no_disponible.svg":"./../../../../assets/images/evento_no_disponible.svg"),this.sanitizer.bypassSecurityTrustResourceUrl(X)}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(mr.H7,16))},T.\u0275pipe=h.Yjl({name:"noImage",type:T,pure:!0}),T})();function Co(T,S){1&T&&(h.TgZ(0,"span",7),h._uU(1,"Online"),h.qZA())}function Rs(T,S){if(1&T&&(h.TgZ(0,"a",25),h._uU(1,"Info descargable"),h.qZA()),2&T){const x=h.oxw();h.Q6J("href",x.enlacePDF,h.LSH)}}function Ao(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1," Requerido y no mayor de 25 caracteres "),h.qZA())}function yi(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1," Requerido y no mayor de 15 caracteres "),h.qZA())}function Bs(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1,"Introduzca su tel\xe9fono"),h.qZA())}function Os(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1,"Introduzca su email"),h.qZA())}function _n(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1," Direcci\xf3n demasiado larga"),h.qZA())}function Hn(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1," Poblaci\xf3n demasiado larga"),h.qZA())}function ts(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1,"Introduzca una provincia"),h.qZA())}function zl(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1," C\xf3digo postal demasiado largo"),h.qZA())}function Fs(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1,"Introduzca su pais"),h.qZA())}function Nr(T,S){1&T&&(h.TgZ(0,"span",66),h._uU(1,"Debe aceptar la pol\xedtica de privacidad "),h.qZA())}function Pl(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"div",26)(1,"form",27)(2,"h3",28),h._uU(3,"Informaci\xf3n requerida"),h.qZA(),h.TgZ(4,"div",29)(5,"div",30)(6,"label",31),h._uU(7,"Apellidos:"),h.qZA(),h.TgZ(8,"div",32),h._UZ(9,"input",33),h.YNc(10,Ao,2,0,"span",34),h.qZA()(),h.TgZ(11,"div",35)(12,"label",36),h._uU(13,"Nombre:"),h.qZA(),h.TgZ(14,"div",32),h._UZ(15,"input",37),h.YNc(16,yi,2,0,"span",34),h.qZA()(),h.TgZ(17,"div",38)(18,"label",39),h._uU(19,"Tel\xe9fono:"),h.qZA(),h.TgZ(20,"div",32),h._UZ(21,"input",40),h.YNc(22,Bs,2,0,"span",34),h.qZA()(),h.TgZ(23,"div",41)(24,"label",42),h._uU(25,"Email:"),h.qZA(),h.TgZ(26,"div",32),h._UZ(27,"input",43),h.YNc(28,Os,2,0,"span",34),h.qZA()(),h.TgZ(29,"div",44)(30,"label",45),h._uU(31,"Direcci\xf3n:"),h.qZA(),h.TgZ(32,"div",32),h._UZ(33,"input",46),h.YNc(34,_n,2,0,"span",34),h.qZA()(),h.TgZ(35,"div",47)(36,"label",48),h._uU(37,"Poblaci\xf3n:"),h.qZA(),h.TgZ(38,"div",32),h._UZ(39,"input",49),h.YNc(40,Hn,2,0,"span",34),h.qZA()(),h.TgZ(41,"div",50)(42,"label",51),h._uU(43,"Provincia:"),h.qZA(),h.TgZ(44,"div",32),h._UZ(45,"input",52),h.YNc(46,ts,2,0,"span",34),h.qZA()(),h.TgZ(47,"div",53)(48,"label",54),h._uU(49,"C.P.:"),h.qZA(),h.TgZ(50,"div",32),h._UZ(51,"input",55),h.YNc(52,zl,2,0,"span",34),h.qZA()(),h.TgZ(53,"div",56)(54,"label",57),h._uU(55,"Pa\xeds:"),h.qZA(),h.TgZ(56,"div",32),h._UZ(57,"input",58),h.YNc(58,Fs,2,0,"span",34),h.qZA()()(),h.TgZ(59,"div",12)(60,"div",11),h._UZ(61,"app-proteccion-datos-personales"),h.TgZ(62,"label",59),h._UZ(63,"input",60),h._uU(64," He le\xeddo y acepto la informaci\xf3n sobre el tratamiento de datos personales "),h.qZA(),h.YNc(65,Nr,2,0,"span",34),h.TgZ(66,"label",61),h._UZ(67,"input",62),h._uU(68," Marque si desea recibir informaci\xf3n comercial de nuestros productos o servicios. "),h.qZA()()(),h.TgZ(69,"div",63)(70,"button",64),h.NdJ("click",function(){h.CHM(x);const X=h.oxw();return h.KtG(X.enviarDatosCompra())}),h._uU(71,"Comprar"),h.qZA(),h.TgZ(72,"button",65),h.NdJ("click",function(){h.CHM(x);const X=h.oxw();return h.KtG(X.onReset())}),h._uU(73,"Cancelar"),h.qZA()()()()}if(2&T){const x=h.oxw();h.xp6(1),h.Q6J("formGroup",x.formCompra),h.xp6(9),h.Q6J("ngIf",x.submitted&&x.campoNoValido("apellidos")),h.xp6(6),h.Q6J("ngIf",x.submitted&&x.campoNoValido("nombre")),h.xp6(6),h.Q6J("ngIf",x.submitted&&x.campoNoValido("telefono")),h.xp6(6),h.Q6J("ngIf",x.submitted&&x.campoNoValido("email")),h.xp6(6),h.Q6J("ngIf",x.submitted&&x.campoNoValido("direccion")),h.xp6(6),h.Q6J("ngIf",x.submitted&&x.campoNoValido("poblacion")),h.xp6(6),h.Q6J("ngIf",x.submitted&&x.campoNoValido("provincia")),h.xp6(6),h.Q6J("ngIf",x.submitted&&x.campoNoValido("codigo_postal")),h.xp6(6),h.Q6J("ngIf",x.submitted&&x.campoNoValido("pais")),h.xp6(7),h.Q6J("ngIf",x.campoNoValido("privacidad")&&x.submitted),h.xp6(5),h.Q6J("disabled",x.compraIniciada)}}function Ia(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"app-modal-email",67),h.NdJ("close",function(X){h.CHM(x);const Ie=h.oxw();return h.KtG(Ie.cerrarModalEmail(X))}),h.qZA()}}let Jn=(()=>{class T{constructor(x,A,X,Ie,et){this.serviceModalEventoService=x,this.router=A,this.fb=X,this.checkoutService=Ie,this.clientesService=et,this.twitter={nombre:"",enlace:"",icono:""},this.instagram={nombre:"",enlace:"",icono:""},this.facebook={nombre:"",enlace:"",icono:""},this.youtube={nombre:"",enlace:"",icono:""},this.twitch={nombre:"",enlace:"",icono:""},this.mostrarModalEmail=!1,this.revista=!1,this.enlacePDF="",this.enCompra=!1,this.formCompra=this.fb.group({nombre:["Manuel",[Se.kI.required,Se.kI.maxLength(30)]],apellidos:["Fernandez",[Se.kI.required,Se.kI.maxLength(80)]],direccion:["Avda. Arquitecto Luis Bono, 7",[Se.kI.maxLength(50)]],provincia:["M\xe1laga",[Se.kI.required,Se.kI.maxLength(50)]],poblacion:["M\xe1laga",[Se.kI.maxLength(50)]],codigo_postal:["29190",[Se.kI.maxLength(6)]],pais:["Espa\xf1a",[Se.kI.required,Se.kI.maxLength(30)]],telefono:["677230977",[Se.kI.required,Se.kI.maxLength(20)]],email:["manuel_fe1977@hotmail.com",[Se.kI.required,Se.kI.email]],privacidad:[!1,Se.kI.requiredTrue],aceptaComercial:[!1]}),this.submitted=!1,this.compraIniciada=!1}ngOnInit(){this.enlacePDF=this.evento.pdf,this.direccion={title:"Ubicacion",direccion:this.evento.direccion,localidad:this.evento.localidad,provincia:this.evento.provincia,codigo_postal:this.evento.codigo_postal,pais:this.evento.pais,icono:"../../assets/images/icons-svg/location-pin-solid.svg"},this.infoTelefono={title:"Telefono",info:this.evento.telefono,icono:"../../assets/images/icons-svg/mobile-solid.svg"},this.infoMail={title:"Email",info:this.evento.email,icono:"../../assets/images/icons-svg/envelope-regular.svg"},this.infoWeb={title:"Web",info:this.evento.web,icono:"../../assets/images/icons-svg/globe-solid.svg"},this.twitter={nombre:"",enlace:this.evento.twitter,icono:"../../assets/images/icons-svg/twitter.svg"},this.instagram={nombre:"",enlace:this.evento.instagram,icono:"../../assets/images/icons-svg/instagram.svg"},this.facebook={nombre:"",enlace:this.evento.facebook,icono:"../../assets/images/icons-svg/facebook.svg"},this.youtube={nombre:"",enlace:this.evento.you_tube,icono:"../../assets/images/icons-svg/youtube.svg"},this.twitch={nombre:"",enlace:this.evento.twich,icono:"../../assets/images/icons-svg/twitch.svg"},this.formCompra=this.fb.group({nombre:["Manuel",[Se.kI.required,Se.kI.maxLength(30)]],apellidos:["Fernandez",[Se.kI.required,Se.kI.maxLength(80)]],direccion:["Avda. Arquitecto Luis Bono, 7",[Se.kI.maxLength(50)]],provincia:["M\xe1laga",[Se.kI.required,Se.kI.maxLength(50)]],poblacion:["M\xe1laga",[Se.kI.maxLength(50)]],codigo_postal:["29190",[Se.kI.maxLength(6)]],pais:["Espa\xf1a",[Se.kI.required,Se.kI.maxLength(30)]],telefono:["677230977",[Se.kI.required,Se.kI.maxLength(20)]],email:["manuel_fe1977@hotmail.com",[Se.kI.required,Se.kI.email]],privacidad:[!1,Se.kI.requiredTrue],aceptaComercial:[!1]})}cerrarModal(){this.serviceModalEventoService.closeDialog()}descargarContenido(){""===this.evento.id&&(this.mostrarModalEmail=!0)}cerrarModalEmail(x){this.mostrarModalEmail=!1,""!=x.mail&&(this.cerrarModal(),this.router.navigate(["revistas"]))}campoNoValido(x){return this.submitted&&this.formCompra.get(x).invalid}comprar(){this.enCompra=!0}onReset(){this.compraIniciada=!1,this.formCompra.reset(),this.enCompra=!1}enviarDatosCompra(){this.submitted=!0,this.formCompra.valid&&(this.compraIniciada=!0,console.log(this.formCompra.value),this.clientesService.darAltaCliente(this.formCompra.value).subscribe(x=>{console.log(x),this.checkoutService.startEventoCheckoutSession(this.evento.id,x.id).subscribe(X=>{console.log("stripe sesion iniciada"),window.open(X.url,"blank"),this.formCompra.reset()},X=>{console.log("Error en la sesion de stripe"),this.compraIniciada=!1})},x=>{console.log(x),$t().fire("Error",x.msg,"error")}))}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Ji.Y),h.Y36(a.F0),h.Y36(Se.qu),h.Y36(bo),h.Y36(wo))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-modal-evento"]],inputs:{evento:"evento"},decls:49,vars:32,consts:[[1,"overlay"],[1,"cerrar-modal",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 512 512"],["d","M175 175C184.4 165.7 199.6 165.7 208.1 175L255.1 222.1L303 175C312.4 165.7 327.6 165.7 336.1 175C346.3 184.4 346.3 199.6 336.1 208.1L289.9 255.1L336.1 303C346.3 312.4 346.3 327.6 336.1 336.1C327.6 346.3 312.4 346.3 303 336.1L255.1 289.9L208.1 336.1C199.6 346.3 184.4 346.3 175 336.1C165.7 327.6 165.7 312.4 175 303L222.1 255.1L175 208.1C165.7 199.6 165.7 184.4 175 175V175zM512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256zM256 48C141.1 48 48 141.1 48 256C48 370.9 141.1 464 256 464C370.9 464 464 370.9 464 256C464 141.1 370.9 48 256 48z"],["id","modal-evento",1,"modal-evento"],[1,"fila"],[1,"title-l-primary","color-accent"],[1,"encabezado","color-accent"],[1,"content-evento","gap-20"],[1,"columna","imagen-evento"],[1,"img-grande",3,"src","alt"],[1,"columna"],[1,"fila","gap-10"],[1,"fila","gap-20","primerafila"],[3,"info"],["class","encabezado color-accent",4,"ngIf"],[3,"infoDireccion"],[1,"texto-regular","color-accent"],[1,"fila","social"],[3,"redSocial"],["class","boton btn-info color-accent bold","target","_blank",3,"href",4,"ngIf"],[1,"title-l-primary","color-accent","bold"],[1,"boton","btn-info",3,"click"],["class","formulario_compra",4,"ngIf"],[3,"close",4,"ngIf"],["target","_blank",1,"boton","btn-info","color-accent","bold",3,"href"],[1,"formulario_compra"],[3,"formGroup"],[1,"title-l-primary"],[1,"wrapper-form-compra"],[1,"columna","gap-10","apellidos"],["for","apellidos",1,"option-menu"],[1,"columna","gap-10"],["type","text","name","apellidos","id","","formControlName","apellidos","placeholder","Fern\xe1ndez Esteban"],["class","caption color-red",4,"ngIf"],[1,"columna","gap-10","nombre"],["for","nombre",1,"option-menu"],["type","text","name","nombre","id","","formControlName","nombre","placeholder","Manuel"],[1,"columna","gap-10","telefono"],["for","telefono",1,"option-menu"],["type","tel","id","","formControlName","telefono","placeholder","612345678"],[1,"columna","gap-10","email"],["for","email",1,"option-menu"],["type","email","name","email","id","","formControlName","email","placeholder","email@especialista.com"],[1,"columna","gap-10","direccion"],["for","direccion",1,"option-menu"],["type","text","name","direccion","id","","formControlName","direccion","placeholder","Calle del evento, 1"],[1,"columna","gap-10","poblacion"],["for","poblacion",1,"option-menu"],["type","text","name","poblacion","id","","formControlName","poblacion","placeholder","Alameda"],[1,"columna","gap-10","provincia"],["for","provincia",1,"option-menu"],["type","text","name","provincia","id","","formControlName","provincia","placeholder","M\xe1laga"],[1,"columna","gap-10","c-postal"],["for","codigo_postal",1,"option-menu"],["type","text","name","codigo_postal","id","","formControlName","codigo_postal","placeholder","29000"],[1,"columna","gap-10","pais"],["for","pais",1,"option-menu"],["type","text","name","pais","id","","formControlName","pais","placeholder","Pais"],["for","privacidad",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","privacidad","formControlName","privacidad"],["for","aceptaComercial",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","aceptaComercial","formControlName","aceptaComercial"],[1,"fila","gap-10","botones"],[1,"boton","btn-submit-form",3,"disabled","click"],[1,"boton","btn-cancelar",3,"click"],[1,"caption","color-red"],[3,"close"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"button",1),h.NdJ("click",function(){return A.cerrarModal()}),h.TgZ(2,"span"),h.O4$(),h.TgZ(3,"svg",2),h._UZ(4,"path",3),h.qZA()()(),h.kcU(),h.TgZ(5,"div",4)(6,"div",5)(7,"span",6),h._uU(8),h.ALo(9,"uppercase"),h.qZA(),h.TgZ(10,"span",7),h._uU(11),h.ALo(12,"date"),h.qZA()(),h.TgZ(13,"div",8)(14,"div",9),h._UZ(15,"img",10),h.ALo(16,"noImage"),h.qZA(),h.TgZ(17,"div",11)(18,"div",12)(19,"span",6),h._uU(20),h.qZA()(),h.TgZ(21,"div",13),h._UZ(22,"app-info-modal",14),h.YNc(23,Co,2,0,"span",15),h.qZA(),h.TgZ(24,"div",5),h._UZ(25,"app-info-direccion-modal",16),h.qZA(),h.TgZ(26,"div",5),h._UZ(27,"app-info-modal-enlace",14),h.qZA(),h.TgZ(28,"div",5),h._UZ(29,"app-info-modal-enlace",14),h.qZA(),h.TgZ(30,"div",5)(31,"p",17),h._uU(32),h.qZA()(),h.TgZ(33,"div",18),h._UZ(34,"app-red-social",19)(35,"app-red-social",19)(36,"app-red-social",19)(37,"app-red-social",19)(38,"app-red-social",19),h.YNc(39,Rs,2,1,"a",20),h.qZA(),h._UZ(40,"div",5),h.TgZ(41,"div",5)(42,"span",21),h._uU(43),h.ALo(44,"euros"),h.qZA(),h.TgZ(45,"button",22),h.NdJ("click",function(){return A.comprar()}),h._uU(46,"Comprar ahora"),h.qZA()()()(),h.YNc(47,Pl,74,12,"div",23),h.qZA(),h.YNc(48,Ia,1,0,"app-modal-email",24),h.qZA()),2&x&&(h.xp6(8),h.Oqu(h.lcZ(9,21,A.evento.evento)),h.xp6(3),h.Oqu(h.xi3(12,23,A.evento.fecha,"dd/MM/yyyy")),h.xp6(4),h.Q6J("src",h.xi3(16,26,A.evento.imagen,!1),h.LSH)("alt",A.evento.evento),h.xp6(5),h.AsE("",A.evento.Especialista.nombre," ",A.evento.Especialista.apellidos,""),h.xp6(2),h.Q6J("info",A.infoTelefono),h.xp6(1),h.Q6J("ngIf",A.evento.online),h.xp6(2),h.Q6J("infoDireccion",A.direccion),h.xp6(2),h.Q6J("info",A.infoWeb),h.xp6(2),h.Q6J("info",A.infoMail),h.xp6(3),h.Oqu(A.evento.descripcion),h.xp6(2),h.Q6J("redSocial",A.twitter),h.xp6(1),h.Q6J("redSocial",A.instagram),h.xp6(1),h.Q6J("redSocial",A.facebook),h.xp6(1),h.Q6J("redSocial",A.youtube),h.xp6(1),h.Q6J("redSocial",A.twitch),h.xp6(1),h.Q6J("ngIf",null!=A.evento.pdf),h.xp6(4),h.Oqu(h.xi3(44,29,A.evento.precio,A.evento.monedaId)),h.xp6(4),h.Q6J("ngIf",A.enCompra),h.xp6(1),h.Q6J("ngIf",A.mostrarModalEmail))},dependencies:[zt.O5,Se._Y,Se.Fj,Se.Wl,Se.JJ,Se.JL,Mt.g,mn,Se.sg,Se.u,fi,Eo,es,Bi,zt.gd,zt.uU,Sa,ei]}),T})();var Yi=Bt(3570);const is=["contenedor"],Yn=["indicators"];function Us(T,S){1&T&&(h.TgZ(0,"li"),h._UZ(1,"span"),h.qZA())}function ns(T,S){if(1&T&&(h.TgZ(0,"div",11),h._UZ(1,"img",12),h.ALo(2,"noImage"),h.qZA()),2&T){const x=S.$implicit;h.xp6(1),h.Q6J("src",h.xi3(2,2,x.imagen,!1),h.LSH)("alt",x.evento)}}function gn(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"a",13),h.NdJ("click",function(){h.CHM(x);const X=h.oxw();return h.KtG(X.mover(-1))}),h.TgZ(1,"span",14),h._UZ(2,"img",15),h.qZA(),h.TgZ(3,"span",16),h._uU(4,"Previous"),h.qZA()()}}function Ma(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"a",17),h.NdJ("click",function(){h.CHM(x);const X=h.oxw();return h.KtG(X.mover(1))}),h.TgZ(1,"span",18),h._UZ(2,"img",19),h.qZA(),h.TgZ(3,"span",16),h._uU(4,"Next"),h.qZA()()}}const rs=Qe.N.especialistaAdmin;let ka=(()=>{class T{constructor(x,A){this.renderer=x,this.serviceEventos=A,this.indiceSiguiente=0,this.hayEventos=!1}ngOnDestroy(){clearInterval(this.interval)}ngOnInit(){this.serviceEventos.getEventos(rs).subscribe(x=>{this.eventos=x.eventos,this.eventos.length>0&&(this.hayEventos=!0,this.interval=setInterval(()=>{this.mover(1)},4e3))})}mover(x){if(this.indiceSiguiente=this.indiceSiguiente+x,this.indicators.nativeElement.hasChildNodes()){const A=this.indicators.nativeElement.childNodes;this.indiceSiguiente>=A.length-1?this.indiceSiguiente=0:this.indiceSiguiente<0&&(this.indiceSiguiente=A.length-2);for(let X=0;X<A.length-1;X++){const Ie=A[X];this.renderer.removeClass(Ie,"color-active"),this.renderer.addClass(Ie,"color-no-active")}this.renderer.addClass(A[this.indiceSiguiente],"color-active"),this.renderer.removeClass(A[this.indiceSiguiente],"color-no-active")}if(this.contenedor.nativeElement.hasChildNodes()){const A=this.contenedor.nativeElement.childNodes;this.indiceSiguiente>=A.length-1?this.indiceSiguiente=0:this.indiceSiguiente<0&&(this.indiceSiguiente=A.length-2);for(let X=0;X<A.length-1;X++)this.renderer.addClass(A[X],"sr-only");this.renderer.removeClass(A[this.indiceSiguiente],"sr-only")}clearInterval(this.interval),this.interval=setInterval(()=>{this.mover(1)},2e3)}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(h.Qsj),h.Y36(Yi.S))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-carousel"]],viewQuery:function(x,A){if(1&x&&(h.Gf(is,5),h.Gf(Yn,5)),2&x){let X;h.iGM(X=h.CRH())&&(A.contenedor=X.first),h.iGM(X=h.CRH())&&(A.indicators=X.first)}},decls:13,vars:4,consts:[[1,"contenedor"],[1,"title-xl-primary","color-accent","pad-20","center"],["id","carouselExampleIndicators","data-ride","carousel",1,"carousel","slide"],[1,"carousel-indicators"],["indicators",""],[4,"ngFor","ngForOf"],[1,"carousel-inner"],["contenedor",""],["class","carousel-item fade-in-right sr-only",4,"ngFor","ngForOf"],["class","carousel-control-prev","role","button","data-slide","prev",3,"click",4,"ngIf"],["class","carousel-control-next","role","button","data-slide","next",3,"click",4,"ngIf"],[1,"carousel-item","fade-in-right","sr-only"],[3,"src","alt"],["role","button","data-slide","prev",1,"carousel-control-prev",3,"click"],["aria-hidden","true",1,"carousel-control-prev-icon"],["src","./../../../../assets/images/icons-svg/angle-left-solid.svg","alt",""],[1,"sr-only"],["role","button","data-slide","next",1,"carousel-control-next",3,"click"],["aria-hidden","true",1,"carousel-control-next-icon"],["src","./../../../../assets/images/icons-svg/angle-right-solid.svg","alt",""]],template:function(x,A){1&x&&(h.TgZ(0,"section",0)(1,"h3",1),h._uU(2,"Eventos Nativos tierra"),h.qZA(),h.TgZ(3,"div",2)(4,"ol",3,4),h.YNc(6,Us,2,0,"li",5),h.qZA(),h.TgZ(7,"div",6)(8,"div",null,7),h.YNc(10,ns,3,5,"div",8),h.qZA(),h.YNc(11,gn,5,0,"a",9),h.YNc(12,Ma,5,0,"a",10),h.qZA()()()),2&x&&(h.xp6(6),h.Q6J("ngForOf",A.eventos),h.xp6(4),h.Q6J("ngForOf",A.eventos),h.xp6(1),h.Q6J("ngIf",A.hayEventos),h.xp6(1),h.Q6J("ngIf",A.hayEventos))},dependencies:[zt.sg,zt.O5,ei]}),T})(),Zs=(()=>{class T{constructor(){}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-btn-whatssap"]],decls:4,vars:0,consts:[["id","whatsapp"],["href","https://api.whatsapp.com/send?phone=34653655706&text=Hola%20,este%20mensaje%20es%20una%20prueba%20de%20whatssap%20.","target","_blank"],["aria-hidden","true","focusable","false","data-prefix","fab","data-icon","whatsapp","role","img","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 448 512",1,"svg-inline--fa","fa-whatsapp","fa-w-14"],["fill","currentColor","d","M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"a",1),h.O4$(),h.TgZ(2,"svg",2),h._UZ(3,"path",3),h.qZA()()())}}),T})();var So=Bt(7788);function Ns(T,S){if(1&T&&h._UZ(0,"app-modal-evento",3),2&T){const x=h.oxw();h.Q6J("evento",x.eventoAMostrar)}}const Vs=function(){return{fullScreenBackdrop:!0}};let _r=(()=>{class T{constructor(x,A){this.dataEventos=x,this.serviceModalEventoService=A,this.mostrarModal=!1,this.eventos=[],this.loading=!1}ngOnInit(){this.loading=!0,this.dataEventos.getEventosAlernativo().subscribe(x=>{this.loading=!1,this.eventos=x.eventos})}eventoSeleccionado(x){this.eventoAMostrar=x,""===this.eventoAMostrar.id&&(this.serviceModalEventoService.showDialogRevista=!0),this.serviceModalEventoService.openDialog()}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(gt),h.Y36(Ji.Y))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-home"]],decls:6,vars:4,consts:[[1,"container"],[3,"evento",4,"ngIf"],[3,"show","config"],[3,"evento"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0),h._UZ(1,"app-carousel")(2,"app-banner-publicidad"),h.YNc(3,Ns,1,1,"app-modal-evento",1),h._UZ(4,"app-btn-whatssap"),h.qZA(),h._UZ(5,"ngx-loading",2)),2&x&&(h.xp6(3),h.Q6J("ngIf",A.serviceModalEventoService.showDialog),h.xp6(2),h.Q6J("show",A.loading)("config",h.DdM(3,Vs)))},dependencies:[zt.O5,kl,Jn,ka,Zs,So.RJ],styles:["h3[_ngcontent-%COMP%]{text-align:center}"]}),T})(),js=(()=>{class T{constructor(){}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-nosotros"]],decls:39,vars:0,consts:[["id","nosotros",1,"columna","gap-20"],[1,"title-xl-primary","color-accent","center"],[1,"columna","gap-20"],[1,"fila","gap-20"],[1,"title-l-primary","color-accent"],[1,"texto-regular","color-accent"],["src","./../../../../assets/images/nosotros/esoterismo.jpg","alt","imagen"],[1,"grid-nosotros"],[1,"columna","gap-10"],["src","","alt",""],[1,"encabezado","color-purple"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Nosotros"),h.qZA(),h.TgZ(3,"div",2)(4,"div",3)(5,"div",2)(6,"h4",4),h._uU(7,"Que es Nativos Tierra"),h.qZA(),h.TgZ(8,"p",5),h._uU(9,"Lo alternativo es un portal web, desarrollado para publicaci\xf3n y difusi\xf3n de eventos cursos y productos relacionados con el crecimiento personal, asi como esoterismo, naturopat\xeda, terapia energ\xe9tica, corporal, artesan\xeda, alquiler de salas, retiros y productos bio, para facilitar a las personas que buscan un bienestar f\xedsico,mental y emocional, un espacio web f\xe1cil, sencillo, cercano, y activo, mediante un amplio directorio de especialistas. "),h.qZA()(),h._UZ(10,"img",6),h.qZA(),h.TgZ(11,"div",2)(12,"h4",4),h._uU(13,"Equipo humano"),h.qZA(),h.TgZ(14,"div",7)(15,"div",8),h._UZ(16,"img",9),h.TgZ(17,"span",10),h._uU(18,"Judith Retuerto G."),h.qZA(),h.TgZ(19,"span",5),h._uU(20,"COORDINADORA WEB"),h.qZA()(),h.TgZ(21,"div",8),h._UZ(22,"img",9),h.TgZ(23,"span",10),h._uU(24,"Francisco Valencia J."),h.qZA(),h.TgZ(25,"span",5),h._uU(26,"COLABORADOR WEB"),h.qZA()(),h.TgZ(27,"div",8),h._UZ(28,"img",9),h.TgZ(29,"span",10),h._uU(30,"Manuel Fern\xe1ndez E."),h.qZA(),h.TgZ(31,"span",5),h._uU(32,"DISE\xd1ADOR WEB"),h.qZA()(),h.TgZ(33,"div",8),h._UZ(34,"img",9),h.TgZ(35,"span",10),h._uU(36,"Grupo Para Vivir Alameda MALAGA"),h.qZA(),h.TgZ(37,"span",5),h._uU(38,"COORDINADOR DE EVENTOS PRESENCIALES"),h.qZA()()()()()())}}),T})();var Vr=Bt(8985),os=Bt(5861);function qs(T,S){if(1&T&&(h.TgZ(0,"li")(1,"span",8),h._uU(2),h.ALo(3,"uppercase"),h.qZA()()),2&T){const x=S.$implicit;h.xp6(2),h.Oqu(h.lcZ(3,1,x.categoria))}}function yn(T,S){if(1&T&&(h.TgZ(0,"div",6)(1,"ul"),h.YNc(2,qs,4,3,"li",7),h.qZA()()),2&T){const x=h.oxw();h.xp6(2),h.Q6J("ngForOf",x.boxEspecialidad.Herramientas)}}let At=(()=>{class T{constructor(){this.onEspecialidad=new h.vpe,this.boxEspecialidad={id:0,nombre:"",imagen:"",Herramientas:[]}}ngOnInit(){}onClickEspecialidad(){var x=this;return(0,os.Z)(function*(){x.onEspecialidad.emit(x.boxEspecialidad)})()}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-especialidad-cuadrada"]],inputs:{boxEspecialidad:"boxEspecialidad"},outputs:{onEspecialidad:"onEspecialidad"},decls:7,vars:4,consts:[["id","especialista",1,"container-especialidad",3,"click"],[1,"container-title"],[1,"option-menu"],["class","desplegable animate__animated animate__fadeIn",4,"ngIf"],[1,"container-image"],[3,"src","alt"],[1,"desplegable","animate__animated","animate__fadeIn"],[4,"ngFor","ngForOf"],[1,"texto-regular","color_accent"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0),h.NdJ("click",function(){return A.onClickEspecialidad()}),h.TgZ(1,"div",1)(2,"span",2),h._uU(3),h.qZA()(),h.YNc(4,yn,3,1,"div",3),h.TgZ(5,"div",4),h._UZ(6,"img",5),h.qZA()()),2&x&&(h.xp6(3),h.Oqu(A.boxEspecialidad.nombre),h.xp6(1),h.Q6J("ngIf",A.boxEspecialidad.Herramientas.length>0),h.xp6(2),h.Q6J("src",A.boxEspecialidad.imagen,h.LSH)("alt",A.boxEspecialidad.nombre))},dependencies:[zt.sg,zt.O5,zt.gd]}),T})(),Io=(()=>{class T{constructor(){this.onEspecialidad=new h.vpe,this.boxEspecialidad={id:0,nombre:"",imagen:""}}ngOnInit(){}onClickEspecialidad(){this.onEspecialidad.emit(this.boxEspecialidad)}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-especialidad-redonda"]],inputs:{boxEspecialidad:"boxEspecialidad"},outputs:{onEspecialidad:"onEspecialidad"},decls:6,vars:3,consts:[[1,"container-especialidad",3,"click"],[1,"container-title"],[1,"option-menu"],[1,"container-image"],[3,"src","alt"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0),h.NdJ("click",function(){return A.onClickEspecialidad()}),h.TgZ(1,"div",1)(2,"span",2),h._uU(3),h.qZA()(),h.TgZ(4,"div",3),h._UZ(5,"img",4),h.qZA()()),2&x&&(h.xp6(3),h.Oqu(A.boxEspecialidad.nombre),h.xp6(2),h.Q6J("src",A.boxEspecialidad.imagen,h.LSH)("alt",A.boxEspecialidad.nombre))},styles:[".container-especialidad[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:2.5px 2.5px 6px #000000bf;border-radius:50%;cursor:pointer;position:relative}.container-especialidad[_ngcontent-%COMP%]:hover   .container-title[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{background-color:#dc4d0c}.container-image[_ngcontent-%COMP%]{width:360px;height:360px}.container-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%;width:100%;height:100%;object-fit:cover}@media (max-width: 1280px){.container-image[_ngcontent-%COMP%]{width:280px;height:280px}}.container-title[_ngcontent-%COMP%]{width:auto;height:40px;border-radius:4px;background:linear-gradient(rgba(0,0,0,.4),rgba(0,0,0,.4));display:flex;justify-content:center;align-items:center;position:absolute;inset:0;margin:auto}.container-title[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{color:#fff;width:100%;height:100%;border-radius:4px;text-align:center}"]}),T})();function ss(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"app-especialidad-cuadrada",3),h.NdJ("onEspecialidad",function(X){h.CHM(x);const Ie=h.oxw(2);return h.KtG(Ie.selecionEspecialidad(X))}),h.qZA()}if(2&T){const x=h.oxw().$implicit;h.Q6J("boxEspecialidad",x)}}function as(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"app-especialidad-redonda",3),h.NdJ("onEspecialidad",function(X){h.CHM(x);const Ie=h.oxw(2);return h.KtG(Ie.selecionEspecialidad(X))}),h.qZA()}if(2&T){const x=h.oxw().$implicit;h.Q6J("boxEspecialidad",x)}}function ls(T,S){if(1&T&&(h.TgZ(0,"div"),h.YNc(1,ss,1,1,"app-especialidad-cuadrada",2),h.YNc(2,as,1,1,"app-especialidad-redonda",2),h.qZA()),2&T){const x=h.oxw();h.xp6(1),h.Q6J("ngIf",x.cuadrada),h.xp6(1),h.Q6J("ngIf",!x.cuadrada)}}let Gs=(()=>{class T{constructor(){this.cuadrada=!1,this.especialidades=[],this.onSeleccionEspecialidad=new h.vpe}ngOnInit(){}selecionEspecialidad(x){this.onSeleccionEspecialidad.emit(x)}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-directorio"]],inputs:{cuadrada:"cuadrada",especialidades:"especialidades"},outputs:{onSeleccionEspecialidad:"onSeleccionEspecialidad"},decls:2,vars:1,consts:[[1,"grid-directorio"],[4,"ngFor","ngForOf"],[3,"boxEspecialidad","onEspecialidad",4,"ngIf"],[3,"boxEspecialidad","onEspecialidad"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0),h.YNc(1,ls,3,2,"div",1),h.qZA()),2&x&&(h.xp6(1),h.Q6J("ngForOf",A.especialidades))},dependencies:[zt.sg,zt.O5,At,Io]}),T})(),cs=(()=>{class T{constructor(x,A,X){this.dataEspecialidadesService=x,this.serviceModalEventoService=A,this.router=X,this.actividades=[]}ngOnInit(){this.dataEspecialidadesService.getEspecialidades().subscribe(x=>{this.actividades=x.actividades})}selecionEspecialidad(x){window.scrollTo(0,0),this.dataEspecialidadesService.actividadSeleccionada=x,this.router.navigate(["eventos/eventos-especialidad",x.id])}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Vr.c),h.Y36(Ji.Y),h.Y36(a.F0))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-eventos"]],decls:4,vars:2,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],[3,"cuadrada","especialidades","onSeleccionEspecialidad"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Eventos"),h.qZA(),h.TgZ(3,"app-directorio",2),h.NdJ("onSeleccionEspecialidad",function(Ie){return A.selecionEspecialidad(Ie)}),h.qZA()()),2&x&&(h.xp6(3),h.Q6J("cuadrada",!1)("especialidades",A.actividades))},dependencies:[Gs]}),T})(),$s=(()=>{class T{constructor(x,A,X){this.dataEspecialidadesService=x,this.serviceModalEventoService=A,this.router=X,this.especialidades=[]}ngOnInit(){this.dataEspecialidadesService.getEspecialidades().subscribe(x=>{this.especialidades=x.actividades})}selecionEspecialidad(x){window.scrollTo(0,0),this.dataEspecialidadesService.actividadSeleccionada=x,this.router.navigate(["especialistas/especialistas-especialidad/",x.id])}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Vr.c),h.Y36(Ji.Y),h.Y36(a.F0))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-especialistas"]],decls:4,vars:2,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],[3,"cuadrada","especialidades","onSeleccionEspecialidad"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Especialistas"),h.qZA(),h.TgZ(3,"app-directorio",2),h.NdJ("onSeleccionEspecialidad",function(Ie){return A.selecionEspecialidad(Ie)}),h.qZA()()),2&x&&(h.xp6(3),h.Q6J("cuadrada",!0)("especialidades",A.especialidades))},dependencies:[Gs]}),T})(),us=(()=>{class T{constructor(){}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-cursos"]],decls:5,vars:0,consts:[["id","cursos-provisional",1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],[1,"encabezado","color-accent","center"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Cursos"),h.qZA(),h.TgZ(3,"h4",2),h._uU(4," Proximamente aqu\xed podras encontrar los cursos de nuestros especialistas "),h.qZA()())}}),T})();var gr=Bt(9898);let Qn=(()=>{class T{constructor(){this.encabezado="encabezado",this.infoPhone={title:"Tel\xe9fono",info:"634889199",icono:"../../assets/images/icons-svg/mobile-solid.svg"},this.infoEmail={title:"Email",info:"Portalnativostierra@gmail.com",icono:"../../assets/images/icons-svg/envelope-regular.svg"},this.infoDireccion={title:"Direcci\xf3n",direccion:"Ctra. Alameda-Antequera Km, 1",localidad:"Alameda",provincia:"M\xe1laga",codigo_postal:"29530",pais:"Espa\xf1a",icono:"../../assets/images/icons-svg/location-pin-solid.svg"},this.instagram={nombre:"Instagram",enlace:"https://www.instagram.com/nativostierra_/",icono:"../../../assets/images/icons-svg/instagram.svg"},this.facebook={nombre:"FaceBook",enlace:"https://www.facebook.com/100089059505165",icono:"../../../assets/images/icons-svg/facebook.svg"},this.youtube={nombre:"YouTube",enlace:"https://www.youtube.com/channel/UCMzJ0PPoQhcKkNZvnyBc3gA",icono:"../../../assets/images/icons-svg/youtube.svg"}}ngOnInit(){gr.accessToken=Qe.N.mapBoxToken;const x=new gr.Map({container:"mapa",style:"mapbox://styles/mapbox/streets-v12",center:[-4.641528293780888,37.19905456837209],zoom:16});(new gr.Marker).setLngLat([-4.641528293780888,37.19905456837209]).addTo(x)}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-donde"]],decls:16,vars:9,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],[1,"box-donde","color-accent"],[1,"fila"],[1,"box-datos"],[3,"infoDireccion"],[3,"info"],[1,"column","gap-20"],[3,"fontSize","redSocial"],["id","mapa"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Donde estamos"),h.qZA(),h.TgZ(3,"div",2)(4,"div",3)(5,"div",4),h._UZ(6,"app-info-direccion-modal",5)(7,"app-info-modal",6)(8,"app-info-modal",6),h.qZA(),h.TgZ(9,"div",4)(10,"div",7),h._UZ(11,"app-red-social",8)(12,"app-red-social",8)(13,"app-red-social",8),h.qZA()()(),h.TgZ(14,"div",4),h._UZ(15,"div",9),h.qZA()()()),2&x&&(h.xp6(6),h.Q6J("infoDireccion",A.infoDireccion),h.xp6(1),h.Q6J("info",A.infoPhone),h.xp6(1),h.Q6J("info",A.infoEmail),h.xp6(3),h.Q6J("fontSize",A.encabezado)("redSocial",A.instagram),h.xp6(1),h.Q6J("fontSize",A.encabezado)("redSocial",A.facebook),h.xp6(1),h.Q6J("fontSize",A.encabezado)("redSocial",A.youtube))},dependencies:[fi,Eo,Mt.g]}),T})();const jr=Qe.N.base_url;let Et=(()=>{class T{constructor(x){this.http=x}enviarConsulta(x){return this.http.post(`${jr}/contacto/`,x)}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();const qr=Qe.N.base_url;let Mo=(()=>{class T{constructor(x){this.http=x}postUser(x){return this.http.post(`${qr}/newsletter/`,x)}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();function za(T,S){1&T&&(h.TgZ(0,"span",20),h._uU(1,"Introduzca su nombre"),h.qZA())}function Pa(T,S){1&T&&(h.TgZ(0,"span",20),h._uU(1,"No es un email v\xe1lido"),h.qZA())}function hs(T,S){1&T&&(h.TgZ(0,"span",20),h._uU(1,"Deje un mensaje de al menos diez caracteres"),h.qZA())}function Da(T,S){1&T&&(h.TgZ(0,"span",20),h._uU(1,"Debe aceptar la pol\xedtica de privacidad "),h.qZA())}let La=(()=>{class T{constructor(x,A,X){this.fb=x,this.contactoService=A,this.newsletterService=X,this.submitted=!1,this.formContacto=this.fb.group({nombre:["",Se.kI.required],email:["",[Se.kI.required,Se.kI.email]],privacidad:[!1,Se.kI.requiredTrue],info_comercial:[!1],mensaje:["",[Se.kI.required,Se.kI.minLength(10)]]})}ngOnInit(){}campoValido(x){return this.formContacto.get(x)?.invalid||!1}onSubmit(){this.submitted=!0,this.formContacto.valid&&(!0===this.formContacto.get("info_comercial").value&&this.newsletterService.postUser(this.formContacto.value).subscribe(x=>{}),this.contactoService.enviarConsulta(this.formContacto.value).subscribe(x=>{$t().fire("Enviado","Mensaje enviado","success")},x=>{$t().fire("Error","Mensaje no enviado","error")}),this.formContacto.reset(),this.submitted=!1)}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Se.qu),h.Y36(Et),h.Y36(Mo))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-contacto"]],decls:37,vars:5,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],["id","contacto",1,"box-donde","color-accent"],[3,"formGroup","ngSubmit"],[1,"fila","gap-20"],[1,"columna","gap-20","email-nombre"],[1,"columna","gap-10"],["for","nombre",1,"encabezado","color-accent"],["type","text","name","nombre","formControlName","nombre","placeholder","Manuel"],["class","caption color-red",4,"ngIf"],["for","email",1,"encabezado","color-accent"],["type","email","name","email","formControlName","email","placeholder","tuemail@email.es"],[1,"columna","gap-20"],["for","mensaje",1,"encabezado","color-accent"],["name","mensaje","cols","40","rows","7","formControlName","mensaje","placeholder","Cuentanos que necesitas"],["for","privacidad",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","privacidad","formControlName","privacidad"],["for","info_comercial",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","info_comercial","formControlName","info_comercial"],["type","submit",1,"boton","btn-login","end"],[1,"caption","color-red"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Contacto"),h.qZA(),h.TgZ(3,"div",2)(4,"form",3),h.NdJ("ngSubmit",function(){return A.onSubmit()}),h.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),h._uU(9,"Nombre:"),h.qZA(),h.TgZ(10,"div",6),h._UZ(11,"input",8),h.YNc(12,za,2,0,"span",9),h.qZA()(),h.TgZ(13,"div",6)(14,"label",10),h._uU(15,"Email:"),h.qZA(),h.TgZ(16,"div",6),h._UZ(17,"input",11),h.YNc(18,Pa,2,0,"span",9),h.qZA()(),h.TgZ(19,"div",12)(20,"label",13),h._uU(21,"Mensaje"),h.qZA(),h.TgZ(22,"div",6)(23,"textarea",14),h._uU(24,"\n                        "),h.qZA(),h.YNc(25,hs,2,0,"span",9),h.qZA()(),h.TgZ(26,"div",6),h._UZ(27,"app-proteccion-datos-personales"),h.TgZ(28,"label",15),h._UZ(29,"input",16),h._uU(30," He le\xeddo y acepto la informaci\xf3n sobre el tratamiento de datos personales "),h.qZA(),h.YNc(31,Da,2,0,"span",9),h.TgZ(32,"label",17),h._UZ(33,"input",18),h._uU(34," Marque si desea recibir informaci\xf3n comercial de nuestros productos o servicios. "),h.qZA()(),h.TgZ(35,"button",19),h._uU(36,"Enviar"),h.qZA()()()()()()),2&x&&(h.xp6(4),h.Q6J("formGroup",A.formContacto),h.xp6(8),h.Q6J("ngIf",A.campoValido("nombre")&&A.submitted),h.xp6(6),h.Q6J("ngIf",A.campoValido("email")&&A.submitted),h.xp6(7),h.Q6J("ngIf",A.campoValido("mensaje")&&A.submitted),h.xp6(6),h.Q6J("ngIf",A.campoValido("privacidad")&&A.submitted))},dependencies:[zt.O5,mn,Se._Y,Se.Fj,Se.Wl,Se.JJ,Se.JL,Se.sg,Se.u]}),T})(),Ra=(()=>{class T{transform(x,...A){return""===x?"Online":x}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275pipe=h.Yjl({name:"localizacion",type:T,pure:!0}),T})();const Xs=["cajaEvento"];function ps(T,S){if(1&T&&(h.TgZ(0,"a",12),h._uU(1,"Info descargable"),h.qZA()),2&T){const x=h.oxw();h.Q6J("href",x.evento.pdf,h.LSH)}}let Ws=(()=>{class T{constructor(x,A){this.renderer=x,this.router=A,this.onEvento=new h.vpe,this.mostrarModalEmail=!1}ngAfterViewInit(){}ngOnInit(){}descargarContenido(){""===this.evento.id&&(this.mostrarModalEmail=!0)}cerrarModalEmail(x){this.mostrarModalEmail=!1,""!=x.mail&&this.router.navigate(["revistas"])}onMasInfo(){this.onEvento.emit(this.evento)}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(h.Qsj),h.Y36(a.F0))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-evento"]],viewQuery:function(x,A){if(1&x&&h.Gf(Xs,5),2&x){let X;h.iGM(X=h.CRH())&&(A.cajaEvento=X.first)}},inputs:{evento:"evento"},outputs:{onEvento:"onEvento"},decls:25,vars:13,consts:[[1,"contenedor__especialista"],[1,"contenedor__imagen__especialista"],[1,"especialista__imagen",3,"src","alt"],[1,"contenedor__content__especialista"],[1,"columna"],[1,"fila","gap-10"],[1,"texto__cajas__especialistas","color-accent","end"],[1,"boton","btn-info","color-light",3,"click"],["class","boton btn-info color-light","target","_blank",3,"href",4,"ngIf"],[1,"fila"],[1,"fila","gap-10","end"],[1,"texto__cajas__especialistas","bold","color-light"],["target","_blank",1,"boton","btn-info","color-light",3,"href"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"div",1),h._UZ(2,"img",2),h.ALo(3,"noImage"),h.qZA(),h.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"span",6),h._uU(8),h.qZA()(),h.TgZ(9,"div",5)(10,"span",6),h._uU(11),h.qZA(),h.TgZ(12,"span",6),h._uU(13),h.qZA()(),h.TgZ(14,"div",5)(15,"button",7),h.NdJ("click",function(){return A.onMasInfo()}),h._uU(16,"m\xe1s info."),h.qZA(),h.YNc(17,ps,2,1,"a",8),h.qZA(),h.TgZ(18,"div",9)(19,"div",10)(20,"span",6),h._uU(21),h.qZA(),h.TgZ(22,"span",11),h._uU(23),h.ALo(24,"localizacion"),h.qZA()()()()()()),2&x&&(h.xp6(2),h.Q6J("src",h.xi3(3,8,A.evento.imagen,!0),h.LSH)("alt",A.evento.evento),h.xp6(6),h.Oqu(A.evento.evento),h.xp6(3),h.Oqu(A.evento.Especialista.nombre),h.xp6(2),h.Oqu(A.evento.Especialista.apellidos),h.xp6(4),h.Q6J("ngIf",null!=A.evento.pdf),h.xp6(4),h.Oqu(A.evento.pais),h.xp6(2),h.Oqu(h.lcZ(24,11,A.evento.localidad)))},dependencies:[zt.O5,Ra,ei]}),T})();function ds(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"div",5)(1,"a",6),h.NdJ("click",function(){h.CHM(x);const X=h.oxw(2);return h.KtG(X.anterior())}),h._uU(2,"Anterior"),h.qZA()()}}function Hs(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"div",7)(1,"a",6),h.NdJ("click",function(){h.CHM(x);const X=h.oxw(2);return h.KtG(X.siguiente())}),h._uU(2,"Siguiente"),h.qZA()()}}function Ba(T,S){if(1&T&&(h.TgZ(0,"div",1),h.YNc(1,ds,3,0,"div",2),h.TgZ(2,"div",3)(3,"p"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA()(),h.YNc(7,Hs,3,0,"div",4),h.qZA()),2&T){const x=h.oxw();h.xp6(1),h.Q6J("ngIf",x.page>1),h.xp6(3),h.AsE("P\xe1gina ",x.page," de ",x.totalPages,""),h.xp6(2),h.hij("",x.numItems," resultados"),h.xp6(1),h.Q6J("ngIf",x.page<x.totalPages)}}let Dl=(()=>{class T{constructor(){this.numItems=0,this.page=0,this.totalPages=0,this.paginaEmiter=new h.vpe}ngOnInit(){}anterior(){this.page--,this.pasarPagina()}siguiente(){this.page++,this.pasarPagina()}pasarPagina(){this.paginaEmiter.emit(this.page)}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-pagination"]],inputs:{numItems:"numItems",page:"page",totalPages:"totalPages"},outputs:{paginaEmiter:"paginaEmiter"},decls:1,vars:1,consts:[["class","pagination",4,"ngIf"],[1,"pagination"],["class","pagination__prev",4,"ngIf"],[1,"pagination__text"],["class","pagination__next",4,"ngIf"],[1,"pagination__prev"],[3,"click"],[1,"pagination__next"]],template:function(x,A){1&x&&h.YNc(0,Ba,8,5,"div",0),2&x&&h.Q6J("ngIf",A.numItems)},dependencies:[zt.O5]}),T})();function ko(T,S){if(1&T){const x=h.EpF();h.ynx(0),h.TgZ(1,"app-evento",7),h.NdJ("onEvento",function(X){h.CHM(x);const Ie=h.oxw();return h.KtG(Ie.eventoSeleccionado(X))}),h.qZA(),h.BQk()}if(2&T){const x=S.$implicit;h.xp6(1),h.Q6J("evento",x)}}function zo(T,S){if(1&T&&h._UZ(0,"app-modal-evento",8),2&T){const x=h.oxw();h.Q6J("evento",x.eventoAMostrar)}}let Oa=(()=>{class T{constructor(x,A,X,Ie){this.serviceModalEventoService=x,this.dataEspecialidadesService=A,this.eventosService=X,this.route=Ie,this.especialidad="",this.eventos=[],this.numeroTotalEventos=0,this.mostrarModal=!1,this.paginaActual=1,this.numeroDePaginas=0}ngOnInit(){this.dataEspecialidadesService.actividadSeleccionada||this.route.navigate(["/"]),this.actividad=this.dataEspecialidadesService.actividadSeleccionada,this.especialidad=this.actividad.nombre,this.cargarPagina(1)}eventoSeleccionado(x){this.eventoAMostrar=x,this.serviceModalEventoService.openDialog()}cargarPagina(x){this.paginaActual=x,this.eventosService.getEventosActividad(this.actividad.id,this.paginaActual).subscribe(A=>{this.eventos=A.eventos,this.numeroTotalEventos=A.count,this.numeroDePaginas=5===this.numeroTotalEventos?1:Math.floor(this.numeroTotalEventos/5)+1},A=>{$t().fire("Error",A.error.msg,"error")})}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Ji.Y),h.Y36(Vr.c),h.Y36(Yi.S),h.Y36(a.F0))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-eventos-especialidad"]],decls:9,vars:8,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],[1,"wrapper-eventos"],[1,"contenedor-eventos"],[4,"ngFor","ngForOf"],[3,"numItems","page","totalPages","paginaEmiter"],[3,"evento",4,"ngIf"],[3,"evento","onEvento"],[3,"evento"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2),h.ALo(3,"lowercase"),h.qZA(),h.TgZ(4,"div",2)(5,"div",3),h.YNc(6,ko,2,1,"ng-container",4),h.qZA(),h.TgZ(7,"app-pagination",5),h.NdJ("paginaEmiter",function(Ie){return A.cargarPagina(Ie)}),h.qZA()(),h.YNc(8,zo,1,1,"app-modal-evento",6),h.qZA()),2&x&&(h.xp6(2),h.hij(" Eventos ",h.lcZ(3,6,A.especialidad)," "),h.xp6(4),h.Q6J("ngForOf",A.eventos),h.xp6(1),h.Q6J("numItems",A.numeroTotalEventos)("page",A.paginaActual)("totalPages",A.numeroDePaginas),h.xp6(1),h.Q6J("ngIf",A.serviceModalEventoService.showDialog))},dependencies:[zt.sg,zt.O5,Ws,Jn,Dl,zt.i8]}),T})();var Po=Bt(9751);let fs=(()=>{class T{constructor(x){this.http=x,this.observer=new Po.y}getEspecialistas(){return this.http.get("./../../assets/data/especialistas.json")}setEspecialista(x){this.especialista=x}getEspecialista(){return this.observer=new Po.y(x=>{x.next(this.especialista)}),this.observer}login(){}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();var xn=Bt(4641);const Gr=Qe.N.base_url;let ms=(()=>{class T{constructor(x){this.http=x}getHerramienta(x){return this.http.get(`${Gr}/herramientas/${x}`)}getHerramientasByEspecialista(x){return this.http.get(`${Gr}/herramientas/especialista/${x}`)}getHerramientasByActividad(x){return this.http.get(`${Gr}/herramientas/herramientas/${x}`)}getEspecialistasByHerramientas(x,A){return console.log(A),this.http.post(`${Gr}/herramientas/especialistasByHerramientas/${x}`,A)}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();function Js(T,S){if(1&T&&(h.TgZ(0,"span",2),h._uU(1),h.qZA()),2&T){const x=S.$implicit;h.xp6(1),h.hij(" ",x.Herramienta.categoria," ")}}let Ys=(()=>{class T{constructor(x){this.herramientasService=x,this.especialista="",this.herramientas=[]}ngOnInit(){console.log(this.especialista),this.herramientasService.getHerramientasByEspecialista(this.especialista).subscribe(x=>{this.herramientas=x.usaHerramientas})}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(ms))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-listado-categorias"]],inputs:{especialista:"especialista"},decls:2,vars:1,consts:[[1,"wrapper-categorias"],["class","texto-regular color-accent",4,"ngFor","ngForOf"],[1,"texto-regular","color-accent"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0),h.YNc(1,Js,2,1,"span",1),h.qZA()),2&x&&(h.xp6(1),h.Q6J("ngForOf",A.herramientas))},dependencies:[zt.sg]}),T})(),_s=(()=>{class T{constructor(){this.actividades=["Esoterismo","Naturopat\xeda","Crecimiento personal","Terapia corporal","Terapia energ\xe9tica","Artesan\xeda","Productos bio","Retiros","Alquiler salas"]}transform(x){return this.actividades[x-1]}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275pipe=h.Yjl({name:"actividad",type:T,pure:!0}),T})();function Fa(T,S){if(1&T&&h._UZ(0,"app-listado-categorias",28),2&T){const x=h.oxw();h.Q6J("especialista",x.especialista.id)}}let Qs=(()=>{class T{constructor(x,A){this.serviceModalEventoService=x,this.herramientasService=A,this.hayCategorias=!1}ngOnInit(){this.direccion={title:"Ubicacion",direccion:this.especialista.direccion,localidad:this.especialista.localidad,provincia:this.especialista.provincia,codigo_postal:this.especialista.codigo_postal,pais:this.especialista.pais,icono:"../../assets/images/icons-svg/location-pin-solid.svg"},this.infoTelefono={title:"Telefono",info:this.especialista.telefono,icono:"../../assets/images/icons-svg/mobile-solid.svg"},this.infoMail={title:"Email",info:this.especialista.email,icono:"../../assets/images/icons-svg/envelope-regular.svg"},this.infoWeb={title:"Web",info:this.especialista.web,icono:"../../assets/images/icons-svg/globe-solid.svg"},this.especialista.UsaHerramientas&&this.especialista.UsaHerramientas.length>0&&(this.hayCategorias=!0)}cerrarModal(){this.serviceModalEventoService.closeDialog()}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Ji.Y),h.Y36(ms))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-modal-especialista"]],inputs:{especialista:"especialista"},decls:61,vars:31,consts:[[1,"overlay"],[1,"cerrar-modal",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 512 512"],["d","M175 175C184.4 165.7 199.6 165.7 208.1 175L255.1 222.1L303 175C312.4 165.7 327.6 165.7 336.1 175C346.3 184.4 346.3 199.6 336.1 208.1L289.9 255.1L336.1 303C346.3 312.4 346.3 327.6 336.1 336.1C327.6 346.3 312.4 346.3 303 336.1L255.1 289.9L208.1 336.1C199.6 346.3 184.4 346.3 175 336.1C165.7 327.6 165.7 312.4 175 303L222.1 255.1L175 208.1C165.7 199.6 165.7 184.4 175 175V175zM512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256zM256 48C141.1 48 48 141.1 48 256C48 370.9 141.1 464 256 464C370.9 464 464 370.9 464 256C464 141.1 370.9 48 256 48z"],[1,"modal-especialista"],[1,"fila","gap-20"],[1,"title-l-primary","color-accent"],[1,"encabezado","color-accent"],[1,"avatar",3,"src","alt"],[1,"content-especialista","fila","gap-20"],[1,"columna","gap-20"],[1,"img-grande",3,"src","alt"],[1,"fila"],[1,"contenedor-video"],["id","","autoplay","","loop","","preload","metada",3,"src"],[1,"texto-regular","color-accent"],[3,"especialista",4,"ngIf"],[3,"infoDireccion"],[3,"info"],[1,"fila","social","gap-20"],[1,"tooltip"],[1,"tooltiptext","caption","color-accent","bold"],["d","M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 448 512"],["d","M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"],["d","M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 576 512"],["d","M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"],[3,"especialista"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"button",1),h.NdJ("click",function(){return A.cerrarModal()}),h.TgZ(2,"span"),h.O4$(),h.TgZ(3,"svg",2),h._UZ(4,"path",3),h.qZA()()(),h.kcU(),h.TgZ(5,"div",4)(6,"div",5)(7,"div",5)(8,"span",6),h._uU(9),h.ALo(10,"uppercase"),h.qZA(),h.TgZ(11,"span",7),h._uU(12),h.qZA()(),h._UZ(13,"img",8),h.ALo(14,"noImage"),h.qZA(),h.TgZ(15,"div",9)(16,"div",10),h._UZ(17,"img",11),h.ALo(18,"noImage"),h.TgZ(19,"div",12)(20,"div",13),h._UZ(21,"video",14),h.ALo(22,"noImage"),h.qZA()()(),h.TgZ(23,"div",10)(24,"div",5)(25,"span",7),h._uU(26),h.ALo(27,"actividad"),h.qZA()(),h.TgZ(28,"div",5)(29,"p",15),h._uU(30),h.qZA()(),h.TgZ(31,"div",5),h.YNc(32,Fa,1,1,"app-listado-categorias",16),h.qZA(),h.TgZ(33,"div",5),h._UZ(34,"app-info-direccion-modal",17)(35,"app-info-modal",18),h.qZA(),h.TgZ(36,"div",5),h._UZ(37,"app-info-modal",18),h.qZA(),h.TgZ(38,"div",5),h._UZ(39,"app-info-modal-enlace",18),h.qZA(),h.TgZ(40,"div",19)(41,"span",20)(42,"span",21),h._uU(43),h.qZA(),h.O4$(),h.TgZ(44,"svg",2),h._UZ(45,"path",22),h.qZA()(),h.kcU(),h.TgZ(46,"span",20)(47,"span",21),h._uU(48),h.qZA(),h.O4$(),h.TgZ(49,"svg",23),h._UZ(50,"path",24),h.qZA()(),h.kcU(),h.TgZ(51,"span",20)(52,"span",21),h._uU(53),h.qZA(),h.O4$(),h.TgZ(54,"svg",23),h._UZ(55,"path",25),h.qZA()(),h.kcU(),h.TgZ(56,"span",20)(57,"span",21),h._uU(58),h.qZA(),h.O4$(),h.TgZ(59,"svg",26),h._UZ(60,"path",27),h.qZA()()()()()()()),2&x&&(h.xp6(9),h.Oqu(h.lcZ(10,18,A.especialista.nombre)),h.xp6(3),h.Oqu(A.especialista.apellidos),h.xp6(1),h.Q6J("src",h.xi3(14,20,A.especialista.imagen,!0),h.LSH)("alt",A.especialista.nombre),h.xp6(4),h.Q6J("src",h.xi3(18,23,A.especialista.imagen,!0),h.LSH)("alt",A.especialista.nombre),h.xp6(4),h.Q6J("src",h.xi3(22,26,A.especialista.video,!0),h.LSH),h.xp6(5),h.Oqu(h.lcZ(27,29,A.especialista.ActividadeId)),h.xp6(4),h.Oqu(A.especialista.descripcion_terapia),h.xp6(2),h.Q6J("ngIf",A.hayCategorias),h.xp6(2),h.Q6J("infoDireccion",A.direccion),h.xp6(1),h.Q6J("info",A.infoTelefono),h.xp6(2),h.Q6J("info",A.infoMail),h.xp6(2),h.Q6J("info",A.infoWeb),h.xp6(4),h.Oqu(A.especialista.twitter),h.xp6(5),h.Oqu(A.especialista.instagram),h.xp6(5),h.Oqu(A.especialista.facebook),h.xp6(5),h.Oqu(A.especialista.you_tube))},dependencies:[zt.O5,fi,Eo,es,Ys,zt.gd,_s,ei]}),T})();const Ll=["cajaEspecialista"];let Do=(()=>{class T{constructor(x){this.renderer=x,this.imagen="",this.onEspecialista=new h.vpe}ngOnInit(){this.imagen="",this.imagen=null!=this.especialista.imagen?this.especialista.imagen:"../../assets/images/especialista_no_disponible.svg"}ngAfterViewInit(){}onMasInfo(){this.onEspecialista.emit(this.especialista)}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(h.Qsj))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-especialista"]],viewQuery:function(x,A){if(1&x&&h.Gf(Ll,5),2&x){let X;h.iGM(X=h.CRH())&&(A.cajaEspecialista=X.first)}},inputs:{especialista:"especialista"},outputs:{onEspecialista:"onEspecialista"},decls:22,vars:10,consts:[[1,"contenedor__especialista"],[1,"contenedor__imagen__especialista"],[1,"especialista__imagen",3,"src","alt"],[1,"contenedor__content__especialista"],[1,"columna"],[1,"fila","gap-10"],[1,"texto__cajas__especialistas","end","color-accent"],[1,"fila"],[1,"texto__cajas__especialistas","color-accent"],[1,"boton","btn-info","color-light",3,"click"],[1,"fila","gap-10","end"],[1,"texto__cajas__especialistas","color-accent","end"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"div",1),h._UZ(2,"img",2),h.ALo(3,"noImage"),h.qZA(),h.TgZ(4,"div",3)(5,"div",4)(6,"div",5)(7,"span",6),h._uU(8),h.qZA(),h.TgZ(9,"span",6),h._uU(10),h.qZA()(),h.TgZ(11,"div",7)(12,"span",8),h._uU(13),h.qZA()(),h.TgZ(14,"div",7)(15,"button",9),h.NdJ("click",function(){return A.onMasInfo()}),h._uU(16,"m\xe1s info."),h.qZA(),h.TgZ(17,"div",10)(18,"span",11),h._uU(19),h.qZA(),h.TgZ(20,"span",11),h._uU(21),h.qZA()()()()()()),2&x&&(h.xp6(2),h.Q6J("src",h.xi3(3,7,A.especialista.imagen,!0),h.LSH)("alt",A.especialista.nombre),h.xp6(6),h.Oqu(A.especialista.nombre),h.xp6(2),h.Oqu(A.especialista.apellidos),h.xp6(3),h.Oqu(A.especialista.telefono),h.xp6(6),h.Oqu(A.especialista.pais),h.xp6(2),h.Oqu(A.especialista.provincia))},dependencies:[ei]}),T})(),Ua=(()=>{class T{transform(x,A=0,X="",Ie=""){return x.slice(A,A+5)}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275pipe=h.Yjl({name:"filtroEspecialistas",type:T,pure:!0}),T})();function gs(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"button",9),h.NdJ("click",function(){h.CHM(x);const X=h.oxw();return h.KtG(X.toggleFiltros())}),h._uU(1,"Filtros"),h.qZA()}}function Rl(T,S){if(1&T&&(h.TgZ(0,"option",24),h._uU(1),h.qZA()),2&T){const x=S.$implicit;h.s9C("value",x.id),h.xp6(1),h.hij(" ",x.categoria," ")}}function Ks(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"div",10)(1,"div",11)(2,"form",12)(3,"div",13)(4,"div",14)(5,"label",15),h._uU(6,"Herramientas:"),h.qZA(),h.TgZ(7,"select",16,17),h.YNc(9,Rl,2,2,"option",18),h.qZA()()(),h.TgZ(10,"div",19)(11,"button",20),h.NdJ("click",function(){h.CHM(x);const X=h.oxw();return h.KtG(X.onClickBuscar())}),h.TgZ(12,"span",21),h._uU(13," Buscar "),h._UZ(14,"img",22),h.qZA()(),h.TgZ(15,"button",20),h.NdJ("click",function(){h.CHM(x);const X=h.oxw();return h.KtG(X.onReset())}),h.TgZ(16,"span",21),h._uU(17," Limpiar "),h._UZ(18,"img",23),h.qZA()()()()()()}if(2&T){const x=h.oxw();h.xp6(2),h.Q6J("formGroup",x.formFiltros),h.xp6(7),h.Q6J("ngForOf",x.herramientas)}}function Bl(T,S){if(1&T){const x=h.EpF();h.ynx(0),h.TgZ(1,"app-especialista",25),h.NdJ("onEspecialista",function(X){h.CHM(x);const Ie=h.oxw();return h.KtG(Ie.especialistaSeleccionado(X))}),h.qZA(),h.BQk()}if(2&T){const x=S.$implicit;h.xp6(1),h.Q6J("especialista",x)}}function ys(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"div",30)(1,"a",31),h.NdJ("click",function(){h.CHM(x);const X=h.oxw(2);return h.KtG(X.anterior())}),h._uU(2,"Anterior"),h.qZA()()}}function xs(T,S){if(1&T){const x=h.EpF();h.TgZ(0,"div",32)(1,"a",31),h.NdJ("click",function(){h.CHM(x);const X=h.oxw(2);return h.KtG(X.siguiente())}),h._uU(2,"Siguiente"),h.qZA()()}}function ea(T,S){if(1&T&&(h.TgZ(0,"div",26),h.YNc(1,ys,3,0,"div",27),h.TgZ(2,"div",28)(3,"p"),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._uU(6),h.qZA()(),h.YNc(7,xs,3,0,"div",29),h.qZA()),2&T){const x=h.oxw();h.xp6(1),h.Q6J("ngIf",x.paginaActual>1),h.xp6(3),h.AsE("P\xe1gina ",x.paginaActual," de ",x.numeroDePaginas,""),h.xp6(2),h.hij("",x.numeroTotalEspecialistas," resultados"),h.xp6(1),h.Q6J("ngIf",x.paginaActual<x.numeroDePaginas)}}function ta(T,S){if(1&T&&h._UZ(0,"app-modal-especialista",33),2&T){const x=h.oxw();h.Q6J("especialista",x.especialistaAMostrar)}}let $r=(()=>{class T{constructor(x,A,X,Ie,et){this.serviceDataEspecialistas=x,this.serviceModalEventoService=A,this.especialistasServices=X,this.herramientasService=Ie,this.fb=et,this.isVisible=!1,this.sinFiltros=!1,this.lista=[],this.listaResultado=[],this.paginaActual=1,this.numeroDePaginas=0,this.numeroTotalEspecialistas=0,this.nombre="",this.provincia="",this.pagina=0,this.herramientas=[],this.formFiltros=this.fb.group({herramientas:[],provincia:[""]})}ngOnInit(){this.herramientasService.getHerramientasByActividad(this.especialidad).subscribe(x=>{this.herramientas=x.herramientas,this.herramientas&&this.herramientas.length>0&&(this.sinFiltros=!0)}),this.traerEspecialistas()}reset(){this.formFiltros.reset(),this.paginaActual=1,this.traerEspecialistas()}toggleFiltros(){this.isVisible=!this.isVisible}especialistaSeleccionado(x){this.especialistaAMostrar=x,this.serviceModalEventoService.openDialog()}traerEspecialistas(){this.especialistasServices.getEspecialistasActividad(this.especialidad).subscribe(x=>{this.listaResultado=x.especialistas,this.numeroTotalEspecialistas=this.listaResultado.length,this.paginaActual=1,this.numeroDePaginas=5===this.numeroTotalEspecialistas?1:this.numeroTotalEspecialistas%5==0?Math.floor(this.numeroTotalEspecialistas/5):Math.floor(this.numeroTotalEspecialistas/5)+1},x=>{$t().fire("Error",x.error.msg,"error")})}moverPagina(x){this.pagina=x}onClickBuscar(){this.herramientasService.getEspecialistasByHerramientas(this.especialidad,this.formFiltros.value).subscribe(x=>{this.listaResultado=x.especialistas,this.numeroTotalEspecialistas=this.listaResultado.length,this.paginaActual=1,this.numeroDePaginas=5===this.numeroTotalEspecialistas?1:this.numeroTotalEspecialistas%5==0?Math.floor(this.numeroTotalEspecialistas/5):Math.floor(this.numeroTotalEspecialistas/5)+1,this.listaResultado=x.especialistas,console.log(this.listaResultado)},x=>{console.log(x)})}onReset(){this.reset()}anterior(){this.pagina-=5,this.paginaActual--}siguiente(){this.pagina+=5,this.paginaActual++}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(fs),h.Y36(Ji.Y),h.Y36(xn.n),h.Y36(ms),h.Y36(Se.qu))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-resultado-busqueda-especialistas"]],inputs:{especialidad:"especialidad"},decls:10,vars:8,consts:[[1,"contendor-principal-resultados"],[1,"contenedor-filtros"],["class","boton btn-info-filtro",3,"click",4,"ngIf"],["class","box-filtro",4,"ngIf"],[1,"wrapper"],[1,"wrapper2"],[4,"ngFor","ngForOf"],["class","pagination",4,"ngIf"],[3,"especialista",4,"ngIf"],[1,"boton","btn-info-filtro",3,"click"],[1,"box-filtro"],[1,"fila","gap-20"],["autocomplete","off",3,"formGroup"],[1,"columna","color-accent","gap-10"],[1,"columna","gap-10"],["for","nombre",1,"option-menu","color-accent"],["name","herramientas","formControlName","herramientas","multiple","",1,"texto-regular"],["categoria",""],["class","texto-regular",3,"value",4,"ngFor","ngForOf"],[1,"fila","botonera"],[1,"boton",3,"click"],[1,"option-menu","color-accent"],["src","./../../../../assets/images/icons-svg/magnifying-glass-solid.svg","alt","buscar","width","20px"],["src","./../../../../assets/images/icons-svg/trash-solid.svg","alt","buscar","width","20px"],[1,"texto-regular",3,"value"],[3,"especialista","onEspecialista"],[1,"pagination"],["class","pagination__prev",4,"ngIf"],[1,"pagination__text"],["class","pagination__next",4,"ngIf"],[1,"pagination__prev"],[3,"click"],[1,"pagination__next"],[3,"especialista"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"div",1),h.YNc(2,gs,2,0,"button",2),h.YNc(3,Ks,19,2,"div",3),h.qZA(),h.TgZ(4,"div",4)(5,"div",5),h.YNc(6,Bl,2,1,"ng-container",6),h.ALo(7,"filtroEspecialistas"),h.qZA(),h.YNc(8,ea,8,5,"div",7),h.qZA(),h.YNc(9,ta,1,1,"app-modal-especialista",8),h.qZA()),2&x&&(h.xp6(2),h.Q6J("ngIf",A.sinFiltros),h.xp6(1),h.Q6J("ngIf",A.isVisible),h.xp6(3),h.Q6J("ngForOf",h.xi3(7,5,A.listaResultado,A.pagina)),h.xp6(2),h.Q6J("ngIf",A.numeroTotalEspecialistas),h.xp6(1),h.Q6J("ngIf",A.serviceModalEventoService.showDialog))},dependencies:[zt.sg,zt.O5,Se._Y,Se.YN,Se.Kr,Se.K7,Se.JJ,Se.JL,Se.sg,Se.u,Qs,Do,Ua]}),T})(),Ol=(()=>{class T{constructor(x,A){this.dataEspecialidadesService=x,this.route=A,this.especialidad=""}ngOnInit(){this.dataEspecialidadesService.actividadSeleccionada||this.route.navigate(["/"]),this.actividad=this.dataEspecialidadesService.actividadSeleccionada,this.especialidad=this.actividad.nombre,this.idEspecialidad=this.actividad.id}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Vr.c),h.Y36(a.F0))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-especialistas-especialidad"]],decls:5,vars:4,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],[3,"especialidad"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2),h.ALo(3,"lowercase"),h.qZA(),h._UZ(4,"app-resultado-busqueda-especialistas",2),h.qZA()),2&x&&(h.xp6(2),h.hij(" Especialistas ",h.lcZ(3,2,A.especialidad),""),h.xp6(2),h.Q6J("especialidad",A.idEspecialidad))},dependencies:[$r,zt.i8]}),T})(),Fl=(()=>{class T{constructor(){}ngOnInit(){}}return T.\u0275fac=function(x){return new(x||T)},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-revistas"]],decls:3,vars:0,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Revista L\xf6Alternativo"),h.qZA()())}}),T})();function Za(T,S){1&T&&(h.TgZ(0,"span",22),h._uU(1,"Introduzca su nombre"),h.qZA())}function Na(T,S){1&T&&(h.TgZ(0,"span",22),h._uU(1,"No es un email v\xe1lido"),h.qZA())}function Va(T,S){1&T&&(h.TgZ(0,"span",22),h._uU(1,"Debe aceptar la pol\xedtica de privacidad"),h.qZA())}const ia=function(){return["/privacidad"]};let na=(()=>{class T{constructor(x,A){this.fb=x,this.newsletterService=A,this.submitted=!1,this.formNewsletter=this.fb.group({nombre:["",Se.kI.required],email:["",[Se.kI.required,Se.kI.email]],privacidad:[!1,Se.kI.requiredTrue],info_comercial:[!1]})}ngOnInit(){}campoValido(x){return this.submitted&&this.formNewsletter.get(x).invalid}onSubmit(){this.submitted=!0,this.formNewsletter.valid&&this.submitted&&(this.submitted=!1,this.newsletterService.postUser(this.formNewsletter.value).subscribe(x=>{$t().fire("Suscrito","Te has suscrito correctamente","success"),this.formNewsletter.reset()},x=>{console.log(x.error.errors.errors[0].msg),$t().fire("Error",x.error.errors.errors[0].msg||"Error","error")}))}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(Se.qu),h.Y36(Mo))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-newsletter"]],decls:38,vars:6,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],["id","contacto",1,"box-donde","color-accent"],[3,"formGroup","ngSubmit"],[1,"fila","gap-20"],[1,"columna","gap-20"],[1,"columna","gap-10"],["for","nombre",1,"encabezado","color-accent"],["type","text","name","nombre","id","","formControlName","nombre","placeholder","Manuel"],["class","caption color-red",4,"ngIf"],["for","email",1,"encabezado","color-accent"],["type","email","name","email","formControlName","email","placeholder","tuemail@email.es"],[1,"columna"],[1,"option-menu","color-accent"],[1,"caption","color-accent"],["target","_blank",3,"routerLink"],["for","privacidad",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","privacidad","formControlName","privacidad"],["for","info_comercial",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","info_comercial","formControlName","info_comercial"],[1,"columna","gap-20","end"],["type","submit",1,"boton","btn-login","end"],[1,"caption","color-red"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Suscr\xedbete a nuestra newsletter"),h.qZA(),h.TgZ(3,"div",2)(4,"form",3),h.NdJ("ngSubmit",function(){return A.onSubmit()}),h.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),h._uU(9,"Nombre:"),h.qZA(),h.TgZ(10,"div",6),h._UZ(11,"input",8),h.YNc(12,Za,2,0,"span",9),h.qZA()(),h.TgZ(13,"div",6)(14,"label",10),h._uU(15,"Email:"),h.qZA(),h.TgZ(16,"div",6),h._UZ(17,"input",11),h.YNc(18,Na,2,0,"span",9),h.qZA()(),h.TgZ(19,"div",6)(20,"div",12)(21,"h5",13),h._uU(22,"PROTECCI\xd3N DE DATOS PERSONALES:"),h.qZA(),h.TgZ(23,"p",14),h._uU(24," La entidad responsable del tratamiento de sus datos es D. David Jesus Molina Retuerto -NATIVOS TIERRRA. Los datos se tratar\xe1n para atender su solicitud de suscripci\xf3n a nuestra Newsletter. En las condiciones legales, tiene derecho a acceder, rectificar y suprimir los datos, a la limitaci\xf3n de su tratamiento, a oponerse al mismo y a su portabilidad. Puede ampliar la informaci\xf3n sobre el tratamiento de sus datos personales consultando nuestra "),h.TgZ(25,"a",15),h._uU(26,"Pol\xedtica de Privacidad"),h.qZA(),h._uU(27,". "),h.qZA()(),h.TgZ(28,"label",16),h._UZ(29,"input",17),h._uU(30," He le\xeddo y acepto la informaci\xf3n sobre el tratamiento de datos personales. "),h.qZA(),h.YNc(31,Va,2,0,"span",9),h.TgZ(32,"label",18),h._UZ(33,"input",19),h._uU(34," Marque si tambi\xe9n desea recibir otro tipo de informaci\xf3n comercial de nuestros productos o servicios. "),h.qZA()()(),h.TgZ(35,"div",20)(36,"button",21),h._uU(37,"Enviar"),h.qZA()()()()()()),2&x&&(h.xp6(4),h.Q6J("formGroup",A.formNewsletter),h.xp6(8),h.Q6J("ngIf",A.campoValido("nombre")&&A.submitted),h.xp6(6),h.Q6J("ngIf",A.campoValido("email")&&A.submitted),h.xp6(7),h.Q6J("routerLink",h.DdM(5,ia)),h.xp6(6),h.Q6J("ngIf",A.campoValido("privacidad")&&A.submitted))},dependencies:[zt.O5,Se._Y,Se.Fj,Se.Wl,Se.JJ,Se.JL,Se.sg,Se.u,a.yS],styles:["form[_ngcontent-%COMP%]{padding:0}"]}),T})();var ra=Bt(9300);const ja=function(){return{fullScreenBackdrop:!0}};let qa=(()=>{class T{constructor(x,A,X,Ie){this.route=x,this.router=A,this.checkoutService=X,this.socketService=Ie,this.loading=!0,this.mensaje="Esperando la confirmaci\xf3n del pago"}ngOnInit(){if("success"===this.route.snapshot.queryParamMap.get("resultadoCompra")){const A=this.route.snapshot.queryParamMap.get("sesion_compra_eventoId");this.mensajesSuscription=this.socketService.listen("sesion_compra_finalizada").pipe((0,ra.h)(X=>X===A)).subscribe(X=>{console.log("resultado",X),this.loading=!1,this.mensaje="Compra finalizada con exito",setTimeout(()=>{this.router.navigateByUrl("/home")},3e3)})}else this.loading=!1,this.mensaje="Compra cancelada o fallida, redireccionando...",setTimeout(()=>{this.router.navigateByUrl("/home")},3e3)}ngOnDestroy(){this.mensajesSuscription.unsubscribe()}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(a.gz),h.Y36(a.F0),h.Y36(bo),h.Y36(Tt))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-stripe-checkout"]],decls:4,vars:4,consts:[[1,"container",2,"min-height","40vh"],[1,"encabezado","color-accent","center"],[3,"show","config"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2),h.qZA()(),h._UZ(3,"ngx-loading",2)),2&x&&(h.xp6(2),h.Oqu(A.mensaje),h.xp6(1),h.Q6J("show",A.loading)("config",h.DdM(3,ja)))},dependencies:[So.RJ]}),T})();const Ga=Qe.N.base_url;let vs=(()=>{class T{constructor(x){this.http=x}enviarVerificacion(x,A,X){return console.log(x,A),this.http.post(`${Ga}/validar-compras/${X}/`,x,{headers:{token:A}})}}return T.\u0275fac=function(x){return new(x||T)(h.LFG(Ii.eN))},T.\u0275prov=h.Yz7({token:T,factory:T.\u0275fac,providedIn:"root"}),T})();function yr(T,S){1&T&&(h.TgZ(0,"span",17),h._uU(1,"Introduzca su nombre"),h.qZA())}function Xr(T,S){1&T&&(h.TgZ(0,"span",17),h._uU(1,"No es un email v\xe1lido"),h.qZA())}function oa(T,S){1&T&&(h.TgZ(0,"span",17),h._uU(1,"Debe aceptar la pol\xedtica de privacidad "),h.qZA())}function Wr(T,S){1&T&&(h.TgZ(0,"span",15),h._uU(1,"No es un email v\xe1lido"),h.qZA())}function $a(T,S){1&T&&(h.TgZ(0,"span",15),h._uU(1,"Introduzca su password"),h.qZA())}function vn(T,S){1&T&&(h.TgZ(0,"span",15),h._uU(1,"Debe aceptar la pol\xedtica de privacidad "),h.qZA())}const Ln=[{path:"",component:dt,children:[{path:"home",component:_r},{path:"nosotros",component:js},{path:"cursos",component:us},{path:"donde",component:Qn},{path:"contacto",component:La},{path:"eventos",component:cs},{path:"revistas",component:Fl},{path:"eventos/eventos-especialidad/:id",component:Oa},{path:"especialistas",component:$s},{path:"especialistas/especialistas-especialidad/:id",component:Ol},{path:"newsletter",component:na},{path:"stripe-checkout",component:qa},{path:"verificar_compras_clientes/:token",component:(()=>{class T{constructor(x,A,X,Ie){this.routeParam=x,this.fb=A,this.newsletterService=X,this.verificarCompraClienteService=Ie,this.submitted=!1,this.token="",this.formVerificacionCliente=this.fb.group({email:["",[Se.kI.required,Se.kI.email]],nombre:["",Se.kI.required],privacidad:[!1,Se.kI.requiredTrue],info_comercial:[!1]})}ngOnInit(){this.token=this.routeParam.snapshot.paramMap.get("token")}campoValido(x){return this.formVerificacionCliente.get(x)?.invalid||!1}onSubmit(){this.submitted=!0,this.formVerificacionCliente.valid&&(!0===this.formVerificacionCliente.get("info_comercial").value&&this.newsletterService.postUser(this.formVerificacionCliente.value).subscribe(x=>{$t().fire("Suscrito","Te has suscrito correctamente","success")},x=>{$t().fire("Error",x.error.errors.errors[0].msg||"Error","error")}),this.verificarCompraClienteService.enviarVerificacion(this.formVerificacionCliente.value,this.token,"cliente").subscribe(x=>{$t().fire("Evento validado","has validado el evento correctamente","success"),this.formVerificacionCliente.reset()},x=>{$t().fire("Evento no validado",x.error.msg,"error")}))}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(a.gz),h.Y36(Se.qu),h.Y36(Mo),h.Y36(vs))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-verificar-compras"]],decls:30,vars:4,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],["id","contacto",1,"box-donde","color-accent"],[3,"formGroup","ngSubmit"],[1,"fila","gap-20"],[1,"columna","gap-20","email-nombre"],[1,"columna","gap-10"],["for","nombre",1,"encabezado","color-accent"],["type","text","name","nombre","id","","formControlName","nombre","placeholder","Manuel"],["class","caption color-red",4,"ngIf"],["for","email",1,"encabezado","color-accent"],["type","email","name","email","formControlName","email","placeholder","tuemail@email.es"],["for","privacidad",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","privacidad","formControlName","privacidad"],["for","info_comercial",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","info_comercial","formControlName","info_comercial"],["type","submit",1,"boton","btn-login","end"],[1,"caption","color-red"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Verificaci\xf3n asistencia evento"),h.qZA(),h.TgZ(3,"div",2)(4,"form",3),h.NdJ("ngSubmit",function(){return A.onSubmit()}),h.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),h._uU(9,"Nombre:"),h.qZA(),h.TgZ(10,"div",6),h._UZ(11,"input",8),h.YNc(12,yr,2,0,"span",9),h.qZA()(),h.TgZ(13,"div",6)(14,"label",10),h._uU(15,"Email:"),h.qZA(),h.TgZ(16,"div",6),h._UZ(17,"input",11),h.YNc(18,Xr,2,0,"span",9),h.qZA()(),h.TgZ(19,"div",6),h._UZ(20,"app-proteccion-datos-personales"),h.TgZ(21,"label",12),h._UZ(22,"input",13),h._uU(23," He le\xeddo y acepto la informaci\xf3n sobre el tratamiento de datos personales "),h.qZA(),h.YNc(24,oa,2,0,"span",9),h.TgZ(25,"label",14),h._UZ(26,"input",15),h._uU(27," Marque si desea recibir informaci\xf3n comercial de nuestros productos o servicios. "),h.qZA()(),h.TgZ(28,"button",16),h._uU(29,"Enviar"),h.qZA()()()()()()),2&x&&(h.xp6(4),h.Q6J("formGroup",A.formVerificacionCliente),h.xp6(8),h.Q6J("ngIf",A.campoValido("nombre")&&A.submitted),h.xp6(6),h.Q6J("ngIf",A.campoValido("email")&&A.submitted),h.xp6(6),h.Q6J("ngIf",A.campoValido("privacidad")&&A.submitted))},dependencies:[zt.O5,mn,Se._Y,Se.Fj,Se.Wl,Se.JJ,Se.JL,Se.sg,Se.u]}),T})()},{path:"verificar_compras_especialistas/:token",component:(()=>{class T{constructor(x,A,X){this.routeParam=x,this.fb=A,this.verificarCompraClienteService=X,this.submitted=!1,this.token="",this.formVerificacionEspecialista=this.fb.group({email:["",[Se.kI.required,Se.kI.email]],privacidad:[!1,Se.kI.requiredTrue],info_comercial:[!1],password:["",[Se.kI.required,Se.kI.minLength(8)]]})}ngOnInit(){this.token=this.routeParam.snapshot.paramMap.get("token")}campoValido(x){return this.formVerificacionEspecialista.get(x)?.invalid||!1}onSubmit(){this.submitted=!0,this.formVerificacionEspecialista.valid&&this.verificarCompraClienteService.enviarVerificacion(this.formVerificacionEspecialista.value,this.token,"especialista").subscribe(x=>{$t().fire("Evento validado","Has validado el evento correctamente","success"),this.formVerificacionEspecialista.reset()},x=>{$t().fire("Evento no validado",x.error.msg,"error")})}}return T.\u0275fac=function(x){return new(x||T)(h.Y36(a.gz),h.Y36(Se.qu),h.Y36(vs))},T.\u0275cmp=h.Xpm({type:T,selectors:[["app-verificar-compras-especialista"]],decls:27,vars:4,consts:[[1,"container"],[1,"title-xl-primary","color-accent","pad-20","center"],["id","contacto",1,"box-donde","color-accent"],[3,"formGroup","ngSubmit"],[1,"fila","gap-20"],[1,"columna","gap-20","email-nombre"],[1,"columna","gap-10"],["for","email",1,"encabezado","color-accent"],["type","email","name","email","formControlName","email","placeholder","tuemail@email.es"],["class","caption color-red",4,"ngIf"],["for","password",1,"encabezado","color-accent"],["type","password","name","password","formControlName","password","placeholder","*******"],["for","privacidad",1,"form-control","texto-regular","color-accent"],["type","checkbox","name","privacidad","formControlName","privacidad"],["type","submit",1,"boton","btn-login","end"],[1,"caption","color-red"]],template:function(x,A){1&x&&(h.TgZ(0,"div",0)(1,"h3",1),h._uU(2,"Verificaci\xf3n realizaci\xf3n evento/servicio"),h.qZA(),h.TgZ(3,"div",2)(4,"form",3),h.NdJ("ngSubmit",function(){return A.onSubmit()}),h.TgZ(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),h._uU(9,"Email:"),h.qZA(),h.TgZ(10,"div",6),h._UZ(11,"input",8),h.YNc(12,Wr,2,0,"span",9),h.qZA()(),h.TgZ(13,"div",6)(14,"label",10),h._uU(15,"Password:"),h.qZA(),h.TgZ(16,"div",6),h._UZ(17,"input",11),h.YNc(18,$a,2,0,"span",9),h.qZA()(),h.TgZ(19,"div",6),h._UZ(20,"app-proteccion-datos-personales"),h.TgZ(21,"label",12),h._UZ(22,"input",13),h._uU(23," He le\xeddo y acepto la informaci\xf3n sobre el tratamiento de datos personales "),h.qZA(),h.YNc(24,vn,2,0,"span",9),h.qZA(),h.TgZ(25,"button",14),h._uU(26,"Enviar"),h.qZA()()()()()()),2&x&&(h.xp6(4),h.Q6J("formGroup",A.formVerificacionEspecialista),h.xp6(8),h.Q6J("ngIf",A.campoValido("email")&&A.submitted),h.xp6(6),h.Q6J("ngIf",A.campoValido("password")&&A.submitted),h.xp6(6),h.Q6J("ngIf",A.campoValido("privacidad")&&A.submitted))},dependencies:[zt.O5,mn,Se._Y,Se.Fj,Se.Wl,Se.JJ,Se.JL,Se.sg,Se.u]}),T})()},{path:"",redirectTo:"home",pathMatch:"full"},{path:"**",redirectTo:"dashboard"}]}];let Ul=(()=>{class T{}return T.\u0275fac=function(x){return new(x||T)},T.\u0275mod=h.oAB({type:T}),T.\u0275inj=h.cJS({imports:[zt.ez,a.Bz.forChild(Ln),a.Bz]}),T})(),Xa=(()=>{class T{}return T.\u0275fac=function(x){return new(x||T)},T.\u0275mod=h.oAB({type:T}),T.\u0275inj=h.cJS({imports:[zt.ez,Se.u5,Rc.m,Se.UX,a.Bz]}),T})(),Hr=(()=>{class T{}return T.\u0275fac=function(x){return new(x||T)},T.\u0275mod=h.oAB({type:T}),T.\u0275inj=h.cJS({imports:[zt.ez,Xa,Rc.m,Ul,Se.u5,Se.UX,So.q.forRoot({animationType:So.Sn.wanderingCubes,backdropBackgroundColour:"rgba(0,0,0,0.1)",backdropBorderRadius:"4px",primaryColour:"#ffffff",secondaryColour:"#ffffff",tertiaryColour:"#ffffff"})]}),T})()},9898:function(Yh){Yh.exports=function(){"use strict";var Go,Bt,Ds;function zt(a,h){if(Go)if(Bt){var Cn="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Go+")(sharedChunk); ("+Bt+")(sharedChunk); self.onerror = null;",rn={};Go(rn),Ds=h(rn),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ds.workerUrl=window.URL.createObjectURL(new Blob([Cn],{type:"text/javascript"})))}else Bt=h;else Go=h}return zt(0,function(a){var h=typeof self<"u"?self:{},Cn="2.11.1";let rn;const lt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==rn){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{rn=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{rn=t}}return rn},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},_t={supported:!1,testSupport:function(t){!An&&Ai&&(uo?ho(t):wi=t)}};let wi,Ai,An=!1,uo=!1;function ho(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ai),t.isContextLost())return;_t.supported=!0}catch{}t.deleteTexture(e),An=!0}h.document&&(Ai=h.document.createElement("img"),Ai.onload=function(){wi&&ho(wi),wi=null,uo=!0},Ai.onerror=function(){An=!0,wi=null},Ai.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const on="01";var or=sn;function sn(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}sn.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var s=this.sampleCurveX(i)-t;if(Math.abs(s)<e)return i;var c=this.sampleCurveDerivativeX(i);if(Math.abs(c)<1e-6)break;i-=s/c}var p=0,f=1;for(i=t,r=0;r<20&&(s=this.sampleCurveX(i),!(Math.abs(s-t)<e));r++)t>s?p=i:f=i,i=.5*(f-p)+p;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Oe=an;function an(t,e){this.x=t,this.y=e}an.prototype={clone:function(){return new an(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),s=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},an.convert=function(t){return t instanceof an?t:Array.isArray(t)?new an(t[0],t[1]):t};const sr=Math.PI/180,$o=180/Math.PI;function vt(t){return t*sr}function li(t){return t*$o}const Xo=[[0,0],[1,0],[1,1],[0,1]];function po(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Ir(t,e,i,r){const s=new or(t,e,i,r);return function(c){return s.solve(c)}}const fo=Ir(.25,.1,.25,1);function yt(t,e,i){return Math.min(i,Math.max(e,t))}function Mr(t,e,i){return(i=yt((i-t)/(e-t),0,1))*i*(3-2*i)}function Gt(t,e,i){const r=i-e,s=((t-e)%r+r)%r+e;return s===e?i:s}function Nn(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const s=new Array(t.length);let c=null;t.forEach((p,f)=>{e(p,(_,g)=>{_&&(c=_),s[f]=g,0==--r&&i(c,s)})})}function pi(t){const e=[];for(const i in t)e.push(t[i]);return e}function Kt(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}let kr=1;function mo(){return kr++}function Xi(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function cn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ar(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function lr(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Wi(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Sn(t,e,i){const r={};for(const s in t)r[s]=e.call(i||this,t[s],s,t);return r}function zr(t,e,i){const r={};for(const s in t)e.call(i||this,t[s],s,t)&&(r[s]=t[s]);return r}function Ti(t){return Array.isArray(t)?t.map(Ti):"object"==typeof t&&t?Sn(t,Ti):t}const _o={};function Jt(t){_o[t]||(typeof console<"u"&&console.warn(t),_o[t]=!0)}function di(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function wt(t){let e=0;for(let i,r,s=0,c=t.length,p=c-1;s<c;p=s++)i=t[s],r=t[p],e+=(r.x-i.x)*(i.y+r.y);return e}function Hi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Wo(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,s,c)=>{const p=s||c;return e[r]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let un=null;function cr(t){if(null==un){const e=t.navigator?t.navigator.userAgent:null;un=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return un}function go(t){try{const e=h[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function In(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Ho="mapbox-tiles";let Ei,Vn,Pr=500,yo=50;function Mn(){try{return h.caches}catch{}}function kn(){Mn()&&!Ei&&(Ei=h.caches.open(Ho))}function Dr(t){const e=t.indexOf("?");if(e<0)return t;const r=function(s){const c=s.indexOf("?");return c>0?s.slice(c+1).split("&"):[]}(t).filter(s=>{const c=s.split("=");return"language"===c[0]||"worldview"===c[0]});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let zn=1/0;const Si={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Si);class xo extends Error{constructor(e,i,r){401===i&&Rr(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ur=Hi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===h.location.protocol?h.parent:h).location.href,jn=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(ur())&&!/^\w+:/.test(i))){if(h.fetch&&h.Request&&h.AbortController&&h.Request.prototype.hasOwnProperty("signal"))return function(r,s){const c=new h.AbortController,p=new h.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:ur(),signal:c.signal});let f=!1,_=!1;const g=(v=p.url).indexOf("sku=")>0&&Rr(v);var v;"json"===r.type&&p.headers.set("Accept","application/json");const E=(k,z,L)=>{if(_)return;if(k&&"SecurityError"!==k.message&&Jt(k),z&&L)return C(z);const O=Date.now();h.fetch(p).then(H=>{if(H.ok){const ne=g?H.clone():null;return C(H,ne,O)}return s(new xo(H.statusText,H.status,r.url))}).catch(H=>{20!==H.code&&s(new Error(H.message))})},C=(k,z,L)=>{("arrayBuffer"===r.type?k.arrayBuffer():"json"===r.type?k.json():k.text()).then(O=>{_||(z&&L&&function(H,ne,W){if(kn(),!Ei)return;const K={status:ne.status,statusText:ne.statusText,headers:new h.Headers};ne.headers.forEach((_e,fe)=>K.headers.set(fe,_e));const oe=Wo(ne.headers.get("Cache-Control")||"");if(oe["no-store"])return;oe["max-age"]&&K.headers.set("Expires",new Date(W+1e3*oe["max-age"]).toUTCString());const ee=K.headers.get("Expires");ee&&(new Date(ee).getTime()-W<42e4||function(_e,fe){if(void 0===Vn)try{new Response(new ReadableStream),Vn=!0}catch{Vn=!1}Vn?fe(_e.body):_e.blob().then(fe)}(ne,_e=>{const fe=new h.Response(_e,K);kn(),Ei&&Ei.then(be=>be.put(Dr(H.url),fe)).catch(be=>Jt(be.message))}))}(p,z,L),f=!0,s(null,O,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(O=>{_||s(new Error(O.message))})};return g?function(k,z){if(kn(),!Ei)return z(null);const L=Dr(k.url);Ei.then(O=>{O.match(L).then(H=>{const ne=function(W){if(!W)return!1;const K=new Date(W.headers.get("Expires")||0),oe=Wo(W.headers.get("Cache-Control")||"");return K>Date.now()&&!oe["no-cache"]}(H);O.delete(L),ne&&O.put(L,H.clone()),z(null,H,ne)}).catch(z)}).catch(z)}(p,E):E(null,null),{cancel:()=>{_=!0,f||c.abort()}}}(t,e);if(Hi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,s){const c=new h.XMLHttpRequest;c.open(r.method||"GET",r.url,!0),"arrayBuffer"===r.type&&(c.responseType="arraybuffer");for(const p in r.headers)c.setRequestHeader(p,r.headers[p]);return"json"===r.type&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials="include"===r.credentials,c.onerror=()=>{s(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||0===c.status)&&null!==c.response){let p=c.response;if("json"===r.type)try{p=JSON.parse(c.response)}catch(f){return s(f)}s(null,p,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else s(new xo(c.statusText,c.status,r.url))},c.send(r.body),{cancel:()=>c.abort()}}(t,e)},qn=function(t,e){return jn(Kt(t,{type:"arrayBuffer"}),e)};function vo(t){const e=h.document.createElement("a");return e.href=t,e.protocol===h.document.location.protocol&&e.host===h.document.location.host}const Jo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Gn,$n;Gn=[],$n=0;const Lr=function(t,e){if(_t.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),$n>=lt.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Gn.push(c),c}$n++;let i=!1;const r=()=>{if(!i)for(i=!0,$n--;Gn.length&&$n<lt.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Gn.shift(),{requestParameters:p,callback:f,cancelled:_}=c;_||(c.cancel=Lr(p,f).cancel)}},s=qn(t,(c,p,f,_)=>{r(),c?e(c):p&&(h.createImageBitmap?function(g,v){const E=new h.Blob([new Uint8Array(g)],{type:"image/png"});h.createImageBitmap(E).then(C=>{v(null,C)}).catch(C=>{v(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(g,v)=>e(g,v,f,_)):function(g,v){const E=new h.Image,C=h.URL;E.onload=()=>{v(null,E),C.revokeObjectURL(E.src),E.onload=null,h.requestAnimationFrame(()=>{E.src=Jo})},E.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new h.Blob([new Uint8Array(g)],{type:"image/png"});E.src=g.byteLength?C.createObjectURL(k):Jo}(p,(g,v)=>e(g,v,f,_)))});return{cancel:()=>{s.cancel(),r()}}},hr="NO_ACCESS_TOKEN";function hn(t){return 0===t.indexOf("mapbox:")}function Rr(t){return lt.API_URL_REGEX.test(t)}function Yo(t){return lt.API_STYLE_REGEX.test(t)&&!Br(t)}function Br(t){return lt.API_SPRITE_REGEX.test(t)}const pr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ri(t){const e=t.match(pr);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function dr(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function fr(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(h.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class pn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=fr(lt.ACCESS_TOKEN);let r="";return r=i&&i.u?h.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(s,c)=>String.fromCharCode(Number("0x"+c)))):lt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=go("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const s=h.localStorage.getItem(i);s&&(this.eventData=JSON.parse(s));const c=h.localStorage.getItem(r);c&&(this.anonId=c)}catch{Jt("Unable to read from LocalStorage")}}saveEventData(){const e=go("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{h.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&h.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Jt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,s){if(!lt.EVENTS_URL)return;const c=Ri(lt.EVENTS_URL);c.params.push(`access_token=${s||lt.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString()},f=i?Kt(p,i):p,_={url:dr(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};var v;this.pendingRequest=(v=g=>{this.pendingRequest=null,r(g),this.saveEventData(),this.processRequests(s)},jn(Kt(_,{method:"POST"}),v))}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const $=new class extends pn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){lt.EVENTS_URL&&lt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>hn(i)||Rr(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=fr(lt.ACCESS_TOKEN),i=e?e.u:lt.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;ar(this.anonId)||(this.anonId=Xi(),r=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),p=new Date(s),f=(s-this.eventData.lastSuccess)/864e5;r=r||f>=1||f<-1||c.getDate()!==p.getDate()}else r=!0;r?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Cn,skuId:on,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=s,this.eventData.tokenU=i)},t):this.processRequests()}},P=$.postTurnstileEvent.bind($),R=new class extends pn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,lt.EVENTS_URL&&(i||lt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(hr)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ar(this.anonId)||(this.anonId=Xi()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Cn,skuId:on,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},q=R.postMapLoadEvent.bind(R),Y=new class extends pn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){lt.EVENTS_URL&&(t||lt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(s){const c=h.performance.getEntriesByType("resource"),p=h.performance.getEntriesByType("mark"),f=function(C){const k={};if(C)for(const z in C)if("other"!==z)for(const L of C[z]){const O=`${z}RequestCount`,H=`${z}ResolveRangeMin`,ne=`${z}ResolveRangeMax`;k[H]=Math.min(k[H]||1/0,L.startTime),k[ne]=Math.max(k[ne]||-1/0,L.responseEnd),void 0===k[O]&&(k[O]=0),++k[O]}return k}(function(C,k){const z={};if(C)for(const L of C){const O=k(L);void 0===z[O]&&(z[O]=[]),z[O].push(L)}return z}(c,qe)),_=h.devicePixelRatio,g=h.navigator.connection||h.navigator.mozConnection||h.navigator.webkitConnection,v={counters:[],metadata:[],attributes:[]},E=(C,k,z)=>{null!=z&&C.push({name:k,value:z.toString()})};for(const C in f)E(v.counters,C,f[C]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(E(v.counters,"interactionRangeMin",s.interactionRange[0]),E(v.counters,"interactionRangeMax",s.interactionRange[1])),p)for(const C of Object.keys(he)){const k=he[C],z=p.find(L=>L.name===k);z&&E(v.counters,k,z.startTime)}return E(v.counters,"visibilityHidden",s.visibilityHidden),E(v.attributes,"style",function(C){if(C)for(const k of C){const z=k.name.split("?")[0];if(Yo(z)){const L=z.split("/").slice(-2);if(2===L.length)return`mapbox://styles/${L[0]}/${L[1]}`}}}(c)),E(v.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),E(v.attributes,"fogEnabled",s.fogEnabled?"true":"false"),E(v.attributes,"projection",s.projection.name),E(v.attributes,"zoom",s.zoom),E(v.metadata,"devicePixelRatio",_),E(v.metadata,"connectionEffectiveType",g?g.effectiveType:void 0),E(v.metadata,"navigatorUserAgent",h.navigator.userAgent),E(v.metadata,"screenWidth",h.screen.width),E(v.metadata,"screenHeight",h.screen.height),E(v.metadata,"windowWidth",h.innerWidth),E(v.metadata,"windowHeight",h.innerHeight),E(v.metadata,"mapWidth",s.width/_),E(v.metadata,"mapHeight",s.height/_),E(v.metadata,"webglRenderer",s.renderer),E(v.metadata,"webglVendor",s.vendor),E(v.metadata,"sdkVersion",Cn),E(v.metadata,"sdkIdentifier","mapbox-gl-js"),v}(i);for(const s of r.metadata);for(const s of r.counters);for(const s of r.attributes);this.postEvent(e,r,()=>{},t)}},Q=Y.postPerformanceEvent.bind(Y),ue=new class extends pn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!lt.API_URL||!lt.SESSION_PATH)return;const s=Ri(lt.API_URL+lt.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${r||lt.ACCESS_TOKEN||""}`);const c={url:dr(s),headers:{"Content-Type":"text/plain"}};var f;this.pendingRequest=(f=p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(r)},jn(Kt(c,{method:"GET"}),f))}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,lt.SESSION_PATH&&lt.API_URL&&(i||lt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(hr)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},ce=ue.getSessionAPI.bind(ue),se=new Set,he={create:"create",load:"load",fullLoad:"fullLoad"},Ae={mark(t){h.performance.mark(t)},measure(t,e,i){h.performance.measure(t,e,i)}};function qe(t){const e=t.name.split("?")[0];return e.includes("mapbox-gl.js")?"javascript":e.includes("mapbox-gl.css")?"css":lt.API_FONTS_REGEX.test(e)?"fontRange":Br(e)?"sprite":Yo(e)?"style":lt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const Me=h.performance;function Ke(t){const e=t?t.url.toString():void 0;return Me.getEntriesByName(e)}let He,Je,Qe,pt;const Tt={now:()=>void 0!==Qe?Qe:h.performance.now(),setNow(t){Qe=t},restoreNow(){Qe=void 0},frame(t){const e=h.requestAnimationFrame(t);return{cancel:()=>h.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;pt||(pt=h.document.createElement("canvas"));const s=pt.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return(i>pt.width||r>pt.height)&&(pt.width=i,pt.height=r),s.clearRect(-e,-e,i+2*e,r+2*e),s.drawImage(t,0,0,i,r),s.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(He||(He=h.document.createElement("a")),He.href=t,He.href),get devicePixelRatio(){return h.devicePixelRatio},get prefersReducedMotion(){return!!h.matchMedia&&(null==Je&&(Je=h.matchMedia("(prefers-reduced-motion: reduce)")),Je.matches)}};function it(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function Mt(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class Dt{constructor(e,i={}){Kt(this,i),this.type=e}}class Xn extends Dt{constructor(e,i={}){super("error",Kt({error:e},i))}}class Pn{on(e,i){return this._listeners=this._listeners||{},it(e,i,this._listeners),this}off(e,i){return Mt(e,i,this._listeners),Mt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},it(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){"string"==typeof e&&(e=new Dt(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const s=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const f of s)f.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const f of c)Mt(r,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(Kt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Xn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var ve=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ci(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function oi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Wn(t){if(Array.isArray(t))return t.map(Wn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Wn(t[i]);return e}return oi(t)}class Ca extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var dn=Ca;class Or{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,s]of i)this.bindings[r]=s}concat(e){return new Or(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Aa=Or;const Fr={kind:"null"},Ve={kind:"number"},dt={kind:"string"},xt={kind:"boolean"},fn={kind:"color"},Ii={kind:"object"},gt={kind:"value"},Ji={kind:"collator"},Ur={kind:"formatted"},Zr={kind:"resolvedImage"};function Vi(t,e){return{kind:"array",itemType:t,N:e}}function Nt(t){if("array"===t.kind){const e=Nt(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const kl=[Fr,Ve,dt,xt,fn,Ur,Ii,Vi(gt),Zr];function Se(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Se(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const i of kl)if(!Se(i,e))return null}return`Expected ${Nt(t)} but found ${Nt(e)} instead.`}function Qo(t,e){return e.some(i=>i.kind===t.kind)}function $t(t,e){return e.some(i=>"null"===i?null===t:"array"===i?Array.isArray(t):"object"===i?t&&!Array.isArray(t)&&"object"==typeof t:i===typeof t)}var Ls,bo={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ko(t){return(t=Math.round(t))<0?0:t>255?255:t}function wo(t){return Ko("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function To(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function mn(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Ls={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in bo)return bo[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),s=i.indexOf(")");if(-1!==r&&s+1===i.length){var c=i.substr(0,r),p=i.substr(r+1,s-(r+1)).split(","),f=1;switch(c){case"rgba":if(4!==p.length)return null;f=To(p.pop());case"rgb":return 3!==p.length?null:[wo(p[0]),wo(p[1]),wo(p[2]),f];case"hsla":if(4!==p.length)return null;f=To(p.pop());case"hsl":if(3!==p.length)return null;var _=(parseFloat(p[0])%360+360)%360/360,g=To(p[1]),v=To(p[2]),E=v<=.5?v*(g+1):v+g-v*g,C=2*v-E;return[Ko(255*mn(C,E,_+1/3)),Ko(255*mn(C,E,_)),Ko(255*mn(C,E,_-1/3)),f];default:return null}}return null}}catch{}class fi{constructor(e,i,r,s=1){this.r=e,this.g=i,this.b=r,this.a=s}static parse(e){if(!e)return;if(e instanceof fi)return e;if("string"!=typeof e)return;const i=Ls(e);return i?new fi(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${s})`}toArray(){const{r:e,g:i,b:r,a:s}=this;return 0===s?[0,0,0,0]:[255*e/s,255*i/s,255*r/s,s]}toArray01(){const{r:e,g:i,b:r,a:s}=this;return 0===s?[0,0,0,0]:[e/s,i/s,r/s,s]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a:s}=this;return[e,i,r,s]}}fi.black=new fi(0,0,0,1),fi.white=new fi(1,1,1,1),fi.transparent=new fi(0,0,0,0),fi.red=new fi(1,0,0,1),fi.blue=new fi(0,0,1,1);var ri=fi;class Eo{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class es{constructor(e,i,r,s,c){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=s,this.textColor=c}}class Mi{constructor(e){this.sections=e}static fromString(e){return new Mi([new es(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Mi?e:Mi.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class Bi{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Bi({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Sa(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mr(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof ri||t instanceof Eo||t instanceof Mi||t instanceof Bi)return!0;if(Array.isArray(t)){for(const e of t)if(!mr(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!mr(t[e]))return!1;return!0}return!1}function ei(t){if(null===t)return Fr;if("string"==typeof t)return dt;if("boolean"==typeof t)return xt;if("number"==typeof t)return Ve;if(t instanceof ri)return fn;if(t instanceof Eo)return Ji;if(t instanceof Mi)return Ur;if(t instanceof Bi)return Zr;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const s=ei(r);if(i){if(i===s)continue;i=gt;break}i=s}return Vi(i||gt,e)}return Ii}function Co(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ri||t instanceof Mi||t instanceof Bi?t.toString():JSON.stringify(t)}class Rs{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!mr(e[1]))return i.error("invalid value");const r=e[1];let s=ei(r);const c=i.expectedType;return"array"!==s.kind||0!==s.N||!c||"array"!==c.kind||"number"==typeof c.N&&0!==c.N||(s=c),new Rs(s,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ri?["rgba"].concat(this.value.toArray()):this.value instanceof Mi?this.value.serialize():this.value}}var Ao=Rs,yi=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Bs={string:dt,number:Ve,boolean:xt,object:Ii};class Os{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,s=1;const c=e[0];if("array"===c){let f,_;if(e.length>2){const g=e[1];if("string"!=typeof g||!(g in Bs)||"object"===g)return i.error('The item type argument of "array" must be one of string, number, boolean',1);f=Bs[g],s++}else f=gt;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);_=e[2],s++}r=Vi(f,_)}else r=Bs[c];const p=[];for(;s<e.length;s++){const f=i.parse(e[s],s,gt);if(!f)return null;p.push(f)}return new Os(r,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!Se(this.type,ei(r)))return r;if(i===this.args.length-1)throw new yi(`Expected value to be of type ${Nt(this.type)}, but found ${Nt(ei(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){i.push(r.kind);const s=e.N;("number"==typeof s||this.args.length>1)&&i.push(s)}}return i.concat(this.args.map(r=>r.serialize()))}}var _n=Os;class Hn{constructor(e){this.type=Ur,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return i.error("First argument must be an image or text section.");const s=[];let c=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(c&&"object"==typeof f&&!Array.isArray(f)){c=!1;let _=null;if(f["font-scale"]&&(_=i.parse(f["font-scale"],1,Ve),!_))return null;let g=null;if(f["text-font"]&&(g=i.parse(f["text-font"],1,Vi(dt)),!g))return null;let v=null;if(f["text-color"]&&(v=i.parse(f["text-color"],1,fn),!v))return null;const E=s[s.length-1];E.scale=_,E.font=g,E.textColor=v}else{const _=i.parse(e[p],1,gt);if(!_)return null;const g=_.type.kind;if("string"!==g&&"value"!==g&&"null"!==g&&"resolvedImage"!==g)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,s.push({content:_,scale:null,font:null,textColor:null})}}return new Hn(s)}evaluate(e){return new Mi(this.sections.map(i=>{const r=i.content.evaluate(e);return ei(r)===Zr?new es("",r,null,null,null):new es(Co(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class ts{constructor(e){this.type=Zr,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const r=i.parse(e[1],1,dt);return r?new ts(r):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),r=Bi.fromString(i);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(i)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const zl={"to-boolean":xt,"to-color":fn,"to-number":Ve,"to-string":dt};class Fs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return i.error("Expected one argument.");const s=zl[r],c=[];for(let p=1;p<e.length;p++){const f=i.parse(e[p],p,gt);if(!f)return null;c.push(f)}return new Fs(s,c)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let i,r;for(const s of this.args){if(i=s.evaluate(e),r=null,i instanceof ri)return i;if("string"==typeof i){const c=e.parseColor(i);if(c)return c}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Sa(i[0],i[1],i[2],i[3]),!r))return new ri(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new yi(r||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const r of this.args){if(i=r.evaluate(e),null===i)return 0;const s=Number(i);if(!isNaN(s))return s}throw new yi(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?Mi.fromString(Co(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Bi.fromString(Co(this.args[0].evaluate(e))):Co(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Hn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ts(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Nr=Fs;const Pl=["Unknown","Point","LineString","Polygon"];var Ia=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Pl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ri.parse(t)),e}};class Jn{constructor(e,i,r,s){this.name=e,this.type=i,this._evaluate=r,this.args=s}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],s=Jn.definitions[r];if(!s)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(s)?s[0]:s.type,p=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,f=p.filter(([g])=>!Array.isArray(g)||g.length===e.length-1);let _=null;for(const[g,v]of f){_=new $s(i.registry,i.path,null,i.scope);const E=[];let C=!1;for(let k=1;k<e.length;k++){const z=e[k],L=Array.isArray(g)?g[k-1]:g.type,O=_.parse(z,1+E.length,L);if(!O){C=!0;break}E.push(O)}if(!C)if(Array.isArray(g)&&g.length!==E.length)_.error(`Expected ${g.length} arguments, but found ${E.length} instead.`);else{for(let k=0;k<E.length;k++){const z=Array.isArray(g)?g[k]:g.type,L=E[k];_.concat(k+1).checkSubtype(z,L.type)}if(0===_.errors.length)return new Jn(r,c,v,E)}}if(1===f.length)i.errors.push(..._.errors);else{const g=(f.length?f:p).map(([E])=>{return C=E,Array.isArray(C)?`(${C.map(Nt).join(", ")})`:`(${Nt(C.type)}...)`;var C}).join(" | "),v=[];for(let E=1;E<e.length;E++){const C=i.parse(e[E],1+v.length);if(!C)return null;v.push(Nt(C.type))}i.error(`Expected arguments of type ${g}, but found (${v.join(", ")}) instead.`)}return null}static register(e,i){Jn.definitions=i;for(const r in i)e[r]=Jn}}var Yi=Jn;class is{constructor(e,i,r){this.type=Ji,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return i.error("Collator options argument must be an object.");const s=i.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,xt);if(!s)return null;const c=i.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,xt);if(!c)return null;let p=null;return r.locale&&(p=i.parse(r.locale,1,dt),!p)?null:new is(s,c,p)}evaluate(e){return new Eo(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Yn=8192;function Us(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ns(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function gn(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(i*s*Yn),Math.round(r*s*Yn)]}function Ma(t,e,i){const r=t[0]-e[0],s=t[1]-e[1],c=t[0]-i[0],p=t[1]-i[1];return r*p-c*s==0&&r*c<=0&&s*p<=0}function rs(t,e){let i=!1;for(let p=0,f=e.length;p<f;p++){const _=e[p];for(let g=0,v=_.length;g<v-1;g++){if(Ma(t,_[g],_[g+1]))return!1;(s=_[g])[1]>(r=t)[1]!=(c=_[g+1])[1]>r[1]&&r[0]<(c[0]-s[0])*(r[1]-s[1])/(c[1]-s[1])+s[0]&&(i=!i)}}var r,s,c;return i}function ka(t,e){for(let i=0;i<e.length;i++)if(rs(t,e[i]))return!0;return!1}function Zs(t,e,i,r){const s=r[0]-i[0],c=r[1]-i[1],p=(t[0]-i[0])*c-s*(t[1]-i[1]),f=(e[0]-i[0])*c-s*(e[1]-i[1]);return p>0&&f<0||p<0&&f>0}function So(t,e,i){for(const g of i)for(let v=0;v<g.length-1;++v)if((f=[(p=g[v+1])[0]-(c=g[v])[0],p[1]-c[1]])[0]*(_=[(s=e)[0]-(r=t)[0],s[1]-r[1]])[1]-f[1]*_[0]!=0&&Zs(r,s,c,p)&&Zs(c,p,r,s))return!0;var r,s,c,p,f,_;return!1}function Ns(t,e){for(let i=0;i<t.length;++i)if(!rs(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(So(t[i],t[i+1],e))return!1;return!0}function Vs(t,e){for(let i=0;i<e.length;i++)if(Ns(t,e[i]))return!0;return!1}function _r(t,e,i){const r=[];for(let s=0;s<t.length;s++){const c=[];for(let p=0;p<t[s].length;p++){const f=gn(t[s][p],i);Us(e,f),c.push(f)}r.push(c)}return r}function js(t,e,i){const r=[];for(let s=0;s<t.length;s++){const c=_r(t[s],e,i);r.push(c)}return r}function Vr(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const s=.5*r;let c=t[0]-i[0]>s?-r:i[0]-t[0]>s?r:0;0===c&&(c=t[0]-i[2]>s?-r:i[2]-t[0]>s?r:0),t[0]+=c}Us(e,t)}function os(t,e,i,r){const s=Math.pow(2,r.z)*Yn,c=[r.x*Yn,r.y*Yn],p=[];if(!t)return p;for(const f of t)for(const _ of f){const g=[_.x+c[0],_.y+c[1]];Vr(g,e,i,s),p.push(g)}return p}function qs(t,e,i,r){const s=Math.pow(2,r.z)*Yn,c=[r.x*Yn,r.y*Yn],p=[];if(!t)return p;for(const _ of t){const g=[];for(const v of _){const E=[v.x+c[0],v.y+c[1]];Us(e,E),g.push(E)}p.push(g)}if(e[2]-e[0]<=s/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const _ of p)for(const g of _)Vr(g,e,i,s)}var f;return p}class yn{constructor(e,i){this.type=xt,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(mr(e[1])){const r=e[1];if("FeatureCollection"===r.type)for(let s=0;s<r.features.length;++s){const c=r.features[s].geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new yn(r,r.features[s].geometry)}else if("Feature"===r.type){const s=r.geometry.type;if("Polygon"===s||"MultiPolygon"===s)return new yn(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new yn(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,r){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if("Polygon"===r.type){const f=_r(r.coordinates,c,p),_=os(i.geometry(),s,c,p);if(!ns(s,c))return!1;for(const g of _)if(!rs(g,f))return!1}if("MultiPolygon"===r.type){const f=js(r.coordinates,c,p),_=os(i.geometry(),s,c,p);if(!ns(s,c))return!1;for(const g of _)if(!ka(g,f))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,r){const s=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if("Polygon"===r.type){const f=_r(r.coordinates,c,p),_=qs(i.geometry(),s,c,p);if(!ns(s,c))return!1;for(const g of _)if(!Ns(g,f))return!1}if("MultiPolygon"===r.type){const f=js(r.coordinates,c,p),_=qs(i.geometry(),s,c,p);if(!ns(s,c))return!1;for(const g of _)if(!Vs(g,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var At=yn;function Io(t){if(t instanceof Yi&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof At)return!1;let e=!0;return t.eachChild(i=>{e&&!Io(i)&&(e=!1)}),e}function ss(t){if(t instanceof Yi&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(i=>{e&&!ss(i)&&(e=!1)}),e}function as(t,e){if(t instanceof Yi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!as(r,e)&&(i=!1)}),i}class ls{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new ls(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Gs=ls;class cs{constructor(e,i=[],r,s=new Aa,c=[]){this.registry=e,this.path=i,this.key=i.map(p=>`[${p}]`).join(""),this.scope=s,this.errors=c,this.expectedType=r}parse(e,i,r,s,c={}){return i?this.concat(i,r,s)._parse(e,c):this._parse(e,c)}_parse(e,i){function r(s,c,p){return"assert"===p?new _n(c,[s]):"coerce"===p?new Nr(c,[s]):s}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const s=e[0];if("string"!=typeof s)return this.error(`Expression name must be a string, but found ${typeof s} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const c=this.registry[s];if(c){let p=c.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,_=p.type;if("string"!==f.kind&&"number"!==f.kind&&"boolean"!==f.kind&&"object"!==f.kind&&"array"!==f.kind||"value"!==_.kind)if("color"!==f.kind&&"formatted"!==f.kind&&"resolvedImage"!==f.kind||"value"!==_.kind&&"string"!==_.kind){if(this.checkSubtype(f,_))return null}else p=r(p,f,i.typeAnnotation||"coerce");else p=r(p,f,i.typeAnnotation||"assert")}if(!(p instanceof Ao)&&"resolvedImage"!==p.type.kind&&us(p)){const f=new Ia;try{p=new Ao(p.type,p.evaluate(f))}catch(_){return this.error(_.message),null}}return p}return this.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const s="number"==typeof e?this.path.concat(e):this.path,c=r?this.scope.concat(r):this.scope;return new cs(this.registry,s,i||null,c,this.errors)}error(e,...i){const r=`${this.key}${i.map(s=>`[${s}]`).join("")}`;this.errors.push(new dn(r,e))}checkSubtype(e,i){const r=Se(e,i);return r&&this.error(r),r}}var $s=cs;function us(t){if(t instanceof Gs)return us(t.boundExpression);if(t instanceof Yi&&"error"===t.name||t instanceof is||t instanceof At)return!1;const e=t instanceof Nr||t instanceof _n;let i=!0;return t.eachChild(r=>{i=e?i&&us(r):i&&r instanceof Ao}),!!i&&Io(t)&&as(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function gr(t,e){const i=t.length-1;let r,s,c=0,p=i,f=0;for(;c<=p;)if(f=Math.floor((c+p)/2),r=t[f],s=t[f+1],r<=e){if(f===i||e<s)return f;c=f+1}else{if(!(r>e))throw new yi("Input is not a number.");p=f-1}return 0}class Qn{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[s,c]of r)this.labels.push(s),this.outputs.push(c)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,Ve);if(!r)return null;const s=[];let c=null;i.expectedType&&"value"!==i.expectedType.kind&&(c=i.expectedType);for(let p=1;p<e.length;p+=2){const f=1===p?-1/0:e[p],_=e[p+1],g=p,v=p+1;if("number"!=typeof f)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(s.length&&s[s.length-1][0]>=f)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',g);const E=i.parse(_,v,c);if(!E)return null;c=c||E.type,s.push([f,E])}return new Qn(c,r,s)}evaluate(e){const i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);const s=this.input.evaluate(e);if(s<=i[0])return r[0].evaluate(e);const c=i.length;return s>=i[c-1]?r[c-1].evaluate(e):r[gr(i,s)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var jr=Qn;function Et(t,e,i){return t*(1-i)+e*i}var qr=Object.freeze({__proto__:null,number:Et,color:function(t,e,i){return new ri(Et(t.r,e.r,i),Et(t.g,e.g,i),Et(t.b,e.b,i),Et(t.a,e.a,i))},array:function(t,e,i){return t.map((r,s)=>Et(r,e[s],i))}});const Pa=4/29,hs=6/29,Da=3*hs*hs,La=Math.PI/180,Ra=180/Math.PI;function Xs(t){return t>.008856451679035631?Math.pow(t,1/3):t/Da+Pa}function ps(t){return t>hs?t*t*t:Da*(t-Pa)}function Ws(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ds(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Hs(t){const e=ds(t.r),i=ds(t.g),r=ds(t.b),s=Xs((.4124564*e+.3575761*i+.1804375*r)/.95047),c=Xs((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*c-16,a:500*(s-c),b:200*(c-Xs((.0193339*e+.119192*i+.9503041*r)/1.08883)),alpha:t.a}}function Ba(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*ps(e),i=.95047*ps(i),r=1.08883*ps(r),new ri(Ws(3.2404542*i-1.5371385*e-.4985314*r),Ws(-.969266*i+1.8760108*e+.041556*r),Ws(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Dl(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const ko={forward:Hs,reverse:Ba,interpolate:function(t,e,i){return{l:Et(t.l,e.l,i),a:Et(t.a,e.a,i),b:Et(t.b,e.b,i),alpha:Et(t.alpha,e.alpha,i)}}},zo={forward:function(t){const{l:e,a:i,b:r}=Hs(t),s=Math.atan2(r,i)*Ra;return{h:s<0?s+360:s,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*La,i=t.c;return Ba({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Dl(t.h,e.h,i),c:Et(t.c,e.c,i),l:Et(t.l,e.l,i),alpha:Et(t.alpha,e.alpha,i)}}};var Oa=Object.freeze({__proto__:null,lab:ko,hcl:zo});class Po{constructor(e,i,r,s,c){this.type=e,this.operator=i,this.interpolation=r,this.input=s,this.labels=[],this.outputs=[];for(const[p,f]of c)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,i,r,s){let c=0;if("exponential"===e.name)c=fs(i,e.base,r,s);else if("linear"===e.name)c=fs(i,1,r,s);else if("cubic-bezier"===e.name){const p=e.controlPoints;c=new or(p[0],p[1],p[2],p[3]).solve(fs(i,1,r,s))}return c}static parse(e,i){let[r,s,c,...p]=e;if(!Array.isArray(s)||0===s.length)return i.error("Expected an interpolation type expression.",1);if("linear"===s[0])s={name:"linear"};else if("exponential"===s[0]){const g=s[1];if("number"!=typeof g)return i.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:g}}else{if("cubic-bezier"!==s[0])return i.error(`Unknown interpolation type ${String(s[0])}`,1,0);{const g=s.slice(1);if(4!==g.length||g.some(v=>"number"!=typeof v||v<0||v>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:g}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(c=i.parse(c,2,Ve),!c)return null;const f=[];let _=null;"interpolate-hcl"===r||"interpolate-lab"===r?_=fn:i.expectedType&&"value"!==i.expectedType.kind&&(_=i.expectedType);for(let g=0;g<p.length;g+=2){const v=p[g],E=p[g+1],C=g+3,k=g+4;if("number"!=typeof v)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(f.length&&f[f.length-1][0]>=v)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const z=i.parse(E,k,_);if(!z)return null;_=_||z.type,f.push([v,z])}return"number"===_.kind||"color"===_.kind||"array"===_.kind&&"number"===_.itemType.kind&&"number"==typeof _.N?new Po(_,r,s,c,f):i.error(`Type ${Nt(_)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);const s=this.input.evaluate(e);if(s<=i[0])return r[0].evaluate(e);const c=i.length;if(s>=i[c-1])return r[c-1].evaluate(e);const p=gr(i,s),f=Po.interpolationFactor(this.interpolation,s,i[p],i[p+1]),_=r[p].evaluate(e),g=r[p+1].evaluate(e);return"interpolate"===this.operator?qr[this.type.kind.toLowerCase()](_,g,f):"interpolate-hcl"===this.operator?zo.reverse(zo.interpolate(zo.forward(_),zo.forward(g),f)):ko.reverse(ko.interpolate(ko.forward(_),ko.forward(g),f))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function fs(t,e,i,r){const s=r-i,c=t-i;return 0===s?0:1===e?c/s:(Math.pow(e,c)-1)/(Math.pow(e,s)-1)}var xn=Po;class Gr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const s=i.expectedType;s&&"value"!==s.kind&&(r=s);const c=[];for(const f of e.slice(1)){const _=i.parse(f,1+c.length,r,void 0,{typeAnnotation:"omit"});if(!_)return null;r=r||_.type,c.push(_)}const p=s&&c.some(f=>Se(s,f.type));return new Gr(p?gt:r,c)}evaluate(e){let i,r=null,s=0;for(const c of this.args){if(s++,r=c.evaluate(e),r&&r instanceof Bi&&!r.available&&(i||(i=r),r=null,s===this.args.length))return i;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ms=Gr;class Js{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let c=1;c<e.length-1;c+=2){const p=e[c];if("string"!=typeof p)return i.error(`Expected string, but found ${typeof p} instead.`,c);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",c);const f=i.parse(e[c+1],c+1);if(!f)return null;r.push([p,f])}const s=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return s?new Js(r,s):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var Ys=Js;class _s{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Ve),s=i.parse(e[2],2,Vi(i.expectedType||gt));return r&&s?new _s(s.type.itemType,r,s):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new yi(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new yi(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new yi(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Fa=_s;class Qs{constructor(e,i){this.type=xt,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,gt),s=i.parse(e[2],2,gt);return r&&s?Qo(r.type,[xt,dt,Ve,Fr,gt])?new Qs(r,s):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!$t(i,["boolean","string","number","null"]))throw new yi(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(ei(i))} instead.`);if(!$t(r,["string","array"]))throw new yi(`Expected second argument to be of type array or string, but found ${Nt(ei(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ll=Qs;class Do{constructor(e,i,r){this.type=Ve,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,gt),s=i.parse(e[2],2,gt);if(!r||!s)return null;if(!Qo(r.type,[xt,dt,Ve,Fr,gt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(r.type)} instead`);if(4===e.length){const c=i.parse(e[3],3,Ve);return c?new Do(r,s,c):null}return new Do(r,s)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!$t(i,["boolean","string","number","null"]))throw new yi(`Expected first argument to be of type boolean, string, number or null, but found ${Nt(ei(i))} instead.`);if(!$t(r,["string","array"]))throw new yi(`Expected second argument to be of type array or string, but found ${Nt(ei(r))} instead.`);if(this.fromIndex){const s=this.fromIndex.evaluate(e);return r.indexOf(i,s)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ua=Do;class gs{constructor(e,i,r,s,c,p){this.inputType=e,this.type=i,this.input=r,this.cases=s,this.outputs=c,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,s;i.expectedType&&"value"!==i.expectedType.kind&&(s=i.expectedType);const c={},p=[];for(let g=2;g<e.length-1;g+=2){let v=e[g];const E=e[g+1];Array.isArray(v)||(v=[v]);const C=i.concat(g);if(0===v.length)return C.error("Expected at least one branch label.");for(const z of v){if("number"!=typeof z&&"string"!=typeof z)return C.error("Branch labels must be numbers or strings.");if("number"==typeof z&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof z&&Math.floor(z)!==z)return C.error("Numeric branch labels must be integer values.");if(r){if(C.checkSubtype(r,ei(z)))return null}else r=ei(z);if(void 0!==c[String(z)])return C.error("Branch labels must be unique.");c[String(z)]=p.length}const k=i.parse(E,g,s);if(!k)return null;s=s||k.type,p.push(k)}const f=i.parse(e[1],1,gt);if(!f)return null;const _=i.parse(e[e.length-1],e.length-1,s);return _?"value"!==f.type.kind&&i.concat(1).checkSubtype(r,f.type)?null:new gs(r,s,f,c,p,_):null}evaluate(e){const i=this.input.evaluate(e);return(ei(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],s={};for(const p of i){const f=s[this.cases[p]];void 0===f?(s[this.cases[p]]=r.length,r.push([this.cases[p],[p]])):r[f][1].push(p)}const c=p=>"number"===this.inputType.kind?Number(p):p;for(const[p,f]of r)e.push(1===f.length?c(f[0]):f.map(c)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var Rl=gs;class Ks{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&"value"!==i.expectedType.kind&&(r=i.expectedType);const s=[];for(let p=1;p<e.length-1;p+=2){const f=i.parse(e[p],p,xt);if(!f)return null;const _=i.parse(e[p+1],p+1,r);if(!_)return null;s.push([f,_]),r=r||_.type}const c=i.parse(e[e.length-1],e.length-1,r);return c?new Ks(r,s,c):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Bl=Ks;class ys{constructor(e,i,r,s){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,gt),s=i.parse(e[2],2,Ve);if(!r||!s)return null;if(!Qo(r.type,[Vi(gt),dt,gt]))return i.error(`Expected first argument to be of type array or string, but found ${Nt(r.type)} instead`);if(4===e.length){const c=i.parse(e[3],3,Ve);return c?new ys(r.type,r,s,c):null}return new ys(r.type,r,s)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!$t(i,["string","array"]))throw new yi(`Expected first argument to be of type array or string, but found ${Nt(ei(i))} instead.`);if(this.endIndex){const s=this.endIndex.evaluate(e);return i.slice(r,s)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var xs=ys;function ea(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ta(t,e,i,r){return 0===r.compare(e,i)}function $r(t,e,i){const r="=="!==t&&"!="!==t;return class Rf{constructor(c,p,f){this.type=xt,this.lhs=c,this.rhs=p,this.collator=f,this.hasUntypedArgument="value"===c.type.kind||"value"===p.type.kind}static parse(c,p){if(3!==c.length&&4!==c.length)return p.error("Expected two or three arguments.");const f=c[0];let _=p.parse(c[1],1,gt);if(!_)return null;if(!ea(f,_.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${Nt(_.type)}'.`);let g=p.parse(c[2],2,gt);if(!g)return null;if(!ea(f,g.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${Nt(g.type)}'.`);if(_.type.kind!==g.type.kind&&"value"!==_.type.kind&&"value"!==g.type.kind)return p.error(`Cannot compare types '${Nt(_.type)}' and '${Nt(g.type)}'.`);r&&("value"===_.type.kind&&"value"!==g.type.kind?_=new _n(g.type,[_]):"value"!==_.type.kind&&"value"===g.type.kind&&(g=new _n(_.type,[g])));let v=null;if(4===c.length){if("string"!==_.type.kind&&"string"!==g.type.kind&&"value"!==_.type.kind&&"value"!==g.type.kind)return p.error("Cannot use collator to compare non-string types.");if(v=p.parse(c[3],3,Ji),!v)return null}return new Rf(_,g,v)}evaluate(c){const p=this.lhs.evaluate(c),f=this.rhs.evaluate(c);if(r&&this.hasUntypedArgument){const _=ei(p),g=ei(f);if(_.kind!==g.kind||"string"!==_.kind&&"number"!==_.kind)throw new yi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${_.kind}, ${g.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const _=ei(p),g=ei(f);if("string"!==_.kind||"string"!==g.kind)return e(c,p,f)}return this.collator?i(c,p,f,this.collator.evaluate(c)):e(c,p,f)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(p=>{c.push(p.serialize())}),c}}}const Ol=$r("==",function(t,e,i){return e===i},ta),Fl=$r("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!ta(0,e,i,r)}),Za=$r("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),Na=$r(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),Va=$r("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),ia=$r(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class na{constructor(e,i,r,s,c,p){this.type=dt,this.number=e,this.locale=i,this.currency=r,this.unit=s,this.minFractionDigits=c,this.maxFractionDigits=p}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const r=i.parse(e[1],1,Ve);if(!r)return null;const s=e[2];if("object"!=typeof s||Array.isArray(s))return i.error("NumberFormat options argument must be an object.");let c=null;if(s.locale&&(c=i.parse(s.locale,1,dt),!c))return null;let p=null;if(s.currency&&(p=i.parse(s.currency,1,dt),!p))return null;let f=null;if(s.unit&&(f=i.parse(s.unit,1,dt),!f))return null;let _=null;if(s["min-fraction-digits"]&&(_=i.parse(s["min-fraction-digits"],1,Ve),!_))return null;let g=null;return s["max-fraction-digits"]&&(g=i.parse(s["max-fraction-digits"],1,Ve),!g)?null:new na(r,c,p,f,_,g)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ra{constructor(e){this.type=Ve,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?i.error(`Expected argument of type string or array, but found ${Nt(r.type)} instead.`):new ra(r):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new yi(`Expected value to be of type string or array, but found ${Nt(ei(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const ja={"==":Ol,"!=":Fl,">":Na,"<":Za,">=":ia,"<=":Va,array:_n,at:Fa,boolean:_n,case:Bl,coalesce:ms,collator:is,format:Hn,image:ts,in:Ll,"index-of":Ua,interpolate:xn,"interpolate-hcl":xn,"interpolate-lab":xn,length:ra,let:Ys,literal:Ao,match:Rl,number:_n,"number-format":na,object:_n,slice:xs,step:jr,string:_n,"to-boolean":Nr,"to-color":Nr,"to-number":Nr,"to-string":Nr,var:Gs,within:At};function qa(t,[e,i,r,s]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const c=s?s.evaluate(t):1,p=Sa(e,i,r,c);if(p)throw new yi(p);return new ri(e/255*c,i/255*c,r/255*c,c)}function Ga(t,e){return t in e}function vs(t,e){const i=e[t];return void 0===i?null:i}function yr(t){return{type:t}}Yi.register(ja,{error:[{kind:"error"},[dt],(t,[e])=>{throw new yi(e.evaluate(t))}],typeof:[dt,[gt],(t,[e])=>Nt(ei(e.evaluate(t)))],"to-rgba":[Vi(Ve,4),[fn],(t,[e])=>e.evaluate(t).toArray()],rgb:[fn,[Ve,Ve,Ve],qa],rgba:[fn,[Ve,Ve,Ve,Ve],qa],has:{type:xt,overloads:[[[dt],(t,[e])=>Ga(e.evaluate(t),t.properties())],[[dt,Ii],(t,[e,i])=>Ga(e.evaluate(t),i.evaluate(t))]]},get:{type:gt,overloads:[[[dt],(t,[e])=>vs(e.evaluate(t),t.properties())],[[dt,Ii],(t,[e,i])=>vs(e.evaluate(t),i.evaluate(t))]]},"feature-state":[gt,[dt],(t,[e])=>vs(e.evaluate(t),t.featureState||{})],properties:[Ii,[],t=>t.properties()],"geometry-type":[dt,[],t=>t.geometryType()],id:[gt,[],t=>t.id()],zoom:[Ve,[],t=>t.globals.zoom],pitch:[Ve,[],t=>t.globals.pitch||0],"distance-from-center":[Ve,[],t=>t.distanceFromCenter()],"heatmap-density":[Ve,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ve,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Ve,[],t=>t.globals.skyRadialProgress||0],accumulated:[gt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Ve,yr(Ve),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[Ve,yr(Ve),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:Ve,overloads:[[[Ve,Ve],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Ve],(t,[e])=>-e.evaluate(t)]]},"/":[Ve,[Ve,Ve],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Ve,[Ve,Ve],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Ve,[Ve],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ve,[Ve],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ve,[Ve],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ve,[Ve],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ve,[Ve],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ve,[Ve],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ve,[Ve],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ve,[Ve],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ve,[Ve],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ve,[Ve],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ve,yr(Ve),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Ve,yr(Ve),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Ve,[Ve],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ve,[Ve],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ve,[Ve],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ve,[Ve],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[xt,[dt,gt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[xt,[gt],(t,[e])=>t.id()===e.value],"filter-type-==":[xt,[dt],(t,[e])=>t.geometryType()===e.value],"filter-<":[xt,[dt,gt],(t,[e,i])=>{const r=t.properties()[e.value],s=i.value;return typeof r==typeof s&&r<s}],"filter-id-<":[xt,[gt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[xt,[dt,gt],(t,[e,i])=>{const r=t.properties()[e.value],s=i.value;return typeof r==typeof s&&r>s}],"filter-id->":[xt,[gt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[xt,[dt,gt],(t,[e,i])=>{const r=t.properties()[e.value],s=i.value;return typeof r==typeof s&&r<=s}],"filter-id-<=":[xt,[gt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[xt,[dt,gt],(t,[e,i])=>{const r=t.properties()[e.value],s=i.value;return typeof r==typeof s&&r>=s}],"filter-id->=":[xt,[gt],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[xt,[gt],(t,[e])=>e.value in t.properties()],"filter-has-id":[xt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[xt,[Vi(dt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[xt,[Vi(gt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[xt,[dt,Vi(gt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[xt,[dt,Vi(gt)],(t,[e,i])=>function(r,s,c,p){for(;c<=p;){const f=c+p>>1;if(s[f]===r)return!0;s[f]>r?p=f-1:c=f+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:xt,overloads:[[[xt,xt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[yr(xt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:xt,overloads:[[[xt,xt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[yr(xt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[xt,[xt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[xt,[dt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[dt,[dt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[dt,[dt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[dt,yr(gt),(t,e)=>e.map(i=>Co(i.evaluate(t))).join("")],"resolved-locale":[dt,[Ji],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Xr=ja;function oa(t){return{result:"success",value:t}}function Dn(t){return{result:"error",value:t}}function Wr(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function $a(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function vn(t){return!!t.expression&&t.expression.interpolated}function St(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Ln(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ul(t){return t}function Xa(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],s=r||!(r||void 0!==t.property),c=t.type||(vn(e)?"exponential":"interval");if(i&&((t=Ci({},t)).stops&&(t.stops=t.stops.map(g=>[g[0],ri.parse(g[1])])),t.default=ri.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Oa[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,f,_;if("exponential"===c)p=x;else if("interval"===c)p=S;else if("categorical"===c){p=T,f=Object.create(null);for(const g of t.stops)f[g[0]]=g[1];_=typeof t.stops[0][0]}else{if("identity"!==c)throw new Error(`Unknown function type "${c}"`);p=A}if(r){const g={},v=[];for(let k=0;k<t.stops.length;k++){const z=t.stops[k],L=z[0].zoom;void 0===g[L]&&(g[L]={zoom:L,type:t.type,property:t.property,default:t.default,stops:[]},v.push(L)),g[L].stops.push([z[0].value,z[1]])}const E=[];for(const k of v)E.push([g[k].zoom,Xa(g[k],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:xn.interpolationFactor.bind(void 0,C),zoomStops:E.map(k=>k[0]),evaluate:({zoom:k},z)=>x({stops:E,base:t.base},e,k).evaluate(k,z)}}if(s){const g="exponential"===c?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:g,interpolationFactor:xn.interpolationFactor.bind(void 0,g),zoomStops:t.stops.map(v=>v[0]),evaluate:({zoom:v})=>p(t,e,v,f,_)}}return{kind:"source",evaluate(g,v){const E=v&&v.properties?v.properties[t.property]:void 0;return void 0===E?Hr(t.default,e.default):p(t,e,E,f,_)}}}function Hr(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function T(t,e,i,r,s){return Hr(typeof i===s?r[i]:void 0,t.default,e.default)}function S(t,e,i){if("number"!==St(i))return Hr(t.default,e.default);const r=t.stops.length;if(1===r||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const s=gr(t.stops.map(c=>c[0]),i);return t.stops[s][1]}function x(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==St(i))return Hr(t.default,e.default);const s=t.stops.length;if(1===s||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];const c=gr(t.stops.map(v=>v[0]),i),p=function(v,E,C,k){const z=k-C,L=v-C;return 0===z?0:1===E?L/z:(Math.pow(E,L)-1)/(Math.pow(E,z)-1)}(i,r,t.stops[c][0],t.stops[c+1][0]),f=t.stops[c][1],_=t.stops[c+1][1];let g=qr[e.type]||Ul;if(t.colorSpace&&"rgb"!==t.colorSpace){const v=Oa[t.colorSpace];g=(E,C)=>v.reverse(v.interpolate(v.forward(E),v.forward(C),p))}return"function"==typeof f.evaluate?{evaluate(...v){const E=f.evaluate.apply(void 0,v),C=_.evaluate.apply(void 0,v);if(void 0!==E&&void 0!==C)return g(E,C,p)}}:g(f,_,p)}function A(t,e,i){return"color"===e.type?i=ri.parse(i):"formatted"===e.type?i=Mi.fromString(i.toString()):"resolvedImage"===e.type?i=Bi.fromString(i.toString()):St(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Hr(i,t.default,e.default)}class X{constructor(e,i){var r;this.expression=e,this._warningHistory={},this._evaluator=new Ia,this._defaultValue=i?"color"===(r=i).type&&(Ln(r.default)||Array.isArray(r.default))?new ri(0,0,0,0):"color"===r.type?ri.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,r,s,c,p,f,_){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=s||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=_||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,s,c,p,f,_){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=_||null;try{const g=this.expression.evaluate(this._evaluator);if(null==g||"number"==typeof g&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new yi(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function Ie(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Xr}function et(t,e){const i=new $s(Xr,[],e?function(s){const c={color:fn,string:dt,number:Ve,enum:dt,boolean:xt,formatted:Ur,resolvedImage:Zr};return"array"===s.type?Vi(c[s.value]||gt,s.length):c[s.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?oa(new X(r,e)):Dn(i.errors)}class ti{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!ss(i.expression)}evaluateWithoutErrorHandling(e,i,r,s,c,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,s,c,p)}evaluate(e,i,r,s,c,p){return this._styleExpression.evaluate(e,i,r,s,c,p)}}class ji{constructor(e,i,r,s){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent="camera"!==e&&!ss(i.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,i,r,s,c,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,s,c,p)}evaluate(e,i,r,s,c,p){return this._styleExpression.evaluate(e,i,r,s,c,p)}interpolationFactor(e,i,r){return this.interpolationType?xn.interpolationFactor(this.interpolationType,e,i,r):0}}function Rn(t,e){if("error"===(t=et(t,e)).result)return t;const i=t.value.expression,r=Io(i);if(!r&&!Wr(e))return Dn([new dn("","data expressions not supported")]);const s=as(i,["zoom","pitch","distance-from-center"]);if(!s&&!$a(e))return Dn([new dn("","zoom expressions not supported")]);const c=Jr(i);return c||s?c instanceof dn?Dn([c]):c instanceof xn&&!vn(e)?Dn([new dn("",'"interpolate" expressions cannot be used with this property')]):oa(c?new ji(r?"camera":"composite",t.value,c.labels,c instanceof xn?c.interpolation:void 0):new ti(r?"constant":"source",t.value)):Dn([new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Oi{constructor(e,i){this._parameters=e,this._specification=i,Ci(this,Xa(this._parameters,this._specification))}static deserialize(e){return new Oi(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Jr(t){let e=null;if(t instanceof Ys)e=Jr(t.result);else if(t instanceof ms){for(const i of t.args)if(e=Jr(i),e)break}else(t instanceof jr||t instanceof xn)&&t.input instanceof Yi&&"zoom"===t.input.name&&(e=t);return e instanceof dn||t.eachChild(i=>{const r=Jr(i);r instanceof dn?e=r:!e&&r?e=new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new dn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class je{constructor(e,i,r,s){this.message=(e?`${e}: `:"")+r,s&&(this.identifier=s),null!=i&&i.__line__&&(this.line=i.__line__)}}function xi(t){const e=t.key,i=t.value,r=t.valueSpec||{},s=t.objectElementValidators||{},c=t.style,p=t.styleSpec;let f=[];const _=St(i);if("object"!==_)return[new je(e,i,`object expected, ${_} found`)];for(const g in i){const v=g.split(".")[0],E=r[v]||r["*"];let C;s[v]?C=s[v]:r[v]?C=Fi:s["*"]?C=s["*"]:r["*"]&&(C=Fi),C?f=f.concat(C({key:(e&&`${e}.`)+g,value:i[g],valueSpec:E,style:c,styleSpec:p,object:i,objectKey:g},i)):f.push(new je(e,i[g],`unknown property "${g}"`))}for(const g in r)s[g]||r[g].required&&void 0===r[g].default&&void 0===i[g]&&f.push(new je(e,i,`missing required property "${g}"`));return f}function Zl(t){const e=t.value,i=t.valueSpec,r=t.style,s=t.styleSpec,c=t.key,p=t.arrayElementValidator||Fi;if("array"!==St(e))return[new je(c,e,`array expected, ${St(e)} found`)];if(i.length&&e.length!==i.length)return[new je(c,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new je(c,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let f={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};s.$version<7&&(f.function=i.function),"object"===St(i.value)&&(f=i.value);let _=[];for(let g=0;g<e.length;g++)_=_.concat(p({array:e,arrayIndex:g,value:e[g],valueSpec:f,style:r,styleSpec:s,key:`${c}[${g}]`}));return _}function Bc(t){const e=t.key,i=t.value,r=t.valueSpec;let s=St(i);if("number"===s&&i!=i&&(s="NaN"),"number"!==s)return[new je(e,i,`number expected, ${s} found`)];if("minimum"in r){let c=r.minimum;if("array"===St(r.minimum)&&(c=r.minimum[t.arrayIndex]),i<c)return[new je(e,i,`${i} is less than the minimum value ${c}`)]}if("maximum"in r){let c=r.maximum;if("array"===St(r.maximum)&&(c=r.maximum[t.arrayIndex]),i>c)return[new je(e,i,`${i} is greater than the maximum value ${c}`)]}return[]}function Nl(t){const e=t.valueSpec,i=oi(t.value.type);let r,s,c,p={};const f="categorical"!==i&&void 0===t.value.property,_=!f,g="array"===St(t.value.stops)&&"array"===St(t.value.stops[0])&&"object"===St(t.value.stops[0][0]),v=xi({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(k){if("identity"===i)return[new je(k.key,k.value,'identity function may not have a "stops" property')];let z=[];const L=k.value;return z=z.concat(Zl({key:k.key,value:L,valueSpec:k.valueSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:E})),"array"===St(L)&&0===L.length&&z.push(new je(k.key,L,"array must have at least one stop")),z},default:function(k){return Fi({key:k.key,value:k.value,valueSpec:e,style:k.style,styleSpec:k.styleSpec})}}});return"identity"===i&&f&&v.push(new je(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||v.push(new je(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!vn(t.valueSpec)&&v.push(new je(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(_&&!Wr(t.valueSpec)?v.push(new je(t.key,t.value,"property functions not supported")):f&&!$a(t.valueSpec)&&v.push(new je(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!g||void 0!==t.value.property||v.push(new je(t.key,t.value,'"property" property is required')),v;function E(k){let z=[];const L=k.value,O=k.key;if("array"!==St(L))return[new je(O,L,`array expected, ${St(L)} found`)];if(2!==L.length)return[new je(O,L,`array length 2 expected, length ${L.length} found`)];if(g){if("object"!==St(L[0]))return[new je(O,L,`object expected, ${St(L[0])} found`)];if(void 0===L[0].zoom)return[new je(O,L,"object stop key must have zoom")];if(void 0===L[0].value)return[new je(O,L,"object stop key must have value")];const H=oi(L[0].zoom);if("number"!=typeof H)return[new je(O,L[0].zoom,"stop zoom values must be numbers")];if(c&&c>H)return[new je(O,L[0].zoom,"stop zoom values must appear in ascending order")];H!==c&&(c=H,s=void 0,p={}),z=z.concat(xi({key:`${O}[0]`,value:L[0],valueSpec:{zoom:{}},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:Bc,value:C}}))}else z=z.concat(C({key:`${O}[0]`,value:L[0],valueSpec:{},style:k.style,styleSpec:k.styleSpec},L));return Ie(Wn(L[1]))?z.concat([new je(`${O}[1]`,L[1],"expressions are not allowed in function stops.")]):z.concat(Fi({key:`${O}[1]`,value:L[1],valueSpec:e,style:k.style,styleSpec:k.styleSpec}))}function C(k,z){const L=St(k.value),O=oi(k.value),H=null!==k.value?k.value:z;if(r){if(L!==r)return[new je(k.key,H,`${L} stop domain type must match previous stop domain type ${r}`)]}else r=L;if("number"!==L&&"string"!==L&&"boolean"!==L&&"number"!=typeof O&&"string"!=typeof O&&"boolean"!=typeof O)return[new je(k.key,H,"stop domain value must be a number, string, or boolean")];if("number"!==L&&"categorical"!==i){let ne=`number expected, ${L} found`;return Wr(e)&&void 0===i&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new je(k.key,H,ne)]}return"categorical"!==i||"number"!==L||"number"==typeof O&&isFinite(O)&&Math.floor(O)===O?"categorical"!==i&&"number"===L&&"number"==typeof O&&"number"==typeof s&&void 0!==s&&O<s?[new je(k.key,H,"stop domain values must appear in ascending order")]:(s=O,"categorical"===i&&O in p?[new je(k.key,H,"stop domain values must be unique")]:(p[O]=!0,[])):[new je(k.key,H,`integer expected, found ${String(O)}`)]}}function xr(t){const e=("property"===t.expressionContext?Rn:et)(Wn(t.value),t.valueSpec);if("error"===e.result)return e.value.map(r=>new je(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new je(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!ss(i))return[new je(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Oc(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!as(i,["zoom","feature-state"]))return[new je(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Io(i))return[new je(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Oc(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const s of e.valueSpec.expression.parameters)i.delete(s);if(0===i.size)return[];const r=[];return t instanceof Yi&&i.has(t.name)?[new je(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(s=>{r.push(...Oc(s,e))}),r)}function Wa(t){const e=t.key,i=t.value,r=t.valueSpec,s=[];return Array.isArray(r.values)?-1===r.values.indexOf(oi(i))&&s.push(new je(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(oi(i))&&s.push(new je(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),s}function Vl(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Vl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ha(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Vl(t)||(t=Ya(t));const i=t;let r=!0;try{r=function(g){if(!vr(g))return g;let v=Wn(g);return sa(v),v=Fc(v),v}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const s=ve[`filter_${e}`],c=et(r,s);let p=null;if("error"===c.result)throw new Error(c.value.map(g=>`${g.key}: ${g.message}`).join(", "));p=(g,v,E)=>c.value.evaluate(g,v,{},E);let f=null,_=null;if(r!==i){const g=et(i,s);if("error"===g.result)throw new Error(g.value.map(v=>`${v.key}: ${v.message}`).join(", "));f=(v,E,C,k,z)=>g.value.evaluate(v,E,{},C,void 0,void 0,k,z),_=!Io(g.value.expression)}return{filter:p,dynamicFilter:f||void 0,needGeometry:Uc(r),needFeature:!!_}}function Fc(t){if(!Array.isArray(t))return t;const e=function(i){if(ln.has(i[0]))for(let r=1;r<i.length;r++)if(vr(i[r]))return!0;return i}(t);return!0===e?e:e.map(i=>Fc(i))}function sa(t){let e=!1;const i=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)e=e||vr(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||vr(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||vr(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)sa(t[r])}function vr(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<t.length;i++)if(vr(t[i]))return!0;return!1}const ln=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ja(t,e){return t<e?-1:t>e?1:0}function Uc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Uc(t[e]))return!0;return!1}function Ya(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?jl(t[1],t[2],"=="):"!="===e?Ka(jl(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?jl(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Ya))):"all"===e?["all"].concat(t.slice(1).map(Ya)):"none"===e?["all"].concat(t.slice(1).map(Ya).map(Ka)):"in"===e?Zc(t[1],t.slice(2)):"!in"===e?Ka(Zc(t[1],t.slice(2))):"has"===e?Qa(t[1]):"!has"===e?Ka(Qa(t[1])):"within"!==e||t;var i}function jl(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Zc(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Ja)]]:["filter-in-small",t,["literal",e]]}}function Qa(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ka(t){return["!",t]}function aa(t){return Vl(Wn(t.value))?xr(Ci({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Nc(t)}function Nc(t){const e=t.value,i=t.key;if("array"!==St(e))return[new je(i,e,`array expected, ${St(e)} found`)];const r=t.styleSpec;let s,c=[];if(e.length<1)return[new je(i,e,"filter array must have at least 1 element")];switch(c=c.concat(Wa({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),oi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===oi(e[1])&&c.push(new je(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&c.push(new je(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(s=St(e[1]),"string"!==s&&c.push(new je(`${i}[1]`,e[1],`string expected, ${s} found`)));for(let p=2;p<e.length;p++)s=St(e[p]),"$type"===oi(e[1])?c=c.concat(Wa({key:`${i}[${p}]`,value:e[p],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&c.push(new je(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${s} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)c=c.concat(Nc({key:`${i}[${p}]`,value:e[p],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":s=St(e[1]),2!==e.length?c.push(new je(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==s&&c.push(new je(`${i}[1]`,e[1],`string expected, ${s} found`));break;case"within":s=St(e[1]),2!==e.length?c.push(new je(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==s&&c.push(new je(`${i}[1]`,e[1],`object expected, ${s} found`))}return c}function Vc(t,e){const i=t.key,r=t.style,s=t.styleSpec,c=t.value,p=t.objectKey,f=s[`${e}_${t.layerType}`];if(!f)return[];const _=p.match(/^(.*)-transition$/);if("paint"===e&&_&&f[_[1]]&&f[_[1]].transition)return Fi({key:i,value:c,valueSpec:s.transition,style:r,styleSpec:s});const g=t.valueSpec||f[p];if(!g)return[new je(i,c,`unknown property "${p}"`)];let v;if("string"===St(c)&&Wr(g)&&!g.tokens&&(v=/^{([^}]+)}$/.exec(c)))return[new je(i,c,`"${p}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(v[1])} }\`.`)];const E=[];return"symbol"===t.layerType&&("text-field"===p&&r&&!r.glyphs&&E.push(new je(i,c,'use of "text-field" requires a style "glyphs" property')),"text-font"===p&&Ln(Wn(c))&&"identity"===oi(c.type)&&E.push(new je(i,c,'"text-font" does not support identity functions'))),E.concat(Fi({key:t.key,value:c,valueSpec:g,style:r,styleSpec:s,expressionContext:"property",propertyType:e,propertyKey:p}))}function el(t){return Vc(t,"paint")}function jc(t){return Vc(t,"layout")}function ql(t){let e=[];const i=t.value,r=t.key,s=t.style,c=t.styleSpec;i.type||i.ref||e.push(new je(r,i,'either "type" or "ref" is required'));let p=oi(i.type);const f=oi(i.ref);if(i.id){const _=oi(i.id);for(let g=0;g<t.arrayIndex;g++){const v=s.layers[g];oi(v.id)===_&&e.push(new je(r,i.id,`duplicate layer id "${i.id}", previously used at line ${v.id.__line__}`))}}if("ref"in i){let _;["type","source","source-layer","filter","layout"].forEach(g=>{g in i&&e.push(new je(r,i[g],`"${g}" is prohibited for ref layers`))}),s.layers.forEach(g=>{oi(g.id)===f&&(_=g)}),_?_.ref?e.push(new je(r,i.ref,"ref cannot reference another ref layer")):p=oi(_.type):"string"==typeof f&&e.push(new je(r,i.ref,`ref layer "${f}" not found`))}else if("background"!==p&&"sky"!==p)if(i.source){const _=s.sources&&s.sources[i.source],g=_&&oi(_.type);_?"vector"===g&&"raster"===p?e.push(new je(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===g&&"raster"!==p?e.push(new je(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==g||i["source-layer"]?"raster-dem"===g&&"hillshade"!==p?e.push(new je(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==p||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===g&&_.lineMetrics||e.push(new je(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new je(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new je(r,i.source,`source "${i.source}" not found`))}else e.push(new je(r,i,'missing required property "source"'));return e=e.concat(xi({key:r,value:i,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fi({key:`${r}.type`,value:i.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:_=>aa(Ci({layerType:p},_)),layout:_=>xi({layer:i,key:_.key,value:_.value,valueSpec:{},style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":g=>jc(Ci({layerType:p},g))}}),paint:_=>xi({layer:i,key:_.key,value:_.value,valueSpec:{},style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":g=>el(Ci({layerType:p},g))}})}})),e}function Lo(t){const e=t.value,i=t.key,r=St(e);return"string"!==r?[new je(i,e,`string expected, ${r} found`)]:[]}const qc={promoteId:function({key:t,value:e}){if("string"===St(e))return Lo({key:t,value:e});{const i=[];for(const r in e)i.push(...Lo({key:`${t}.${r}`,value:e[r]}));return i}}};function tl(t){const e=t.value,i=t.key,r=t.styleSpec,s=t.style;if(!e.type)return[new je(i,e,'"type" is required')];const c=oi(e.type);let p;switch(c){case"vector":case"raster":case"raster-dem":return p=xi({key:i,value:e,valueSpec:r[`source_${c.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:qc}),p;case"geojson":if(p=xi({key:i,value:e,valueSpec:r.source_geojson,style:s,styleSpec:r,objectElementValidators:qc}),e.cluster)for(const f in e.clusterProperties){const[_,g]=e.clusterProperties[f],v="string"==typeof _?[_,["accumulated"],["get",f]]:_;p.push(...xr({key:`${i}.${f}.map`,value:g,expressionContext:"cluster-map"})),p.push(...xr({key:`${i}.${f}.reduce`,value:v,expressionContext:"cluster-reduce"}))}return p;case"video":return xi({key:i,value:e,valueSpec:r.source_video,style:s,styleSpec:r});case"image":return xi({key:i,value:e,valueSpec:r.source_image,style:s,styleSpec:r});case"canvas":return[new je(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wa({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:s,styleSpec:r})}}function la(t){const e=t.value,i=t.styleSpec,r=i.light,s=t.style;let c=[];const p=St(e);if(void 0===e)return c;if("object"!==p)return c=c.concat([new je("light",e,`object expected, ${p} found`)]),c;for(const f in e){const _=f.match(/^(.*)-transition$/);c=c.concat(_&&r[_[1]]&&r[_[1]].transition?Fi({key:f,value:e[f],valueSpec:i.transition,style:s,styleSpec:i}):r[f]?Fi({key:f,value:e[f],valueSpec:r[f],style:s,styleSpec:i}):[new je(f,e[f],`unknown property "${f}"`)])}return c}function Gl(t){const e=t.value,i=t.key,r=t.style,s=t.styleSpec,c=s.terrain;let p=[];const f=St(e);if(void 0===e)return p;if("object"!==f)return p=p.concat([new je("terrain",e,`object expected, ${f} found`)]),p;for(const _ in e){const g=_.match(/^(.*)-transition$/);p=p.concat(g&&c[g[1]]&&c[g[1]].transition?Fi({key:_,value:e[_],valueSpec:s.transition,style:r,styleSpec:s}):c[_]?Fi({key:_,value:e[_],valueSpec:c[_],style:r,styleSpec:s}):[new je(_,e[_],`unknown property "${_}"`)])}if(e.source){const _=r.sources&&r.sources[e.source],g=_&&oi(_.type);_?"raster-dem"!==g&&p.push(new je(i,e.source,`terrain cannot be used with a source of type ${String(g)}, it only be used with a "raster-dem" source type`)):p.push(new je(i,e.source,`source "${e.source}" not found`))}else p.push(new je(i,e,'terrain is missing required property "source"'));return p}function Gc(t){const e=t.value,i=t.style,r=t.styleSpec,s=r.fog;let c=[];const p=St(e);if(void 0===e)return c;if("object"!==p)return c=c.concat([new je("fog",e,`object expected, ${p} found`)]),c;for(const f in e){const _=f.match(/^(.*)-transition$/);c=c.concat(_&&s[_[1]]&&s[_[1]].transition?Fi({key:f,value:e[f],valueSpec:r.transition,style:i,styleSpec:r}):s[f]?Fi({key:f,value:e[f],valueSpec:s[f],style:i,styleSpec:r}):[new je(f,e[f],`unknown property "${f}"`)])}return c}const $l={"*":()=>[],array:Zl,boolean:function(t){const e=t.value,i=t.key,r=St(e);return"boolean"!==r?[new je(i,e,`boolean expected, ${r} found`)]:[]},number:Bc,color:function(t){const e=t.key,i=t.value,r=St(i);return"string"!==r?[new je(e,i,`color expected, ${r} found`)]:null===Ls(i)?[new je(e,i,`color expected, "${i}" found`)]:[]},enum:Wa,filter:aa,function:Nl,layer:ql,object:xi,source:tl,light:la,terrain:Gl,fog:Gc,string:Lo,formatted:function(t){return 0===Lo(t).length?[]:xr(t)},resolvedImage:function(t){return 0===Lo(t).length?[]:xr(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,s=t.style;let c=[];const p=St(e);if("object"===p)for(const f in e)c=c.concat(Fi({key:f,value:e[f],valueSpec:r[f],style:s,styleSpec:i}));else"string"!==p&&(c=c.concat([new je("projection",e,`object or string expected, ${p} found`)]));return c}};function Fi(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&Ln(oi(e))?Nl(t):i.expression&&Ie(Wn(e))?xr(t):i.type&&$l[i.type]?$l[i.type](t):xi(Ci({},t,{valueSpec:i.type?r[i.type]:i}))}function Xl(t){const e=t.value,i=t.key,r=Lo(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new je(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new je(i,e,'"glyphs" url must include a "{range}" token'))),r}function $c(t,e=ve){return br(Fi({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Xl,"*":()=>[]}}))}const $u=t=>br(el(t)),Xu=t=>br(jc(t));function br(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Wl(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new Xn(new Error(r.message))),i=!0;return i}var bs=Kn;function Kn(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(i=s[2]);for(var c=0;c<this.d*this.d;c++){var p=s[3+c],f=s[3+c+1];r.push(p===f?null:s.subarray(p,f))}var _=s[3+r.length+1];this.keys=s.subarray(s[3+r.length],_),this.bboxes=s.subarray(_),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var g=0;g<this.d*this.d;g++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var v=i/e*t;this.min=-v,this.max=t+v}Kn.prototype.insert=function(t,e,i,r,s){this._forEachCell(e,i,r,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(s)},Kn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Kn.prototype._insertCell=function(t,e,i,r,s,c){this.cells[s].push(c)},Kn.prototype.query=function(t,e,i,r,s){var c=this.min,p=this.max;if(t<=c&&e<=c&&p<=i&&p<=r&&!s)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(t,e,i,r,this._queryCell,f,{},s),f},Kn.prototype._queryCell=function(t,e,i,r,s,c,p,f){var _=this.cells[s];if(null!==_)for(var g=this.keys,v=this.bboxes,E=0;E<_.length;E++){var C=_[E];if(void 0===p[C]){var k=4*C;(f?f(v[k+0],v[k+1],v[k+2],v[k+3]):t<=v[k+2]&&e<=v[k+3]&&i>=v[k+0]&&r>=v[k+1])?(p[C]=!0,c.push(g[C])):p[C]=!1}}},Kn.prototype._forEachCell=function(t,e,i,r,s,c,p,f){for(var _=this._convertToCellCoord(t),g=this._convertToCellCoord(e),v=this._convertToCellCoord(i),E=this._convertToCellCoord(r),C=_;C<=v;C++)for(var k=g;k<=E;k++){var z=this.d*k+C;if((!f||f(this._convertFromCellCoord(C),this._convertFromCellCoord(k),this._convertFromCellCoord(C+1),this._convertFromCellCoord(k+1)))&&s.call(this,t,e,i,r,z,c,p,f))return}},Kn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Kn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Kn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var s=new Int32Array(e+i+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var c=e,p=0;p<t.length;p++){var f=t[p];s[3+p]=c,s.set(f,c),c+=f.length}return s[3+t.length]=c,s.set(this.keys,c),s[3+t.length+1]=c+=this.keys.length,s.set(this.bboxes,c),c+=this.bboxes.length,s.buffer};const il={};function $e(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),il[e]={klass:t,omit:i.omit||[]}}$e(Object,"Object"),bs.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},bs.deserialize=function(t){return new bs(t.buffer)},Object.defineProperty(bs,"name",{value:"Grid"}),$e(bs,"Grid"),$e(ri,"Color"),$e(Error,"Error"),$e(xo,"AJAXError"),$e(Bi,"ResolvedImage"),$e(Oi,"StylePropertyFunction"),$e(X,"StyleExpression",{omit:["_evaluator"]}),$e(ji,"ZoomDependentExpression"),$e(ti,"ZoomConstantExpression"),$e(Yi,"CompoundExpression",{omit:["_evaluate"]});for(const t in Xr)il[Xr[t]._classRegistryKey]||$e(Xr[t],`Expression${t}`);function Xc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Wc(t){return h.ImageBitmap&&t instanceof h.ImageBitmap}function ca(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Xc(t)||Wc(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof h.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(ca(r,e));return i}if("object"==typeof t){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const s=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const c in t)t.hasOwnProperty(c)&&(il[r].omit.indexOf(c)>=0||(s[c]=ca(t[c],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(s.$name=r),s}throw new Error("can't serialize object of type "+typeof t)}function Yr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Xc(t)||Wc(t)||ArrayBuffer.isView(t)||t instanceof h.ImageData)return t;if(Array.isArray(t))return t.map(Yr);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=il[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const s of Object.keys(t))"$name"!==s&&(r[s]=Yr(t[s]));return r}throw new Error("can't deserialize object of type "+typeof t)}class Hc{constructor(){this.first=!0}update(e,i){const r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const Jc=t=>t>=1536&&t<=1791,ua=t=>t>=1872&&t<=1919,Yc=t=>t>=2208&&t<=2303,Hl=t=>t>=11904&&t<=12031,Qc=t=>t>=12032&&t<=12255,Jl=t=>t>=12272&&t<=12287,ha=t=>t>=12288&&t<=12351,nl=t=>t>=12352&&t<=12447,pa=t=>t>=12448&&t<=12543,rl=t=>t>=12544&&t<=12591,ol=t=>t>=12704&&t<=12735,Kc=t=>t>=12736&&t<=12783,eu=t=>t>=12784&&t<=12799,Yl=t=>t>=12800&&t<=13055,tu=t=>t>=13056&&t<=13311,iu=t=>t>=13312&&t<=19903,Ql=t=>t>=19968&&t<=40959,sl=t=>t>=40960&&t<=42127,nu=t=>t>=42128&&t<=42191,ru=t=>t>=44032&&t<=55215,ou=t=>t>=63744&&t<=64255,Kl=t=>t>=64336&&t<=65023,su=t=>t>=65040&&t<=65055,al=t=>t>=65072&&t<=65103,da=t=>t>=65104&&t<=65135,l=t=>t>=65136&&t<=65279,n=t=>t>=65280&&t<=65519;function o(t){for(const e of t)if(m(e.charCodeAt(0)))return!0;return!1}function u(t){for(const e of t)if(!d(e.charCodeAt(0)))return!1;return!0}function d(t){return!(Jc(t)||ua(t)||Yc(t)||Kl(t)||l(t))}function m(t){return!(746!==t&&747!==t&&(t<4352||!(ol(t)||rl(t)||al(t)&&!(t>=65097&&t<=65103)||ou(t)||tu(t)||Hl(t)||Kc(t)||!(!ha(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||iu(t)||Ql(t)||Yl(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||ru(t)||nl(t)||Jl(t)||(e=>e>=12688&&e<=12703)(t)||Qc(t)||eu(t)||pa(t)&&12540!==t||!(!n(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!da(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||su(t)||(e=>e>=19904&&e<=19967)(t)||sl(t)||nu(t))));var e}function y(t){return!(m(t)||(e=t,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ha(e)||pa(e)||(i=>i>=57344&&i<=63743)(e)||al(e)||da(e)||n(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function b(t){return t>=1424&&t<=2303||Kl(t)||l(t)}function w(t,e){return!(!e&&b(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=t,i>=6016&&i<=6143));var i}function I(t){for(const e of t)if(b(e.charCodeAt(0)))return!0;return!1}const M="deferred",D="loading",B="loaded";let V=null,U="unavailable",j=null;const Z=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(U="error"),V&&V(t)};function F(){G.fire(new Dt("pluginStateChange",{pluginStatus:U,pluginURL:j}))}const G=new Pn,N=function(){return U},te=function(){if(U!==M||!j)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");U=D,F(),j&&qn({url:j},t=>{t?Z(t):(U=B,F())})},ie={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>U===B||null!=ie.applyArabicShaping,isLoading:()=>U===D,setState(t){U=t.pluginStatus,j=t.pluginURL},isParsed:()=>null!=ie.applyArabicShaping&&null!=ie.processBidirectionalText&&null!=ie.processStyledBidirectionalText,getPluginURL:()=>j};class J{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hc,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,r){for(const s of i)if(!w(s.charCodeAt(0),r))return!1;return!0}(e,ie.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*i}}}class re{constructor(e,i){this.property=e,this.value=i,this.expression=function(r,s){if(Ln(r))return new Oi(r,s);if(Ie(r)){const c=Rn(r,s);if("error"===c.result)throw new Error(c.value.map(p=>`${p.key}: ${p.message}`).join(", "));return c.value}{let c=r;return"string"==typeof r&&"color"===s.type&&(c=ri.parse(r)),{kind:"constant",evaluate:()=>c}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class pe{constructor(e){this.property=e,this.value=new re(e,void 0)}transitioned(e,i){return new me(this.property,this.value,i,Kt({},e.transition,this.transition),e.now)}untransitioned(){return new me(this.property,this.value,null,{},0)}}class ge{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ti(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new pe(this._values[e].property)),this._values[e].value=new re(this._values[e].property,null===i?void 0:Ti(i))}getTransition(e){return Ti(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new pe(this._values[e].property)),this._values[e].transition=Ti(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);void 0!==r&&(e[i]=r);const s=this.getTransition(i);void 0!==s&&(e[`${i}-transition`]=s)}return e}transitioned(e,i){const r=new ze(this._properties);for(const s of Object.keys(this._values))r._values[s]=this._values[s].transitioned(e,i._values[s]);return r}untransitioned(){const e=new ze(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class me{constructor(e,i,r,s,c){const p=s.delay||0,f=s.duration||0;c=c||0,this.property=e,this.value=i,this.begin=c+p,this.end=this.begin+f,e.specification.transition&&(s.delay||s.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const s=e.now||0,c=this.value.possiblyEvaluate(e,i,r),p=this.prior;if(p){if(s>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(s<this.begin)return p.possiblyEvaluate(e,i,r);{const f=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,r),c,po(f))}}return c}}class ze{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const s=new Te(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].possiblyEvaluate(e,i,r);return s}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class le{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ti(this._values[e].value)}setValue(e,i){this._values[e]=new re(this._values[e].property,null===i?void 0:Ti(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);void 0!==r&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const s=new Te(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].possiblyEvaluate(e,i,r);return s}}class Ee{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,r,s){return this.property.evaluate(this.value,this.parameters,e,i,r,s)}}class Te{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class de{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const s=qr[this.specification.type];return s?s(e,i,r):e}}class ae{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,s){return new Ee(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},r,s)}:e.expression,i)}interpolate(e,i,r){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new Ee(this,{kind:"constant",value:void 0},e.parameters);const s=qr[this.specification.type];return s?new Ee(this,{kind:"constant",value:s(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,s,c,p){return"constant"===e.kind?e.value:e.evaluate(i,r,s,c,p)}}class Ze extends ae{possiblyEvaluate(e,i,r,s){if(void 0===e.value)return new Ee(this,{kind:"constant",value:void 0},i);if("constant"===e.expression.kind){const c=e.expression.evaluate(i,null,{},r,s),p="resolvedImage"===e.property.specification.type&&"string"!=typeof c?c.name:c,f=this._calculate(p,p,p,i);return new Ee(this,{kind:"constant",value:f},i)}if("camera"===e.expression.kind){const c=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Ee(this,{kind:"constant",value:c},i)}return new Ee(this,e.expression,i)}evaluate(e,i,r,s,c,p){if("source"===e.kind){const f=e.evaluate(i,r,s,c,p);return this._calculate(f,f,f,i)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},r,s),e.evaluate({zoom:Math.floor(i.zoom)},r,s),e.evaluate({zoom:Math.floor(i.zoom)+1},r,s),i):e.value}_calculate(e,i,r,s){return s.zoom>s.zoomHistory.lastIntegerZoom?{from:e,to:i,other:r}:{from:r,to:i,other:e}}interpolate(e){return e}}class Le{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,s){if(void 0!==e.value){if("constant"===e.expression.kind){const c=e.expression.evaluate(i,null,{},r,s);return this._calculate(c,c,c,i)}return this._calculate(e.expression.evaluate(new J(Math.floor(i.zoom-1),i)),e.expression.evaluate(new J(Math.floor(i.zoom),i)),e.expression.evaluate(new J(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,r,s){return s.zoom>s.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:r,to:i}}interpolate(e){return e}}class Fe{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,s){return!!e.expression.evaluate(i,null,{},r,s)}interpolate(){return!1}}class Re{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new J(0,{});for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new re(s,void 0),p=this.defaultTransitionablePropertyValues[r]=new pe(s);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate(i)}}}function We(t,e){return 256*(t=yt(Math.floor(t),0,255))+yt(Math.floor(e),0,255)}$e(ae,"DataDrivenProperty"),$e(de,"DataConstantProperty"),$e(Ze,"CrossFadedDataDrivenProperty"),$e(Le,"CrossFadedProperty"),$e(Fe,"ColorRampProperty");const ot={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class tt{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ye{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Be(t,e=1){let i=0,r=0;return{members:t.map(s=>{const c=ot[s.type].BYTES_PER_ELEMENT,p=i=at(i,Math.max(e,c)),f=s.components||1;return r=Math.max(r,c),i+=c*f,{name:s.name,type:s.type,components:f,offset:p}}),size:at(i,Math.max(r,e)),alignment:e}}function at(t,e){return Math.ceil(t/e)*e}class ft extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.int16[s+0]=i,this.int16[s+1]=r,e}}ft.prototype.bytesPerElement=4,$e(ft,"StructArrayLayout2i4");class Ot extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const c=3*e;return this.int16[c+0]=i,this.int16[c+1]=r,this.int16[c+2]=s,e}}Ot.prototype.bytesPerElement=6,$e(Ot,"StructArrayLayout3i6");class Ft extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=r,this.int16[p+2]=s,this.int16[p+3]=c,e}}Ft.prototype.bytesPerElement=8,$e(Ft,"StructArrayLayout4i8");class Lt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,r,s,c,p,f)}emplace(e,i,r,s,c,p,f,_){const g=6*e,v=12*e,E=3*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.uint8[v+4]=s,this.uint8[v+5]=c,this.uint8[v+6]=p,this.uint8[v+7]=f,this.float32[E+2]=_,e}}Lt.prototype.bytesPerElement=12,$e(Lt,"StructArrayLayout2i4ub1f12");class vi extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=s,this.float32[p+3]=c,e}}vi.prototype.bytesPerElement=16,$e(vi,"StructArrayLayout4f16");class qi extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p,f,_,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,r,s,c,p,f,_,g,v)}emplace(e,i,r,s,c,p,f,_,g,v,E){const C=10*e;return this.uint16[C+0]=i,this.uint16[C+1]=r,this.uint16[C+2]=s,this.uint16[C+3]=c,this.uint16[C+4]=p,this.uint16[C+5]=f,this.uint16[C+6]=_,this.uint16[C+7]=g,this.uint16[C+8]=v,this.uint16[C+9]=E,e}}qi.prototype.bytesPerElement=20,$e(qi,"StructArrayLayout10ui20");class er extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p,f,_){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,s,c,p,f,_)}emplace(e,i,r,s,c,p,f,_,g){const v=8*e;return this.uint16[v+0]=i,this.uint16[v+1]=r,this.uint16[v+2]=s,this.uint16[v+3]=c,this.uint16[v+4]=p,this.uint16[v+5]=f,this.uint16[v+6]=_,this.uint16[v+7]=g,e}}er.prototype.bytesPerElement=16,$e(er,"StructArrayLayout8ui16");class Xt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,r,s,c,p)}emplace(e,i,r,s,c,p,f){const _=6*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=s,this.int16[_+3]=c,this.int16[_+4]=p,this.int16[_+5]=f,e}}Xt.prototype.bytesPerElement=12,$e(Xt,"StructArrayLayout6i12");class ii extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p,f,_,g,v,E,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,r,s,c,p,f,_,g,v,E,C)}emplace(e,i,r,s,c,p,f,_,g,v,E,C,k){const z=12*e;return this.int16[z+0]=i,this.int16[z+1]=r,this.int16[z+2]=s,this.int16[z+3]=c,this.uint16[z+4]=p,this.uint16[z+5]=f,this.uint16[z+6]=_,this.uint16[z+7]=g,this.int16[z+8]=v,this.int16[z+9]=E,this.int16[z+10]=C,this.int16[z+11]=k,e}}ii.prototype.bytesPerElement=24,$e(ii,"StructArrayLayout4i4ui4i24");class Pt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,r,s,c,p)}emplace(e,i,r,s,c,p,f){const _=10*e,g=5*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=s,this.float32[g+2]=c,this.float32[g+3]=p,this.float32[g+4]=f,e}}Pt.prototype.bytesPerElement=20,$e(Pt,"StructArrayLayout3i3f20");class ci extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ci.prototype.bytesPerElement=4,$e(ci,"StructArrayLayout1ul4");class Ui extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p,f,_,g,v,E,C,k){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,r,s,c,p,f,_,g,v,E,C,k)}emplace(e,i,r,s,c,p,f,_,g,v,E,C,k,z){const L=20*e,O=10*e;return this.int16[L+0]=i,this.int16[L+1]=r,this.int16[L+2]=s,this.int16[L+3]=c,this.int16[L+4]=p,this.float32[O+3]=f,this.float32[O+4]=_,this.float32[O+5]=g,this.float32[O+6]=v,this.int16[L+14]=E,this.uint32[O+8]=C,this.uint16[L+18]=k,this.uint16[L+19]=z,e}}Ui.prototype.bytesPerElement=40,$e(Ui,"StructArrayLayout5i4f1i1ul2ui40");class Vt extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,r,s,c,p,f)}emplace(e,i,r,s,c,p,f,_){const g=8*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.int16[g+2]=s,this.int16[g+4]=c,this.int16[g+5]=p,this.int16[g+6]=f,this.int16[g+7]=_,e}}Vt.prototype.bytesPerElement=16,$e(Vt,"StructArrayLayout3i2i2i16");class Qi extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,s,c)}emplace(e,i,r,s,c,p){const f=4*e,_=8*e;return this.float32[f+0]=i,this.float32[f+1]=r,this.float32[f+2]=s,this.int16[_+6]=c,this.int16[_+7]=p,e}}Qi.prototype.bytesPerElement=16,$e(Qi,"StructArrayLayout2f1f2i16");class Ro extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const p=12*e,f=3*e;return this.uint8[p+0]=i,this.uint8[p+1]=r,this.float32[f+1]=s,this.float32[f+2]=c,e}}Ro.prototype.bytesPerElement=12,$e(Ro,"StructArrayLayout2ub2f12");class Bn extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const c=3*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=s,e}}Bn.prototype.bytesPerElement=12,$e(Bn,"StructArrayLayout3f12");class Gi extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,i,r)}emplace(e,i,r,s){const c=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=r,this.uint16[c+2]=s,e}}Gi.prototype.bytesPerElement=6,$e(Gi,"StructArrayLayout3ui6");class ws extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p,f,_,g,v,E,C,k,z,L,O,H,ne,W,K,oe){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,i,r,s,c,p,f,_,g,v,E,C,k,z,L,O,H,ne,W,K,oe)}emplace(e,i,r,s,c,p,f,_,g,v,E,C,k,z,L,O,H,ne,W,K,oe,ee){const _e=30*e,fe=15*e,be=60*e;return this.int16[_e+0]=i,this.int16[_e+1]=r,this.int16[_e+2]=s,this.float32[fe+2]=c,this.float32[fe+3]=p,this.uint16[_e+8]=f,this.uint16[_e+9]=_,this.uint32[fe+5]=g,this.uint32[fe+6]=v,this.uint32[fe+7]=E,this.uint16[_e+16]=C,this.uint16[_e+17]=k,this.uint16[_e+18]=z,this.float32[fe+10]=L,this.float32[fe+11]=O,this.uint8[be+48]=H,this.uint8[be+49]=ne,this.uint8[be+50]=W,this.uint32[fe+13]=K,this.int16[_e+28]=oe,this.uint8[be+58]=ee,e}}ws.prototype.bytesPerElement=60,$e(ws,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Qr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c,p,f,_,g,v,E,C,k,z,L,O,H,ne,W,K,oe,ee,_e,fe,be,Pe,ye,we,Ce,ke){const De=this.length;return this.resize(De+1),this.emplace(De,e,i,r,s,c,p,f,_,g,v,E,C,k,z,L,O,H,ne,W,K,oe,ee,_e,fe,be,Pe,ye,we,Ce,ke)}emplace(e,i,r,s,c,p,f,_,g,v,E,C,k,z,L,O,H,ne,W,K,oe,ee,_e,fe,be,Pe,ye,we,Ce,ke,De){const xe=38*e,Ue=19*e;return this.int16[xe+0]=i,this.int16[xe+1]=r,this.int16[xe+2]=s,this.float32[Ue+2]=c,this.float32[Ue+3]=p,this.int16[xe+8]=f,this.int16[xe+9]=_,this.int16[xe+10]=g,this.int16[xe+11]=v,this.int16[xe+12]=E,this.int16[xe+13]=C,this.uint16[xe+14]=k,this.uint16[xe+15]=z,this.uint16[xe+16]=L,this.uint16[xe+17]=O,this.uint16[xe+18]=H,this.uint16[xe+19]=ne,this.uint16[xe+20]=W,this.uint16[xe+21]=K,this.uint16[xe+22]=oe,this.uint16[xe+23]=ee,this.uint16[xe+24]=_e,this.uint16[xe+25]=fe,this.uint16[xe+26]=be,this.uint16[xe+27]=Pe,this.uint16[xe+28]=ye,this.uint32[Ue+15]=we,this.float32[Ue+16]=Ce,this.float32[Ue+17]=ke,this.float32[Ue+18]=De,e}}Qr.prototype.bytesPerElement=76,$e(Qr,"StructArrayLayout3i2f6i15ui1ul3f76");class ki extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ki.prototype.bytesPerElement=4,$e(ki,"StructArrayLayout1f4");class tr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,s,c)}emplace(e,i,r,s,c,p){const f=5*e;return this.float32[f+0]=i,this.float32[f+1]=r,this.float32[f+2]=s,this.float32[f+3]=c,this.float32[f+4]=p,e}}tr.prototype.bytesPerElement=20,$e(tr,"StructArrayLayout5f20");class Kr extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,s)}emplace(e,i,r,s,c){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=r,this.uint16[p+3]=s,this.uint16[p+4]=c,e}}Kr.prototype.bytesPerElement=12,$e(Kr,"StructArrayLayout1ul3ui12");class On extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.uint16[s+0]=i,this.uint16[s+1]=r,e}}On.prototype.bytesPerElement=4,$e(On,"StructArrayLayout2ui4");class ec extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ec.prototype.bytesPerElement=2,$e(ec,"StructArrayLayout1ui2");class au extends Ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const s=2*e;return this.float32[s+0]=i,this.float32[s+1]=r,e}}au.prototype.bytesPerElement=8,$e(au,"StructArrayLayout2f8");class Qh extends tt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Qh.prototype.size=12;class Kh extends Xt{get(e){return new Qh(this,e)}}$e(Kh,"FillExtrusionExtArray");class ep extends tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ep.prototype.size=40;class Wu extends Ui{get(e){return new ep(this,e)}}$e(Wu,"CollisionBoxArray");class tp extends tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}tp.prototype.size=60;class ip extends ws{get(e){return new tp(this,e)}}$e(ip,"PlacedSymbolArray");class np extends tt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}np.prototype.size=76;class rp extends Qr{get(e){return new np(this,e)}}$e(rp,"SymbolInstanceArray");class op extends ki{getoffsetX(e){return this.float32[1*e+0]}}$e(op,"GlyphOffsetArray");class sp extends Ot{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}$e(sp,"SymbolLineVertexArray");class ap extends tt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ap.prototype.size=12;class lp extends Kr{get(e){return new ap(this,e)}}$e(lp,"FeatureIndexArray");class cp extends tt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}cp.prototype.size=4;class up extends On{get(e){return new cp(this,e)}}$e(up,"FillExtrusionCentroidArray");class hp extends tt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}hp.prototype.size=12;class pp extends Xt{get(e){return new hp(this,e)}}$e(pp,"CircleGlobeExtArray");const Bf=Be([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Of=Be([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ll={exports:{}},mp=function(t,e){var i,r,s,c,p,f,_,g;for(r=t.length-(i=3&t.length),s=e,p=3432918353,f=461845907,g=0;g<r;)_=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24,++g,s=27492+(65535&(c=5*(65535&(s=(s^=_=(65535&(_=(_=(65535&_)*p+(((_>>>16)*p&65535)<<16)&4294967295)<<15|_>>>17))*f+(((_>>>16)*f&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(_=0,i){case 3:_^=(255&t.charCodeAt(g+2))<<16;case 2:_^=(255&t.charCodeAt(g+1))<<8;case 1:s^=_=(65535&(_=(_=(65535&(_^=255&t.charCodeAt(g)))*p+(((_>>>16)*p&65535)<<16)&4294967295)<<15|_>>>17))*f+(((_>>>16)*f&65535)<<16)&4294967295}return s^=t.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0},Ff=function(t,e){for(var i,r=t.length,s=e^r,c=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24))+((1540483477*(i>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++c;switch(r){case 3:s^=(255&t.charCodeAt(c+2))<<16;case 2:s^=(255&t.charCodeAt(c+1))<<8;case 1:s=1540483477*(65535&(s^=255&t.charCodeAt(c)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0};ll.exports=mp,ll.exports.murmur3=mp,ll.exports.murmur2=Ff;class lu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,r,s){this.ids.push(_p(e)),this.positions.push(i,r,s)}getPositions(e){const i=_p(e);let r=0,s=this.ids.length-1;for(;r<s;){const p=r+s>>1;this.ids[p]>=i?s=p:r=p+1}const c=[];for(;this.ids[r]===i;)c.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return c}static serialize(e,i){const r=new Float64Array(e.ids),s=new Uint32Array(e.positions);return Hu(r,s,0,r.length-1),i&&i.push(r.buffer,s.buffer),{ids:r,positions:s}}static deserialize(e){const i=new lu;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function _p(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ll.exports(String(t))}function Hu(t,e,i,r){for(;i<r;){const s=t[i+r>>1];let c=i-1,p=r+1;for(;;){do{c++}while(t[c]<s);do{p--}while(t[p]>s);if(c>=p)break;cu(t,c,p),cu(e,3*c,3*p),cu(e,3*c+1,3*p+1),cu(e,3*c+2,3*p+2)}p-i<r-p?(Hu(t,e,i,p),i=p+1):(Hu(t,e,p+1,r),r=p)}}function cu(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}$e(lu,"FeaturePositionMap");class Bo{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class uu extends Bo{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class gp extends Bo{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class yp extends Bo{constructor(e){super(e),this.current=ri.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Uf=new Float32Array(16),Zf=new Float32Array(9),Nf=new Float32Array(4);function Ju(t){return[We(255*t.r,255*t.g),We(255*t.b,255*t.a)]}class tc{constructor(e,i,r){this.value=e,this.uniformNames=i.map(s=>`u_${s}`),this.type=r}setUniform(e,i,r,s,c){i.set(e,c,s.constantOr(this.value))}getBinding(e,i){return"color"===this.type?new yp(e):new uu(e)}}class cl{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,r,s,c){const p="u_pattern_to"===c||"u_dash_to"===c?this.patternTo:"u_pattern_from"===c||"u_dash_from"===c?this.patternFrom:"u_pixel_ratio_to"===c?this.pixelRatioTo:"u_pixel_ratio_from"===c?this.pixelRatioFrom:null;p&&i.set(e,c,p)}getBinding(e,i){return"u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?new gp(e):new uu(e)}}class Oo{constructor(e,i,r,s){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,i,r,s,c,p){const f=this.paintVertexArray.length,_=this.expression.evaluate(new J(0),i,{},c,s,p);this.paintVertexArray.resize(e),this._setPaintValue(f,e,_)}updatePaintArray(e,i,r,s,c){const p=this.expression.evaluate({zoom:0},r,s,void 0,c);this._setPaintValue(e,i,p)}_setPaintValue(e,i,r){if("color"===this.type){const s=Ju(r);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,s[0],s[1])}else{for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wr{constructor(e,i,r,s,c,p){this.expression=e,this.uniformNames=i.map(f=>`u_${f}_t`),this.type=r,this.useIntegerZoom=s,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,r,s,c,p){const f=this.expression.evaluate(new J(this.zoom),i,{},c,s,p),_=this.expression.evaluate(new J(this.zoom+1),i,{},c,s,p),g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(g,e,f,_)}updatePaintArray(e,i,r,s,c){const p=this.expression.evaluate({zoom:this.zoom},r,s,void 0,c),f=this.expression.evaluate({zoom:this.zoom+1},r,s,void 0,c);this._setPaintValue(e,i,p,f)}_setPaintValue(e,i,r,s){if("color"===this.type){const c=Ju(r),p=Ju(s);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,c[0],c[1],p[0],p[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,r,s);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,s,c){const p=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,f=yt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);i.set(e,c,f)}getBinding(e,i){return new uu(e)}}class Ts{constructor(e,i,r,s,c,p,f){this.expression=e,this.type=r,this.useIntegerZoom=s,this.zoom=c,this.layerId=f,this.paintVertexAttributes=("array"===r?Of:Bf).members;for(let _=0;_<i.length;++_);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,i,r){const s=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(s,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,s,c,p){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],p)}_setPaintValues(e,i,r,s){if(!s||!r)return;const{min:c,mid:p,max:f}=r,_=s[c],g=s[p],v=s[f];if(_&&g&&v)for(let E=e;E<i;E++)this._setPaintValue(this.zoomInPaintVertexArray,E,g,_),this._setPaintValue(this.zoomOutPaintVertexArray,E,g,v)}_setPaintValue(e,i,r,s){e.emplace(i,r.tl[0],r.tl[1],r.br[0],r.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],r.pixelRatio,s.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Es{constructor(e,i,r=(()=>!0)){this.binders={},this._buffers=[];const s=[];for(const c in e.paint._values){if(!r(c))continue;const p=e.paint.get(c);if(!(p instanceof Ee&&Wr(p.property.specification)))continue;const f=jf(c,e.type),_=p.value,g=p.property.specification.type,v=p.property.useIntegerZoom,E=p.property.specification["property-type"],C="cross-faded"===E||"cross-faded-data-driven"===E,k="line-dasharray"===String(c)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==_.kind||k)if("source"===_.kind||k||C){const z=xp(c,g,"source");this.binders[c]=C?new Ts(_,f,g,v,i,z,e.id):new Oo(_,f,g,z),s.push(`/a_${c}`)}else{const z=xp(c,g,"composite");this.binders[c]=new wr(_,f,g,v,i,z),s.push(`/z_${c}`)}else this.binders[c]=C?new cl(_.value,f):new tc(_.value,f,g),s.push(`/u_${c}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Oo||i instanceof wr?i.maxValue:0}populatePaintArrays(e,i,r,s,c,p){for(const f in this.binders){const _=this.binders[f];(_ instanceof Oo||_ instanceof wr||_ instanceof Ts)&&_.populatePaintArray(e,i,r,s,c,p)}}setConstantPatternPositions(e,i){for(const r in this.binders){const s=this.binders[r];s instanceof cl&&s.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,r,s,c,p){let f=!1;for(const _ in e){const g=i.getPositions(_);for(const v of g){const E=r.feature(v.index);for(const C in this.binders){const k=this.binders[C];if((k instanceof Oo||k instanceof wr||k instanceof Ts)&&!0===k.expression.isStateDependent){const z=s.paint.get(C);k.expression=z.value,k.updatePaintArray(v.start,v.end,E,e[_],c,p),f=!0}}}}return f}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof tc||r instanceof cl)&&e.push(...r.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Oo||r instanceof wr||r instanceof Ts)for(let s=0;s<r.paintVertexAttributes.length;s++)e.push(r.paintVertexAttributes[s].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof tc||r instanceof cl||r instanceof wr)for(const s of r.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof tc||s instanceof cl||s instanceof wr)for(const c of s.uniformNames)i.push({name:c,property:r,binding:s.getBinding(e,c)})}return i}setUniforms(e,i,r,s,c){for(const{name:p,property:f,binding:_}of r)this.binders[f].setUniform(e,_,c,s.get(f),p)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const r=this.binders[i];if(e&&r instanceof Ts){const s=2===e.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;s&&this._buffers.push(s)}else(r instanceof Oo||r instanceof wr)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof Oo||r instanceof wr||r instanceof Ts)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Oo||i instanceof wr||i instanceof Ts)&&i.destroy()}}}class fa{constructor(e,i,r=(()=>!0)){this.programConfigurations={};for(const s of e)this.programConfigurations[s.id]=new Es(s,i,r);this.needsUpload=!1,this._featureMap=new lu,this._bufferOffset=0}populatePaintArrays(e,i,r,s,c,p,f){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,i,s,c,p,f);void 0!==i.id&&this._featureMap.add(i.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,s,c){for(const p of r)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,i,p,s,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Vf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function jf(t,e){return Vf[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const qf={"line-pattern":{source:qi,composite:qi},"fill-pattern":{source:qi,composite:qi},"fill-extrusion-pattern":{source:qi,composite:qi},"line-dasharray":{source:er,composite:er}},Gf={color:{source:au,composite:vi},number:{source:ki,composite:au}};function xp(t,e,i){const r=qf[t];return r&&r[i]||Gf[e][i]}$e(tc,"ConstantBinder"),$e(cl,"CrossFadedConstantBinder"),$e(Oo,"SourceExpressionBinder"),$e(Ts,"CrossFadedCompositeBinder"),$e(wr,"CompositeExpressionBinder"),$e(Es,"ProgramConfiguration",{omit:["_buffers"]}),$e(fa,"ProgramConfigurationSet");const hu="-transition";class Tr extends Pn{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new le(i.layout)),i.paint)){this._transitionablePaint=new ge(i.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Te(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){null!=i&&this._validate(Xu,`layers.${this.id}.layout.${e}`,e,i,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Wi(e,hu)?this._transitionablePaint.getTransition(e.slice(0,-hu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(null!=i&&this._validate($u,`layers.${this.id}.paint.${e}`,e,i,r))return!1;if(Wi(e,hu))return this._transitionablePaint.setTransition(e.slice(0,-hu.length),i||void 0),!1;{const s=this._transitionablePaint._values[e],c="cross-faded-data-driven"===s.property.specification["property-type"],p=s.value.isDataDriven(),f=s.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const _=this._transitionablePaint._values[e].value;return _.isDataDriven()||p||c||this._handleOverridablePaintPropertyUpdate(e,f,_)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),zr(e,(i,r)=>!(void 0===i||"layout"===r&&!Object.keys(i).length||"paint"===r&&!Object.keys(i).length))}_validate(e,i,r,s,c={}){return(!c||!1!==c.validate)&&Wl(this,e.call($c,{key:i,layerType:this.type,objectKey:r,value:s,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ee&&Wr(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ha(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const $f=Be([{name:"a_pos",components:2,type:"Int16"}],4),Xf=Be([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mi{constructor(e=[]){this.segments=e}prepareSegment(e,i,r,s){let c=this.segments[this.segments.length-1];return e>mi.MAX_VERTEX_ARRAY_LENGTH&&Jt(`Max vertices per segment is ${mi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>mi.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==s)&&(c={vertexOffset:i.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==s&&(c.sortKey=s),this.segments.push(c)),c}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,s){return new mi([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:s,vaos:{},sortKey:0}])}}mi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e(mi,"SegmentVector");var st=8192;class Cs{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof kt?new kt(e.lng,e.lat):kt.convert(e),this}setSouthWest(e){return this._sw=e instanceof kt?new kt(e.lng,e.lat):kt.convert(e),this}extend(e){const i=this._sw,r=this._ne;let s,c;if(e instanceof kt)s=e,c=e;else{if(!(e instanceof Cs))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Cs.convert(e)):this.extend(kt.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(kt.convert(e)):this;if(s=e._sw,c=e._ne,!s||!c)return this}return i||r?(i.lng=Math.min(s.lng,i.lng),i.lat=Math.min(s.lat,i.lat),r.lng=Math.max(c.lng,r.lng),r.lat=Math.max(c.lat,r.lat)):(this._sw=new kt(s.lng,s.lat),this._ne=new kt(c.lng,c.lat)),this}getCenter(){return new kt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new kt(this.getWest(),this.getNorth())}getSouthEast(){return new kt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=kt.convert(e);let s=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&s}static convert(e){return!e||e instanceof Cs?e:new Cs(e)}}const pu=6371008.8;class kt{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kt(Gt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,s=e.lat*i,c=Math.sin(r)*Math.sin(s)+Math.cos(r)*Math.cos(s)*Math.cos((e.lng-this.lng)*i);return pu*Math.acos(Math.min(c,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new Cs(new kt(this.lng-r,this.lat-i),new kt(this.lng+r,this.lat+i))}static convert(e){if(e instanceof kt)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new kt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new kt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vp=2*Math.PI*pu;function Yu(t){return vp*Math.cos(t*Math.PI/180)}function eo(t){return(180+t)/360}function to(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ir(t,e){return t/Yu(e)}function Fn(t){return 360*t-180}function Zi(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function bp(t,e){return t*Yu(Zi(e))}const io=85.051129;function wp(t){return 1/Math.cos(t*Math.PI/180)}class ul{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=kt.convert(e);return new ul(eo(r.lng),to(r.lat),ir(i,r.lat))}toLngLat(){return new kt(Fn(this.x),Zi(this.y))}toAltitude(){return bp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vp*wp(Zi(this.y))}}function Qu(t,e,i,r,s,c,p,f,_){const g=(e+r)/2,v=(i+s)/2,E=new Oe(g,v);f(E),function(C,k,z,L,O,H){const ne=z-O,W=L-H;return Math.abs((L-k)*ne-(z-C)*W)/Math.hypot(ne,W)}(E.x,E.y,c.x,c.y,p.x,p.y)>=_?(Qu(t,e,i,g,v,c,E,f,_),Qu(t,g,v,r,s,E,p,f,_)):t.push(p)}function Tp(t,e,i){let r=t[0],s=r.x,c=r.y;e(r);const p=[r];for(let f=1;f<t.length;f++){const _=t[f],{x:g,y:v}=_;e(_),Qu(p,s,c,g,v,r,_,e,i),s=g,c=v,r=_}return p}function Ku(t,e,i,r){if(r(e,i)){const s=e.add(i)._mult(.5);Ku(t,e,s,r),Ku(t,s,i,r)}else t.push(i)}function Wf(t,e){let i=t[0];const r=[i];for(let s=1;s<t.length;s++){const c=t[s];Ku(r,i,c,e),i=c}return r}const eh=Math.pow(2,14)-1,Ep=-eh-1;function Hf(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=yt(i,Ep,eh),t.y=yt(r,Ep,eh),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&Jt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Fo(t,e,i){const r=t.loadGeometry(),s=t.extent,c=st/s;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:f,x:_,y:g,projection:v}=i,E=C=>{const k=Fn((e.x+C.x/s)/p),z=Zi((e.y+C.y/s)/p),L=v.project(k,z);C.x=(L.x*f-_)*s,C.y=(L.y*f-g)*s};for(let C=0;C<r.length;C++)if(1!==t.type)r[C]=Tp(r[C],E,1);else{const k=[];for(const z of r[C])z.x<0||z.x>=s||z.y<0||z.y>=s||(E(z),k.push(z));r[C]=k}}for(const p of r)for(const f of p)Hf(f,c);return r}function ma(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Fo(t):[]}}function du(t,e,i,r,s){t.emplaceBack(2*e+(r+1)/2,2*i+(s+1)/2)}function fu(t,e,i){t.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class th{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ft,this.indexArray=new Gi,this.segments=new mi,this.programConfigurations=new fa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,s){const c=this.layers[0],p=[];let f=null;"circle"===c.type&&(f=c.layout.get("circle-sort-key"));for(const{feature:g,id:v,index:E,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,z=ma(g,k);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),z,r))continue;const L=f?f.evaluate(z,{},r):void 0,O={id:v,properties:g.properties,type:g.type,sourceLayerIndex:C,index:E,geometry:k?z.geometry:Fo(g,r,s),patterns:{},sortKey:L};p.push(O)}f&&p.sort((g,v)=>g.sortKey-v.sortKey);let _=null;"globe"===s.projection.name&&(this.globeExtVertexArray=new pp,_=s.projection);for(const g of p){const{geometry:v,index:E,sourceLayerIndex:C}=g,k=e[E].feature;this.addFeature(g,v,E,i.availableImages,r,_),i.featureIndex.insert(k,v,E,C,this.index)}}update(e,i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$f.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Xf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,s,c,p){for(const f of i)for(const _ of f){const g=_.x,v=_.y;if(g<0||g>=st||v<0||v>=st)continue;if(p){const k=p.projectTilePoint(g,v,c),z=p.upVector(c,g,v),L=this.globeExtVertexArray;fu(L,k,z),fu(L,k,z),fu(L,k,z),fu(L,k,z)}const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=E.vertexLength;du(this.layoutVertexArray,g,v,-1,-1),du(this.layoutVertexArray,g,v,1,-1),du(this.layoutVertexArray,g,v,1,1),du(this.layoutVertexArray,g,v,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},s,c)}}function Cp(t,e){for(let i=0;i<t.length;i++)if(_a(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(_a(t,e[i]))return!0;return!!ih(t,e)}function Jf(t,e,i){return!!_a(t,e)||!!nh(e,t,i)}function Ap(t,e){if(1===t.length)return Ip(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let s=0;s<r.length;s++)if(_a(t,r[s]))return!0}for(let i=0;i<t.length;i++)if(Ip(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ih(t,e[i]))return!0;return!1}function Yf(t,e,i){if(t.length>1){if(ih(t,e))return!0;for(let r=0;r<e.length;r++)if(nh(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(nh(t[r],e,i))return!0;return!1}function ih(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],s=t[i+1];for(let c=0;c<e.length-1;c++)if(Qf(r,s,e[c],e[c+1]))return!0}return!1}function Qf(t,e,i,r){return di(t,i,r)!==di(e,i,r)&&di(t,e,i)!==di(t,e,r)}function nh(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let s=1;s<e.length;s++)if(Sp(t,e[s-1],e[s])<r)return!0;return!1}function Sp(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const s=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(s<0?e:s>1?i:i.sub(e)._mult(s)._add(e))}function Ip(t,e){let i,r,s,c=!1;for(let p=0;p<t.length;p++){i=t[p];for(let f=0,_=i.length-1;f<i.length;_=f++)r=i[f],s=i[_],r.y>e.y!=s.y>e.y&&e.x<(s.x-r.x)*(e.y-r.y)/(s.y-r.y)+r.x&&(c=!c)}return c}function _a(t,e){let i=!1;for(let r=0,s=t.length-1;r<t.length;s=r++){const c=t[r],p=t[s];c.y>e.y!=p.y>e.y&&e.x<(p.x-c.x)*(e.y-c.y)/(p.y-c.y)+c.x&&(i=!i)}return i}function Mp(t,e,i,r,s){for(const p of t)if(e<=p.x&&i<=p.y&&r>=p.x&&s>=p.y)return!0;const c=[new Oe(e,i),new Oe(e,s),new Oe(r,s),new Oe(r,i)];if(t.length>2)for(const p of c)if(_a(t,p))return!0;for(let p=0;p<t.length-1;p++)if(Kf(t[p],t[p+1],c))return!0;return!1}function Kf(t,e,i){const r=i[0],s=i[2];if(t.x<r.x&&e.x<r.x||t.x>s.x&&e.x>s.x||t.y<r.y&&e.y<r.y||t.y>s.y&&e.y>s.y)return!1;const c=di(t,e,i[0]);return c!==di(t,e,i[1])||c!==di(t,e,i[2])||c!==di(t,e,i[3])}function hl(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function mu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function kp(t,e,i,r,s){if(!e[0]&&!e[1])return t;const c=Oe.convert(e)._mult(s);"viewport"===i&&c._rotate(-r);const p=[];for(let f=0;f<t.length;f++)p.push(t[f].sub(c));return p}function zp(t,e,i,r){const s=Oe.convert(t)._mult(r);return"viewport"===e&&s._rotate(-i),s}$e(th,"CircleBucket",{omit:["layers"]});const em=new Re({"circle-sort-key":new ae(ve.layout_circle["circle-sort-key"])});var tm={paint:new Re({"circle-radius":new ae(ve.paint_circle["circle-radius"]),"circle-color":new ae(ve.paint_circle["circle-color"]),"circle-blur":new ae(ve.paint_circle["circle-blur"]),"circle-opacity":new ae(ve.paint_circle["circle-opacity"]),"circle-translate":new de(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new de(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new de(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new de(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ae(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ae(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ae(ve.paint_circle["circle-stroke-opacity"])}),layout:em},_u=1e-6,bn=typeof Float32Array<"u"?Float32Array:Array;function Pp(){var t=new bn(9);return bn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Dp(t,e,i){var r=e[0],s=e[1],c=e[2],p=e[3],f=e[4],_=e[5],g=e[6],v=e[7],E=e[8],C=i[0],k=i[1],z=i[2],L=i[3],O=i[4],H=i[5],ne=i[6],W=i[7],K=i[8];return t[0]=C*r+k*p+z*g,t[1]=C*s+k*f+z*v,t[2]=C*c+k*_+z*E,t[3]=L*r+O*p+H*g,t[4]=L*s+O*f+H*v,t[5]=L*c+O*_+H*E,t[6]=ne*r+W*p+K*g,t[7]=ne*s+W*f+K*v,t[8]=ne*c+W*_+K*E,t}function no(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rh(t,e){var i=e[0],r=e[1],s=e[2],c=e[3],p=e[4],f=e[5],_=e[6],g=e[7],v=e[8],E=e[9],C=e[10],k=e[11],z=e[12],L=e[13],O=e[14],H=e[15],ne=i*f-r*p,W=i*_-s*p,K=i*g-c*p,oe=r*_-s*f,ee=r*g-c*f,_e=s*g-c*_,fe=v*L-E*z,be=v*O-C*z,Pe=v*H-k*z,ye=E*O-C*L,we=E*H-k*L,Ce=C*H-k*O,ke=ne*Ce-W*we+K*ye+oe*Pe-ee*be+_e*fe;return ke?(t[0]=(f*Ce-_*we+g*ye)*(ke=1/ke),t[1]=(s*we-r*Ce-c*ye)*ke,t[2]=(L*_e-O*ee+H*oe)*ke,t[3]=(C*ee-E*_e-k*oe)*ke,t[4]=(_*Pe-p*Ce-g*be)*ke,t[5]=(i*Ce-s*Pe+c*be)*ke,t[6]=(O*K-z*_e-H*W)*ke,t[7]=(v*_e-C*K+k*W)*ke,t[8]=(p*we-f*Pe+g*fe)*ke,t[9]=(r*Pe-i*we-c*fe)*ke,t[10]=(z*ee-L*K+H*ne)*ke,t[11]=(E*K-v*ee-k*ne)*ke,t[12]=(f*be-p*ye-_*fe)*ke,t[13]=(i*ye-r*be+s*fe)*ke,t[14]=(L*W-z*oe-O*ne)*ke,t[15]=(v*oe-E*W+C*ne)*ke,t):null}function pl(t,e,i){var r=e[0],s=e[1],c=e[2],p=e[3],f=e[4],_=e[5],g=e[6],v=e[7],E=e[8],C=e[9],k=e[10],z=e[11],L=e[12],O=e[13],H=e[14],ne=e[15],W=i[0],K=i[1],oe=i[2],ee=i[3];return t[0]=W*r+K*f+oe*E+ee*L,t[1]=W*s+K*_+oe*C+ee*O,t[2]=W*c+K*g+oe*k+ee*H,t[3]=W*p+K*v+oe*z+ee*ne,t[4]=(W=i[4])*r+(K=i[5])*f+(oe=i[6])*E+(ee=i[7])*L,t[5]=W*s+K*_+oe*C+ee*O,t[6]=W*c+K*g+oe*k+ee*H,t[7]=W*p+K*v+oe*z+ee*ne,t[8]=(W=i[8])*r+(K=i[9])*f+(oe=i[10])*E+(ee=i[11])*L,t[9]=W*s+K*_+oe*C+ee*O,t[10]=W*c+K*g+oe*k+ee*H,t[11]=W*p+K*v+oe*z+ee*ne,t[12]=(W=i[12])*r+(K=i[13])*f+(oe=i[14])*E+(ee=i[15])*L,t[13]=W*s+K*_+oe*C+ee*O,t[14]=W*c+K*g+oe*k+ee*H,t[15]=W*p+K*v+oe*z+ee*ne,t}function ic(t,e,i){var r,s,c,p,f,_,g,v,E,C,k,z,L=i[0],O=i[1],H=i[2];return e===t?(t[12]=e[0]*L+e[4]*O+e[8]*H+e[12],t[13]=e[1]*L+e[5]*O+e[9]*H+e[13],t[14]=e[2]*L+e[6]*O+e[10]*H+e[14],t[15]=e[3]*L+e[7]*O+e[11]*H+e[15]):(s=e[1],c=e[2],p=e[3],f=e[4],_=e[5],g=e[6],v=e[7],E=e[8],C=e[9],k=e[10],z=e[11],t[0]=r=e[0],t[1]=s,t[2]=c,t[3]=p,t[4]=f,t[5]=_,t[6]=g,t[7]=v,t[8]=E,t[9]=C,t[10]=k,t[11]=z,t[12]=r*L+f*O+E*H+e[12],t[13]=s*L+_*O+C*H+e[13],t[14]=c*L+g*O+k*H+e[14],t[15]=p*L+v*O+z*H+e[15]),t}function ga(t,e,i){var r=i[0],s=i[1],c=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function oh(t,e,i){var r=Math.sin(i),s=Math.cos(i),c=e[4],p=e[5],f=e[6],_=e[7],g=e[8],v=e[9],E=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*s+g*r,t[5]=p*s+v*r,t[6]=f*s+E*r,t[7]=_*s+C*r,t[8]=g*s-c*r,t[9]=v*s-p*r,t[10]=E*s-f*r,t[11]=C*s-_*r,t}function gu(t,e,i){var r=Math.sin(i),s=Math.cos(i),c=e[0],p=e[1],f=e[2],_=e[3],g=e[8],v=e[9],E=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s-g*r,t[1]=p*s-v*r,t[2]=f*s-E*r,t[3]=_*s-C*r,t[8]=c*r+g*s,t[9]=p*r+v*s,t[10]=f*r+E*s,t[11]=_*r+C*s,t}function Lp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rp(t,e,i){var r,s,c,p=i[0],f=i[1],_=i[2],g=Math.hypot(p,f,_);return g<_u?null:(p*=g=1/g,f*=g,_*=g,r=Math.sin(e),s=Math.cos(e),t[0]=p*p*(c=1-s)+s,t[1]=f*p*c+_*r,t[2]=_*p*c-f*r,t[3]=0,t[4]=p*f*c-_*r,t[5]=f*f*c+s,t[6]=_*f*c+p*r,t[7]=0,t[8]=p*_*c+f*r,t[9]=f*_*c-p*r,t[10]=_*_*c+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var im=pl;function sh(){var t=new bn(3);return bn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Bp(t){var e=new bn(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function nc(t){return Math.hypot(t[0],t[1],t[2])}function dl(t,e,i){var r=new bn(3);return r[0]=t,r[1]=e,r[2]=i,r}function Uo(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ah(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Op(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function rc(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function oc(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Un(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function sc(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Ki(t,e){var i=e[0],r=e[1],s=e[2],c=i*i+r*r+s*s;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t}function nr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function lh(t,e,i){var r=e[0],s=e[1],c=e[2],p=i[0],f=i[1],_=i[2];return t[0]=s*_-c*f,t[1]=c*p-r*_,t[2]=r*f-s*p,t}function _i(t,e,i){var r=e[0],s=e[1],c=e[2],p=i[3]*r+i[7]*s+i[11]*c+i[15];return t[0]=(i[0]*r+i[4]*s+i[8]*c+i[12])/(p=p||1),t[1]=(i[1]*r+i[5]*s+i[9]*c+i[13])/p,t[2]=(i[2]*r+i[6]*s+i[10]*c+i[14])/p,t}function Fp(t,e,i){var r=i[0],s=i[1],c=i[2],p=e[0],f=e[1],_=e[2],g=s*_-c*f,v=c*p-r*_,E=r*f-s*p,C=s*E-c*v,k=c*g-r*E,z=r*v-s*g,L=2*i[3];return v*=L,E*=L,k*=2,z*=2,t[0]=p+(g*=L)+(C*=2),t[1]=f+v+k,t[2]=_+E+z,t}var ac,Er=ah,nm=Op,rm=nc;function Up(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Zp(t,e){var i=e[0],r=e[1],s=e[2],c=e[3],p=i*i+r*r+s*s+c*c;return p>0&&(p=1/Math.sqrt(p)),t[0]=i*p,t[1]=r*p,t[2]=s*p,t[3]=c*p,t}function ya(t,e,i){var r=e[0],s=e[1],c=e[2],p=e[3];return t[0]=i[0]*r+i[4]*s+i[8]*c+i[12]*p,t[1]=i[1]*r+i[5]*s+i[9]*c+i[13]*p,t[2]=i[2]*r+i[6]*s+i[10]*c+i[14]*p,t[3]=i[3]*r+i[7]*s+i[11]*c+i[15]*p,t}function Np(){var t=new bn(4);return bn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Vp(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function jp(t,e,i){i*=.5;var r=e[0],s=e[1],c=e[2],p=e[3],f=Math.sin(i),_=Math.cos(i);return t[0]=r*_+p*f,t[1]=s*_+c*f,t[2]=c*_-s*f,t[3]=p*_-r*f,t}function qp(t,e,i){i*=.5;var r=e[0],s=e[1],c=e[2],p=e[3],f=Math.sin(i),_=Math.cos(i);return t[0]=r*_-c*f,t[1]=s*_+p*f,t[2]=c*_+r*f,t[3]=p*_-s*f,t}sh(),ac=new bn(4),bn!=Float32Array&&(ac[0]=0,ac[1]=0,ac[2]=0,ac[3]=0);var om=Zp;sh(),dl(1,0,0),dl(0,1,0),Np(),Np(),Pp();class ch{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const s=nr(i,this.dir);if(Math.abs(s)<1e-6)return!1;const c=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/s;return r[0]=this.pos[0]+this.dir[0]*c,r[1]=this.pos[1]+this.dir[1]*c,r[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,i,r){if(L=(k=this.pos)[0],O=k[1],H=k[2],ne=(z=e)[0],W=z[1],K=z[2],Math.abs(L-ne)<=_u*Math.max(1,Math.abs(L),Math.abs(ne))&&Math.abs(O-W)<=_u*Math.max(1,Math.abs(O),Math.abs(W))&&Math.abs(H-K)<=_u*Math.max(1,Math.abs(H),Math.abs(K))||0===i)return r[0]=r[1]=r[2]=0,!1;var k,z,L,O,H,ne,W,K;const[s,c,p]=this.dir,f=this.pos[0]-e[0],_=this.pos[1]-e[1],g=this.pos[2]-e[2],v=s*s+c*c+p*p,E=2*(f*s+_*c+g*p),C=E*E-4*v*(f*f+_*_+g*g-i*i);if(C<0){const k=Math.max(-E/2,0),z=f+s*k,L=_+c*k,O=g+p*k,H=Math.hypot(z,L,O);return r[0]=z*i/H,r[1]=L*i/H,r[2]=O*i/H,!1}{const k=(-E-Math.sqrt(C))/(2*v);if(k<0){const z=Math.hypot(f,_,g);return r[0]=f*i/z,r[1]=_*i/z,r[2]=g*i/z,!1}return r[0]=f+s*k,r[1]=_+c*k,r[2]=g+p*k,!0}}}class uh{constructor(e,i,r,s,c){this.TL=e,this.TR=i,this.BR=r,this.BL=s,this.horizon=c}static fromInvProjectionMatrix(e,i,r){const s=[-1,1,1],c=[1,1,1],p=[1,-1,1],f=[-1,-1,1],_=_i(s,s,e),g=_i(c,c,e),v=_i(p,p,e),E=_i(f,f,e);return new uh(_,g,v,E,i/r)}}class hh{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,r,s){const c=Math.pow(2,r),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const g=ya([],_,e),v=1/g[3]/i*c;return(E=g)[0]=(C=g)[0]*(k=[v,v,s?1/g[3]:v,v])[0],E[1]=C[1]*k[1],E[2]=C[2]*k[2],E[3]=C[3]*k[3],E;var E,C,k}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const g=Ki([],lh([],Er([],p[_[0]],p[_[1]]),Er([],p[_[2]],p[_[1]]))),v=-nr(g,p[_[1]]);return g.concat(v)});return new hh(p,f)}}class en{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const s of e)rc(i,i,s),oc(r,r,s);return new en(i,r)}static applyTransform(e,i){const r=e.getCorners();for(let s=0;s<r.length;++s)_i(r[s],r[s],i);return en.fromPoints(r)}constructor(e,i){this.min=e,this.max=i,this.center=Un([],Uo([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=Bp(this.min),s=Bp(this.max);for(let c=0;c<i.length;c++)r[c]=i[c]?this.min[c]:this.center[c],s[c]=i[c]?this.center[c]:this.max[c];return s[2]=this.max[2],new en(r,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let r=!0;for(let s=0;s<e.planes.length;s++){const c=e.planes[s];let p=0;for(let f=0;f<i.length;f++)p+=nr(c,i[f])+c[3]>=0;if(0===p)return 0;p!==i.length&&(r=!1)}if(r)return 2;for(let s=0;s<3;s++){let c=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let f=0;f<e.points.length;f++){const _=e.points[f][s]-this.min[s];c=Math.min(c,_),p=Math.max(p,_)}if(p<0||c>this.max[s]-this.min[s])return 0}return 1}}function Gp(t,e,i,r,s,c,p,f,_){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(_*=t.pixelToTileUnitsFactor);const g=t.tileID.canonical,v=i.projection.upVectorScale(g,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const C of E){const k=C.add(f),z=s&&i.elevation?i.elevation.exaggeration()*s.getElevationAt(k.x,k.y,!0):0,L=i.projection.projectTilePoint(k.x,k.y,g);if(z>0){const W=i.projection.upVector(g,k.x,k.y);L.x+=W[0]*v*z,L.y+=W[1]*v*z,L.z+=W[2]*v*z}const O=c?k:sm(L.x,L.y,L.z,r),H=c?t.tilespaceRays.map(W=>lm(W,z)):t.queryGeometry.screenGeometry,ne=ya([],[L.x,L.y,L.z,1],r);if(!p&&c?_*=ne[3]/i.cameraToCenterDistance:p&&!c&&(_*=i.cameraToCenterDistance/ne[3]),c){const W=Zi((C.y/st+g.y)/(1<<g.z));_/=i.projection.pixelsPerMeter(W,1)/ir(1,W)}if(Jf(H,O,_))return!0}return!1}function sm(t,e,i,r){const s=ya([],[t,e,i,1],r);return new Oe(s[0]/s[3],s[1]/s[3])}const $p=dl(0,0,0),am=dl(0,0,1);function lm(t,e){const i=sh();return $p[2]=e,t.intersectsPlane($p,am,i),new Oe(i[0],i[1])}class Xp extends th{}function Wp(t,{width:e,height:i},r,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*i*r)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=s,t}function Hp(t,e,i){const{width:r,height:s}=e;r===t.width&&s===t.height||(ph(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,s)},i),t.width=r,t.height=s,t.data=e.data)}function ph(t,e,i,r,s,c){if(0===s.width||0===s.height)return e;if(s.width>t.width||s.height>t.height||i.x>t.width-s.width||i.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||r.x>e.width-s.width||r.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const p=t.data,f=e.data;for(let _=0;_<s.height;_++){const g=((i.y+_)*t.width+i.x)*c,v=((r.y+_)*e.width+r.x)*c;for(let E=0;E<s.width*c;E++)f[v+E]=p[g+E]}return e}$e(Xp,"HeatmapBucket",{omit:["layers"]});class Zo{constructor(e,i){Wp(this,e,1,i)}resize(e){Hp(this,new Zo(e),1)}clone(){return new Zo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,s,c){ph(e,i,r,s,c,1)}}class wn{constructor(e,i){Wp(this,e,4,i)}resize(e){Hp(this,new wn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new wn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,s,c){ph(e,i,r,s,c,4)}}$e(Zo,"AlphaImage"),$e(wn,"RGBAImage");var cm={paint:new Re({"heatmap-radius":new ae(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ae(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new de(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Fe(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new de(ve.paint_heatmap["heatmap-opacity"])})};function dh(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,s=t.image||new wn({width:i,height:r}),c=(p,f,_)=>{e[t.evaluationKey]=_;const g=t.expression.evaluate(e);s.data[p+f+0]=Math.floor(255*g.r/g.a),s.data[p+f+1]=Math.floor(255*g.g/g.a),s.data[p+f+2]=Math.floor(255*g.b/g.a),s.data[p+f+3]=Math.floor(255*g.a)};if(t.clips)for(let p=0,f=0;p<r;++p,f+=4*i)for(let _=0,g=0;_<i;_++,g+=4){const v=_/(i-1),{start:E,end:C}=t.clips[p];c(f,g,E*(1-v)+C*v)}else for(let p=0,f=0;p<i;p++,f+=4)c(0,f,p/(i-1));return s}var um={paint:new Re({"hillshade-illumination-direction":new de(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new de(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new de(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new de(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new de(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new de(ve.paint_hillshade["hillshade-accent-color"])})};const hm=Be([{name:"a_pos",components:2,type:"Int16"}],4),{members:pm}=hm;var lc={exports:{}};function yu(t,e,i){i=i||2;var r,s,c,p,f,_,g,v=e&&e.length,E=v?e[0]*i:t.length,C=Jp(t,0,E,i,!0),k=[];if(!C||C.next===C.prev)return k;if(v&&(C=function(L,O,H,ne){var W,K,oe,ee=[];for(W=0,K=O.length;W<K;W++)(oe=Jp(L,O[W]*ne,W<K-1?O[W+1]*ne:L.length,ne,!1))===oe.next&&(oe.steiner=!0),ee.push(vm(oe));for(ee.sort(gm),W=0;W<ee.length;W++)H=ym(ee[W],H);return H}(t,e,C,i)),t.length>80*i){r=c=t[0],s=p=t[1];for(var z=i;z<E;z+=i)(f=t[z])<r&&(r=f),(_=t[z+1])<s&&(s=_),f>c&&(c=f),_>p&&(p=_);g=0!==(g=Math.max(c-r,p-s))?32767/g:0}return cc(C,k,i,r,s,g,0),k}function Jp(t,e,i,r,s){var c,p;if(s===_h(t,e,i,r)>0)for(c=e;c<i;c+=r)p=Kp(c,t[c],t[c+1],p);else for(c=i-r;c>=e;c-=r)p=Kp(c,t[c],t[c+1],p);return p&&xu(p,p.next)&&(hc(p),p=p.next),p}function xa(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!xu(r,r.next)&&0!==ui(r.prev,r,r.next))r=r.next;else{if(hc(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function cc(t,e,i,r,s,c,p){if(t){!p&&c&&function(v,E,C,k){var z=v;do{0===z.z&&(z.z=fh(z.x,z.y,E,C,k)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next}while(z!==v);z.prevZ.nextZ=null,z.prevZ=null,function(L){var O,H,ne,W,K,oe,ee,_e,fe=1;do{for(H=L,L=null,K=null,oe=0;H;){for(oe++,ne=H,ee=0,O=0;O<fe&&(ee++,ne=ne.nextZ);O++);for(_e=fe;ee>0||_e>0&&ne;)0!==ee&&(0===_e||!ne||H.z<=ne.z)?(W=H,H=H.nextZ,ee--):(W=ne,ne=ne.nextZ,_e--),K?K.nextZ=W:L=W,W.prevZ=K,K=W;H=ne}K.nextZ=null,fe*=2}while(oe>1)}(z)}(t,r,s,c);for(var f,_,g=t;t.prev!==t.next;)if(f=t.prev,_=t.next,c?fm(t,r,s,c):dm(t))e.push(f.i/i|0),e.push(t.i/i|0),e.push(_.i/i|0),hc(t),t=_.next,g=_.next;else if((t=_)===g){p?1===p?cc(t=mm(xa(t),e,i),e,i,r,s,c,2):2===p&&_m(t,e,i,r,s,c):cc(xa(t),e,i,r,s,c,1);break}}}function dm(t){var e=t.prev,i=t,r=t.next;if(ui(e,i,r)>=0)return!1;for(var s=e.x,c=i.x,p=r.x,f=e.y,_=i.y,g=r.y,v=s<c?s<p?s:p:c<p?c:p,E=f<_?f<g?f:g:_<g?_:g,C=s>c?s>p?s:p:c>p?c:p,k=f>_?f>g?f:g:_>g?_:g,z=r.next;z!==e;){if(z.x>=v&&z.x<=C&&z.y>=E&&z.y<=k&&fl(s,f,c,_,p,g,z.x,z.y)&&ui(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function fm(t,e,i,r){var s=t.prev,c=t,p=t.next;if(ui(s,c,p)>=0)return!1;for(var f=s.x,_=c.x,g=p.x,v=s.y,E=c.y,C=p.y,k=f<_?f<g?f:g:_<g?_:g,z=v<E?v<C?v:C:E<C?E:C,L=f>_?f>g?f:g:_>g?_:g,O=v>E?v>C?v:C:E>C?E:C,H=fh(k,z,e,i,r),ne=fh(L,O,e,i,r),W=t.prevZ,K=t.nextZ;W&&W.z>=H&&K&&K.z<=ne;){if(W.x>=k&&W.x<=L&&W.y>=z&&W.y<=O&&W!==s&&W!==p&&fl(f,v,_,E,g,C,W.x,W.y)&&ui(W.prev,W,W.next)>=0||(W=W.prevZ,K.x>=k&&K.x<=L&&K.y>=z&&K.y<=O&&K!==s&&K!==p&&fl(f,v,_,E,g,C,K.x,K.y)&&ui(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;W&&W.z>=H;){if(W.x>=k&&W.x<=L&&W.y>=z&&W.y<=O&&W!==s&&W!==p&&fl(f,v,_,E,g,C,W.x,W.y)&&ui(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;K&&K.z<=ne;){if(K.x>=k&&K.x<=L&&K.y>=z&&K.y<=O&&K!==s&&K!==p&&fl(f,v,_,E,g,C,K.x,K.y)&&ui(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function mm(t,e,i){var r=t;do{var s=r.prev,c=r.next.next;!xu(s,c)&&Yp(s,r,r.next,c)&&uc(s,c)&&uc(c,s)&&(e.push(s.i/i|0),e.push(r.i/i|0),e.push(c.i/i|0),hc(r),hc(r.next),r=t=c),r=r.next}while(r!==t);return xa(r)}function _m(t,e,i,r,s,c){var p=t;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&bm(p,f)){var _=Qp(p,f);return p=xa(p,p.next),_=xa(_,_.next),cc(p,e,i,r,s,c,0),void cc(_,e,i,r,s,c,0)}f=f.next}p=p.next}while(p!==t)}function gm(t,e){return t.x-e.x}function ym(t,e){var i=function(s,c){var p,f=c,_=s.x,g=s.y,v=-1/0;do{if(g<=f.y&&g>=f.next.y&&f.next.y!==f.y){var E=f.x+(g-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(E<=_&&E>v&&(v=E,p=f.x<f.next.x?f:f.next,E===_))return p}f=f.next}while(f!==c);if(!p)return null;var C,k=p,z=p.x,L=p.y,O=1/0;f=p;do{_>=f.x&&f.x>=z&&_!==f.x&&fl(g<L?_:v,g,z,L,g<L?v:_,g,f.x,f.y)&&(C=Math.abs(g-f.y)/(_-f.x),uc(f,s)&&(C<O||C===O&&(f.x>p.x||f.x===p.x&&xm(p,f)))&&(p=f,O=C)),f=f.next}while(f!==k);return p}(t,e);if(!i)return e;var r=Qp(i,t);return xa(r,r.next),xa(i,i.next)}function xm(t,e){return ui(t.prev,t,e.prev)<0&&ui(e.next,t,t.next)<0}function fh(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vm(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function fl(t,e,i,r,s,c,p,f){return(s-p)*(e-f)>=(t-p)*(c-f)&&(t-p)*(r-f)>=(i-p)*(e-f)&&(i-p)*(c-f)>=(s-p)*(r-f)}function bm(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var s=i;do{if(s.i!==i.i&&s.next.i!==i.i&&s.i!==r.i&&s.next.i!==r.i&&Yp(s,s.next,i,r))return!0;s=s.next}while(s!==i);return!1}(t,e)&&(uc(t,e)&&uc(e,t)&&function(i,r){var s=i,c=!1,p=(i.x+r.x)/2,f=(i.y+r.y)/2;do{s.y>f!=s.next.y>f&&s.next.y!==s.y&&p<(s.next.x-s.x)*(f-s.y)/(s.next.y-s.y)+s.x&&(c=!c),s=s.next}while(s!==i);return c}(t,e)&&(ui(t.prev,t,e.prev)||ui(t,e.prev,e))||xu(t,e)&&ui(t.prev,t,t.next)>0&&ui(e.prev,e,e.next)>0)}function ui(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function xu(t,e){return t.x===e.x&&t.y===e.y}function Yp(t,e,i,r){var s=bu(ui(t,e,i)),c=bu(ui(t,e,r)),p=bu(ui(i,r,t)),f=bu(ui(i,r,e));return s!==c&&p!==f||!(0!==s||!vu(t,i,e))||!(0!==c||!vu(t,r,e))||!(0!==p||!vu(i,t,r))||!(0!==f||!vu(i,e,r))}function vu(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function bu(t){return t>0?1:t<0?-1:0}function uc(t,e){return ui(t.prev,t,t.next)<0?ui(t,e,t.next)>=0&&ui(t,t.prev,e)>=0:ui(t,e,t.prev)<0||ui(t,t.next,e)<0}function Qp(t,e){var i=new mh(t.i,t.x,t.y),r=new mh(e.i,e.x,e.y),s=t.next,c=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,c.next=r,r.prev=c,r}function Kp(t,e,i,r){var s=new mh(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function hc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mh(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _h(t,e,i,r){for(var s=0,c=e,p=i-r;c<i;c+=r)s+=(t[p]-t[c])*(t[c+1]+t[p+1]),p=c;return s}function wm(t,e,i,r,s){ed(t,e,i||0,r||t.length-1,s||Tm)}function ed(t,e,i,r,s){for(;r>i;){if(r-i>600){var c=r-i+1,p=e-i+1,f=Math.log(c),_=.5*Math.exp(2*f/3),g=.5*Math.sqrt(f*_*(c-_)/c)*(p-c/2<0?-1:1);ed(t,e,Math.max(i,Math.floor(e-p*_/c+g)),Math.min(r,Math.floor(e+(c-p)*_/c+g)),s)}var v=t[e],E=i,C=r;for(pc(t,i,e),s(t[r],v)>0&&pc(t,i,r);E<C;){for(pc(t,E,C),E++,C--;s(t[E],v)<0;)E++;for(;s(t[C],v)>0;)C--}0===s(t[i],v)?pc(t,i,C):pc(t,++C,r),C<=e&&(i=C+1),e<=C&&(r=C-1)}}function pc(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Tm(t,e){return t<e?-1:t>e?1:0}function gh(t,e){const i=t.length;if(i<=1)return[t];const r=[];let s,c;for(let p=0;p<i;p++){const f=wt(t[p]);0!==f&&(t[p].area=Math.abs(f),void 0===c&&(c=f<0),c===f<0?(s&&r.push(s),s=[t[p]]):s.push(t[p]))}if(s&&r.push(s),e>1)for(let p=0;p<r.length;p++)r[p].length<=e||(wm(r[p],e,1,r[p].length-1,Em),r[p]=r[p].slice(0,e));return r}function Em(t,e){return e.area-t.area}function yh(t,e,i){const r=i.patternDependencies;let s=!1;for(const c of e){const p=c.paint.get(`${t}-pattern`);p.isConstant()||(s=!0);const f=p.constantOr(null);f&&(s=!0,r[f.to]=!0,r[f.from]=!0)}return s}function xh(t,e,i,r,s){const c=s.patternDependencies;for(const p of e){const f=p.paint.get(`${t}-pattern`).value;if("constant"!==f.kind){let _=f.evaluate({zoom:r-1},i,{},s.availableImages),g=f.evaluate({zoom:r},i,{},s.availableImages),v=f.evaluate({zoom:r+1},i,{},s.availableImages);_=_&&_.name?_.name:_,g=g&&g.name?g.name:g,v=v&&v.name?v.name:v,c[_]=!0,c[g]=!0,c[v]=!0,i.patterns[p.id]={min:_,mid:g,max:v}}}return i}lc.exports=yu,lc.exports.default=yu,yu.deviation=function(t,e,i,r){var s=e&&e.length,c=Math.abs(_h(t,0,s?e[0]*i:t.length,i));if(s)for(var p=0,f=e.length;p<f;p++)c-=Math.abs(_h(t,e[p]*i,p<f-1?e[p+1]*i:t.length,i));var _=0;for(p=0;p<r.length;p+=3){var g=r[p]*i,v=r[p+1]*i,E=r[p+2]*i;_+=Math.abs((t[g]-t[E])*(t[v+1]-t[g+1])-(t[g]-t[v])*(t[E+1]-t[g+1]))}return 0===c&&0===_?0:Math.abs((_-c)/c)},yu.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var c=0;c<t[s].length;c++)for(var p=0;p<e;p++)i.vertices.push(t[s][c][p]);s>0&&i.holes.push(r+=t[s-1].length)}return i};class wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ft,this.indexArray=new Gi,this.indexArray2=new On,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new mi,this.segments2=new mi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,s){this.hasPattern=yh("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:f,id:_,index:g,sourceLayerIndex:v}of e){const E=this.layers[0]._featureFilter.needGeometry,C=ma(f,E);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),C,r))continue;const k=c?c.evaluate(C,{},r,i.availableImages):void 0,z={id:_,properties:f.properties,type:f.type,sourceLayerIndex:v,index:g,geometry:E?C.geometry:Fo(f,r,s),patterns:{},sortKey:k};p.push(z)}c&&p.sort((f,_)=>f.sortKey-_.sortKey);for(const f of p){const{geometry:_,index:g,sourceLayerIndex:v}=f;if(this.hasPattern){const E=xh("fill",this.layers,f,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(f,_,g,r,{},i.availableImages);i.featureIndex.insert(e[g].feature,_,g,v,this.index)}}update(e,i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,s)}addFeatures(e,i,r,s,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,s,c,p=[]){for(const f of gh(i,500)){let _=0;for(const z of f)_+=z.length;const g=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),v=g.vertexLength,E=[],C=[];for(const z of f){if(0===z.length)continue;z!==f[0]&&C.push(E.length/2);const L=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),O=L.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(O+z.length-1,O),E.push(z[0].x),E.push(z[0].y);for(let H=1;H<z.length;H++)this.layoutVertexArray.emplaceBack(z[H].x,z[H].y),this.indexArray2.emplaceBack(O+H-1,O+H),E.push(z[H].x),E.push(z[H].y);L.vertexLength+=z.length,L.primitiveLength+=z.length}const k=lc.exports(E,C);for(let z=0;z<k.length;z+=3)this.indexArray.emplaceBack(v+k[z],v+k[z+1],v+k[z+2]);g.vertexLength+=_,g.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,p,s)}}$e(wu,"FillBucket",{omit:["layers","patternFeatures"]});const Cm=new Re({"fill-sort-key":new ae(ve.layout_fill["fill-sort-key"])});var Am={paint:new Re({"fill-antialias":new de(ve.paint_fill["fill-antialias"]),"fill-opacity":new ae(ve.paint_fill["fill-opacity"]),"fill-color":new ae(ve.paint_fill["fill-color"]),"fill-outline-color":new ae(ve.paint_fill["fill-outline-color"]),"fill-translate":new de(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new de(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ze(ve.paint_fill["fill-pattern"])}),layout:Cm};const Sm=Be([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Im=Be([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Mm=Be([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:km}=Sm;var Tu={},zm=Oe,td=ml;function ml(t,e,i,r,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=s,t.readFields(Pm,this,e)}function Pm(t,e,i){1==t?e.id=i.readVarint():2==t?function(r,s){for(var c=r.readVarint()+r.pos;r.pos<c;){var p=s._keys[r.readVarint()],f=s._values[r.readVarint()];s.properties[p]=f}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function Dm(t){for(var e,i,r=0,s=0,c=t.length,p=c-1;s<c;p=s++)r+=((i=t[p]).x-(e=t[s]).x)*(e.y+i.y);return r}ml.types=["Unknown","Point","LineString","Polygon"],ml.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,s=0,c=0,p=0,f=[];t.pos<i;){if(s<=0){var _=t.readVarint();r=7&_,s=_>>3}if(s--,1===r||2===r)c+=t.readSVarint(),p+=t.readSVarint(),1===r&&(e&&f.push(e),e=[]),e.push(new zm(c,p));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&f.push(e),f},ml.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,s=0,c=0,p=1/0,f=-1/0,_=1/0,g=-1/0;t.pos<e;){if(r<=0){var v=t.readVarint();i=7&v,r=v>>3}if(r--,1===i||2===i)(s+=t.readSVarint())<p&&(p=s),s>f&&(f=s),(c+=t.readSVarint())<_&&(_=c),c>g&&(g=c);else if(7!==i)throw new Error("unknown command "+i)}return[p,_,f,g]},ml.prototype.toGeoJSON=function(t,e,i){var r,s,c=this.extent*Math.pow(2,i),p=this.extent*t,f=this.extent*e,_=this.loadGeometry(),g=ml.types[this.type];function v(k){for(var z=0;z<k.length;z++){var L=k[z];k[z]=[360*(L.x+p)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+f)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(r=0;r<_.length;r++)E[r]=_[r][0];v(_=E);break;case 2:for(r=0;r<_.length;r++)v(_[r]);break;case 3:for(_=function(k){var z=k.length;if(z<=1)return[k];for(var L,O,H=[],ne=0;ne<z;ne++){var W=Dm(k[ne]);0!==W&&(void 0===O&&(O=W<0),O===W<0?(L&&H.push(L),L=[k[ne]]):L.push(k[ne]))}return L&&H.push(L),H}(_),r=0;r<_.length;r++)for(s=0;s<_[r].length;s++)v(_[r][s])}1===_.length?_=_[0]:g="Multi"+g;var C={type:"Feature",geometry:{type:g,coordinates:_},properties:this.properties};return"id"in this&&(C.id=this.id),C};var Lm=td,id=nd;function nd(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Rm,this,e),this.length=this._features.length}function Rm(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(r){for(var s=null,c=r.readVarint()+r.pos;r.pos<c;){var p=r.readVarint()>>3;s=1===p?r.readString():2===p?r.readFloat():3===p?r.readDouble():4===p?r.readVarint64():5===p?r.readVarint():6===p?r.readSVarint():7===p?r.readBoolean():null}return s}(i))}nd.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Lm(this._pbf,e,this.extent,this._keys,this._values)};var Bm=id;function Om(t,e,i){if(3===t){var r=new Bm(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var vh=Tu.VectorTile=function(t,e){this.layers=t.readFields(Om,{},e)},Eu=Tu.VectorTileFeature=td;function Cu(t,e,i,r){const s=[],c=0===r?(p,f,_,g,v,E)=>{p.push(new Oe(E,_+(E-f)/(g-f)*(v-_)))}:(p,f,_,g,v,E)=>{p.push(new Oe(f+(E-_)/(v-_)*(g-f),E))};for(const p of t){const f=[];for(const _ of p){if(_.length<=2)continue;const g=[];for(let C=0;C<_.length-1;C++){const k=_[C].x,z=_[C].y,L=_[C+1].x,O=_[C+1].y,H=0===r?k:z,ne=0===r?L:O;H<e?ne>e&&c(g,k,z,L,O,e):H>i?ne<i&&c(g,k,z,L,O,i):g.push(_[C]),ne<e&&H>=e&&c(g,k,z,L,O,e),ne>i&&H<=i&&c(g,k,z,L,O,i)}let v=_[_.length-1];const E=0===r?v.x:v.y;E>=e&&E<=i&&g.push(v),g.length&&(v=g[g.length-1],g[0].x===v.x&&g[0].y===v.y||g.push(g[0]),f.push(g))}f.length&&s.push(f)}return s}Tu.VectorTileLayer=id;const Fm=Eu.types,Um=Math.pow(2,13);function dc(t,e,i,r,s,c,p,f){t.emplaceBack((e<<1)+p,(i<<1)+c,(Math.floor(r*Um)<<1)+s,Math.round(f))}function fc(t,e,i){t.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class rd{constructor(){this.acc=new Oe(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Oe(e.x,e.y),this.max=new Oe(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,s=this.max;e.x<r.x?r.x=e.x:e.x>s.x&&(s.x=e.x),e.y<r.y?r.y=e.y:e.y>s.y&&(s.y=e.y),((0===e.x||e.x===st)&&e.x===i.x)!=((0===e.y||e.y===st)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,Et(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>st!=e.x>st&&this.addBorderIntersection(1,Et(i.y,e.y,(st-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Et(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>st!=e.y>st&&this.addBorderIntersection(3,Et(i.x,e.x,(st-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((i,r)=>i+r.edges,0);return 0!==e?this.acc.div(e)._round():new Oe(0,0)}span(){return new Oe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class mc{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Ft,this.centroidVertexArray=new up,this.indexArray=new Gi,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new mi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,r,s){this.features=[],this.hasPattern=yh("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(c){const p=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*p/(p*p+1)/st/(1<<c.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:p,index:f,sourceLayerIndex:_}of e){const g=this.layers[0]._featureFilter.needGeometry,v=ma(c,g);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),v,r))continue;const E={id:p,sourceLayerIndex:_,index:f,geometry:g?v.geometry:Fo(c,r,s),properties:c.properties,type:c.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(xh("fill-extrusion",this.layers,E,this.zoom,i)):this.addFeature(E,E.geometry,f,r,{},i.availableImages,s),i.featureIndex.insert(c,E.geometry,f,_,this.index,C)}this.sortBorders()}addFeatures(e,i,r,s,c){for(const p of this.features){const{geometry:f}=p;this.addFeature(p,f,p.index,i,r,s,c)}this.sortBorders()}update(e,i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,km),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Mm.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Im.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,s,c,p,f){const _=[new Oe(0,0),new Oe(st,st)],g=f.projection,v="globe"===g.name,E=this.enableTerrain&&!v?new rd:null,C="Polygon"===Fm[e.type];v&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Kh);const k=gh(i,500);for(let H=k.length-1;H>=0;H--){const ne=k[H];(0===ne.length||(z=ne[0]).every(W=>W.x<=0)||z.every(W=>W.x>=st)||z.every(W=>W.y<=0)||z.every(W=>W.y>=st))&&k.splice(H,1)}var z;let L;if(v)L=hd(k,_,s);else{L=[];for(const H of k)L.push({polygon:H,bounds:_})}const O=C?this.edgeRadius:0;for(const{polygon:H,bounds:ne}of L){let W=0,K=0;for(const ee of H)C&&!ee[0].equals(ee[ee.length-1])&&ee.push(ee[0]),K+=C?ee.length-1:ee.length;const oe=this.segments.prepareSegment((C?5:4)*K,this.layoutVertexArray,this.indexArray);if(C){const ee=[],_e=[];W=oe.vertexLength;for(const be of H){let Pe,ye;be.length&&be!==H[0]&&_e.push(ee.length/2),Pe=be[1].sub(be[0])._perp()._unit();for(let we=1;we<be.length;we++){const Ce=be[we],ke=be[we===be.length-1?1:we+1];let{x:De,y:xe}=Ce;if(O){ye=ke.sub(Ce)._perp()._unit();const Ue=Pe.add(ye)._unit(),nt=O*Math.min(4,1/(Pe.x*Ue.x+Pe.y*Ue.y));De+=nt*Ue.x,xe+=nt*Ue.y,Pe=ye}dc(this.layoutVertexArray,De,xe,0,0,1,1,0),oe.vertexLength++,ee.push(Ce.x,Ce.y),v&&fc(this.layoutVertexExtArray,g.projectTilePoint(De,xe,s),g.upVector(s,De,xe))}}const fe=lc.exports(ee,_e);for(let be=0;be<fe.length;be+=3)this.indexArray.emplaceBack(W+fe[be],W+fe[be+2],W+fe[be+1]),oe.primitiveLength++}for(const ee of H){E&&ee.length&&E.startRing(ee[0]);let _e,fe,be,Pe=ee.length>4&&ld(ee[ee.length-2],ee[0],ee[1]),ye=O?Zm(ee[ee.length-2],ee[0],ee[1],O):0;fe=ee[1].sub(ee[0])._perp()._unit();let we=!0;for(let Ce=1,ke=0;Ce<ee.length;Ce++){let De=ee[Ce-1],xe=ee[Ce];const Ue=ee[Ce===ee.length-1?1:Ce+1];if(E&&C&&E.currentPolyCount.top++,ad(xe,De,ne)){O&&(fe=Ue.sub(xe)._perp()._unit(),we=!we);continue}E&&E.append(xe,De);const nt=xe.sub(De)._perp(),Ge=nt.x/(Math.abs(nt.x)+Math.abs(nt.y)),Xe=nt.y>0?1:0,Ne=De.dist(xe);if(ke+Ne>32768&&(ke=0),O){be=Ue.sub(xe)._perp()._unit();let Ct=sd(De,xe,Ue,od(fe,be),O);isNaN(Ct)&&(Ct=0);const ct=xe.sub(De)._unit();De=De.add(ct.mult(ye))._round(),xe=xe.add(ct.mult(-Ct))._round(),ye=Ct,fe=be}const rt=oe.vertexLength,ut=ee.length>4&&ld(De,xe,Ue);let ht=cd(ke,Pe,we);if(dc(this.layoutVertexArray,De.x,De.y,Ge,Xe,0,0,ht),dc(this.layoutVertexArray,De.x,De.y,Ge,Xe,0,1,ht),ke+=Ne,ht=cd(ke,ut,!we),Pe=ut,dc(this.layoutVertexArray,xe.x,xe.y,Ge,Xe,0,0,ht),dc(this.layoutVertexArray,xe.x,xe.y,Ge,Xe,0,1,ht),oe.vertexLength+=4,this.indexArray.emplaceBack(rt+0,rt+1,rt+2),this.indexArray.emplaceBack(rt+1,rt+3,rt+2),oe.primitiveLength+=2,O){const Ct=W+(1===Ce?ee.length-2:Ce-2),ct=1===Ce?W:Ct+1;if(this.indexArray.emplaceBack(rt+1,Ct,rt+3),this.indexArray.emplaceBack(Ct,ct,rt+3),oe.primitiveLength+=2,void 0===_e&&(_e=rt),!ad(Ue,ee[Ce],ne)){const Yt=Ce===ee.length-1?_e:oe.vertexLength;this.indexArray.emplaceBack(rt+2,rt+3,Yt),this.indexArray.emplaceBack(rt+3,Yt+1,Yt),this.indexArray.emplaceBack(rt+3,ct,Yt+1),oe.primitiveLength+=3}we=!we}if(v){const Ct=this.layoutVertexExtArray,ct=g.projectTilePoint(De.x,De.y,s),Yt=g.projectTilePoint(xe.x,xe.y,s),mt=g.upVector(s,De.x,De.y),bt=g.upVector(s,xe.x,xe.y);fc(Ct,ct,mt),fc(Ct,ct,mt),fc(Ct,Yt,bt),fc(Ct,Yt,bt)}}C&&(W+=ee.length-1)}}if(E&&E.polyCount.length>0){if(E.borders){E.vertexArrayOffset=this.centroidVertexArray.length;const H=E.borders,ne=this.featuresOnBorder.push(E)-1;for(let W=0;W<4;W++)H[W][0]!==Number.MAX_VALUE&&this.borders[W].push(ne)}this.encodeCentroid(E.borders?void 0:E.centroid(),E)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,p,s)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,i,r=!0){let s,c;if(e)if(0!==e.y){const f=i.span()._mult(this.tileToMeter);s=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(f.x/10)),c=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(f.y/10))}else s=Math.ceil(7*(e.x+450)),c=0;else s=0,c=+r;let p=r?this.centroidVertexArray.length:i.vertexArrayOffset;for(const f of i.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*f.edges+f.top);for(let _=0;_<f.top;_++)this.centroidVertexArray.emplace(p++,s,c);for(let _=0;_<2*f.edges;_++)this.centroidVertexArray.emplace(p++,0,c),this.centroidVertexArray.emplace(p++,s,c)}}}function od(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Zm(t,e,i,r){const s=e.sub(t)._perp()._unit(),c=i.sub(e)._perp()._unit();return sd(t,e,i,od(s,c),r)}function sd(t,e,i,r,s){const c=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,s*c/r)}function ad(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function ld(t,e,i){if(t.x<0||t.x>=st||e.x<0||e.x>=st||i.x<0||i.x>=st)return!1;const r=i.sub(e),s=r.perp(),c=t.sub(e);return(r.x*c.x+r.y*c.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(c.x*c.x+c.y*c.y))>-.866&&s.x*c.x+s.y*c.y<0}function cd(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function ud(){const t=Math.PI/32,e=Math.tan(t),i=pu;return i*Math.sqrt(1+2*e*e)-i}function hd(t,e,i){const r=1<<i.z,s=Fn(i.x/r),c=Fn((i.x+1)/r),p=Zi(i.y/r),f=Zi((i.y+1)/r);return function(_,g,v,E,C=0,k){const z=[];if(!_.length||!v||!E)return z;const L=(ee,_e)=>{for(const fe of ee)z.push({polygon:fe,bounds:_e})},O=Math.ceil(Math.log2(v)),H=Math.ceil(Math.log2(E)),ne=O-H,W=[];for(let ee=0;ee<Math.abs(ne);ee++)W.push(ne>0?0:1);for(let ee=0;ee<Math.min(O,H);ee++)W.push(0),W.push(1);let K=_;if(K=Cu(K,g[0].y-C,g[1].y+C,1),K=Cu(K,g[0].x-C,g[1].x+C,0),!K.length)return z;const oe=[];for(W.length?oe.push({polygons:K,bounds:g,depth:0}):L(K,g);oe.length;){const ee=oe.pop(),_e=ee.depth,fe=W[_e],be=ee.bounds[0],Pe=ee.bounds[1],ye=0===fe?be.x:be.y,we=0===fe?Pe.x:Pe.y,Ce=k?k(fe,ye,we):.5*(ye+we),ke=Cu(ee.polygons,ye-C,Ce+C,fe),De=Cu(ee.polygons,Ce-C,we+C,fe);if(ke.length){const xe=[be,new Oe(0===fe?Ce:Pe.x,1===fe?Ce:Pe.y)];W.length>_e+1?oe.push({polygons:ke,bounds:xe,depth:_e+1}):L(ke,xe)}if(De.length){const xe=[new Oe(0===fe?Ce:be.x,1===fe?Ce:be.y),Pe];W.length>_e+1?oe.push({polygons:De,bounds:xe,depth:_e+1}):L(De,xe)}}return z}(t,e,Math.ceil((c-s)/11.25),Math.ceil((p-f)/11.25),1,(_,g,v)=>{if(0===_)return.5*(g+v);{const E=Zi((i.y+g/st)/r);return(to(.5*(Zi((i.y+v/st)/r)+E))*r-i.y)*st}})}$e(mc,"FillExtrusionBucket",{omit:["layers","features"]}),$e(rd,"PartMetadata");const Nm=new Re({"fill-extrusion-edge-radius":new de(ve["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Vm={paint:new Re({"fill-extrusion-opacity":new de(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ae(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new de(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new de(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ze(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ae(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ae(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new de(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new de(ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new de(ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Nm};function pd(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Au{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=_c(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=(p=this.y,f=this.z,_=pd(256*(c=this.x),256*(p=Math.pow(2,f)-p-1),f),g=pd(256*(c+1),256*(p+1),f),_[0]+","+_[1]+","+g[0]+","+g[1]),s=function(c,p,f){let _,g="";for(let v=c;v>0;v--)_=1<<v-1,g+=(p&_?1:0)+(f&_?2:0);return g}(this.z,this.x,this.y);var c,p,f,_,g;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dd{constructor(e,i){this.wrap=e,this.canonical=i,this.key=_c(e,i.z,i.z,i.x,i.y)}}class tn{constructor(e,i,r,s,c){this.overscaledZ=e,this.wrap=i,this.canonical=new Au(r,+s,+c),this.key=0===i&&e===r?this.canonical.key:_c(i,e,r,s,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new tn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new tn(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return _c(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return _c(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new tn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,s=2*this.canonical.y;return[new tn(i,this.wrap,i,r,s),new tn(i,this.wrap,i,r+1,s),new tn(i,this.wrap,i,r,s+1),new tn(i,this.wrap,i,r+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new tn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new tn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _c(t,e,i,r,s){const c=1<<Math.min(i,22);let p=c*(s%c)+r%c;return t&&i<22&&(p+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}$e(Au,"CanonicalTileID"),$e(tn,"OverscaledTileID",{omit:["projMatrix"]});class _l extends Oe{constructor(e,i,r){super(e,i),this.z=r}}function gc(t,e){return t.x*e.x+t.y*e.y}function fd(t,e){if(1===t.length){let i=0;const r=e[i++];let s;for(;!s||r.equals(s);)if(s=e[i++],!s)return 1/0;for(;i<e.length;i++){const c=e[i],p=t[0],f=s.sub(r),_=c.sub(r),g=p.sub(r),v=gc(f,f),E=gc(f,_),C=gc(_,_),k=gc(g,f),z=gc(g,_),L=v*C-E*E,O=(C*k-E*z)/L,H=(v*z-E*k)/L,ne=r.z*(1-O-H)+s.z*O+c.z*H;if(isFinite(ne))return ne}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function md(t,e,i,r,s,c,p,f){const _=p*s.getElevationAt(t,e,!0,!0),g=0!==c[0],v=g?0===c[1]?p*(c[0]/7-450):p*function(E,C,k){const z=Math.floor(C[0]/8),L=Math.floor(C[1]/8),O=10*(C[0]-8*z),H=10*(C[1]-8*L),ne=E.getElevationAt(z,L,!0,!0),W=E.getMeterToDEM(k),K=Math.floor(.5*(O*W-1)),oe=Math.floor(.5*(H*W-1)),ee=E.tileCoordToPixel(z,L),_e=2*K+1,fe=2*oe+1,be=(nt=_e,Ge=fe,[(De=E).getElevationAtPixel(xe=ee.x-K,Ue=ee.y-oe,!0),De.getElevationAtPixel(xe+Ge,Ue,!0),De.getElevationAtPixel(xe,Ue+Ge,!0),De.getElevationAtPixel(xe+nt,Ue+Ge,!0)]),Pe=Math.abs(be[0]-be[1]),ye=Math.abs(be[2]-be[3]),we=Math.abs(be[0]-be[2])+Math.abs(be[1]-be[3]),Ce=Math.min(.25,.5*W*(Pe+ye)/_e),ke=Math.min(.25,.5*W*we/fe);var De,xe,Ue,nt,Ge;return ne+Math.max(Ce*O,ke*H)}(s,c,f):_;return{base:_+(0===i)?-1:i,top:g?Math.max(v+r,_+i+2):_+r}}const jm=Be([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:qm}=jm,Gm=Be([{name:"a_packed",components:4,type:"Float32"}]),{members:$m}=Gm,Xm=Eu.types,Wm=Math.cos(Math.PI/180*37.5);class Su{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Lt,this.layoutVertexArray2=new vi,this.indexArray=new Gi,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new mi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,s){this.hasPattern=yh("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:v,id:E,index:C,sourceLayerIndex:k}of e){const z=this.layers[0]._featureFilter.needGeometry,L=ma(v,z);if(!this.layers[0]._featureFilter.filter(new J(this.zoom),L,r))continue;const O=c?c.evaluate(L,{},r):void 0,H={id:E,properties:v.properties,type:v.type,sourceLayerIndex:k,index:C,geometry:z?L.geometry:Fo(v,r,s),patterns:{},sortKey:O};p.push(H)}c&&p.sort((v,E)=>v.sortKey-E.sortKey);const{lineAtlas:f,featureIndex:_}=i,g=this.addConstantDashes(f);for(const v of p){const{geometry:E,index:C,sourceLayerIndex:k}=v;if(g&&this.addFeatureDashes(v,f),this.hasPattern){const z=xh("line",this.layers,v,this.zoom,i);this.patternFeatures.push(z)}else this.addFeature(v,E,C,r,f.positions,i.availableImages);_.insert(e[C].feature,E,C,k,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const s=r.paint.get("line-dasharray").value,c=r.layout.get("line-cap").value;if("constant"!==s.kind||"constant"!==c.kind)i=!0;else{const p=c.value,f=s.value;if(!f)continue;e.addDash(f.from,p),e.addDash(f.to,p),f.other&&e.addDash(f.other,p)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if("constant"===c.kind&&"constant"===p.kind)continue;let f,_,g,v,E,C;if("constant"===c.kind){const O=c.value;if(!O)continue;f=O.other||O.to,_=O.to,g=O.from}else f=c.evaluate({zoom:r-1},e),_=c.evaluate({zoom:r},e),g=c.evaluate({zoom:r+1},e);"constant"===p.kind?v=E=C=p.value:(v=p.evaluate({zoom:r-1},e),E=p.evaluate({zoom:r},e),C=p.evaluate({zoom:r+1},e)),i.addDash(f,v),i.addDash(_,E),i.addDash(g,C);const k=i.getKey(f,v),z=i.getKey(_,E),L=i.getKey(g,C);e.patterns[s.id]={min:k,mid:z,max:L}}}update(e,i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,s)}addFeatures(e,i,r,s,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,r,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,$m)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,s,c,p){const f=this.layers[0].layout,_=f.get("line-join").evaluate(e,{}),g=f.get("line-cap").evaluate(e,{}),v=f.get("line-miter-limit"),E=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of i)this.addLine(C,e,_,g,v,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,p,s)}addLine(e,i,r,s,c,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<e.length-1;H++)this.totalDistance+=e[H].dist(e[H+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f="Polygon"===Xm[i.type];let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let g=0;for(;g<_-1&&e[g].equals(e[g+1]);)g++;if(_<(f?3:2))return;"bevel"===r&&(c=1.05);const v=this.overscaling<=16?122880/(512*this.overscaling):0,E=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let C,k,z,L,O;this.e1=this.e2=-1,f&&(C=e[_-2],O=e[g].sub(C)._unit()._perp());for(let H=g;H<_;H++){if(z=H===_-1?f?e[g+1]:void 0:e[H+1],z&&e[H].equals(z))continue;O&&(L=O),C&&(k=C),C=e[H],O=z?z.sub(C)._unit()._perp():L,L=L||O;let ne=L.add(O);0===ne.x&&0===ne.y||ne._unit();const W=L.x*O.x+L.y*O.y,K=ne.x*O.x+ne.y*O.y,oe=0!==K?1/K:1/0,ee=2*Math.sqrt(2-2*K),_e=K<Wm&&k&&z,fe=L.x*O.y-L.y*O.x>0;if(_e&&H>g){const ye=C.dist(k);if(ye>2*v){const we=C.sub(C.sub(k)._mult(v/ye)._round());this.updateDistance(k,we),this.addCurrentVertex(we,L,0,0,E),k=we}}const be=k&&z;let Pe=be?r:f?"butt":s;if(be&&"round"===Pe&&(oe<p?Pe="miter":oe<=2&&(Pe="fakeround")),"miter"===Pe&&oe>c&&(Pe="bevel"),"bevel"===Pe&&(oe>2&&(Pe="flipbevel"),oe<c&&(Pe="miter")),k&&this.updateDistance(k,C),"miter"===Pe)ne._mult(oe),this.addCurrentVertex(C,ne,0,0,E);else if("flipbevel"===Pe){if(oe>100)ne=O.mult(-1);else{const ye=oe*L.add(O).mag()/L.sub(O).mag();ne._perp()._mult(ye*(fe?-1:1))}this.addCurrentVertex(C,ne,0,0,E),this.addCurrentVertex(C,ne.mult(-1),0,0,E)}else if("bevel"===Pe||"fakeround"===Pe){const ye=-Math.sqrt(oe*oe-1),we=fe?ye:0,Ce=fe?0:ye;if(k&&this.addCurrentVertex(C,L,we,Ce,E),"fakeround"===Pe){const ke=Math.round(180*ee/Math.PI/20);for(let De=1;De<ke;De++){let xe=De/ke;if(.5!==xe){const nt=xe-.5;xe+=xe*nt*(xe-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*nt*nt+(.848013+W*(.215638*W-1.06021)))}const Ue=O.sub(L)._mult(xe)._add(L)._unit()._mult(fe?-1:1);this.addHalfVertex(C,Ue.x,Ue.y,!1,fe,0,E)}}z&&this.addCurrentVertex(C,O,-we,-Ce,E)}else if("butt"===Pe)this.addCurrentVertex(C,ne,0,0,E);else if("square"===Pe){const ye=k?1:-1;k||this.addCurrentVertex(C,ne,ye,ye,E),this.addCurrentVertex(C,ne,0,0,E),k&&this.addCurrentVertex(C,ne,ye,ye,E)}else"round"===Pe&&(k&&(this.addCurrentVertex(C,L,0,0,E),this.addCurrentVertex(C,L,1,1,E,!0)),z&&(this.addCurrentVertex(C,O,-1,-1,E,!0),this.addCurrentVertex(C,O,0,0,E)));if(_e&&H<_-1){const ye=C.dist(z);if(ye>2*v){const we=C.add(z.sub(C)._mult(v/ye)._round());this.updateDistance(C,we),this.addCurrentVertex(we,O,0,0,E),C=we}}}}addCurrentVertex(e,i,r,s,c,p=!1){const f=i.y*s-i.x,_=-i.y-i.x*s;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,p,!1,r,c),this.addHalfVertex(e,f,_,p,!0,-s,c)}addHalfVertex({x:e,y:i},r,s,c,p,f,_){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(i<<1)+(p?1:0),Math.round(63*r)+128,Math.round(63*s)+128,1+(0===f?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const g=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,g),_.primitiveLength++),p?this.e2=g:this.e1=g}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}$e(Su,"LineBucket",{omit:["layers","patternFeatures"]});const Hm=new Re({"line-cap":new ae(ve.layout_line["line-cap"]),"line-join":new ae(ve.layout_line["line-join"]),"line-miter-limit":new de(ve.layout_line["line-miter-limit"]),"line-round-limit":new de(ve.layout_line["line-round-limit"]),"line-sort-key":new ae(ve.layout_line["line-sort-key"])});var _d={paint:new Re({"line-opacity":new ae(ve.paint_line["line-opacity"]),"line-color":new ae(ve.paint_line["line-color"]),"line-translate":new de(ve.paint_line["line-translate"]),"line-translate-anchor":new de(ve.paint_line["line-translate-anchor"]),"line-width":new ae(ve.paint_line["line-width"]),"line-gap-width":new ae(ve.paint_line["line-gap-width"]),"line-offset":new ae(ve.paint_line["line-offset"]),"line-blur":new ae(ve.paint_line["line-blur"]),"line-dasharray":new Ze(ve.paint_line["line-dasharray"]),"line-pattern":new Ze(ve.paint_line["line-pattern"]),"line-gradient":new Fe(ve.paint_line["line-gradient"]),"line-trim-offset":new de(ve.paint_line["line-trim-offset"])}),layout:Hm};const gd=new class extends ae{possiblyEvaluate(t,e){return e=new J(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=Kt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(_d.paint.properties["line-width"].specification);function yd(t,e){return e>0?e+2*t:t}gd.useIntegerZoom=!0;const Jm=Be([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ym=Be([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Qm=Be([{name:"a_projected_pos",components:4,type:"Float32"}],4);Be([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Km=Be([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),e_=Be([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const xd=Be([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),t_=Be([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Be([{name:"triangle",components:3,type:"Uint16"}]),Be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Be([{type:"Float32",name:"offsetX"}]),Be([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ro=128;function bh(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new J(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:r,interpolationType:s}=i;let c=0;for(;c<r.length&&r[c]<=t;)c++;c=Math.max(0,c-1);let p=c;for(;p<r.length&&r[p]<t+1;)p++;p=Math.min(r.length-1,p);const f=r[c],_=r[p];return"composite"===i.kind?{kind:"composite",minZoom:f,maxZoom:_,interpolationType:s}:{kind:"camera",minZoom:f,maxZoom:_,minSize:i.evaluate(new J(f)),maxSize:i.evaluate(new J(_)),interpolationType:s}}}function Iu(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:s}){return"source"===t.kind?r/ro:"composite"===t.kind?Et(r/ro,s/ro,i):e}function gl(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:s,minZoom:c,maxZoom:p}=t,f=s?yt(xn.interpolationFactor(s,e,c,p),0,1):0;"camera"===t.kind?r=Et(t.minSize,t.maxSize,f):i=f}return{uSizeT:i,uSize:r}}var i_=Object.freeze({__proto__:null,getSizeData:bh,evaluateSizeForFeature:Iu,evaluateSizeForZoom:gl,SIZE_PACK_FACTOR:ro});function n_(t,e,i){return t.sections.forEach(r=>{r.text=function(s,c,p){const f=c.layout.get("text-transform").evaluate(p,{});return"uppercase"===f?s=s.toLocaleUpperCase():"lowercase"===f&&(s=s.toLocaleLowerCase()),ie.applyArabicShaping&&(s=ie.applyArabicShaping(s)),s}(r.text,e,i)}),t}const yc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function r_(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function o_(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var xc=jt,vd=function(t,e,i,r,s){var c,p,f=8*s-r-1,_=(1<<f)-1,g=_>>1,v=-7,E=i?s-1:0,C=i?-1:1,k=t[e+E];for(E+=C,c=k&(1<<-v)-1,k>>=-v,v+=f;v>0;c=256*c+t[e+E],E+=C,v-=8);for(p=c&(1<<-v)-1,c>>=-v,v+=r;v>0;p=256*p+t[e+E],E+=C,v-=8);if(0===c)c=1-g;else{if(c===_)return p?NaN:1/0*(k?-1:1);p+=Math.pow(2,r),c-=g}return(k?-1:1)*p*Math.pow(2,c-r)},bd=function(t,e,i,r,s,c){var p,f,_,g=8*c-s-1,v=(1<<g)-1,E=v>>1,C=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,k=r?0:c-1,z=r?1:-1,L=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=v):(p=Math.floor(Math.log(e)/Math.LN2),e*(_=Math.pow(2,-p))<1&&(p--,_*=2),(e+=p+E>=1?C/_:C*Math.pow(2,1-E))*_>=2&&(p++,_/=2),p+E>=v?(f=0,p=v):p+E>=1?(f=(e*_-1)*Math.pow(2,s),p+=E):(f=e*Math.pow(2,E-1)*Math.pow(2,s),p=0));s>=8;t[i+k]=255&f,k+=z,f/=256,s-=8);for(p=p<<s|f,g+=s;g>0;t[i+k]=255&p,k+=z,p/=256,g-=8);t[i+k-z]|=128*L};function jt(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0,jt.Fixed64=1,jt.Bytes=2,jt.Fixed32=5;var wh=4294967296,wd=1/wh,Td=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function No(t){return t.type===jt.Bytes?t.readVarint()+t.pos:t.pos+1}function Ed(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var s=i.pos-1;s>=t;s--)i.buf[s+r]=i.buf[s]}function s_(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function a_(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function l_(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function c_(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function u_(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function h_(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function p_(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function d_(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function f_(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Mu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function xl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Cd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function m_(t,e,i){e.glyphs=[],1===t&&i.readMessage(__,e)}function __(t,e,i){if(3===t){const{id:r,bitmap:s,width:c,height:p,left:f,top:_,advance:g}=i.readMessage(g_,{});e.glyphs.push({id:r,bitmap:new Zo({width:c+6,height:p+6},s),metrics:{width:c,height:p,left:f,top:_,advance:g}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function g_(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function Th(t){let e=0,i=0;for(const p of t)e+=p.w*p.h,i=Math.max(i,p.w);t.sort((p,f)=>f.h-p.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let s=0,c=0;for(const p of t)for(let f=r.length-1;f>=0;f--){const _=r[f];if(!(p.w>_.w||p.h>_.h)){if(p.x=_.x,p.y=_.y,c=Math.max(c,p.y+p.h),s=Math.max(s,p.x+p.w),p.w===_.w&&p.h===_.h){const g=r.pop();f<r.length&&(r[f]=g)}else p.h===_.h?(_.x+=p.w,_.w-=p.w):p.w===_.w?(_.y+=p.h,_.h-=p.h):(r.push({x:_.x+p.w,y:_.y,w:_.w-p.w,h:p.h}),_.y+=p.h,_.h-=p.h);break}}return{w:s,h:c,fill:e/(s*c)||0}}jt.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),s=r>>3,c=this.pos;this.type=7&r,t(s,e,this),this.pos===c&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Mu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Cd(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Mu(this.buf,this.pos)+Mu(this.buf,this.pos+4)*wh;return this.pos+=8,t},readSFixed64:function(){var t=Mu(this.buf,this.pos)+Cd(this.buf,this.pos+4)*wh;return this.pos+=8,t},readFloat:function(){var t=vd(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=vd(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(s,c,p){var f,_,g=p.buf;if(f=(112&(_=g[p.pos++]))>>4,_<128||(f|=(127&(_=g[p.pos++]))<<3,_<128)||(f|=(127&(_=g[p.pos++]))<<10,_<128)||(f|=(127&(_=g[p.pos++]))<<17,_<128)||(f|=(127&(_=g[p.pos++]))<<24,_<128)||(f|=(1&(_=g[p.pos++]))<<31,_<128))return function yl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(s,f,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Td?Td.decode(this.buf.subarray(e,t)):function(i,r,s){for(var c="",p=r;p<s;){var f,_,g,v=i[p],E=null,C=v>239?4:v>223?3:v>191?2:1;if(p+C>s)break;1===C?v<128&&(E=v):2===C?128==(192&(f=i[p+1]))&&(E=(31&v)<<6|63&f)<=127&&(E=null):3===C?(_=i[p+2],128==(192&(f=i[p+1]))&&128==(192&_)&&((E=(15&v)<<12|(63&f)<<6|63&_)<=2047||E>=55296&&E<=57343)&&(E=null)):4===C&&(_=i[p+2],g=i[p+3],128==(192&(f=i[p+1]))&&128==(192&_)&&128==(192&g)&&((E=(15&v)<<18|(63&f)<<12|(63&_)<<6|63&g)<=65535||E>=1114112)&&(E=null)),null===E?(E=65533,C=1):E>65535&&(E-=65536,c+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),c+=String.fromCharCode(E),p+=C}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==jt.Bytes)return t.push(this.readVarint(e));var i=No(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==jt.Bytes)return t.push(this.readSVarint());var e=No(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==jt.Bytes)return t.push(this.readBoolean());var e=No(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==jt.Bytes)return t.push(this.readFloat());var e=No(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==jt.Bytes)return t.push(this.readDouble());var e=No(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==jt.Bytes)return t.push(this.readFixed32());var e=No(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==jt.Bytes)return t.push(this.readSFixed32());var e=No(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==jt.Bytes)return t.push(this.readFixed64());var e=No(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==jt.Bytes)return t.push(this.readSFixed64());var e=No(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===jt.Varint)for(;this.buf[this.pos++]>127;);else if(e===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===jt.Fixed32)this.pos+=4;else{if(e!==jt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),xl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),xl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),xl(this.buf,-1&t,this.pos),xl(this.buf,Math.floor(t*wd),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),xl(this.buf,-1&t,this.pos),xl(this.buf,Math.floor(t*wd),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,s,c,f;if(e>=0?(r=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,s=s+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),c=r,(f=i).buf[f.pos++]=127&c|128,c>>>=7,f.buf[f.pos++]=127&c|128,c>>>=7,f.buf[f.pos++]=127&c|128,c>>>=7,f.buf[f.pos++]=127&c|128,f.buf[f.pos]=127&(c>>>=7),function(c,p){var f=(7&c)<<4;p.buf[p.pos++]|=f|((c>>>=3)?128:0),c&&(p.buf[p.pos++]=127&c|((c>>>=7)?128:0),c&&(p.buf[p.pos++]=127&c|((c>>>=7)?128:0),c&&(p.buf[p.pos++]=127&c|((c>>>=7)?128:0),c&&(p.buf[p.pos++]=127&c|((c>>>=7)?128:0),c&&(p.buf[p.pos++]=127&c)))))}(s,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,s,c){for(var p,f,_=0;_<s.length;_++){if((p=s.charCodeAt(_))>55295&&p<57344){if(!f){p>56319||_+1===s.length?(r[c++]=239,r[c++]=191,r[c++]=189):f=p;continue}if(p<56320){r[c++]=239,r[c++]=191,r[c++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(r[c++]=239,r[c++]=191,r[c++]=189,f=null);p<128?r[c++]=p:(p<2048?r[c++]=p>>6|192:(p<65536?r[c++]=p>>12|224:(r[c++]=p>>18|240,r[c++]=p>>12&63|128),r[c++]=p>>6&63|128),r[c++]=63&p|128)}return c}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Ed(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),bd(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),bd(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Ed(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,jt.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,s_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,a_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,u_,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,l_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,c_,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,h_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,p_,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,d_,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,f_,e)},writeBytesField:function(t,e){this.writeTag(t,jt.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,jt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,jt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,jt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,jt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,jt.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,jt.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,jt.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,jt.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,jt.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Eh{constructor(e,{pixelRatio:i,version:r,stretchX:s,stretchY:c,content:p}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=s,this.stretchY=c,this.content=p,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Ad{constructor(e,i){const r={},s={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,r,c),this.addImages(i,s,c);const{w:p,h:f}=Th(c),_=new wn({width:p||1,height:f||1});for(const g in e){const v=e[g],E=r[g].paddedRect;wn.copy(v.data,_,{x:0,y:0},{x:E.x+1,y:E.y+1},v.data)}for(const g in i){const v=i[g],E=s[g].paddedRect,C=E.x+1,k=E.y+1,z=v.data.width,L=v.data.height;wn.copy(v.data,_,{x:0,y:0},{x:C,y:k},v.data),wn.copy(v.data,_,{x:0,y:L-1},{x:C,y:k-1},{width:z,height:1}),wn.copy(v.data,_,{x:0,y:0},{x:C,y:k+L},{width:z,height:1}),wn.copy(v.data,_,{x:z-1,y:0},{x:C-1,y:k},{width:1,height:L}),wn.copy(v.data,_,{x:0,y:0},{x:C+z,y:k},{width:1,height:L})}this.image=_,this.iconPositions=r,this.patternPositions=s}addImages(e,i,r){for(const s in e){const c=e[s],p={x:0,y:0,w:c.data.width+2,h:c.data.height+2};r.push(p),i[s]=new Eh(p,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),i),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[s,c]=e.tl;r.update(i.data,void 0,{x:s,y:c})}}$e(Eh,"ImagePosition"),$e(Ad,"ImageAtlas");const Zn={horizontal:1,vertical:2,horizontalOnly:3};class vc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new vc;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new vc;return i.imageName=e,i}}class vl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new vl;for(let s=0;s<e.sections.length;s++){const c=e.sections[s];c.image?r.addImageSection(c):r.addTextSection(c,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,r){let s="";for(let c=0;c<i.length;c++){const p=i.charCodeAt(c+1)||null,f=i.charCodeAt(c-1)||null;s+=!r&&(p&&y(p)&&!yc[i[c+1]]||f&&y(f)&&!yc[i[c-1]])||!yc[i[c]]?i[c]:yc[i[c]]}return s}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&ku[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&ku[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new vl;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(vc.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void Jt("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(vc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Jt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ch(t,e,i,r,s,c,p,f,_,g,v,E,C,k,z){const L=vl.fromFeature(t,s);E===Zn.vertical&&L.verticalizePunctuation(C);let O=[];const H=function(ee,_e,fe,be,Pe,ye){if(!ee)return[];const we=[],Ce=function(Ue,nt,Ge,Xe,Ne,rt){let ut=0;for(let ht=0;ht<Ue.length();ht++){const Ct=Ue.getSection(ht);ut+=Sd(Ue.getCharCode(ht),Ct,Xe,Ne,nt,rt)}return ut/Math.max(1,Math.ceil(ut/Ge))}(ee,_e,fe,be,Pe,ye),ke=ee.text.indexOf("\u200b")>=0;let De=0;for(let Ue=0;Ue<ee.length();Ue++){const nt=ee.getSection(Ue),Ge=ee.getCharCode(Ue);if(ku[Ge]||(De+=Sd(Ge,nt,be,Pe,_e,ye)),Ue<ee.length()-1){const Xe=!((xe=Ge)<11904||!(ol(xe)||rl(xe)||al(xe)||ou(xe)||tu(xe)||Hl(xe)||Kc(xe)||ha(xe)||iu(xe)||Ql(xe)||Yl(xe)||n(xe)||nl(xe)||Jl(xe)||Qc(xe)||eu(xe)||pa(xe)||su(xe)||nu(xe)||sl(xe)));(y_[Ge]||Xe||nt.imageName)&&we.push(Md(Ue+1,De,Ce,we,x_(Ge,ee.getCharCode(Ue+1),Xe&&ke),!1))}}var xe;return kd(Md(ee.length(),De,Ce,we,0,!0))}(L,g,c,e,r,k),{processBidirectionalText:ne,processStyledBidirectionalText:W}=ie;if(ne&&1===L.sections.length){const ee=ne(L.toString(),H);for(const _e of ee){const fe=new vl;fe.text=_e,fe.sections=L.sections;for(let be=0;be<_e.length;be++)fe.sectionIndex.push(0);O.push(fe)}}else if(W){const ee=W(L.text,L.sectionIndex,H);for(const _e of ee){const fe=new vl;fe.text=_e[0],fe.sectionIndex=_e[1],fe.sections=L.sections,O.push(fe)}}else O=function(ee,_e){const fe=[],be=ee.text;let Pe=0;for(const ye of _e)fe.push(ee.substring(Pe,ye)),Pe=ye;return Pe<be.length&&fe.push(ee.substring(Pe,be.length)),fe}(L,H);const K=[],oe={positionedLines:K,text:L.toString(),top:v[1],bottom:v[1],left:v[0],right:v[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ee,_e,fe,be,Pe,ye,we,Ce,ke,De,xe,Ue){let nt=0,Ge=0,Xe=0;const Ne="right"===Ce?1:"left"===Ce?0:.5;let rt=!1;for(const mt of Pe){const bt=mt.getSections();for(const Ut of bt){if(Ut.imageName)continue;const Wt=_e[Ut.fontStack];if(Wt&&(rt=void 0!==Wt.ascender&&void 0!==Wt.descender,!rt))break}if(!rt)break}let ut=0;for(const mt of Pe){mt.trim();const bt=mt.getMaxScale(),Ut=24*(bt-1),Wt={positionedGlyphs:[],lineOffset:0};ee.positionedLines[ut]=Wt;const qt=Wt.positionedGlyphs;let Ht=0;if(!mt.length()){Ge+=ye,++ut;continue}let Qt=0,si=0;for(let Rt=0;Rt<mt.length();Rt++){const gi=mt.getSection(Rt),hi=mt.getSectionIndex(Rt),It=mt.getCharCode(Rt);let ni=gi.scale,bi=null,Zt=null,ai=null,$i=24,Pi=0;const Di=!(ke===Zn.horizontal||!xe&&!m(It)||xe&&(ku[It]||(ht=It,Jc(ht)||ua(ht)||Yc(ht)||Kl(ht)||l(ht))));if(gi.imageName){const nn=be[gi.imageName];if(!nn)continue;ai=gi.imageName,ee.iconsInText=ee.iconsInText||!0,Zt=nn.paddedRect;const Li=nn.displaySize;ni=24*ni/Ue,bi={width:Li[0],height:Li[1],left:1,top:-3,advance:Di?Li[1]:Li[0],localGlyph:!1},Pi=rt?-bi.height*ni:24*bt-17-Li[1]*ni,$i=bi.advance;const qo=(Di?Li[0]:Li[1])*ni-24*bt;qo>0&&qo>Ht&&(Ht=qo)}else{const nn=fe[gi.fontStack];if(!nn)continue;nn[It]&&(Zt=nn[It]);const Li=_e[gi.fontStack];if(!Li)continue;const qo=Li.glyphs[It];if(!qo)continue;if(bi=qo.metrics,$i=8203!==It?24:0,rt){const Ml=void 0!==Li.ascender?Math.abs(Li.ascender):0,Pc=void 0!==Li.descender?Math.abs(Li.descender):0,Dc=(Ml+Pc)*ni;Qt<Dc&&(Qt=Dc,si=(Ml-Pc)/2*ni),Pi=-Ml*ni}else Pi=24*(bt-ni)-17}Di?(ee.verticalizable=!0,qt.push({glyph:It,imageName:ai,x:nt,y:Ge+Pi,vertical:Di,scale:ni,localGlyph:bi.localGlyph,fontStack:gi.fontStack,sectionIndex:hi,metrics:bi,rect:Zt}),nt+=$i*ni+De):(qt.push({glyph:It,imageName:ai,x:nt,y:Ge+Pi,vertical:Di,scale:ni,localGlyph:bi.localGlyph,fontStack:gi.fontStack,sectionIndex:hi,metrics:bi,rect:Zt}),nt+=bi.advance*ni+De)}0!==qt.length&&(Xe=Math.max(nt-De,Xe),rt?zd(qt,Ne,Ht,si,ye*bt/2):zd(qt,Ne,Ht,0,ye/2)),nt=0;const zi=ye*bt+Ht;Wt.lineOffset=Math.max(Ht,Ut),Ge+=zi,++ut}var ht;const Ct=Ge,{horizontalAlign:ct,verticalAlign:Yt}=Ah(we);(function(mt,bt,Ut,Wt,qt,Ht){const Qt=(bt-Ut)*qt,si=-Ht*Wt;for(const zi of mt)for(const Rt of zi.positionedGlyphs)Rt.x+=Qt,Rt.y+=si})(ee.positionedLines,Ne,ct,Yt,Xe,Ct),ee.top+=-Yt*Ct,ee.bottom=ee.top+Ct,ee.left+=-ct*Xe,ee.right=ee.left+Xe,ee.hasBaseline=rt}(oe,e,i,r,O,p,f,_,E,g,C,z),!function(ee){for(const _e of ee)if(0!==_e.positionedGlyphs.length)return!1;return!0}(K)&&oe}const ku={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},y_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sd(t,e,i,r,s,c){if(e.imageName){const p=r[e.imageName];return p?p.displaySize[0]*e.scale*24/c+s:0}{const p=i[e.fontStack],f=p&&p.glyphs[t];return f?f.metrics.advance*e.scale+s:0}}function Id(t,e,i,r){const s=Math.pow(t-e,2);return r?t<e?s/2:2*s:s+Math.abs(i)*i}function x_(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Md(t,e,i,r,s,c){let p=null,f=Id(e,i,s,c);for(const _ of r){const g=Id(e-_.x,i,s,c)+_.badness;g<=f&&(p=_,f=g)}return{index:t,x:e,priorBreak:p,badness:f}}function kd(t){return t?kd(t.priorBreak).concat(t.index):[]}function Ah(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function zd(t,e,i,r,s){if(!(e||i||r||s))return;const c=t.length-1,p=t[c],f=(p.x+p.metrics.advance*p.scale)*e;for(let _=0;_<=c;_++)t[_].x-=f,t[_].y+=i+r+s}function v_(t,e,i){const{horizontalAlign:r,verticalAlign:s}=Ah(i),c=e[0]-t.displaySize[0]*r,p=e[1]-t.displaySize[1]*s;return{image:t,top:p,bottom:p+t.displaySize[1],left:c,right:c+t.displaySize[0]}}function Pd(t,e,i,r,s,c){const p=t.image;let f;if(p.content){const O=p.content,H=p.pixelRatio||1;f=[O[0]/H,O[1]/H,p.displaySize[0]-O[2]/H,p.displaySize[1]-O[3]/H]}const _=e.left*c,g=e.right*c;let v,E,C,k;"width"===i||"both"===i?(k=s[0]+_-r[3],E=s[0]+g+r[1]):(k=s[0]+(_+g-p.displaySize[0])/2,E=k+p.displaySize[0]);const z=e.top*c,L=e.bottom*c;return"height"===i||"both"===i?(v=s[1]+z-r[0],C=s[1]+L+r[2]):(v=s[1]+(z+L-p.displaySize[1])/2,C=v+p.displaySize[1]),{image:p,top:v,right:E,bottom:C,left:k,collisionPadding:f}}class Vo extends Oe{constructor(e,i,r,s,c){super(e,i),this.angle=s,this.z=r,void 0!==c&&(this.segment=c)}clone(){return new Vo(this.x,this.y,this.z,this.angle,this.segment)}}function Dd(t,e,i,r,s){if(void 0===e.segment)return!0;let c=e,p=e.segment+1,f=0;for(;f>-i/2;){if(p--,p<0)return!1;f-=t[p].dist(c),c=t[p]}f+=t[p].dist(t[p+1]),p++;const _=[];let g=0;for(;f<i/2;){const v=t[p],E=t[p+1];if(!E)return!1;let C=t[p-1].angleTo(v)-v.angleTo(E);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),_.push({distance:f,angleDelta:C}),g+=C;f-_[0].distance>r;)g-=_.shift().angleDelta;if(g>s)return!1;p++,f+=v.dist(E)}return!0}function Ld(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Rd(t,e,i){return t?.6*e*i:0}function Bd(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function b_(t,e,i,r,s,c){const p=Rd(i,s,c),f=Bd(i,r)*c;let _=0;const g=Ld(t)/2;for(let v=0;v<t.length-1;v++){const E=t[v],C=t[v+1],k=E.dist(C);if(_+k>g){const z=(g-_)/k,L=Et(E.x,C.x,z),O=Et(E.y,C.y,z),H=new Vo(L,O,0,C.angleTo(E),v);return!p||Dd(t,H,f,p,e)?H:void 0}_+=k}}function w_(t,e,i,r,s,c,p,f,_){const g=Rd(r,c,p),v=Bd(r,s),E=v*p,C=0===t[0].x||t[0].x===_||0===t[0].y||t[0].y===_;return e-E<e/4&&(e=E+e/4),Od(t,C?e/2*f%e:(v/2+2*c)*p*f%e,e,g,i,E,C,!1,_)}function Od(t,e,i,r,s,c,p,f,_){const g=c/2,v=Ld(t);let E=0,C=e-i,k=[];for(let z=0;z<t.length-1;z++){const L=t[z],O=t[z+1],H=L.dist(O),ne=O.angleTo(L);for(;C+i<E+H;){C+=i;const W=(C-E)/H,K=Et(L.x,O.x,W),oe=Et(L.y,O.y,W);if(K>=0&&K<_&&oe>=0&&oe<_&&C-g>=0&&C+g<=v){const ee=new Vo(K,oe,0,ne,z);ee._round(),r&&!Dd(t,ee,c,r,s)||k.push(ee)}}E+=H}return f||k.length||p||(k=Od(t,E/2,i,r,s,c,p,!0,_)),k}function Fd(t,e,i,r,s){const c=[];for(let p=0;p<t.length;p++){const f=t[p];let _;for(let g=0;g<f.length-1;g++){let v=f[g],E=f[g+1];v.x<e&&E.x<e||(v.x<e?v=new Oe(e,v.y+(e-v.x)/(E.x-v.x)*(E.y-v.y))._round():E.x<e&&(E=new Oe(e,v.y+(e-v.x)/(E.x-v.x)*(E.y-v.y))._round()),v.y<i&&E.y<i||(v.y<i?v=new Oe(v.x+(i-v.y)/(E.y-v.y)*(E.x-v.x),i)._round():E.y<i&&(E=new Oe(v.x+(i-v.y)/(E.y-v.y)*(E.x-v.x),i)._round()),v.x>=r&&E.x>=r||(v.x>=r?v=new Oe(r,v.y+(r-v.x)/(E.x-v.x)*(E.y-v.y))._round():E.x>=r&&(E=new Oe(r,v.y+(r-v.x)/(E.x-v.x)*(E.y-v.y))._round()),v.y>=s&&E.y>=s||(v.y>=s?v=new Oe(v.x+(s-v.y)/(E.y-v.y)*(E.x-v.x),s)._round():E.y>=s&&(E=new Oe(v.x+(s-v.y)/(E.y-v.y)*(E.x-v.x),s)._round()),_&&v.equals(_[_.length-1])||(_=[v],c.push(_)),_.push(E)))))}}return c}$e(Vo,"Anchor");const bc=1e20;function Ud(t,e,i,r,s,c,p,f,_){for(let g=e;g<e+r;g++)Zd(t,i*c+g,c,s,p,f,_);for(let g=i;g<i+s;g++)Zd(t,g*c+e,1,r,p,f,_)}function Zd(t,e,i,r,s,c,p){c[0]=0,p[0]=-bc,p[1]=bc,s[0]=t[e];for(let f=1,_=0,g=0;f<r;f++){s[f]=t[e+f*i];const v=f*f;do{const E=c[_];g=(s[f]-s[E]+v-E*E)/(f-E)/2}while(g<=p[_]&&--_>-1);_++,c[_]=f,p[_]=g,p[_+1]=bc}for(let f=0,_=0;f<r;f++){for(;p[_+1]<f;)_++;const g=c[_],v=f-g;t[e+f*i]=s[g]+v*v}}const Sh={none:0,ideographs:1,all:2};class bl{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const r=[];for(const s in e)for(const c of e[s])r.push({stack:s,id:c});Nn(r,({stack:s,id:c},p)=>{let f=this.entries[s];f||(f=this.entries[s]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=f.glyphs[c];if(void 0!==_)return void p(null,{stack:s,id:c,glyph:_});if(_=this._tinySDF(f,s,c),_)return f.glyphs[c]=_,void p(null,{stack:s,id:c,glyph:_});const g=Math.floor(c/256);if(256*g>65535)return void p(new Error("glyphs > 65535 not supported"));if(f.ranges[g])return void p(null,{stack:s,id:c,glyph:_});let v=f.requests[g];v||(v=f.requests[g]=[],bl.loadGlyphRange(s,g,this.url,this.requestManager,(E,C)=>{if(C){f.ascender=C.ascender,f.descender=C.descender;for(const k in C.glyphs)this._doesCharSupportLocalGlyph(+k)||(f.glyphs[+k]=C.glyphs[+k]);f.ranges[g]=!0}for(const k of v)k(E,C);delete f.requests[g]})),v.push((E,C)=>{E?p(E):C&&p(null,{stack:s,id:c,glyph:C.glyphs[c]||null})})},(s,c)=>{if(s)i(s);else if(c){const p={};for(const{stack:f,id:_,glyph:g}of c)void 0===p[f]&&(p[f]={}),void 0===p[f].glyphs&&(p[f].glyphs={}),p[f].glyphs[_]=g&&{id:g.id,bitmap:g.bitmap.clone(),metrics:g.metrics},p[f].ascender=this.entries[f].ascender,p[f].descender=this.entries[f].descender;i(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Sh.none&&(this.localGlyphMode===Sh.all?!!this.localFontFamily:!!this.localFontFamily&&(Ql(e)||ru(e)||nl(e)||pa(e)||ha(e)))}_tinySDF(e,i,r){const s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(r))return;let c=e.tinySDF;if(!c){let L="400";/bold/i.test(i)?L="900":/medium/i.test(i)?L="500":/light/i.test(i)&&(L="200"),c=e.tinySDF=new bl.TinySDF({fontFamily:s,fontWeight:L,fontSize:48,buffer:6,radius:16}),c.fontWeight=L}if(this.localGlyphs[c.fontWeight][r])return this.localGlyphs[c.fontWeight][r];const p=String.fromCharCode(r),{data:f,width:_,height:g,glyphWidth:v,glyphHeight:E,glyphLeft:C,glyphTop:k,glyphAdvance:z}=c.draw(p);return this.localGlyphs[c.fontWeight][r]={id:r,bitmap:new Zo({width:_,height:g},f),metrics:{width:v/2,height:E/2,left:C/2,top:k/2-27,advance:z/2,localGlyph:!0}}}}function Nd(t,e,i,r){const s=[],c=t.image,p=c.pixelRatio,f=c.paddedRect.w-2,_=c.paddedRect.h-2,g=t.right-t.left,v=t.bottom-t.top,E=c.stretchX||[[0,f]],C=c.stretchY||[[0,_]],k=(ye,we)=>ye+we[1]-we[0],z=E.reduce(k,0),L=C.reduce(k,0),O=f-z,H=_-L;let ne=0,W=z,K=0,oe=L,ee=0,_e=O,fe=0,be=H;if(c.content&&r){const ye=c.content;ne=zu(E,0,ye[0]),K=zu(C,0,ye[1]),W=zu(E,ye[0],ye[2]),oe=zu(C,ye[1],ye[3]),ee=ye[0]-ne,fe=ye[1]-K,_e=ye[2]-ye[0]-W,be=ye[3]-ye[1]-oe}const Pe=(ye,we,Ce,ke)=>{const De=Pu(ye.stretch-ne,W,g,t.left),xe=Du(ye.fixed-ee,_e,ye.stretch,z),Ue=Pu(we.stretch-K,oe,v,t.top),nt=Du(we.fixed-fe,be,we.stretch,L),Ge=Pu(Ce.stretch-ne,W,g,t.left),Xe=Du(Ce.fixed-ee,_e,Ce.stretch,z),Ne=Pu(ke.stretch-K,oe,v,t.top),rt=Du(ke.fixed-fe,be,ke.stretch,L),ut=new Oe(De,Ue),ht=new Oe(Ge,Ue),Ct=new Oe(Ge,Ne),ct=new Oe(De,Ne),Yt=new Oe(xe/p,nt/p),mt=new Oe(Xe/p,rt/p),bt=e*Math.PI/180;if(bt){const qt=Math.sin(bt),Ht=Math.cos(bt),Qt=[Ht,-qt,qt,Ht];ut._matMult(Qt),ht._matMult(Qt),ct._matMult(Qt),Ct._matMult(Qt)}const Ut=ye.stretch+ye.fixed,Wt=we.stretch+we.fixed;return{tl:ut,tr:ht,bl:ct,br:Ct,tex:{x:c.paddedRect.x+1+Ut,y:c.paddedRect.y+1+Wt,w:Ce.stretch+Ce.fixed-Ut,h:ke.stretch+ke.fixed-Wt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yt,pixelOffsetBR:mt,minFontScaleX:_e/p/g,minFontScaleY:be/p/v,isSDF:i}};if(r&&(c.stretchX||c.stretchY)){const ye=Vd(E,O,z),we=Vd(C,H,L);for(let Ce=0;Ce<ye.length-1;Ce++){const ke=ye[Ce],De=ye[Ce+1];for(let xe=0;xe<we.length-1;xe++)s.push(Pe(ke,we[xe],De,we[xe+1]))}}else s.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:_+1}));return s}function zu(t,e,i){let r=0;for(const s of t)r+=Math.max(e,Math.min(i,s[1]))-Math.max(e,Math.min(i,s[0]));return r}function Vd(t,e,i){const r=[{fixed:-1,stretch:0}];for(const[s,c]of t){const p=r[r.length-1];r.push({fixed:s-p.stretch,stretch:p.stretch}),r.push({fixed:s-p.stretch,stretch:p.stretch+(c-s)})}return r.push({fixed:e+1,stretch:i}),r}function Pu(t,e,i,r){return t/e*i+r}function Du(t,e,i,r){return t-e*i/r}function T_(t,e,i,r){const s=e+t.positionedLines[r].lineOffset;return 0===r?i+s/2:i+(s+(e+t.positionedLines[r-1].lineOffset))/2}bl.loadGlyphRange=function(t,e,i,r,s){const c=256*e,p=c+255,f=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${c}-${p}`),Si.Glyphs);qn(f,(_,g)=>{if(_)s(_);else if(g){const v={},E=new xc(g).readFields(m_,{});for(const C of E.glyphs)v[C.id]=C;s(null,{glyphs:v,ascender:E.ascender,descender:E.descender})}})},bl.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:c="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const f=this.size=t+4*e,_=this._createCanvas(f),g=this.ctx=_.getContext("2d",{willReadFrequently:!0});g.font=`${p} ${c} ${t}px ${s}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:c}=this.ctx.measureText(t),p=Math.ceil(i),f=Math.min(this.size-this.buffer,Math.ceil(c-s)),_=Math.min(this.size-this.buffer,p+Math.ceil(r)),g=f+2*this.buffer,v=_+2*this.buffer,E=Math.max(g*v,0),C=new Uint8ClampedArray(E),k={data:C,width:g,height:v,glyphWidth:f,glyphHeight:_,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(0===f||0===_)return k;const{ctx:z,buffer:L,gridInner:O,gridOuter:H}=this;z.clearRect(L,L,f,_),z.fillText(t,L,L+p);const ne=z.getImageData(L,L,f,_);H.fill(bc,0,E),O.fill(0,0,E);for(let W=0;W<_;W++)for(let K=0;K<f;K++){const oe=ne.data[4*(W*f+K)+3]/255;if(0===oe)continue;const ee=(W+L)*g+K+L;if(1===oe)H[ee]=0,O[ee]=bc;else{const _e=.5-oe;H[ee]=_e>0?_e*_e:0,O[ee]=_e<0?_e*_e:0}}Ud(H,0,0,g,v,g,this.f,this.v,this.z),Ud(O,L,L,f,_,g,this.f,this.v,this.z);for(let W=0;W<E;W++){const K=Math.sqrt(H[W])-Math.sqrt(O[W]);C[W]=Math.round(255-255*(K/this.radius+this.cutoff))}return k}};class E_{constructor(e=[],i=C_){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:r}=this,s=i[e];for(;e>0;){const c=e-1>>1,p=i[c];if(r(s,p)>=0)break;i[e]=p,e=c}i[e]=s}_down(e){const{data:i,compare:r}=this,s=this.length>>1,c=i[e];for(;e<s;){let p=1+(e<<1),f=i[p];const _=p+1;if(_<this.length&&r(i[_],f)<0&&(p=_,f=i[_]),r(f,c)>=0)break;i[e]=f,e=p}i[e]=c}}function C_(t,e){return t<e?-1:t>e?1:0}function A_(t,e=1,i=!1){let r=1/0,s=1/0,c=-1/0,p=-1/0;const f=t[0];for(let k=0;k<f.length;k++){const z=f[k];(!k||z.x<r)&&(r=z.x),(!k||z.y<s)&&(s=z.y),(!k||z.x>c)&&(c=z.x),(!k||z.y>p)&&(p=z.y)}const _=Math.min(c-r,p-s);let g=_/2;const v=new E_([],S_);if(0===_)return new Oe(r,s);for(let k=r;k<c;k+=_)for(let z=s;z<p;z+=_)v.push(new wl(k+g,z+g,g,t));let E=function(k){let z=0,L=0,O=0;const H=k[0];for(let ne=0,W=H.length,K=W-1;ne<W;K=ne++){const oe=H[ne],ee=H[K],_e=oe.x*ee.y-ee.x*oe.y;L+=(oe.x+ee.x)*_e,O+=(oe.y+ee.y)*_e,z+=3*_e}return new wl(L/z,O/z,0,k)}(t),C=v.length;for(;v.length;){const k=v.pop();(k.d>E.d||!E.d)&&(E=k,i&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,C)),k.max-E.d<=e||(g=k.h/2,v.push(new wl(k.p.x-g,k.p.y-g,g,t)),v.push(new wl(k.p.x+g,k.p.y-g,g,t)),v.push(new wl(k.p.x-g,k.p.y+g,g,t)),v.push(new wl(k.p.x+g,k.p.y+g,g,t)),C+=4)}return i&&(console.log(`num probes: ${C}`),console.log(`best distance: ${E.d}`)),E.p}function S_(t,e){return e.max-t.max}function wl(t,e,i,r){this.p=new Oe(t,e),this.h=i,this.d=function(s,c){let p=!1,f=1/0;for(let _=0;_<c.length;_++){const g=c[_];for(let v=0,E=g.length,C=E-1;v<E;C=v++){const k=g[v],z=g[C];k.y>s.y!=z.y>s.y&&s.x<(z.x-k.x)*(s.y-k.y)/(z.y-k.y)+k.x&&(p=!p),f=Math.min(f,Sp(s,k,z))}}return(p?1:-1)*Math.sqrt(f)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const Ih=Number.POSITIVE_INFINITY,I_=Math.sqrt(2);function jd(t,e){return e[1]!==Ih?function(i,r,s){let c=0,p=0;switch(r=Math.abs(r),s=Math.abs(s),i){case"top-right":case"top-left":case"top":p=s-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-s}switch(i){case"top-right":case"bottom-right":case"right":c=-r;break;case"top-left":case"bottom-left":case"left":c=r}return[c,p]}(t,e[0],e[1]):function(i,r){let s=0,c=0;r<0&&(r=0);const p=r/I_;switch(i){case"top-right":case"top-left":c=p-7;break;case"bottom-right":case"bottom-left":c=7-p;break;case"bottom":c=7-r;break;case"top":c=r-7}switch(i){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=r;break;case"right":s=-r}return[s,c]}(t,e[0])}function M_(t,e,i,r,s,c,p,f,_,g){t.createArrays(),t.tilePixelRatio=st/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const v=t.layers[0].layout,E=t.layers[0]._unevaluatedLayout._values,C={};if("composite"===t.textSizeData.kind){const{minZoom:L,maxZoom:O}=t.textSizeData;C.compositeTextSizes=[E["text-size"].possiblyEvaluate(new J(L),f),E["text-size"].possiblyEvaluate(new J(O),f)]}if("composite"===t.iconSizeData.kind){const{minZoom:L,maxZoom:O}=t.iconSizeData;C.compositeIconSizes=[E["icon-size"].possiblyEvaluate(new J(L),f),E["icon-size"].possiblyEvaluate(new J(O),f)]}C.layoutTextSize=E["text-size"].possiblyEvaluate(new J(_+1),f),C.layoutIconSize=E["icon-size"].possiblyEvaluate(new J(_+1),f),C.textMaxSize=E["text-size"].possiblyEvaluate(new J(18),f);const k="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement"),z=v.get("text-size");for(const L of t.features){const O=v.get("text-font").evaluate(L,{},f).join(","),H=z.evaluate(L,{},f),ne=C.layoutTextSize.evaluate(L,{},f),W=(C.layoutIconSize.evaluate(L,{},f),{horizontal:{},vertical:void 0}),K=L.text;let oe,ee=[0,0];if(K){const be=K.toString(),Pe=24*v.get("text-letter-spacing").evaluate(L,{},f),ye=24*v.get("text-line-height").evaluate(L,{},f),we=u(be)?Pe:0,Ce=v.get("text-anchor").evaluate(L,{},f),ke=v.get("text-variable-anchor");if(!ke){const Ge=v.get("text-radial-offset").evaluate(L,{},f);ee=Ge?jd(Ce,[24*Ge,Ih]):v.get("text-offset").evaluate(L,{},f).map(Xe=>24*Xe)}let De=k?"center":v.get("text-justify").evaluate(L,{},f);const xe="point"===v.get("symbol-placement"),Ue=xe?24*v.get("text-max-width").evaluate(L,{},f):1/0,nt=Ge=>{t.allowVerticalPlacement&&o(be)&&(W.vertical=Ch(K,e,i,s,O,Ue,ye,Ce,Ge,we,ee,Zn.vertical,!0,ne,H))};if(!k&&ke){const Ge="auto"===De?ke.map(Ne=>Mh(Ne)):[De];let Xe=!1;for(let Ne=0;Ne<Ge.length;Ne++){const rt=Ge[Ne];if(!W.horizontal[rt])if(Xe)W.horizontal[rt]=W.horizontal[0];else{const ut=Ch(K,e,i,s,O,Ue,ye,"center",rt,we,ee,Zn.horizontal,!1,ne,H);ut&&(W.horizontal[rt]=ut,Xe=1===ut.positionedLines.length)}}nt("left")}else{if("auto"===De&&(De=Mh(Ce)),xe||v.get("text-writing-mode").indexOf("horizontal")>=0||!o(be)){const Ge=Ch(K,e,i,s,O,Ue,ye,Ce,De,we,ee,Zn.horizontal,!1,ne,H);Ge&&(W.horizontal[De]=Ge)}nt(xe?"left":De)}}let _e=!1;if(L.icon&&L.icon.name){const be=r[L.icon.name];be&&(oe=v_(s[L.icon.name],v.get("icon-offset").evaluate(L,{},f),v.get("icon-anchor").evaluate(L,{},f)),_e=be.sdf,void 0===t.sdfIcons?t.sdfIcons=be.sdf:t.sdfIcons!==be.sdf&&Jt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==t.pixelRatio||0!==v.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const fe=Gd(W.horizontal)||W.vertical;t.iconsInText||(t.iconsInText=!!fe&&fe.iconsInText),(fe||oe)&&k_(t,L,W,oe,r,C,ne,0,ee,_e,p,f,g)}c&&t.generateCollisionDebugBuffers(_,t.collisionBoxArray)}function Mh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function k_(t,e,i,r,s,c,p,f,_,g,v,E,C){let k=c.textMaxSize.evaluate(e,{},E);void 0===k&&(k=p);const z=t.layers[0].layout,L=z.get("icon-offset").evaluate(e,{},E),O=Gd(i.horizontal)||i.vertical,H="globe"===C.name,ne=p/24,W=t.tilePixelRatio*k/24,K=(we=t.overscaling,t.zoom>18&&we>2&&(we>>=1),Math.max(st/(512*we),1)*z.get("symbol-spacing")),oe=z.get("text-padding")*t.tilePixelRatio,ee=z.get("icon-padding")*t.tilePixelRatio,_e=vt(z.get("text-max-angle")),fe="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),be="map"===z.get("icon-rotation-alignment")&&"point"!==z.get("symbol-placement"),Pe=z.get("symbol-placement"),ye=K/2;var we;const Ce=z.get("icon-text-fit");let ke;r&&"none"!==Ce&&(t.allowVerticalPlacement&&i.vertical&&(ke=Pd(r,i.vertical,Ce,z.get("icon-text-fit-padding"),L,ne)),O&&(r=Pd(r,O,Ce,z.get("icon-text-fit-padding"),L,ne)));const De=(xe,Ue,nt)=>{if(Ue.x<0||Ue.x>=st||Ue.y<0||Ue.y>=st)return;let Ge=null;if(H){const{x:Xe,y:Ne,z:rt}=C.projectTilePoint(Ue.x,Ue.y,nt);Ge={anchor:new Vo(Xe,Ne,rt,0,void 0),up:C.upVector(nt,Ue.x,Ue.y)}}!function(Xe,Ne,rt,ut,ht,Ct,ct,Yt,mt,bt,Ut,Wt,qt,Ht,Qt,si,zi,Rt,gi,hi,It,ni,bi,Zt,ai){const $i=Xe.addToLineVertexArray(Ne,ut);let Pi,Di,nn,Li,qo,Ml,Pc,Dc=0,kf=0,zf=0,Pf=0,Gh=-1,$h=-1;const co={};let Df=ll.exports("");const Ta=rt?rt.anchor:Ne;let Xh=0,Wh=0;if(void 0===mt._unevaluatedLayout.getValue("text-radial-offset")?[Xh,Wh]=mt.layout.get("text-offset").evaluate(It,{},ai).map(Tn=>24*Tn):(Xh=24*mt.layout.get("text-radial-offset").evaluate(It,{},ai),Wh=Ih),Xe.allowVerticalPlacement&&ht.vertical){const Tn=ht.vertical;if(Qt)Ml=kh(Tn),Yt&&(Pc=kh(Yt));else{const En=mt.layout.get("text-rotate").evaluate(It,{},ai)+90;nn=Lu(bt,Ta,Ne,Ut,Wt,qt,Tn,Ht,En,si),Yt&&(Li=Lu(bt,Ta,Ne,Ut,Wt,qt,Yt,Rt,En))}}if(Ct){const Tn=mt.layout.get("icon-rotate").evaluate(It,{},ai),En="none"!==mt.layout.get("icon-text-fit"),Lc=Nd(Ct,Tn,bi,En),Jh=Yt?Nd(Yt,Tn,bi,En):void 0;Di=Lu(bt,Ta,Ne,Ut,Wt,qt,Ct,Rt,Tn),Dc=4*Lc.length;const Lf=Xe.iconSizeData;let Ea=null;"source"===Lf.kind?(Ea=[ro*mt.layout.get("icon-size").evaluate(It,{},ai)],Ea[0]>As&&Jt(`${Xe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Lf.kind&&(Ea=[ro*ni.compositeIconSizes[0].evaluate(It,{},ai),ro*ni.compositeIconSizes[1].evaluate(It,{},ai)],(Ea[0]>As||Ea[1]>As)&&Jt(`${Xe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,Lc,Ea,hi,gi,It,!1,rt,Ne,$i.lineStartIndex,$i.lineLength,-1,Zt,ai),Gh=Xe.icon.placedSymbolArray.length-1,Jh&&(kf=4*Jh.length,Xe.addSymbols(Xe.icon,Jh,Ea,hi,gi,It,Zn.vertical,rt,Ne,$i.lineStartIndex,$i.lineLength,-1,Zt,ai),$h=Xe.icon.placedSymbolArray.length-1)}for(const Tn in ht.horizontal){const En=ht.horizontal[Tn];Pi||(Df=ll.exports(En.text),Qt?qo=kh(En):Pi=Lu(bt,Ta,Ne,Ut,Wt,qt,En,Ht,mt.layout.get("text-rotate").evaluate(It,{},ai),si));const Lc=1===En.positionedLines.length;if(zf+=qd(Xe,rt,Ne,En,ct,mt,Qt,It,si,$i,ht.vertical?Zn.horizontal:Zn.horizontalOnly,Lc?Object.keys(ht.horizontal):[Tn],co,Gh,ni,Zt,ai),Lc)break}ht.vertical&&(Pf+=qd(Xe,rt,Ne,ht.vertical,ct,mt,Qt,It,si,$i,Zn.vertical,["vertical"],co,$h,ni,Zt,ai));let Ps=-1;const Hh=(Tn,En)=>Tn?Math.max(Tn,En):En;Ps=Hh(qo,Ps),Ps=Hh(Ml,Ps),Ps=Hh(Pc,Ps);const lg=Ps>-1?1:0;Xe.glyphOffsetArray.length>=Is.MAX_GLYPHS&&Jt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==It.sortKey&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,It.sortKey),Xe.symbolInstances.emplaceBack(Ta.x,Ta.y,Ta.z,Ne.x,Ne.y,co.right>=0?co.right:-1,co.center>=0?co.center:-1,co.left>=0?co.left:-1,co.vertical>=0?co.vertical:-1,Gh,$h,Df,void 0!==Pi?Pi:Xe.collisionBoxArray.length,void 0!==Pi?Pi+1:Xe.collisionBoxArray.length,void 0!==nn?nn:Xe.collisionBoxArray.length,void 0!==nn?nn+1:Xe.collisionBoxArray.length,void 0!==Di?Di:Xe.collisionBoxArray.length,void 0!==Di?Di+1:Xe.collisionBoxArray.length,Li||Xe.collisionBoxArray.length,Li?Li+1:Xe.collisionBoxArray.length,Ut,zf,Pf,Dc,kf,lg,0,Xh,Wh,Ps)}(t,Ue,Ge,xe,i,r,s,ke,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,oe,fe,_,0,ee,be,L,e,c,g,v,E)};if("line"===Pe)for(const xe of Fd(e.geometry,0,0,st,st)){const Ue=w_(xe,K,_e,i.vertical||O,r,24,W,t.overscaling,st);for(const nt of Ue){const Ge=O;Ge&&z_(t,Ge.text,ye,nt)||De(xe,nt,E)}}else if("line-center"===Pe){for(const xe of e.geometry)if(xe.length>1){const Ue=b_(xe,_e,i.vertical||O,r,24,W);Ue&&De(xe,Ue,E)}}else if("Polygon"===e.type)for(const xe of gh(e.geometry,0)){const Ue=A_(xe,16);De(xe[0],new Vo(Ue.x,Ue.y,0,0,void 0),E)}else if("LineString"===e.type)for(const xe of e.geometry)De(xe,new Vo(xe[0].x,xe[0].y,0,0,void 0),E);else if("Point"===e.type)for(const xe of e.geometry)for(const Ue of xe)De([Ue],new Vo(Ue.x,Ue.y,0,0,void 0),E)}const As=32640;function qd(t,e,i,r,s,c,p,f,_,g,v,E,C,k,z,L,O){const H=function(K,oe,ee,_e,fe,be,Pe,ye){const we=[];if(0===oe.positionedLines.length)return we;const Ce=_e.layout.get("text-rotate").evaluate(be,{})*Math.PI/180,ke=function(Ge){const Xe=Ge[0],Ne=Ge[1],rt=Xe*Ne;return rt>0?[Xe,-Ne]:rt<0?[-Xe,Ne]:0===Xe?[Ne,Xe]:[Ne,-Xe]}(ee);let De=Math.abs(oe.top-oe.bottom);for(const Ge of oe.positionedLines)De-=Ge.lineOffset;const xe=oe.positionedLines.length,Ue=De/xe;let nt=oe.top-ee[1];for(let Ge=0;Ge<xe;++Ge){const Xe=oe.positionedLines[Ge];nt=T_(oe,Ue,nt,Ge);for(const Ne of Xe.positionedGlyphs){if(!Ne.rect)continue;const rt=Ne.rect||{};let ut=4,ht=!0,Ct=1,ct=0;if(Ne.imageName){const Zt=Pe[Ne.imageName];if(!Zt)continue;if(Zt.sdf){Jt("SDF images are not supported in formatted text and will be ignored.");continue}ht=!1,Ct=Zt.pixelRatio,ut=1/Ct}const Yt=(fe||ye)&&Ne.vertical,mt=Ne.metrics.advance*Ne.scale/2,bt=Ne.metrics,Ut=Ne.rect;if(null===Ut)continue;ye&&oe.verticalizable&&(ct=Ne.imageName?mt-Ne.metrics.width*Ne.scale/2:0);const Wt=fe?[Ne.x+mt,Ne.y]:[0,0];let qt=[0,0],Ht=[0,0],Qt=!1;fe||(Yt?(Ht=[Ne.x+mt+ke[0],Ne.y+ke[1]-ct],Qt=!0):qt=[Ne.x+mt+ee[0],Ne.y+ee[1]-ct]);const si=Ut.w*Ne.scale/(Ct*(Ne.localGlyph?2:1)),zi=Ut.h*Ne.scale/(Ct*(Ne.localGlyph?2:1));let Rt,gi,hi,It;if(Yt){const Zt=Ne.y-nt,ai=new Oe(-mt,mt-Zt),$i=-Math.PI/2,Pi=new Oe(...Ht);Rt=new Oe(-mt+qt[0],qt[1]),Rt._rotateAround($i,ai)._add(Pi),Rt.x+=-Zt+mt,Rt.y-=(bt.left-ut)*Ne.scale;const Di=Ne.imageName?bt.advance*Ne.scale:24*Ne.scale,nn=String.fromCharCode(Ne.glyph);r_(nn)?Rt.x+=(1-ut)*Ne.scale:o_(nn)?Rt.x+=Di-bt.height*Ne.scale+(-ut-1)*Ne.scale:Rt.x+=Ne.imageName||bt.width+2*ut===Ut.w&&bt.height+2*ut===Ut.h?(Di-zi)/2:(Di-(bt.height+2*ut)*Ne.scale)/2,gi=new Oe(Rt.x,Rt.y-si),hi=new Oe(Rt.x+zi,Rt.y),It=new Oe(Rt.x+zi,Rt.y-si)}else{const Zt=(bt.left-ut)*Ne.scale-mt+qt[0],ai=(-bt.top-ut)*Ne.scale+qt[1],$i=Zt+si,Pi=ai+zi;Rt=new Oe(Zt,ai),gi=new Oe($i,ai),hi=new Oe(Zt,Pi),It=new Oe($i,Pi)}if(Ce){let Zt;Zt=fe?new Oe(0,0):Qt?new Oe(ke[0],ke[1]):new Oe(ee[0],ee[1]),Rt._rotateAround(Ce,Zt),gi._rotateAround(Ce,Zt),hi._rotateAround(Ce,Zt),It._rotateAround(Ce,Zt)}const ni=new Oe(0,0),bi=new Oe(0,0);we.push({tl:Rt,tr:gi,bl:hi,br:It,tex:rt,writingMode:oe.writingMode,glyphOffset:Wt,sectionIndex:Ne.sectionIndex,isSDF:ht,pixelOffsetTL:ni,pixelOffsetBR:bi,minFontScaleX:0,minFontScaleY:0})}}return we}(0,r,_,c,p,f,s,t.allowVerticalPlacement),ne=t.textSizeData;let W=null;"source"===ne.kind?(W=[ro*c.layout.get("text-size").evaluate(f,{},O)],W[0]>As&&Jt(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ne.kind&&(W=[ro*z.compositeTextSizes[0].evaluate(f,{},O),ro*z.compositeTextSizes[1].evaluate(f,{},O)],(W[0]>As||W[1]>As)&&Jt(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,H,W,_,p,f,v,e,i,g.lineStartIndex,g.lineLength,k,L,O);for(const K of E)C[K]=t.text.placedSymbolArray.length-1;return 4*H.length}function Gd(t){for(const e in t)return t[e];return null}function Lu(t,e,i,r,s,c,p,f,_,g){let v=p.top,E=p.bottom,C=p.left,k=p.right;const z=p.collisionPadding;if(z&&(C-=z[0],v-=z[1],k+=z[2],E+=z[3]),_){const L=new Oe(C,v),O=new Oe(k,v),H=new Oe(C,E),ne=new Oe(k,E),W=vt(_);let K=new Oe(0,0);g&&(K=new Oe(g[0],g[1])),L._rotateAround(W,K),O._rotateAround(W,K),H._rotateAround(W,K),ne._rotateAround(W,K),C=Math.min(L.x,O.x,H.x,ne.x),k=Math.max(L.x,O.x,H.x,ne.x),v=Math.min(L.y,O.y,H.y,ne.y),E=Math.max(L.y,O.y,H.y,ne.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,C,v,k,E,f,r,s,c),t.length-1}function kh(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function z_(t,e,i,r){const s=t.compareText;if(e in s){const c=s[e];for(let p=c.length-1;p>=0;p--)if(r.dist(c[p])<i)return!0}else s[e]=[];return s[e].push(r),!1}const P_=Be([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$d}=P_,Xd=Be([{name:"a_pos_3",components:3,type:"Int16"}]);var wc=Be([{name:"a_pos",type:"Int16",components:2}]);const jo=st/Math.PI/2,zh=2*ir(1,0)*jo*Math.PI,El=[64,32,16],Cr=-jo,Ar=jo,D_=[new en([Cr,Cr,Cr],[Ar,Ar,Ar]),new en([Cr,Cr,Cr],[0,0,Ar]),new en([0,Cr,Cr],[Ar,0,Ar]),new en([Cr,0,Cr],[0,Ar,Ar]),new en([0,0,Cr],[Ar,Ar,Ar])];function Wd(t,e,i,r=!0){const s=Un([],t._camera.position,t.worldSize),c=[e,i,1,1];ya(c,c,t.pixelMatrixInverse),Up(c,c,1/c[3]);const p=Ki([],Er([],c,s)),f=t.globeMatrix,_=[f[12],f[13],f[14]],g=Er([],_,s),v=nc(g),E=Ki([],g),C=t.worldSize/(2*Math.PI),k=nr(E,p),z=Math.asin(C/v);if(z<Math.acos(k)){if(!r)return null;const Pe=[],ye=[];Un(Pe,p,v/k),Ki(ye,Er(ye,Pe,g)),Ki(p,Uo(p,g,Un(p,ye,Math.tan(z)*v)))}const L=[];new ch(s,p).closestPointOnSphere(_,C,L);const O=Ki([],In(f,0)),H=Ki([],In(f,1)),ne=Ki([],In(f,2)),W=nr(O,L),K=nr(H,L),oe=nr(ne,L),ee=li(Math.asin(-K/C));let _e=li(Math.atan2(W,oe));_e=t.center.lng+function(Pe,ye){const we=(ye-Pe+180)%360-180;return we<-180?we+360:we}(t.center.lng,_e);const fe=eo(_e),be=yt(to(ee),0,1);return new ul(fe,be)}class L_{constructor(e,i,r){this.a=Er([],e,r),this.b=Er([],i,r),this.center=r;const s=Ki([],this.a),c=Ki([],this.b);this.angle=Math.acos(nr(s,c))}}function Ph(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,s,c,p){const f=Math.sin(c);return r*(Math.sin((1-p)*c)/f)+s*(Math.sin(p*c)/f)}(t.a[e],t.b[e],t.angle,yt(i,0,1))+t.center[e]}function oo(t){if(t.z<=1)return D_[t.z+2*t.y+t.x];const e=Dh(Ru(t));return en.fromPoints(e)}function va(t,e,i){return Un(t,t,1-i),sc(t,t,e,i)}function Hd(t,e){const i=Al(e.zoom);if(0===i)return oo(t);const r=Ru(t),s=Dh(r),c=eo(r.getWest())*e.worldSize,p=eo(r.getEast())*e.worldSize,f=to(r.getNorth())*e.worldSize,_=to(r.getSouth())*e.worldSize,g=[c,f,0],v=[p,f,0],E=[c,_,0],C=[p,_,0],k=rh([],e.globeMatrix);return _i(g,g,k),_i(v,v,k),_i(E,E,k),_i(C,C,k),s[0]=va(s[0],E,i),s[1]=va(s[1],C,i),s[2]=va(s[2],v,i),s[3]=va(s[3],g,i),en.fromPoints(s)}function Jd(t,e,i){for(const r of t)_i(r,r,e),Un(r,r,i)}function Ru({x:t,y:e,z:i}){const r=1/(1<<i),s=new kt(Fn(t*r),Zi((e+1)*r)),c=new kt(Fn((t+1)*r),Zi(e*r));return new Cs(s,c)}function Dh(t){const e=vt(t.getNorth()),i=vt(t.getSouth()),r=Math.cos(e),s=Math.cos(i),c=Math.sin(e),p=Math.sin(i),f=t.getWest(),_=t.getEast();return[Cl(s,p,f),Cl(s,p,_),Cl(r,c,_),Cl(r,c,f)]}function Cl(t,e,i,r=jo){return i=vt(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function Tc(t,e,i){return Cl(Math.cos(vt(t)),Math.sin(vt(t)),e,i)}function Ec(t,e,i,r){const s=1<<i.z,c=(t/st+i.x)/s;return Tc(Zi((e/st+i.y)/s),Fn(c),r)}function Bu({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Yd=new Float64Array(16);function Cc(t){const e=Bu(t),i=Lp(Yd,[e,e,e]);return ic(i,i,((r=[])[0]=-(s=t.min)[0],r[1]=-s[1],r[2]=-s[2],r));var r,s}function Lh(t){const e=(r=t.min,(i=Yd)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const s=1/Bu(t);return ga(e,e,[s,s,s])}function Qd(t,e,i,r,s){const c=function(_){const g=st/(2*Math.PI);return _/(2*Math.PI)/g}(i),p=[t,e,-i/(2*Math.PI)],f=no(new Float64Array(16));return ic(f,f,p),ga(f,f,[c,c,c]),oh(f,f,vt(-s)),gu(f,f,vt(-r)),f}function Al(t){return Mr(5,6,t)}function Kd(t,e){const i=Tc(e.lat,e.lng);return p=(s=ah([],function(z){const L=Tc(z._center.lat,z._center.lng);let O=lh([],dl(0,1,0),L);const H=Rp([],-z.angle,L);O=_i(O,O,H),Rp(H,-z._pitch,O);const ne=Ki([],L);return Un(ne,ne,z.cameraToCenterDistance/z.pixelsPerMeter*zh),_i(ne,ne,H),Uo([],L,ne)}(t),i))[0],f=s[1],_=s[2],g=(c=i)[0],v=c[1],E=c[2],k=(C=Math.sqrt(p*p+f*f+_*_)*Math.sqrt(g*g+v*v+E*E))&&nr(s,c)/C,Math.acos(Math.min(Math.max(k,-1),1));var s,c,p,f,_,g,v,E,C,k}const ef=vt(85),B_=Math.cos(ef),O_=Math.sin(ef);function tf(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),c=Math.sin(i)*s/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),p=Math.sin(t._pitch)*c+s;return Math.min(1.01*p,s*(1/t._horizonShift))}function ba(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,s=(t.x+1)*i,c=t.y*i,p=(t.y+1)*i,f=Fn(r),_=Fn(s),g=Zi(c),v=Zi(p),E=e.project(f,g),C=e.project(_,g),k=e.project(_,v),z=e.project(f,v);let L=Math.min(E.x,C.x,k.x,z.x),O=Math.min(E.y,C.y,k.y,z.y),H=Math.max(E.x,C.x,k.x,z.x),ne=Math.max(E.y,C.y,k.y,z.y);const W=i/16;function K(ee,_e,fe,be,Pe,ye){const we=(fe+Pe)/2,Ce=(be+ye)/2,ke=e.project(Fn(we),Zi(Ce)),De=Math.max(0,L-ke.x,O-ke.y,ke.x-H,ke.y-ne);L=Math.min(L,ke.x),H=Math.max(H,ke.x),O=Math.min(O,ke.y),ne=Math.max(ne,ke.y),De>W&&(K(ee,ke,fe,be,we,Ce),K(ke,_e,we,Ce,Pe,ye))}K(E,C,r,c,s,c),K(C,k,s,c,s,p),K(k,z,s,p,r,p),K(z,E,r,p,r,c),L-=W,O-=W,H+=W,ne+=W;const oe=1/Math.max(H-L,ne-O);return{scale:oe,x:L*oe,y:O*oe,x2:H*oe,y2:ne*oe,projection:e}}const F_=no(new Float32Array(16));class Ss{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new kt(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return ir(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return tf(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,s){const c=e.horizonLineFromTop(!1),p=new Oe(i,Math.max(c,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,s))}pointCoordinate3D(e,i,r){const s=new Oe(i,r);if(e.elevation)return e.elevation.pointCoordinate(s);{const c=this.pointCoordinate(e,s.x,s.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return F_}createTileMatrix(e,i,r){let s,c,p;const f=r.canonical,_=no(new Float64Array(16));if(this.isReprojectedInTileSpace){const g=ba(f,this);s=1,c=g.x+r.wrap*g.scale,p=g.y,ga(_,_,[s/g.scale,s/g.scale,e.pixelsPerMeter/i])}else s=i/e.zoomScale(f.z),c=(f.x+Math.pow(2,f.z)*r.wrap)*s,p=f.y*s;return ic(_,_,[c,p,0]),ga(_,_,[s/st,s/st,1]),_}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class U_ extends Ss{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(vt(i));this.n=(s+Math.sin(vt(r)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:s,r0:c}=this,p=vt(e-this.center[0]),f=vt(i),_=Math.sqrt(s-2*r*Math.sin(f))/r;return{x:_*Math.sin(p*r),y:_*Math.cos(p*r)-c,z:0}}unproject(e,i){const{n:r,c:s,r0:c}=this,p=c+i;let f=Math.atan2(e,Math.abs(p))*Math.sign(p);p*r<0&&(f-=Math.PI*Math.sign(e)*Math.sign(p));const _=vt(this.center[0])*r;f=Gt(f,-Math.PI-_,Math.PI-_);const g=yt(li(f/r)+this.center[0],-180,180),v=Math.asin(yt((s-(e*e+p*p)*r*r)/(2*r),-1,1)),E=yt(li(v),-85.051129,io);return new kt(g,E)}}const Ac=1.340264,Sc=-.081106,Ic=893e-6,Mc=.003796,Ou=Math.sqrt(3)/2;class Z_ extends Ss{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(Ou*Math.sin(i)),s=r*r,c=s*s*s;return{x:.5*(e*Math.cos(r)/(Ou*(Ac+3*Sc*s+c*(7*Ic+9*Mc*s)))/Math.PI+.5),y:1-.5*(r*(Ac+Sc*s+c*(Ic+Mc*s))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,s=r*r,c=s*s*s;for(let v,E,C,k=0;k<12&&(E=r*(Ac+Sc*s+c*(Ic+Mc*s))-i,C=Ac+3*Sc*s+c*(7*Ic+9*Mc*s),v=E/C,r=yt(r-v,-Math.PI/3,Math.PI/3),s=r*r,c=s*s*s,!(Math.abs(v)<1e-12));++k);const p=Ou*e*(Ac+3*Sc*s+c*(7*Ic+9*Mc*s))/Math.cos(r),f=Math.asin(Math.sin(r)/Ou),_=yt(180*p/Math.PI,-180,180),g=yt(180*f/Math.PI,-85.051129,io);return new kt(_,g)}}class N_ extends Ss{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),s=yt(360*(.5-i),-85.051129,io);return new kt(r,s)}}const Sl=Math.PI/2;function Fu(t){return Math.tan((Sl+t)/2)}class V_ extends Ss{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let s=vt(i),c=vt(r);this.southernCenter=s+c<0,this.southernCenter&&(s=-s,c=-c);const p=Math.cos(s),f=Fu(s);this.n=s===c?Math.sin(s):Math.log(p/Math.cos(c))/Math.log(Fu(c)/f),this.f=p*Math.pow(Fu(s),this.n)/this.n}project(e,i){i=vt(i),this.southernCenter&&(i=-i),e=vt(e-this.center[0]);const r=1e-6,{n:s,f:c}=this;c>0?i<-Sl+r&&(i=-Sl+r):i>Sl-r&&(i=Sl-r);const p=c/Math.pow(Fu(i),s);let f=p*Math.sin(s*e),_=c-p*Math.cos(s*e);return f=.5*(f/Math.PI+.5),_=.5*(_/Math.PI+.5),{x:f,y:this.southernCenter?_:1-_,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:s}=this,c=s-i,p=Math.sign(c),f=Math.sign(r)*Math.sqrt(e*e+c*c);let _=Math.atan2(e,Math.abs(c))*p;c*r<0&&(_-=Math.PI*Math.sign(e)*p);const g=yt(li(_/r)+this.center[0],-180,180),v=yt(li(2*Math.atan(Math.pow(s/f,1/r))-Sl),-85.051129,io);return new kt(g,this.southernCenter?-v:v)}}class nf extends Ss{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:eo(e),y:to(i),z:0}}unproject(e,i){const r=Fn(e),s=Zi(i);return new kt(r,s)}}const rf=vt(io);class j_ extends Ss{project(e,i){const r=(i=vt(i))*i,s=r*r;return{x:.5*((e=vt(e))*(.8707-.131979*r+s*(s*(.003971*r-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+s*(.028874*r-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,s=25,c=0,p=r*r;do{p=r*r;const g=p*p;c=(r*(1.007226+p*(.015085+g*(.028874*p-.044475-.005916*g)))-i)/(1.007226+p*(.045255+g*(.259866*p-.311325-.005916*11*g))),r=yt(r-c,-rf,rf)}while(Math.abs(c)>1e-6&&--s>0);p=r*r;const f=yt(li(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),_=li(r);return new kt(f,_)}}const of=vt(io);class q_ extends Ss{project(e,i){i=vt(i),e=vt(e);const r=Math.cos(i),s=2/Math.PI,c=Math.acos(r*Math.cos(e/2)),p=Math.sin(c)/c,f=.5*(e*s+2*r*Math.sin(e/2)/p)||0,_=.5*(i+Math.sin(i)/p)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(_/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,s=i=(2*(1-i)-1)*Math.PI,c=25;const p=1e-6;let f=0,_=0;do{const g=Math.cos(s),v=Math.sin(s),E=2*v*g,C=v*v,k=g*g,z=Math.cos(r/2),L=Math.sin(r/2),O=2*z*L,H=L*L,ne=1-k*z*z,W=ne?1/ne:0,K=ne?Math.acos(g*z)*Math.sqrt(1/ne):0,oe=.5*(2*K*g*L+2*r/Math.PI)-e,ee=.5*(K*v+s)-i,_e=.5*W*(k*H+K*g*z*C)+1/Math.PI,fe=W*(O*E/4-K*v*L),be=.125*W*(E*L-K*v*k*O),Pe=.5*W*(C*z+K*H*g)+.5,ye=fe*be-Pe*_e;f=(ee*fe-oe*Pe)/ye,_=(oe*be-ee*_e)/ye,r=yt(r-f,-Math.PI,Math.PI),s=yt(s-_,-of,of)}while((Math.abs(f)>p||Math.abs(_)>p)&&--c>0);return new kt(li(r),li(s))}}class sf extends Ss{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(vt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:s}=this;return{x:vt(e)*s*r+.5,y:-Math.sin(vt(i))/s*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:s}=this,c=-(i-.5)/r,p=yt(li((e-.5)/r)/s,-180,180),f=Math.asin(yt(c*s,-1,1)),_=yt(li(f),-85.051129,io);return new kt(p,_)}}class G_ extends nf{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,i,r){const s=Ec(e,i,r);return _i(s,s,Cc(oo(r))),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,i){const r=Tc(i.lat,i.lng),s=Ki([],r),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;sc(r,r,s,ir(1,0)*st*c);const p=no(new Float64Array(16));return pl(p,e.pixelMatrix,e.globeMatrix),_i(r,r,p),new Oe(r[0],r[1])}pixelsPerMeter(e,i){return ir(1,0)*i}pixelSpaceConversion(e,i,r){const s=ir(1,e)*i,c=Et(ir(1,45)*i,s,r);return this.pixelsPerMeter(e,i)/c}createTileMatrix(e,i,r){const s=Lh(oo(r.canonical));return pl(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,i){const{center:r}=e,s=Cc(oo(i));return gu(s,s,vt(r.lng)),oh(s,s,vt(r.lat)),ga(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,i,r,s){return Wd(e,i,r,!0)||new ul(0,0)}pointCoordinate3D(e,i,r){const s=this.pointCoordinate(e,i,r,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,i){return!Wd(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(s,c){const p=s.cameraToCenterDistance,f=s._centerAltitude*c,_=s._camera,g=s._camera.forward(),v=Uo([],Un([],g,-p),[0,0,f]),E=s.worldSize/(2*Math.PI),C=[0,0,-E],k=s.width/s.height,z=Math.tan(s.fovAboveCenter),L=Un([],_.up(),z),O=Un([],_.right(),z*k),H=Ki([],Uo([],Uo([],g,L),O)),ne=[];let W;if(new ch(v,H).closestPointOnSphere(C,E,ne)){const K=Uo([],ne,C),oe=Er([],K,v);W=Math.cos(s.fovAboveCenter)*nc(oe)}else{const K=Er([],v,C),oe=Er([],C,v);Ki(oe,oe);const ee=nc(K)-E;W=Math.sqrt(ee*(ee+2*E));const _e=Math.acos(W/(E+ee))-Math.acos(nr(g,oe));W*=Math.cos(_e)}return 1.01*W}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Al(e.zoom);if(r>0){const s=tf(e,ir(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Et(i,s+c*(1-Math.cos(p)),Math.pow(r,10))}return i}upVector(e,i,r){return Ec(i,r,e,1)}upVectorScale(e){return{metersToTile:zh*Bu(oo(e))}}}function af(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new nf(t);case"equirectangular":return new N_(t);case"naturalEarth":return new j_(t);case"equalEarth":return new Z_(t);case"winkelTripel":return new q_(t);case"albers":return i?new sf(t):new U_(t);case"lambertConformalConic":return i?new sf(t):new V_(t);case"globe":return new G_(t)}throw new Error(`Invalid projection name: ${t.name}`)}const $_=Eu.types,X_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Uu(t,e,i,r,s,c,p,f,_,g,v,E,C){const k=f?Math.min(As,Math.round(f[0])):0,z=f?Math.min(As,Math.round(f[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*s),c,p,(k<<1)+(_?1:0),z,16*g,16*v,256*E,256*C)}function Zu(t,e,i,r,s,c,p){t.emplaceBack(e,i,r,s,c,p)}function Nu(t,e,i,r,s){t.emplaceBack(e,i,r,s),t.emplaceBack(e,i,r,s),t.emplaceBack(e,i,r,s),t.emplaceBack(e,i,r,s)}function W_(t){for(const e of t.sections)if(I(e.text))return!0;return!1}class Rh{constructor(e){this.layoutVertexArray=new ii,this.indexArray=new Gi,this.programConfigurations=e,this.segments=new mi,this.dynamicLayoutVertexArray=new vi,this.opacityVertexArray=new ci,this.placedSymbolArray=new ip,this.globeExtVertexArray=new Pt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,r,s){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Qm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,X_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ym.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}$e(Rh,"SymbolBuffers");class Bh{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new mi,this.collisionVertexArray=new Ro,this.collisionVertexArrayExt=new Bn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Km.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,e_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}$e(Bh,"CollisionBuffers");class Is{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=no([]),this.placementViewportMatrix=no([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bh(this.zoom,i["text-size"]),this.iconSizeData=bh(this.zoom,i["icon-size"]);const r=this.layers[0].layout,s=r.get("symbol-sort-key"),c=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==c&&void 0!==s.constantOr(1),this.sortFeaturesByY=("viewport-y"===c||"auto"===c&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(p=>Zn[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Rh(new fa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Rh(new fa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new op,this.lineVertexArray=new sp,this.symbolInstances=new rp}calculateGlyphDependencies(e,i,r,s,c){for(let p=0;p<e.length;p++)if(i[e.charCodeAt(p)]=!0,s&&c){const f=yc[e.charAt(p)];f&&(i[f.charCodeAt(0)]=!0)}}populate(e,i,r,s){const c=this.layers[0],p=c.layout,f="globe"===this.projection.name,_=p.get("text-font"),g=p.get("text-field"),v=p.get("icon-image"),E=("constant"!==g.value.kind||g.value.value instanceof Mi&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&("constant"!==_.value.kind||_.value.value.length>0),C="constant"!==v.value.kind||!!v.value.value||Object.keys(v.parameters).length>0,k=p.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const z=i.iconDependencies,L=i.glyphDependencies,O=i.availableImages,H=new J(this.zoom);for(const{feature:ne,id:W,index:K,sourceLayerIndex:oe}of e){const ee=c._featureFilter.needGeometry,_e=ma(ne,ee);if(!c._featureFilter.filter(H,_e,r))continue;if(ee||(_e.geometry=Fo(ne,r,s)),f&&1!==ne.type&&r.z<=5){const ye=_e.geometry,we=.98078528056,Ce=(ke,De)=>nr(Ec(ke.x,ke.y,r,1),Ec(De.x,De.y,r,1))<we;for(let ke=0;ke<ye.length;ke++)ye[ke]=Wf(ye[ke],Ce)}let fe,be;if(E){const ye=c.getValueAndResolveTokens("text-field",_e,r,O),we=Mi.factory(ye);W_(we)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===N()||this.hasRTLText&&ie.isParsed())&&(fe=n_(we,c,_e))}if(C){const ye=c.getValueAndResolveTokens("icon-image",_e,r,O);be=ye instanceof Bi?ye:Bi.fromString(ye)}if(!fe&&!be)continue;const Pe=this.sortFeaturesByKey?k.evaluate(_e,{},r):void 0;if(this.features.push({id:W,text:fe,icon:be,index:K,sourceLayerIndex:oe,geometry:_e.geometry,properties:ne.properties,type:$_[ne.type],sortKey:Pe}),be&&(z[be.name]=!0),fe){const ye=_.evaluate(_e,{},r).join(","),we="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zn.vertical)>=0;for(const Ce of fe.sections)if(Ce.image)z[Ce.image.name]=!0;else{const ke=o(fe.toString()),De=Ce.fontStack||ye,xe=L[De]=L[De]||{};this.calculateGlyphDependencies(Ce.text,xe,we,this.allowVerticalPlacement,ke)}}}"line"===p.get("symbol-placement")&&(this.features=function(ne){const W={},K={},oe=[];let ee=0;function _e(ye){oe.push(ne[ye]),ee++}function fe(ye,we,Ce){const ke=K[ye];return delete K[ye],K[we]=ke,oe[ke].geometry[0].pop(),oe[ke].geometry[0]=oe[ke].geometry[0].concat(Ce[0]),ke}function be(ye,we,Ce){const ke=W[we];return delete W[we],W[ye]=ke,oe[ke].geometry[0].shift(),oe[ke].geometry[0]=Ce[0].concat(oe[ke].geometry[0]),ke}function Pe(ye,we,Ce){const ke=Ce?we[0][we[0].length-1]:we[0][0];return`${ye}:${ke.x}:${ke.y}`}for(let ye=0;ye<ne.length;ye++){const we=ne[ye],Ce=we.geometry,ke=we.text?we.text.toString():null;if(!ke){_e(ye);continue}const De=Pe(ke,Ce),xe=Pe(ke,Ce,!0);if(De in K&&xe in W&&K[De]!==W[xe]){const Ue=be(De,xe,Ce),nt=fe(De,xe,oe[Ue].geometry);delete W[De],delete K[xe],K[Pe(ke,oe[nt].geometry,!0)]=nt,oe[Ue].geometry=null}else De in K?fe(De,xe,Ce):xe in W?be(De,xe,Ce):(_e(ye),W[De]=ee-1,K[xe]=ee-1)}return oe.filter(ye=>ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,W)=>ne.sortKey-W.sortKey)}update(e,i,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,r,s),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,r,s))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=af(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length,s=e.segment;if(void 0!==s){let c=e.dist(i[s+1]),p=e.dist(i[s]);const f={};for(let _=s+1;_<i.length;_++)f[_]={x:i[_].x,y:i[_].y,tileUnitDistanceFromAnchor:c},_<i.length-1&&(c+=i[_+1].dist(i[_]));for(let _=s||0;_>=0;_--)f[_]={x:i[_].x,y:i[_].y,tileUnitDistanceFromAnchor:p},_>0&&(p+=i[_-1].dist(i[_]));for(let _=0;_<i.length;_++){const g=f[_];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,s,c,p,f,_,g,v,E,C,k,z){const L=e.indexArray,O=e.layoutVertexArray,H=e.globeExtVertexArray,ne=e.segments.prepareSegment(4*i.length,O,L,this.canOverlap?p.sortKey:void 0),W=this.glyphOffsetArray.length,K=ne.vertexLength,oe=this.allowVerticalPlacement&&f===Zn.vertical?Math.PI/2:0,ee=p.text&&p.text.sections;for(let fe=0;fe<i.length;fe++){const{tl:be,tr:Pe,bl:ye,br:we,tex:Ce,pixelOffsetTL:ke,pixelOffsetBR:De,minFontScaleX:xe,minFontScaleY:Ue,glyphOffset:nt,isSDF:Ge,sectionIndex:Xe}=i[fe],Ne=ne.vertexLength,rt=nt[1];if(Uu(O,g.x,g.y,be.x,rt+be.y,Ce.x,Ce.y,r,Ge,ke.x,ke.y,xe,Ue),Uu(O,g.x,g.y,Pe.x,rt+Pe.y,Ce.x+Ce.w,Ce.y,r,Ge,De.x,ke.y,xe,Ue),Uu(O,g.x,g.y,ye.x,rt+ye.y,Ce.x,Ce.y+Ce.h,r,Ge,ke.x,De.y,xe,Ue),Uu(O,g.x,g.y,we.x,rt+we.y,Ce.x+Ce.w,Ce.y+Ce.h,r,Ge,De.x,De.y,xe,Ue),_){const ut=_.anchor,ht=_.up;Zu(H,ut.x,ut.y,ut.z,ht[0],ht[1],ht[2]),Zu(H,ut.x,ut.y,ut.z,ht[0],ht[1],ht[2]),Zu(H,ut.x,ut.y,ut.z,ht[0],ht[1],ht[2]),Zu(H,ut.x,ut.y,ut.z,ht[0],ht[1],ht[2]),Nu(e.dynamicLayoutVertexArray,ut.x,ut.y,ut.z,oe)}else Nu(e.dynamicLayoutVertexArray,g.x,g.y,g.z,oe);L.emplaceBack(Ne,Ne+1,Ne+2),L.emplaceBack(Ne+1,Ne+2,Ne+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(nt[0]),fe!==i.length-1&&Xe===i[fe+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,p,p.index,{},k,z,ee&&ee[Xe])}const _e=_?_.anchor:g;e.placedSymbolArray.emplaceBack(_e.x,_e.y,_e.z,g.x,g.y,W,this.glyphOffsetArray.length-W,K,v,E,g.segment,r?r[0]:0,r?r[1]:0,s[0],s[1],f,0,!1,0,C,0)}_commitLayoutVertex(e,i,r,s,c,p,f){e.emplaceBack(i,r,s,c,p,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,i,r,s,c,p,f){const _=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),g=_.vertexLength,v=f.tileAnchorX,E=f.tileAnchorY;for(let k=0;k<4;k++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,s,c,p,v,E,new Oe(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,s,c,p,v,E,new Oe(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,s,c,p,v,E,new Oe(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,s,c,p,v,E,new Oe(e.x1,e.y2)),_.vertexLength+=4;const C=r.indexArray;C.emplaceBack(g,g+1),C.emplaceBack(g+1,g+2),C.emplaceBack(g+2,g+3),C.emplaceBack(g+3,g),_.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,s,c,p){for(let f=s;f<c;f++){const _=r.get(f),g=this.getSymbolInstanceTextSize(e,p,i,f);this._addCollisionDebugVertices(_,g,this.textCollisionBox,_.projectedAnchorX,_.projectedAnchorY,_.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,r,s,c,p){for(let f=s;f<c;f++){const _=r.get(f),g=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(_,g,this.iconCollisionBox,_.projectedAnchorX,_.projectedAnchorY,_.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bh(Vt,xd.members,On),this.iconCollisionBox=new Bh(Vt,xd.members,On);const r=gl(this.iconSizeData,e),s=gl(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const p=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(s,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(s,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(r,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,i,r,s){const c=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:s),p=Iu(this.textSizeData,e,c)/24;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,r){const s=this.icon.placedSymbolArray.get(r),c=Iu(this.iconSizeData,e,s);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,i,r){e.emplaceBack(i,-r,-r),e.emplaceBack(i,r,-r),e.emplaceBack(i,r,r),e.emplaceBack(i,-r,r)}_updateTextDebugCollisionBoxes(e,i,r,s,c,p){for(let f=s;f<c;f++){const _=r.get(f),g=this.getSymbolInstanceTextSize(e,p,i,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,g,_.padding)}}_updateIconDebugCollisionBoxes(e,i,r,s,c,p){for(let f=s;f<c;f++){const _=r.get(f),g=this.getSymbolInstanceIconSize(e,i,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,g,_.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=gl(this.iconSizeData,e),s=gl(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const p=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(s,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(s,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(r,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,s,c,p,f,_,g){const v={};for(let E=i;E<r;E++){const C=e.get(E);v.textBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},v.textFeatureIndex=C.featureIndex;break}for(let E=s;E<c;E++){const C=e.get(E);v.verticalTextBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},v.verticalTextFeatureIndex=C.featureIndex;break}for(let E=p;E<f;E++){const C=e.get(E);v.iconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},v.iconFeatureIndex=C.featureIndex;break}for(let E=_;E<g;E++){const C=e.get(E);v.verticalIconBox={x1:C.x1,y1:C.y1,x2:C.x2,y2:C.y2,padding:C.padding,projectedAnchorX:C.projectedAnchorX,projectedAnchorY:C.projectedAnchorY,projectedAnchorZ:C.projectedAnchorZ,tileAnchorX:C.tileAnchorX,tileAnchorY:C.tileAnchorY},v.verticalIconFeatureIndex=C.featureIndex;break}return v}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),s=r.vertexStartIndex+4*r.numGlyphs;for(let c=r.vertexStartIndex;c<s;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),s=[],c=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const _=this.symbolInstances.get(f);s.push(0|Math.round(i*_.tileAnchorX+r*_.tileAnchorY)),c.push(_.featureIndex)}return p.sort((f,_)=>s[f]-s[_]||c[_]-c[f]),p}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((s,c,p)=>{s>=0&&p.indexOf(s)===c&&this.addIndicesForPlacedSymbol(this.text,s)}),r.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),r.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),r.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}$e(Is,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Is.MAX_GLYPHS=65535,Is.addDynamicAttributes=Nu;const H_=new Re({"symbol-placement":new de(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new de(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new de(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ae(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new de(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new de(ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new de(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new de(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new de(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new ae(ve.layout_symbol["icon-size"]),"icon-text-fit":new de(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new de(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new ae(ve.layout_symbol["icon-image"]),"icon-rotate":new ae(ve.layout_symbol["icon-rotate"]),"icon-padding":new de(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new de(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new ae(ve.layout_symbol["icon-offset"]),"icon-anchor":new ae(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new de(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new de(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new de(ve.layout_symbol["text-rotation-alignment"]),"text-field":new ae(ve.layout_symbol["text-field"]),"text-font":new ae(ve.layout_symbol["text-font"]),"text-size":new ae(ve.layout_symbol["text-size"]),"text-max-width":new ae(ve.layout_symbol["text-max-width"]),"text-line-height":new ae(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new ae(ve.layout_symbol["text-letter-spacing"]),"text-justify":new ae(ve.layout_symbol["text-justify"]),"text-radial-offset":new ae(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new de(ve.layout_symbol["text-variable-anchor"]),"text-anchor":new ae(ve.layout_symbol["text-anchor"]),"text-max-angle":new de(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new de(ve.layout_symbol["text-writing-mode"]),"text-rotate":new ae(ve.layout_symbol["text-rotate"]),"text-padding":new de(ve.layout_symbol["text-padding"]),"text-keep-upright":new de(ve.layout_symbol["text-keep-upright"]),"text-transform":new ae(ve.layout_symbol["text-transform"]),"text-offset":new ae(ve.layout_symbol["text-offset"]),"text-allow-overlap":new de(ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new de(ve.layout_symbol["text-ignore-placement"]),"text-optional":new de(ve.layout_symbol["text-optional"])});var Oh={paint:new Re({"icon-opacity":new ae(ve.paint_symbol["icon-opacity"]),"icon-color":new ae(ve.paint_symbol["icon-color"]),"icon-halo-color":new ae(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new ae(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ae(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new de(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new de(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new ae(ve.paint_symbol["text-opacity"]),"text-color":new ae(ve.paint_symbol["text-color"],{runtimeType:fn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ae(ve.paint_symbol["text-halo-color"]),"text-halo-width":new ae(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new ae(ve.paint_symbol["text-halo-blur"]),"text-translate":new de(ve.paint_symbol["text-translate"]),"text-translate-anchor":new de(ve.paint_symbol["text-translate-anchor"])}),layout:H_};class lf{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Fr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e(lf,"FormatSectionOverride",{omit:["defaultValue"]});class Vu extends Tr{constructor(e){super(e,Oh)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const s=[];for(const c of r)s.indexOf(c)<0&&s.push(c);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,s){const c=this.layout.get(e).evaluate(i,{},r,s),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Ie(p.value)||!c?c:(f=i.properties,c.replace(/{([^{}]+)}/g,(g,v)=>v in f?String(f[v]):""));var f}createBucket(e){return new Is(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Oh.paint.overridableProperties){if(!Vu.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new lf(i),s=new X(r,i.property.specification);let c=null;c="constant"===i.value.kind||"source"===i.value.kind?new ti("source",s):new ji("composite",s,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ee(i.property,c,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&Vu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),s=Oh.paint.properties[i];let c=!1;const p=f=>{for(const _ of f)if(s.overrides&&s.overrides.hasOverride(_))return void(c=!0)};if("constant"===r.value.kind&&r.value.value instanceof Mi)p(r.value.value.sections);else if("source"===r.value.kind){const f=g=>{c||(g instanceof Ao&&ei(g.value)===Ur?p(g.value.sections):g instanceof Hn?p(g.sections):g.eachChild(f))},_=r.value;_._styleExpression&&f(_._styleExpression.expression)}return c}getProgramConfiguration(e){return new Es(this,e)}}var J_={paint:new Re({"background-color":new de(ve.paint_background["background-color"]),"background-pattern":new Le(ve.paint_background["background-pattern"]),"background-opacity":new de(ve.paint_background["background-opacity"])})},Y_={paint:new Re({"raster-opacity":new de(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new de(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new de(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new de(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new de(ve.paint_raster["raster-saturation"]),"raster-contrast":new de(ve.paint_raster["raster-contrast"]),"raster-resampling":new de(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new de(ve.paint_raster["raster-fade-duration"])})};class Q_ extends Tr{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var K_={paint:new Re({"sky-type":new de(ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new de(ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new de(ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new de(ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new de(ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new Fe(ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new de(ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new de(ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new de(ve.paint_sky["sky-opacity"])})};function Fh(t,e,i){const r=[0,0,1],s=Vp([]);return qp(s,s,i?-vt(t)+Math.PI:vt(t)),jp(s,s,-vt(e)),Fp(r,r,s),Ki(r,r)}const eg={circle:class extends Tr{constructor(t){super(t,tm)}createBucket(t){return new th(t)}queryRadius(t){const e=t;return hl("circle-radius",this,e)+hl("circle-stroke-width",this,e)+mu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,s,c,p,f){const _=zp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),g=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Gp(t,r,c,p,f,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),_,g)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Es(this,t)}},heatmap:class extends Tr{createBucket(t){return new Xp(t)}constructor(t){super(t,cm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return hl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,s,c,p,f){const _=this.paint.get("heatmap-radius").evaluate(e,i);return Gp(t,r,c,p,f,!0,!0,new Oe(0,0),_)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Es(this,t)}},hillshade:class extends Tr{constructor(t){super(t,um)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Tr{constructor(t){super(t,Am)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Es(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new wu(t)}queryRadius(){return mu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,s,c){return!t.queryGeometry.isAboveHorizon&&Ap(kp(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Tr{constructor(t){super(t,Vm)}createBucket(t){return new mc(t)}queryRadius(){return mu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Es(this,t)}queryIntersectsFeature(t,e,i,r,s,c,p,f,_){const g=zp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),v=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),C=[0,0],k=f&&c.elevation,z=c.elevation?c.elevation.exaggeration():1,L=t.tile.getBucket(this);if(k&&L instanceof mc){const K=L.centroidVertexArray,oe=_+1;if(oe<K.length){const ee=K.get(oe);C[0]=ee.a_centroid_pos0,C[1]=ee.a_centroid_pos1}}if(0===C[0]&&1===C[1])return!1;"globe"===c.projection.name&&(r=hd([r],[new Oe(0,0),new Oe(st,st)],t.tileID.canonical).map(K=>K.polygon).flat());const O=k?f:null,[H,ne]=(oe=r,ee=E,_e=v,fe=g,be=p,Pe=O,ye=C,we=z,Ce=c.center.lat,"globe"===(K=c).projection.name?function(De,xe,Ue,nt,Ge,Xe,Ne,rt,ut,ht,Ct){const ct=[],Yt=[],mt=De.projection.upVectorScale(Ct,De.center.lat,De.worldSize).metersToTile,bt=[0,0,0,1],Ut=[0,0,0,1],Wt=(Ht,Qt,si,zi)=>{Ht[0]=Qt,Ht[1]=si,Ht[2]=zi,Ht[3]=1},qt=ud();Ue>0&&(Ue+=qt),nt+=qt;for(const Ht of xe){const Qt=[],si=[];for(const zi of Ht){const Rt=zi.x+Ge.x,gi=zi.y+Ge.y,hi=De.projection.projectTilePoint(Rt,gi,Ct),It=De.projection.upVector(Ct,zi.x,zi.y);let ni=Ue,bi=nt;if(Ne){const Zt=md(Rt,gi,Ue,nt,Ne,rt,ut,ht);ni+=Zt.base,bi+=Zt.top}0!==Ue?Wt(bt,hi.x+It[0]*mt*ni,hi.y+It[1]*mt*ni,hi.z+It[2]*mt*ni):Wt(bt,hi.x,hi.y,hi.z),Wt(Ut,hi.x+It[0]*mt*bi,hi.y+It[1]*mt*bi,hi.z+It[2]*mt*bi),_i(bt,bt,Xe),_i(Ut,Ut,Xe),Qt.push(new _l(bt[0],bt[1],bt[2])),si.push(new _l(Ut[0],Ut[1],Ut[2]))}ct.push(Qt),Yt.push(si)}return[ct,Yt]}(K,oe,ee,_e,fe,be,Pe,ye,we,Ce,t.tileID.canonical):Pe?function(De,xe,Ue,nt,Ge,Xe,Ne,rt,ut){const ht=[],Ct=[],ct=[0,0,0,1];for(const Yt of De){const mt=[],bt=[];for(const Ut of Yt){const Wt=Ut.x+nt.x,qt=Ut.y+nt.y,Ht=md(Wt,qt,xe,Ue,Xe,Ne,rt,ut);ct[0]=Wt,ct[1]=qt,ct[2]=Ht.base,ct[3]=1,ya(ct,ct,Ge),ct[3]=Math.max(ct[3],1e-5);const Qt=new _l(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=Wt,ct[1]=qt,ct[2]=Ht.top,ct[3]=1,ya(ct,ct,Ge),ct[3]=Math.max(ct[3],1e-5);const si=new _l(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);mt.push(Qt),bt.push(si)}ht.push(mt),Ct.push(bt)}return[ht,Ct]}(oe,ee,_e,fe,be,Pe,ye,we,Ce):function(De,xe,Ue,nt,Ge){const Xe=[],Ne=[],rt=Ge[8]*xe,ut=Ge[9]*xe,ht=Ge[10]*xe,Ct=Ge[11]*xe,ct=Ge[8]*Ue,Yt=Ge[9]*Ue,mt=Ge[10]*Ue,bt=Ge[11]*Ue;for(const Ut of De){const Wt=[],qt=[];for(const Ht of Ut){const Qt=Ht.x+nt.x,si=Ht.y+nt.y,zi=Ge[0]*Qt+Ge[4]*si+Ge[12],Rt=Ge[1]*Qt+Ge[5]*si+Ge[13],gi=Ge[2]*Qt+Ge[6]*si+Ge[14],hi=Ge[3]*Qt+Ge[7]*si+Ge[15],It=zi+rt,ni=Rt+ut,bi=gi+ht,Zt=Math.max(hi+Ct,1e-5),ai=zi+ct,$i=Rt+Yt,Pi=gi+mt,Di=Math.max(hi+bt,1e-5);Wt.push(new _l(It/Zt,ni/Zt,bi/Zt)),qt.push(new _l(ai/Di,$i/Di,Pi/Di))}Xe.push(Wt),Ne.push(qt)}return[Xe,Ne]}(oe,ee,_e,fe,be)),W=t.queryGeometry;var K,oe,ee,_e,fe,be,Pe,ye,we,Ce;return function(K,oe,ee){let _e=1/0;Ap(ee,oe)&&(_e=fd(ee,oe[0]));for(let fe=0;fe<oe.length;fe++){const be=oe[fe],Pe=K[fe];for(let ye=0;ye<be.length-1;ye++){const we=be[ye],Ce=[we,be[ye+1],Pe[ye+1],Pe[ye],we];Cp(ee,Ce)&&(_e=Math.min(_e,fd(ee,Ce)))}}return _e!==1/0&&_e}(H,ne,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends Tr{constructor(t){super(t,_d),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof jr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=gd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Su(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Es(this,t)}queryRadius(t){const e=t,i=yd(hl("line-width",this,e),hl("line-gap-width",this,e)),r=hl("line-offset",this,e);return i/2+Math.abs(r)+mu(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,s,c){if(t.queryGeometry.isAboveHorizon)return!1;const p=kp(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),f=t.pixelToTileUnitsFactor/2*yd(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),_=this.paint.get("line-offset").evaluate(e,i);return _&&(r=function(g,v){const E=[],C=new Oe(0,0);for(let k=0;k<g.length;k++){const z=g[k],L=[];for(let O=0;O<z.length;O++){const H=z[O-1],ne=z[O],W=z[O+1],K=0===O?C:ne.sub(H)._unit()._perp(),oe=O===z.length-1?C:W.sub(ne)._unit()._perp(),ee=K._add(oe)._unit();ee._mult(1/(ee.x*oe.x+ee.y*oe.y)),L.push(ee._mult(v)._add(ne))}E.push(L)}return E}(r,_*t.pixelToTileUnitsFactor)),function(g,v,E){for(let C=0;C<v.length;C++){const k=v[C];if(g.length>=3)for(let z=0;z<k.length;z++)if(_a(g,k[z]))return!0;if(Yf(g,k,E))return!0}return!1}(p,r,f)}isTileClipped(){return!0}},symbol:Vu,background:class extends Tr{constructor(t){super(t,J_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Tr{constructor(t){super(t,Y_)}getProgramIds(){return["raster"]}},sky:class extends Tr{constructor(t){super(t,K_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=dh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),s=!r,c=t.style.light,p=c.properties.get("position");return s&&"viewport"===c.properties.get("anchor")&&Jt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?Fh(p.azimuthal,90-p.polar,e):Fh(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return Fh(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class kc{constructor(e,i,r,s){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,s)}update(e,i,r){const{width:s,height:c}=e,{context:p}=this,{gl:f}=p,{HTMLImageElement:_,HTMLCanvasElement:g,HTMLVideoElement:v,ImageData:E,ImageBitmap:C}=h;if(f.bindTexture(f.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA&&(!i||!1!==i.premultiply)),r||this.size&&this.size[0]===s&&this.size[1]===c){const{x:k,y:z}=r||{x:0,y:0};e instanceof _||e instanceof g||e instanceof v||e instanceof E||C&&e instanceof C?f.texSubImage2D(f.TEXTURE_2D,0,k,z,f.RGBA,f.UNSIGNED_BYTE,e):f.texSubImage2D(f.TEXTURE_2D,0,k,z,s,c,f.RGBA,f.UNSIGNED_BYTE,e.data)}else this.size=[s,c],e instanceof _||e instanceof g||e instanceof v||e instanceof E||C&&e instanceof C?f.texImage2D(f.TEXTURE_2D,0,this.format,this.format,f.UNSIGNED_BYTE,e):f.texImage2D(f.TEXTURE_2D,0,this.format,s,c,0,this.format,f.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:s}=r;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.filter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?e===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class tg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ig{constructor(){this.tasks={},this.taskQueue=[],lr(["process"],this),this.invoker=new tg(this.process),this.nextId=0}add(e,i){const r=this.nextId++,s=function({type:c,isSymbolTile:p,zoom:f}){return f=f||0,"message"===c?0:"maybePrepare"!==c||p?"parseTile"!==c||p?"parseTile"===c&&p?300-f:"maybePrepare"===c&&p?400-f:500:200-f:100-f}(i);if(0===s){Hi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:s,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Hi();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let s=0;s<this.taskQueue.length;s++){const c=this.tasks[this.taskQueue[s]];c.priority<i&&(i=c.priority,e=s)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class cf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const ng=["tile","layer","source","sourceLayer","state"];class uf{constructor(e,i,r,s,c){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=s,this.properties=e.properties,this.id=c}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const i of ng)void 0!==this[i]&&(e[i]=this[i]);return e}}const Ms=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,s=0,c=0,p=0,f=0;for(1&e?s=c=p=32:i=r=f=32;(e>>=1)>1;){const g=i+s>>1,v=r+c>>1;1&e?(s=i,c=r,i=p,r=f):(i=s,r=c,s=p,c=f),p=g,f=v}const _=4*t;Ms[_+0]=i,Ms[_+1]=r,Ms[_+2]=s,Ms[_+3]=c}const ao=new Uint16Array(2178),ks=new Uint8Array(1089),ju=new Uint16Array(1089);function hf(t){return 0===t?-.03125:32===t?.03125:0}var pf=Be([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const df={type:2,extent:st,loadGeometry:()=>[[new Oe(0,0),new Oe(8193,0),new Oe(8193,8193),new Oe(0,8193),new Oe(0,0)]]};class Uh{constructor(e,i,r,s,c){this.tileID=e,this.uid=mo(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,this.expiredRequestCount=0,this.state="loading",s&&s.transform&&(this.projection=s.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Tt.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=ba(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(s,c){const p={};if(!c)return p;for(const f of s){const _=f.layerIds.map(g=>c.getLayer(g)).filter(Boolean);if(0!==_.length){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(g=>_.filter(v=>v.id===g)[0]));for(const g of _)p[g.id]=f}}return p}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const s in this.buckets){const c=this.buckets[s];if(c instanceof Is){if(this.hasSymbolBuckets=!0,!r)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const s in this.buckets){const c=this.buckets[s];if(c instanceof Is&&c.hasRTLText){this.hasRTLText=!0,ie.isLoading()||ie.isLoaded()||"deferred"!==N()||te();break}}this.queryPadding=0;for(const s in this.buckets){const c=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(s).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Wu}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const s=this.buckets[r];s.uploadPending()&&s.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kc(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kc(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new kc(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,r,s,c,p,f,_){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:s,pixelPosMatrix:f,transform:p,params:c,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const s=r.loadVTLayers(),c=i?i.sourceLayer:"",p=s._geojsonTileLayer||s[c];if(!p)return;const f=Ha(i&&i.filter),{z:_,x:g,y:v}=this.tileID.canonical,E={z:_,x:g,y:v};for(let C=0;C<p.length;C++){const k=p.feature(C);if(f.needGeometry){const O=ma(k,!0);if(!f.filter(new J(this.tileID.overscaledZ),O,this.tileID.canonical))continue}else if(!f.filter(new J(this.tileID.overscaledZ),k))continue;const z=r.getId(k,c),L=new uf(k,_,g,v,z);L.tile=E,e.push(L)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=Wo(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let s=!1;if(this.expirationTime>r)s=!1;else if(i)if(this.expirationTime<i)s=!0;else{const c=this.expirationTime-i;c?this.expirationTime=r+Math.max(c,3e4):s=!0}else s=!0;s?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const r=this.latestFeatureIndex.loadVTLayers(),s=i.style.listImages();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const p=this.buckets[c],f=p.layers[0].sourceLayer||"_geojsonTileLayer",_=r[f],g=e[f];if(!_||!g||0===Object.keys(g).length)continue;if(p.update(g,_,s,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof Su||p instanceof wu){const E=i.style._getSourceCache(p.layers[0].source);i._terrain&&i._terrain.enabled&&E&&p.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(E.id,this.tileID)}const v=i&&i.style&&i.style.getLayer(c);v&&(this.queryPadding=Math.max(this.queryPadding,v.queryRadius(p)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Tt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Tt.now()+e}setTexture(e,i){const r=i.context,s=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new kc(r,e,s.RGBA,{useMipmap:!0}),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,i){const r={};for(const s of i)r[s]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const s=this.dependencies[r];if(s)for(const c of i)if(s[c])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const r=Fo(df,this.tileID.canonical,this.tileTransform)[0],s=new ft,c=new ec;for(let p=0;p<r.length;p++){const{x:f,y:_}=r[p];s.emplaceBack(f,_),c.emplaceBack(p)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(s,wc.members),this._tileDebugSegments=mi.simpleSegment(0,0,s.length,c.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const r=Fo(df,this.tileID.canonical,this.tileTransform)[0];let s,c;if(this.isRaster){const p=function(f,_){const g=ba(f,_),v=Math.pow(2,f.z);for(let O=0;O<33;O++)for(let H=0;H<33;H++){const ne=Fn((f.x+(H+hf(H))/32)/v),W=Zi((f.y+(O+hf(O))/32)/v),K=_.project(ne,W),oe=33*O+H;ao[2*oe+0]=Math.round((K.x*g.scale-g.x)*st),ao[2*oe+1]=Math.round((K.y*g.scale-g.y)*st)}ks.fill(0),ju.fill(0);for(let O=2045;O>=0;O--){const H=4*O,ne=Ms[H+0],W=Ms[H+1],K=Ms[H+2],oe=Ms[H+3],ee=ne+K>>1,_e=W+oe>>1,fe=ee+_e-W,be=_e+ne-ee,Pe=33*W+ne,ye=33*oe+K,we=33*_e+ee,Ce=Math.hypot((ao[2*Pe+0]+ao[2*ye+0])/2-ao[2*we+0],(ao[2*Pe+1]+ao[2*ye+1])/2-ao[2*we+1])>=16;if(ks[we]=ks[we]||(Ce?1:0),O<1022){const ke=33*(W+be>>1)+(ne+fe>>1),De=33*(oe+be>>1)+(K+fe>>1);ks[we]=ks[we]||ks[ke]||ks[De]}}const E=new Ft,C=new Gi;let k=0;function z(O,H){const ne=33*H+O;return 0===ju[ne]&&(E.emplaceBack(ao[2*ne+0],ao[2*ne+1],O*st/32,H*st/32),ju[ne]=++k),ju[ne]-1}function L(O,H,ne,W,K,oe){const ee=O+ne>>1,_e=H+W>>1;if(Math.abs(O-K)+Math.abs(H-oe)>1&&ks[33*_e+ee])L(K,oe,O,H,ee,_e),L(ne,W,K,oe,ee,_e);else{const fe=z(O,H),be=z(ne,W),Pe=z(K,oe);C.emplaceBack(fe,be,Pe)}}return L(0,0,32,32,32,0),L(32,32,0,0,0,32),{vertices:E,indices:C}}(this.tileID.canonical,i);s=p.vertices,c=p.indices}else{s=new Ft,c=new Gi;for(const{x:f,y:_}of r)s.emplaceBack(f,_,0,0);const p=lc.exports(s.int16,void 0,4);for(let f=0;f<p.length;f+=3)c.emplaceBack(p[f],p[f+1],p[f+2])}this._tileBoundsBuffer=e.createVertexBuffer(s,pf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=mi.simpleSegment(0,0,s.length,c.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||"globe"!==r.name||i.freezeTileCoverage)return;const s=this.tileID.canonical,c=Cc(Hd(s,i)),p=Al(i.zoom);let f;p>0&&(f=rh(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,s,i,c,f,p),this._makeGlobeTileDebugTextBuffer(e,s,i,c,f,p)}_globePoint(e,i,r,s,c,p,f){let _=Ec(e,i,r);if(p){const g=1<<r.z,v=eo(s.center.lng),E=to(s.center.lat),C=(r.x+.5)/g-v;let k=0;C>.5?k=-1:C<-.5&&(k=1);let z=(e/st+r.x)/g+k,L=(i/st+r.y)/g;z=(z-v)*s._pixelsPerMercatorPixel+v,L=(L-E)*s._pixelsPerMercatorPixel+E;const O=[z*s.worldSize,L*s.worldSize,0];_i(O,O,p),_=va(_,O,f)}return _i(_,_,c)}_makeGlobeTileDebugBorderBuffer(e,i,r,s,c,p){const f=new ft,_=new ec,g=new Ot,v=(C,k,z,L,O)=>{const H=(z-C)/(O-1),ne=(L-k)/(O-1),W=f.length;for(let K=0;K<O;K++){const oe=C+K*H,ee=k+K*ne;f.emplaceBack(oe,ee);const _e=this._globePoint(oe,ee,i,r,s,c,p);g.emplaceBack(_e[0],_e[1],_e[2]),_.emplaceBack(W+K)}},E=st;v(0,0,E,0,16),v(E,0,E,E,16),v(E,E,0,E,16),v(0,E,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(_),this._tileDebugBuffer=e.createVertexBuffer(f,wc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(g,Xd.members),this._tileDebugSegments=mi.simpleSegment(0,0,f.length,_.length)}_makeGlobeTileDebugTextBuffer(e,i,r,s,c,p){const f=new ft,_=new Gi,g=new Ot,v=25;_.reserve(32),f.reserve(v),g.reserve(v);const E=(C,k)=>v*C+k;for(let C=0;C<v;C++){const k=2048*C;for(let z=0;z<v;z++){const L=2048*z;f.emplaceBack(L,k);const O=this._globePoint(L,k,i,r,s,c,p);g.emplaceBack(O[0],O[1],O[2])}}for(let C=0;C<4;C++)for(let k=0;k<4;k++){const z=E(C,k),L=E(C,k+1),O=E(C+1,k),H=E(C+1,k+1);_.emplaceBack(z,L,O),_.emplaceBack(O,L,H)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(_),this._tileDebugTextBuffer=e.createVertexBuffer(f,wc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(g,Xd.members),this._tileDebugTextSegments=mi.simpleSegment(0,0,v,32)}}class rg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const s=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][s]=this.stateChanges[e][s]||{},Kt(this.stateChanges[e][s],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const c in this.state[e])c!==s&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][s]){this.deletedStates[e][s]={};for(const c in this.state[e][s])r[c]||(this.deletedStates[e][s][c]=null)}else for(const c in r)this.deletedStates[e]&&this.deletedStates[e][s]&&null===this.deletedStates[e][s][c]&&delete this.deletedStates[e][s][c]}removeFeatureState(e,i,r){if(null===this.deletedStates[e])return;const s=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==i)null!==this.deletedStates[e][s]&&(this.deletedStates[e][s]=this.deletedStates[e][s]||{},this.deletedStates[e][s][r]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][s])for(r in this.deletedStates[e][s]={},this.stateChanges[e][s])this.deletedStates[e][s][r]=null;else this.deletedStates[e][s]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),s=Kt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const c=this.deletedStates[e][i];if(null===c)return{};for(const p in c)delete s[p]}return s}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const s in this.stateChanges){this.state[s]=this.state[s]||{};const c={};for(const p in this.stateChanges[s])this.state[s][p]||(this.state[s][p]={}),Kt(this.state[s][p],this.stateChanges[s][p]),c[p]=this.state[s][p];r[s]=c}for(const s in this.deletedStates){this.state[s]=this.state[s]||{};const c={};if(null===this.deletedStates[s])for(const p in this.state[s])c[p]={},this.state[s][p]={};else for(const p in this.deletedStates[s]){if(null===this.deletedStates[s][p])this.state[s][p]={};else for(const f of Object.keys(this.deletedStates[s][p]))delete this.state[s][p][f];c[p]=this.state[s][p]}r[s]=r[s]||{},Kt(r[s],c)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const s in e)e[s].setFeatureState(r,i)}}class ff{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function mf(t,e,i,r){let s=0,c=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(r[p])<1e-15){if(i[p]<t[p]||i[p]>e[p])return null}else{const f=1/r[p];let _=(t[p]-i[p])*f,g=(e[p]-i[p])*f;if(_>g){const v=_;_=g,g=v}if(_>s&&(s=_),g<c&&(c=g),s>c)return null}return s}function _f(t,e,i,r,s,c,p,f,_,g,v){const E=r-t,C=s-e,k=c-i,z=p-t,L=f-e,O=_-i,H=v[1]*O-v[2]*L,ne=v[2]*z-v[0]*O,W=v[0]*L-v[1]*z,K=E*H+C*ne+k*W;if(Math.abs(K)<1e-15)return null;const oe=1/K,ee=g[0]-t,_e=g[1]-e,fe=g[2]-i,be=(ee*H+_e*ne+fe*W)*oe;if(be<0||be>1)return null;const Pe=_e*k-fe*C,ye=fe*E-ee*k,we=ee*C-_e*E,Ce=(v[0]*Pe+v[1]*ye+v[2]*we)*oe;return Ce<0||be+Ce>1?null:(z*Pe+L*ye+O*we)*oe}function gf(t,e,i){return(t-e)/(i-e)}function yf(t,e,i,r,s,c,p,f,_){const g=1<<i,v=c-r,E=p-s,C=(t+1)/g*v+r,k=(e+0)/g*E+s,z=(e+1)/g*E+s;f[0]=(t+0)/g*v+r,f[1]=k,_[0]=C,_[1]=z}class xf{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(c){const p=Math.ceil(Math.log2(c.dim/8)),f=[];let _=Math.ceil(Math.pow(2,p));const g=1/_,v=(k,z,L,O,H)=>{const ne=O?1:0,W=(k+1)*L-ne,K=z*L,oe=(z+1)*L-ne;H[0]=k*L,H[1]=K,H[2]=W,H[3]=oe};let E=new ff(_);const C=[];for(let k=0;k<_*_;k++){v(k%_,Math.floor(k/_),g,!1,C);const z=zs(C[0],C[1],c),L=zs(C[2],C[1],c),O=zs(C[2],C[3],c),H=zs(C[0],C[3],c);E.minimums.push(Math.min(z,L,O,H)),E.maximums.push(Math.max(z,L,O,H)),E.leaves.push(1)}for(f.push(E),_/=2;_>=1;_/=2){const k=f[f.length-1];E=new ff(_);for(let z=0;z<_*_;z++){v(z%_,Math.floor(z/_),2,!0,C);const L=k.getElevation(C[0],C[1]),O=k.getElevation(C[2],C[1]),H=k.getElevation(C[2],C[3]),ne=k.getElevation(C[0],C[3]),W=k.isLeaf(C[0],C[1]),K=k.isLeaf(C[2],C[1]),oe=k.isLeaf(C[2],C[3]),ee=k.isLeaf(C[0],C[3]),_e=Math.min(L.min,O.min,H.min,ne.min),fe=Math.max(L.max,O.max,H.max,ne.max),be=W&&K&&oe&&ee;E.maximums.push(fe),E.minimums.push(_e),E.leaves.push(fe-_e<=5&&be?1:0)}f.push(E)}return f}(this.dem),r=i.length-1,s=i[r];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,s,c,p,f=1){return mf([e,i,-100],[r,s,this.maximums[0]*f],c,p)}raycast(e,i,r,s,c,p,f=1){if(!this.nodeCount)return null;const _=this.raycastRoot(e,i,r,s,c,p,f);if(null==_)return null;const g=[],v=[],E=[],C=[],k=[{idx:0,t:_,nodex:0,nodey:0,depth:0}];for(;k.length>0;){const{idx:z,t:L,nodex:O,nodey:H,depth:ne}=k.pop();if(this.leaves[z]){yf(O,H,ne,e,i,r,s,E,C);const K=1<<ne,oe=(O+0)/K,ee=(O+1)/K,_e=(H+0)/K,fe=(H+1)/K,be=zs(oe,_e,this.dem)*f,Pe=zs(ee,_e,this.dem)*f,ye=zs(ee,fe,this.dem)*f,we=zs(oe,fe,this.dem)*f,Ce=_f(E[0],E[1],be,C[0],E[1],Pe,C[0],C[1],ye,c,p),ke=_f(C[0],C[1],ye,E[0],C[1],we,E[0],E[1],be,c,p),De=Math.min(null!==Ce?Ce:Number.MAX_VALUE,null!==ke?ke:Number.MAX_VALUE);if(De!==Number.MAX_VALUE)return De;{const xe=sc([],c,p,L);if(vf(be,Pe,we,ye,gf(xe[0],E[0],C[0]),gf(xe[1],E[1],C[1]))>=xe[2])return L}continue}let W=0;for(let K=0;K<this._siblingOffset.length;K++){yf((O<<1)+this._siblingOffset[K][0],(H<<1)+this._siblingOffset[K][1],ne+1,e,i,r,s,E,C),E[2]=-100,C[2]=this.maximums[this.childOffsets[z]+K]*f;const oe=mf(E,C,c,p);if(null!=oe){const ee=oe;g[K]=ee;let _e=!1;for(let fe=0;fe<W&&!_e;fe++)ee>=g[v[fe]]&&(v.splice(fe,0,K),_e=!0);_e||(v[W]=K),W++}}for(let K=0;K<W;K++){const oe=v[K];k.push({idx:this.childOffsets[z]+oe,t:g[oe],nodex:(O<<1)+this._siblingOffset[oe][0],nodey:(H<<1)+this._siblingOffset[oe][1],depth:ne+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,s,c){if(1===e[s].isLeaf(i,r))return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const p=s-1,f=e[p];let _=0,g=0;for(let v=0;v<this._siblingOffset.length;v++){const E=2*i+this._siblingOffset[v][0],C=2*r+this._siblingOffset[v][1],k=f.getElevation(E,C),z=f.isLeaf(E,C),L=this._addNode(k.min,k.max,z);z&&(_|=1<<v),g||(g=L)}for(let v=0;v<this._siblingOffset.length;v++)_&1<<v||this._construct(e,2*i+this._siblingOffset[v][0],2*r+this._siblingOffset[v][1],p,g+v)}}function vf(t,e,i,r,s,c){return Et(Et(t,i,c),Et(e,r,c),s)}function zs(t,e,i){const r=i.dim,s=yt(t*r-.5,0,r-1),c=yt(e*r-.5,0,r-1),p=Math.floor(s),f=Math.floor(c),_=Math.min(p+1,r-1),g=Math.min(f+1,r-1);return vf(i.get(p,f),i.get(_,f),i.get(p,g),i.get(_,g),s-p,c-f)}const bf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class qu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,s=!1,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return Jt(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=r||"mapbox",this.borderReady=s,!s){for(let _=0;_<p;_++)f[this._idx(-1,_)]=f[this._idx(0,_)],f[this._idx(p,_)]=f[this._idx(p-1,_)],f[this._idx(_,-1)]=f[this._idx(_,0)],f[this._idx(_,p)]=f[this._idx(_,p-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(p,-1)]=f[this._idx(p-1,0)],f[this._idx(-1,p)]=f[this._idx(0,p-1)],f[this._idx(p,p)]=f[this._idx(p-1,p-1)],c&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new xf(this)}get(e,i,r=!1){r&&(e=yt(e,-1,this.dim),i=yt(i,-1,this.dim));const s=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[s],this.pixels[s+1],this.pixels[s+2])}static getUnpackVector(e){return bf[e]}get unpackVector(){return bf[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,r){return(256*e*256+256*i+r)/10-1e4}_unpackTerrarium(e,i,r){return 256*e+i+r/256-32768}static pack(e,i){const r=[0,0,0,0],s=qu.getUnpackVector(i);let c=Math.floor((e+s[3])/s[2]);return r[2]=c%256,c=Math.floor(c/256),r[1]=c%256,c=Math.floor(c/256),r[0]=c,r}getPixels(){return new wn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=i*this.dim,c=i*this.dim+this.dim,p=r*this.dim,f=r*this.dim+this.dim;switch(i){case-1:s=c-1;break;case 1:c=s+1}switch(r){case-1:p=f-1;break;case 1:f=p+1}const _=-i*this.dim,g=-r*this.dim;for(let v=p;v<f;v++)for(let E=s;E<c;E++){const C=4*this._idx(E,v),k=4*this._idx(E+_,v+g);this.pixels[C+0]=e.pixels[k+0],this.pixels[C+1]=e.pixels[k+1],this.pixels[C+2]=e.pixels[k+2],this.pixels[C+3]=e.pixels[k+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}$e(qu,"DEMData"),$e(xf,"DemMinMaxQuadTree",{omit:["dem"]});class og{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const s=e.wrapped().key;void 0===this.data[s]&&(this.data[s]=[]);const c={value:i,timeout:void 0};if(void 0!==r&&(c.timeout=setTimeout(()=>{this.remove(e,c)},r)),this.data[s].push(c),this.order.push(s),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,s=void 0===i?0:this.data[r].indexOf(i),c=this.data[r][s];return this.data[r].splice(s,1),c.timeout&&clearTimeout(c.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(c.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const s of this.data[r])e(s.value)||i.push(s);for(const r of i)this.remove(r.value.tileID,r)}}class Il{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}Il.ReadOnly=!1,Il.ReadWrite=!0,Il.disabled=new Il(519,Il.ReadOnly,[0,1]);class Nh{constructor(e,i,r,s,c,p){this.test=e,this.ref=i,this.mask=r,this.fail=s,this.depthFail=c,this.pass=p}}Nh.disabled=new Nh({func:519,mask:0},0,0,7680,7680,7680);class lo{constructor(e,i,r){this.blendFunction=e,this.blendColor=i,this.mask=r}}lo.Replace=[1,0],lo.disabled=new lo(lo.Replace,ri.transparent,[!1,!1,!1,!1]),lo.unblended=new lo(lo.Replace,ri.transparent,[!0,!0,!0,!0]),lo.alphaBlended=new lo([1,771],ri.transparent,[!0,!0,!0,!0]);class Sr{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}Sr.disabled=new Sr(!1,1029,2305),Sr.backCCW=new Sr(!0,1029,2305),Sr.backCW=new Sr(!0,1029,2304),Sr.frontCW=new Sr(!0,1028,2304),Sr.frontCCW=new Sr(!0,1028,2305);class wa extends Pn{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",s=>{"source"===s.dataType&&"metadata"===s.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===s.dataType&&"content"===s.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new og(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new rg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return pi(this._tiles).map(e=>e.tileID).sort(wf).map(e=>e.key)}getRenderableIds(e){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&i.push(this._tiles[r]);return e?i.sort((r,s)=>{const c=r.tileID,p=s.tileID,f=new Oe(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),_=new Oe(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-p.overscaledZ||_.y-f.y||_.x-f.x}).map(r=>r.tileID.key):i.map(r=>r.tileID).sort(wf).map(r=>r.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,s){if(s)if(e.state="errored",404!==s.status)this._source.fire(new Xn(s,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Tt.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Dt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let s=0;s<i.length;s++){const c=i[s];if(e.neighboringTiles&&e.neighboringTiles[c]){const p=this.getTileByID(c);r(e,p),r(p,e)}}function r(s,c){if(!s.dem||s.dem.borderReady)return;s.needsHillshadePrepare=!0,s.needsDEMTextureUpload=!0;let p=c.tileID.canonical.x-s.tileID.canonical.x;const f=c.tileID.canonical.y-s.tileID.canonical.y,_=Math.pow(2,s.tileID.canonical.z),g=c.tileID.key;0===p&&0===f||Math.abs(f)>1||(Math.abs(p)>1&&(1===Math.abs(p+_)?p+=_:1===Math.abs(p-_)&&(p-=_)),c.dem&&s.dem&&(s.dem.backfillBorder(c.dem,p,f),s.neighboringTiles&&s.neighboringTiles[g]&&(s.neighboringTiles[g].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,s){for(const c in this._tiles){let p=this._tiles[c];if(s[c]||!p.hasData()||p.tileID.overscaledZ<=i||p.tileID.overscaledZ>r)continue;let f=p.tileID;for(;p&&p.tileID.overscaledZ>i+1;){const g=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[g.key],p&&p.hasData()&&(f=g)}let _=f;for(;_.overscaledZ>i;)if(_=_.scaledTo(_.overscaledZ-1),e[_.key]){s[f.key]=f;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const s=e.scaledTo(r),c=this._getLoadedTile(s);if(c)return c}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,s=Math.ceil(e.height/i)+1,c=Math.floor(r*s*5),p="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,c):c,f="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(f)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const s in this._tiles){const c=this._tiles[s];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+i),r[c.tileID.key]=c}this._tiles=r;for(const s in this._timers)clearTimeout(this._timers[s]),delete this._timers[s];for(const s in this._tiles)this._setTileReloadTimer(+s,this._tiles[s])}}update(e,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let s;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?s=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new tn(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(s=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(s=s.filter(f=>this._source.hasTile(f)))):s=[];const c=this._updateRetainedTiles(s);if(Tf(this._source.type)&&0!==s.length){const f={},_={},g=Object.keys(c);for(const E of g){const C=c[E],k=this._tiles[E];if(!k||k.fadeEndTime&&k.fadeEndTime<=Tt.now())continue;const z=this.findLoadedParent(C,Math.max(C.overscaledZ-wa.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),f[z.tileID.key]=z.tileID),_[E]=C}const v=s[s.length-1].overscaledZ;for(const E in this._tiles){const C=this._tiles[E];if(c[E]||!C.hasData())continue;let k=C.tileID;for(;k.overscaledZ>v;){k=k.scaledTo(k.overscaledZ-1);const z=this._tiles[k.key];if(z&&z.hasData()&&_[k.key]){c[E]=C.tileID;break}}}for(const E in f)c[E]||(this._coveredTiles[E]=!0,c[E]=f[E])}for(const f in c)this._tiles[f].clearFadeHold();const p=function(f,_){const g=[];for(const v in f)v in _||g.push(v);return g}(this._tiles,c);for(const f of p){const _=this._tiles[f];_.hasSymbolBuckets&&!_.holdingForFade()?_.setHoldDuration(this.map._fadeDuration):_.hasSymbolBuckets&&!_.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const r={},s=e.reduce((g,v)=>Math.min(g,v.overscaledZ),1/0),c=e[0].overscaledZ,p=Math.max(c-wa.maxOverzooming,this._source.minzoom),f=Math.max(c+wa.maxUnderzooming,this._source.minzoom),_={};for(const g of e){const v=this._addTile(g);i[g.key]=g,v.hasData()||s<this._source.maxzoom&&(_[g.key]=g)}this._retainLoadedChildren(_,s,f,i);for(const g of e){let v=this._tiles[g.key];if(v.hasData())continue;if(g.canonical.z>=this._source.maxzoom){const C=g.children(this._source.maxzoom)[0],k=this.getTile(C);if(k&&k.hasData()){i[C.key]=C;continue}}else{const C=g.children(this._source.maxzoom);if(i[C[0].key]&&i[C[1].key]&&i[C[2].key]&&i[C[3].key])continue}let E=v.wasRequested();for(let C=g.overscaledZ-1;C>=p;--C){const k=g.scaledTo(C);if(r[k.key]||(r[k.key]=!0,v=this.getTile(k),!v&&E&&(v=this._addTile(k)),v&&(i[k.key]=k,E=v.wasRequested(),v.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,s=this._tiles[e].tileID;for(;s.overscaledZ>0;){if(s.key in this._loadedParentTiles){r=this._loadedParentTiles[s.key];break}i.push(s.key);const c=s.scaledTo(s.overscaledZ-1);if(r=this._getLoadedTile(c),r)break;s=c}for(const c of i)this._loadedParentTiles[c]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=Boolean(i);if(!r){const s=this.map?this.map.painter:null;i=new Uh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,s,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new Dt("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const s=[],c=this.transform;if(!c)return s;const p="globe"===c.projection.name,f=eo(c.center.lng);for(const _ in this._tiles){const g=this._tiles[_];if(r&&g.clearQueryDebugViz(),g.holdingForFade())continue;let v;if(p){const E=g.tileID.canonical;if(0===E.z){const C=[Math.abs(yt(f,...zc(E,-1))-f),Math.abs(yt(f,...zc(E,1))-f)];v=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(yt(f,...zc(E,-1))-f),Math.abs(yt(f,...zc(E,0))-f),Math.abs(yt(f,...zc(E,1))-f)];v=[C.indexOf(Math.min(...C))-1]}}else v=[0];for(const E of v){const C=e.containsTile(g,c,i,E);C&&s.push(C)}}return s}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of i)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(Tf(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=Tt.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const s=this._tiles[e];s&&s.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){const r=new Map,s=Array.isArray(e)?e:[e],c=this.map.painter.terrain,p=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const f of s){const _=f.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const g of _)r.set(g.key,g);this.usedForTerrain&&f.updateElevation(!1)}Nn(Array.from(r.values()),(f,_)=>{const g=new Uh(f,this._source.tileSize*f.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(g,v=>{"raster-dem"===this._source.type&&g.dem&&this._backfillDEM(g),_(v,g)})},i)}}function wf(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Tf(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function zc(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}wa.maxOverzooming=10,wa.maxUnderzooming=3;class Gu{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const s=r||e.findDEMTileFor(i);if(!s||!s.dem)return;const c=s.dem,p=s.tileID,f=1<<i.canonical.z-p.canonical.z;return new Gu(s,s.tileSize/st/f,[(i.canonical.x/f-p.canonical.x)*c.dim,(i.canonical.y/f-p.canonical.y)*c.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(r);return new Oe(s,c)}getElevationAt(e,i,r,s){const c=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],f=Math.floor(c),_=Math.floor(p),g=this._dem;return s=!!s,r?Et(Et(g.get(f,_,s),g.get(f,_+1,s),p-_),Et(g.get(f+1,_,s),g.get(f+1,_+1,s),p-_),c-f):g.get(f,_,s)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ir(1,e)*this._dem.stride}}class Ef{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new bs(st,16,0),this.featureIndexArray=new lp,this.promoteId=i}insert(e,i,r,s,c,p=0){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,s,c,p);const _=this.grid;for(let g=0;g<i.length;g++){const v=i[g],E=[1/0,1/0,-1/0,-1/0];for(let C=0;C<v.length;C++){const k=v[C];E[0]=Math.min(E[0],k.x),E[1]=Math.min(E[1],k.y),E[2]=Math.max(E[2],k.x),E[3]=Math.max(E[3],k.y)}E[0]<st&&E[1]<st&&E[2]>=0&&E[3]>=0&&_.insert(f,E[0],E[1],E[2],E[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new vh(new xc(this.rawTileData)).layers,this.sourceLayerCoder=new cf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,s){this.loadVTLayers();const c=e.params||{},p=Ha(c.filter),f=e.tileResult,_=e.transform,g=f.bufferedTilespaceBounds,v=this.grid.query(g.min.x,g.min.y,g.max.x,g.max.y,(z,L,O,H)=>Mp(f.bufferedTilespaceGeometry,z,L,O,H));v.sort(sg);let E=null;_.elevation&&v.length>0&&(E=Gu.create(_.elevation,this.tileID));const C={};let k;for(let z=0;z<v.length;z++){const L=v[z];if(L===k)continue;k=L;const O=this.featureIndexArray.get(L);let H=null;this.loadMatchingFeature(C,O,p,c.layers,c.availableImages,i,r,s,(ne,W,K,oe=0)=>(H||(H=Fo(ne,this.tileID.canonical,e.tileTransform)),W.queryIntersectsFeature(f,ne,K,H,this.z,e.transform,e.pixelPosMatrix,E,oe)))}return C}loadMatchingFeature(e,i,r,s,c,p,f,_,g){const{featureIndex:v,bucketIndex:E,sourceLayerIndex:C,layoutVertexArrayOffset:k}=i,z=this.bucketLayerIDs[E];if(s&&!function(ne,W){for(let K=0;K<ne.length;K++)if(W.indexOf(ne[K])>=0)return!0;return!1}(s,z))return;const L=this.sourceLayerCoder.decode(C),O=this.vtLayers[L].feature(v);if(r.needGeometry){const ne=ma(O,!0);if(!r.filter(new J(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!r.filter(new J(this.tileID.overscaledZ),O))return;const H=this.getId(O,L);for(let ne=0;ne<z.length;ne++){const W=z[ne];if(s&&s.indexOf(W)<0)continue;const K=p[W];if(!K)continue;let oe={};void 0!==H&&_&&(oe=_.getState(K.sourceLayer||"_geojsonTileLayer",H));const ee=Kt({},f[W]);ee.paint=Cf(ee.paint,K.paint,O,oe,c),ee.layout=Cf(ee.layout,K.layout,O,oe,c);const _e=!g||g(O,K,oe,k);if(!_e)continue;const fe=new uf(O,this.z,this.x,this.y,H);fe.layer=ee;let be=e[W];void 0===be&&(be=e[W]=[]),be.push({featureIndex:v,feature:fe,intersectionZ:_e})}}lookupSymbolFeatures(e,i,r,s,c,p,f,_){const g={};this.loadVTLayers();const v=Ha(c);for(const E of e)this.loadMatchingFeature(g,{bucketIndex:r,sourceLayerIndex:s,featureIndex:E,layoutVertexArrayOffset:0},v,p,f,_,i);return g}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const s=this.sourceLayerCoder.decode(r),c=this.vtFeatures[s];if(c[i])return c[i];const p=this.vtLayers[s].feature(i);return c[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const s="string"==typeof this.promoteId?this.promoteId:this.promoteId[i];null!=s&&(r=e.properties[s]),"boolean"==typeof r&&(r=Number(r))}return r}}function Cf(t,e,i,r,s){return Sn(t,(c,p)=>{const f=e instanceof Te?e.get(p):null;return f&&f.evaluate?f.evaluate(i,r,s):f})}function sg(t,e){return e-t}$e(Ef,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Af{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Zo({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=cn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const s=[];let c=e.length%2==1?-e[e.length-1]*r:0,p=e[0]*r,f=!0;s.push({left:c,right:p,isDash:f,zeroLength:0===e[0]});let _=e[0];for(let g=1;g<e.length;g++){f=!f;const v=e[g];c=_*r,_+=v,p=_*r,s.push({left:c,right:p,isDash:f,zeroLength:0===v})}return s}addRoundDash(e,i,r){const s=i/2;for(let c=-r;c<=r;c++){const p=this.width*(this.nextRow+r+c);let f=0,_=e[f];for(let g=0;g<this.width;g++){g/_.right>1&&(_=e[++f]);const v=Math.abs(g-_.left),E=Math.abs(g-_.right),C=Math.min(v,E);let k;const z=c/r*(s+1);if(_.isDash){const L=s-Math.abs(z);k=Math.sqrt(C*C+L*L)}else k=s-Math.sqrt(C*C+z*z);this.image.data[p+g]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(e,i){for(let _=e.length-1;_>=0;--_){const g=e[_],v=e[_+1];g.zeroLength?e.splice(_,1):v&&v.isDash===g.isDash&&(v.left=g.left,e.splice(_,1))}const r=e[0],s=e[e.length-1];r.isDash===s.isDash&&(r.left=s.left-this.width,s.right=r.right+this.width);const c=this.width*this.nextRow;let p=0,f=e[p];for(let _=0;_<this.width;_++){_/f.right>1&&(f=e[++p]);const g=Math.abs(_-f.left),v=Math.abs(_-f.right),E=Math.min(g,v);this.image.data[c+_]=Math.max(0,Math.min(255,(f.isDash?E:-E)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const s="round"===i,c=s?7:0,p=2*c+1;if(this.nextRow+p>this.height)return Jt("LineAtlas out of space"),null;0===e.length&&e.push(1);let f=0;for(let v=0;v<e.length;v++)e[v]<0&&(Jt("Negative value is found in line dasharray, replacing values with 0"),e[v]=0),f+=e[v];if(0!==f){const v=this.width/f,E=this.getDashRanges(e,this.width,v);s?this.addRoundDash(E,v,c):this.addRegularDash(E,"square"===i?.5*v:0)}const _=this.nextRow+c;this.nextRow+=p;const g={tl:[_,c],br:[f,0]};return this.positions[r]=g,g}}$e(Af,"LineAtlas");class Sf{constructor(e){const i={},r=[];for(const f in e){const _=e[f],g=i[f]={};for(const v in _.glyphs){const E=_.glyphs[+v];if(!E||0===E.bitmap.width||0===E.bitmap.height)continue;const C=E.metrics.localGlyph?2:1,k={x:0,y:0,w:E.bitmap.width+2*C,h:E.bitmap.height+2*C};r.push(k),g[v]=k}}const{w:s,h:c}=Th(r),p=new Zo({width:s||1,height:c||1});for(const f in e){const _=e[f];for(const g in _.glyphs){const v=_.glyphs[+g];if(!v||0===v.bitmap.width||0===v.bitmap.height)continue;const E=i[f][g],C=v.metrics.localGlyph?2:1;Zo.copy(v.bitmap,p,{x:0,y:0},{x:E.x+C,y:E.y+C},v.bitmap)}}this.image=p,this.positions=i}}$e(Sf,"GlyphAtlas");class ag{constructor(e){this.tileID=new tn(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ba(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,r,s,c){this.status="parsing",this.data=e,this.collisionBoxArray=new Wu;const p=new cf(Object.keys(e.layers).sort()),f=new Ef(this.tileID,this.promoteId);f.bucketLayerIDs=[];const _={},g=new Af(256,256),v={featureIndex:f,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:g,availableImages:r},E=i.familiesBySource[this.source];for(const oe in E){const ee=e.layers[oe];if(!ee)continue;let _e=!1,fe=!1;for(const ye of E[oe])"symbol"===ye[0].type?_e=!0:fe=!0;if(!0===this.isSymbolTile&&!_e||!1===this.isSymbolTile&&!fe)continue;1===ee.version&&Jt(`Vector tile source "${this.source}" layer "${oe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const be=p.encode(oe),Pe=[];for(let ye=0;ye<ee.length;ye++){const we=ee.feature(ye),Ce=f.getId(we,oe);Pe.push({feature:we,id:Ce,index:ye,sourceLayerIndex:be})}for(const ye of E[oe]){const we=ye[0];void 0!==this.isSymbolTile&&"symbol"===we.type!==this.isSymbolTile||we.minzoom&&this.zoom<Math.floor(we.minzoom)||we.maxzoom&&this.zoom>=we.maxzoom||"none"!==we.visibility&&(qh(ye,this.zoom,r),(_[we.id]=we.createBucket({index:f.bucketLayerIDs.length,layers:ye,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:be,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(Pe,v,this.tileID.canonical,this.tileTransform),f.bucketLayerIDs.push(ye.map(Ce=>Ce.id)))}}let C,k,z,L;g.trim();const O={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},H=Sn(v.glyphDependencies,oe=>Object.keys(oe).map(Number));Object.keys(H).length?s.send("getGlyphs",{uid:this.uid,stacks:H},(oe,ee)=>{C||(C=oe,k=ee,K.call(this))},void 0,!1,O):k={};const ne=Object.keys(v.iconDependencies);ne.length?s.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(oe,ee)=>{C||(C=oe,z=ee,K.call(this))},void 0,!1,O):z={};const W=Object.keys(v.patternDependencies);function K(){if(C)return c(C);if(k&&z&&L){const oe=new Sf(k),ee=new Ad(z,L);for(const _e in _){const fe=_[_e];fe instanceof Is?(qh(fe.layers,this.zoom,r),M_(fe,k,oe.positions,z,ee.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):fe.hasPattern&&(fe instanceof Su||fe instanceof wu||fe instanceof mc)&&(qh(fe.layers,this.zoom,r),fe.addFeatures(v,this.tileID.canonical,ee.patternPositions,r,this.tileTransform))}this.status="done",c(null,{buckets:pi(_).filter(_e=>!_e.isEmpty()),featureIndex:f,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oe.image,lineAtlas:g,imageAtlas:ee,glyphMap:this.returnDependencies?k:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?oe.positions:null})}}W.length?s.send("getImages",{icons:W,source:this.source,tileID:this.tileID,type:"patterns"},(oe,ee)=>{C||(C=oe,L=ee,K.call(this))},void 0,!1,O):L={},K.call(this)}}function qh(t,e,i){const r=new J(e);for(const s of t)s.recalculate(r,i)}class If{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,s){const c=this.entries[e]=this.entries[e]||{callbacks:[]};if(c.result){const[p,f]=c.result;return this.scheduler?this.scheduler.add(()=>{s(p,f)},i):s(p,f),()=>{}}return c.callbacks.push(s),c.cancel||(c.cancel=r((p,f)=>{c.result=[p,f];for(const _ of c.callbacks)this.scheduler?this.scheduler.add(()=>{_(p,f)},i):_(p,f);setTimeout(()=>delete this.entries[e],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(p=>p!==s),c.callbacks.length||(c.cancel(),delete this.entries[e]))}}}function Mf(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},s=>{const c=qn(t.request,(p,f,_,g)=>{p?s(p):f&&s(null,{vectorTile:i?void 0:new vh(new xc(f)),rawData:f,cacheControl:_,expires:g})});return()=>{c.cancel(),s()}},e)}a.ARRAY_TYPE=bn,a.AUTH_ERR_MSG=hr,a.Aabb=en,a.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},lr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Hi()?t:h,this.scheduler=new ig}send(t,e,i,r,s=!1,c){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=c,this.callbacks[p]=i);const f=cr(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:t,hasCallback:!!i,targetMapId:r,mustQueue:s,sourceMapId:this.mapId,data:ca(e,f)},f),{cancel:()=>{i&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(e.mustQueue||Hi()){const r=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),r&&r.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Yr(e.error)):i(null,Yr(e.data)))}else{const i=cr(this.globalScope)?void 0:[],r=e.hasCallback?(c,p)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:c?ca(c):null,data:ca(p,i)},i)}:c=>{},s=Yr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,s,r);else if(this.parent.getWorkerSource){const c=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,c[0],s.source)[c[1]](s,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Au,a.Color=ri,a.ColorMode=lo,a.CullFaceMode=Sr,a.DEMData=qu,a.DataConstantProperty=de,a.DedupedRequest=If,a.DepthMode=Il,a.EXTENT=st,a.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,s=Math.floor(t.x),c=Math.floor((t.x-s)*r),p=Math.floor(t.y*r),f=this.findDEMTileFor(new tn(i,s,i,c,p));return!(!f||!f.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const s=r.getSource().maxzoom,c=1<<s,p=Math.floor(t.x),f=t.x-p,_=new tn(s,p,s,Math.floor(f*c),Math.floor(t.y*c)),g=this.findDEMTileFor(_);if(!g||!g.dem)return e;const v=g.dem,E=1<<g.tileID.canonical.z,C=(f*E-g.tileID.canonical.x)*v.dim,k=(t.y*E-g.tileID.canonical.y)*v.dim,z=Math.floor(C),L=Math.floor(k);return(i?this.exaggeration():1)*Et(Et(v.get(z,L),v.get(z,L+1),k-L),Et(v.get(z+1,L),v.get(z+1,L+1),k-L),C-z)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new ul(t.wrap+(t.canonical.x+e/st)/r,(t.canonical.y+i/st)/r))}getAtTileOffsetFunc(t,e,i,r){return s=>{const c=this.getAtTileOffset(t,s.x,s.y),p=r.upVector(t.canonical,s.x,s.y);return Un(p,p,c*r.upVectorScale(t.canonical,e,i).metersToTile),p}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const s=Gu.create(this,t,r);return!!s&&(e.forEach(c=>{c[2]=this.exaggeration()*s.getElevationAt(c[0],c[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,s=1<<t.canonical.z-r.canonical.z;let c=t.canonical.x/s-r.canonical.x,p=t.canonical.y/s-r.canonical.y,f=0;for(let _=0;_<t.canonical.z-r.canonical.z&&!i.leaves[f];_++){c*=2,p*=2;const g=2*Math.floor(p)+Math.floor(c);f=i.childOffsets[f]+g,c%=1,p%=1}return{min:this.exaggeration()*i.minimums[f],max:this.exaggeration()*i.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=Xn,a.EvaluationParameters=J,a.Event=Dt,a.Evented=Pn,a.FillExtrusionBucket=mc,a.Frustum=hh,a.FrustumCorners=uh,a.GLOBE_METERS_TO_ECEF=zh,a.GLOBE_RADIUS=jo,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GLOBE_ZOOM_THRESHOLD_MIN=5,a.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new ft,i=new Gi,r=65;for(let s=0;s<r;s++)for(let c=0;c<r;c++)e.emplaceBack(c,s);this._gridSegments=[];for(let s=0,c=0;s<El.length;s++){const p=El[s];for(let _=0;_<p;_++)for(let g=0;g<64;g++){const v=_*r+g;i.emplaceBack(v+1,v,v+r),i.emplaceBack(v+r,v+r+1,v+1)}const f=64*p*2;this._gridSegments.push(mi.simpleSegment(0,c,(p+1)*r,f)),c+=f}this._gridBuffer=t.createVertexBuffer(e,wc.members),this._gridIndexBuffer=t.createIndexBuffer(i,!0)}_createPoles(t){const e=new Gi;for(let s=0;s<=64;s++)e.emplaceBack(0,s+1,s+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new tr,r=new tr;this._poleSegments=[];for(let s=0,c=0;s<5;s++){const p=360/(1<<s);i.emplaceBack(0,-jo,0,.5,0),r.emplaceBack(0,-jo,0,.5,1);for(let f=0;f<=64;f++){const _=f/64,g=Et(0,p,_),[v,E,C]=Cl(B_,O_,g,jo);i.emplaceBack(v,E,C,_,0),r.emplaceBack(v,E,C,_,1)}this._poleSegments.push(mi.simpleSegment(c,0,66,64)),c+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,$d,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,$d,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new On,r=64,s=r+1;this._wireframeSegments=[];for(let c=0,p=0;c<El.length;c++){const f=El[c];for(let g=0;g<f;g++)for(let v=0;v<r;v++){const E=g*s+v;i.emplaceBack(E,E+1),i.emplaceBack(E,E+s),i.emplaceBack(E,E+s+1)}const _=f*r*3;this._wireframeSegments.push(mi.simpleSegment(0,p,(f+1)*s,_)),p+=_}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},a.GlyphManager=bl,a.ImagePosition=Eh,a.LivePerformanceUtils=Ae,a.LngLat=kt,a.LngLatBounds=Cs,a.LocalGlyphMode=Sh,a.MAX_MERCATOR_LATITUDE=io,a.MercatorCoordinate=ul,a.ONE_EM=24,a.OverscaledTileID=tn,a.PerformanceMarkers=he,a.Properties=Re,a.RGBAImage=wn,a.Ray=ch,a.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",on,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!hn(t))return t;const i=Ri(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!hn(t))return t;const i=Ri(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!hn(t))return t;const s=Ri(t);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),i&&s.params.push(`language=${i}`),r&&s.params.push(`worldview=${r}`),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const s=Ri(t);return hn(t)?(s.path=`/styles/v1${s.path}/sprite${e}${i}`,this._makeAPIURL(s,this._customAccessToken||r)):(s.path+=`${e}${i}`,dr(s))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!hn(t))return t;const r=Ri(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==r.authority&&512===i?"@2x":""}${_t.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${lt.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${lt.TILE_URL_VERSION}${r.path}`);const s=this._customAccessToken||function(c){for(const p of c){const f=p.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(r.params)||lt.ACCESS_TOKEN;return lt.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,s)}canonicalizeTileURL(t,e){const i=Ri(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${lt.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${lt.TILE_URL_VERSION}/`,"")}`;let s=i.params;return e&&(s=s.filter(c=>!c.match(/^access_token=/))),s.length&&(r+=`?${s.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&hn(e),r=[];for(const s of t.tiles||[])Rr(s)?r.push(this.canonicalizeTileURL(s,i)):r.push(s);return r}_makeAPIURL(t,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=Ri(lt.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const s=t.params.indexOf("secure");s>=0&&t.params.splice(s,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!lt.REQUIRE_ACCESS_TOKEN)return dr(t);if(e=e||lt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(s=>-1===s.indexOf("access_token")),t.params.push(`access_token=${e||""}`),dr(t)}},a.ResourceType=Si,a.SegmentVector=mi,a.SourceCache=wa,a.StencilMode=Nh,a.StructArrayLayout1ui2=ec,a.StructArrayLayout2f1f2i16=Qi,a.StructArrayLayout2i4=ft,a.StructArrayLayout2ui4=On,a.StructArrayLayout3f12=Bn,a.StructArrayLayout3ui6=Gi,a.StructArrayLayout4i8=Ft,a.StructArrayLayout5f20=tr,a.Texture=kc,a.Tile=Uh,a.Transitionable=ge,a.Uniform1f=uu,a.Uniform1i=class extends Bo{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends Bo{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},a.Uniform3f=class extends Bo{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},a.Uniform4f=gp,a.UniformColor=yp,a.UniformMatrix2f=class extends Bo{constructor(t){super(t),this.current=Nf}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},a.UniformMatrix3f=class extends Bo{constructor(t){super(t),this.current=Zf}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},a.UniformMatrix4f=class extends Bo{constructor(t){super(t),this.current=Uf}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},a.UnwrappedTileID=dd,a.ValidationError=je,a.VectorTileFeature=Eu,a.VectorTileWorkerSource=class extends Pn{constructor(t,e,i,r,s){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=s||Mf,this.loading={},this.loaded={},this.deduped=new If(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,r=t&&t.request,s=r&&r.collectResourceTiming,c=this.loading[i]=new ag(t);c.abort=this.loadVectorData(t,(p,f)=>{const _=!this.loading[i];if(delete this.loading[i],_||p||!f)return c.status="done",_||(this.loaded[i]=c),e(p);const g=f.rawData,v={};f.expires&&(v.expires=f.expires),f.cacheControl&&(v.cacheControl=f.cacheControl),c.vectorTile=f.vectorTile||new vh(new xc(g));const E=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(C,k)=>{if(C||!k)return e(C);const z={};if(s){const L=Ke(r);L.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(L)))}e(null,Kt({rawTileData:g.slice(0)},k,v,z))})};this.isSpriteLoaded?E():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(E,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):E()}),this.loaded=this.loaded||{},this.loaded[i]=c})}reloadTile(t,e){const i=this.loaded,r=t.uid,s=this;if(i&&i[r]){const c=i[r];c.showCollisionBoxes=t.showCollisionBoxes,c.enableTerrain=!!t.enableTerrain,c.projection=t.projection,c.tileTransform=ba(t.tileID.canonical,t.projection);const p=(f,_)=>{const g=c.reloadCallback;g&&(delete c.reloadCallback,c.parse(c.vectorTile,s.layerIndex,this.availableImages,s.actor,g)),e(f,_)};"parsing"===c.status?c.reloadCallback=p:"done"===c.status&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},a.WritingMode=Zn,a.ZoomHistory=Hc,a.add=Uo,a.addDynamicAttributes=Nu,a.adjoint=function(t,e){var i=e[0],r=e[1],s=e[2],c=e[3],p=e[4],f=e[5],_=e[6],g=e[7],v=e[8];return t[0]=p*v-f*g,t[1]=s*g-r*v,t[2]=r*f-s*p,t[3]=f*_-c*v,t[4]=i*v-s*_,t[5]=s*c-i*f,t[6]=c*g-p*_,t[7]=r*_-i*g,t[8]=i*p-r*c,t},a.asyncAll=Nn,a.bezier=Ir,a.bindAll=lr,a.boundsAttributes=pf,a.bufferConvexPolygon=function(t,e){const i=[];for(let r=0;r<t.length;r++){const s=Gt(r-1,-1,t.length-1),c=Gt(r+1,-1,t.length-1),p=t[r],f=t[c],_=t[s].sub(p).unit(),g=f.sub(p).unit(),v=g.angleWithSep(_.x,_.y),E=_.add(g).unit().mult(-1*e/Math.sin(v/2));i.push(p.add(E))}return i},a.cacheEntryPossiblyAdded=function(t){zn++,zn>yo&&(t.getActor().send("enforceCacheSizeLimit",Pr),zn=0)},a.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:r}=t.point,s=Qd(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return pl(s,s,Lh(oo(e)))},a.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:s}=t._center;return Qd(e,i,t.worldSize,r,s)},a.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/ir(1,t.center.lat),r=no(new Float64Array(16));return ic(r,r,[t.point.x,t.point.y,0]),ga(r,r,[i,i,e]),Float32Array.from(r)},a.circumferenceAtLatitude=Yu,a.clamp=yt,a.clearTileCache=function(t){if(!Mn())return;const e=h.caches.delete(Ho);t&&e.catch(t).then(()=>t())},a.clipLine=Fd,a.clone=function(t){var e=new bn(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.clone$1=Ti,a.collisionCircleLayout=t_,a.config=lt,a.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},a.create=function(){var t=new bn(16);return bn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},a.create$1=Pp,a.createExpression=et,a.createLayout=Be,a.createStyleLayer=function(t){return"custom"===t.type?new Q_(t):new eg[t.type](t)},a.cross=lh,a.degToRad=vt,a.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},a.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},a.dot=nr,a.earthRadius=pu,a.ease=fo,a.easeCubicInOut=po,a.ecefToLatLng=function([t,e,i]){const r=Math.hypot(t,e,i),s=Math.atan2(t,i),c=.5*Math.PI-Math.acos(-e/r);return new kt(li(s),li(c))},a.emitValidationErrors=Wl,a.endsWith=Wi,a.enforceCacheSizeLimit=function(t){kn(),Ei&&Ei.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},a.evaluateSizeForFeature=Iu,a.evaluateSizeForZoom=gl,a.evaluateVariableOffset=jd,a.evented=G,a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},a.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},a.exported=Tt,a.exported$1=_t,a.extend=Kt,a.extend$1=Ci,a.fillExtrusionHeightLift=ud,a.filterObject=zr,a.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},a.fromQuat=function(t,e){var i=e[0],r=e[1],s=e[2],c=e[3],p=i+i,f=r+r,_=s+s,g=i*p,v=r*p,E=r*f,C=s*p,k=s*f,z=s*_,L=c*p,O=c*f,H=c*_;return t[0]=1-E-z,t[1]=v+H,t[2]=C-O,t[3]=0,t[4]=v-H,t[5]=1-g-z,t[6]=k+L,t[7]=0,t[8]=C+O,t[9]=k-L,t[10]=1-g-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromScaling=Lp,a.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Xo[e]},a.getAABBPointSquareDist=function(t,e,i){let r=0;for(let s=0;s<2;++s){const c=i?i[s]:0;t[s]>c&&(r+=(t[s]-c)*(t[s]-c)),e[s]<c&&(r+=(c-e[s])*(c-e[s]))}return r},a.getAnchorAlignment=Ah,a.getAnchorJustification=Mh,a.getBounds=function(t){let e=1/0,i=1/0,r=-1/0,s=-1/0;for(const c of t)e=Math.min(e,c.x),i=Math.min(i,c.y),r=Math.max(r,c.x),s=Math.max(s,c.y);return{min:new Oe(e,i),max:new Oe(r,s)}},a.getColumn=In,a.getGridMatrix=function(t,e,i,r){const s=e.getNorth(),c=e.getSouth(),p=e.getWest(),f=e.getEast(),_=1<<t.z,g=f-p,v=s-c,E=g/64,C=-v/El[i],k=[0,E,0,C,0,0,s,p,0];if(t.z>0){const z=180/r;Dp(k,k,[z/g+1,0,0,0,z/v+1,0,-.5*z/E,.5*z/C,1])}return k[2]=_,k[5]=t.x,k[8]=t.y,k},a.getImage=Lr,a.getJSON=function(t,e){return jn(Kt(t,{type:"json"}),e)},a.getLatitudinalLod=function(t){const e=80.051129;t=yt(t,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(vt(t))),3);return Math.round(i*(El.length-1))},a.getMapSessionAPI=ce,a.getPerformanceMeasurement=Ke,a.getProjection=af,a.getRTLTextPluginStatus=N,a.getReferrer=ur,a.getTilePoint=function(t,{x:e,y:i},r=0){return new Oe(((e-r)*t.scale-t.x)*st,(i*t.scale-t.y)*st)},a.getTileVec3=function(t,e,i=0){return dl(((e.x-i)*t.scale-t.x)*st,(e.y*t.scale-t.y)*st,bp(e.z,e.y))},a.getVideo=function(t,e){const i=h.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<t.length;r++){const s=h.document.createElement("source");vo(t[r])||(i.crossOrigin="Anonymous"),s.src=t[r],i.appendChild(s)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=no(new Float64Array(16));return pl(i,t.pixelMatrix,t.globeMatrix),_i(e,e,i),new Oe(e[0],e[1])},a.globeDenormalizeECEF=Lh,a.globeECEFOrigin=function(t,e){const i=[0,0,0];return _i(i,i,Cc(oo(e.canonical))),_i(i,i,t),i},a.globeNormalizeECEF=Cc,a.globePixelsToTileUnits=function(t,e){return st/(512*Math.pow(2,t))*Bu(oo(e))},a.globePoleMatrixForTile=function(t,e,i){const r=no(new Float64Array(16)),s=(e/(1<<t)-.5)*Math.PI*2;return gu(r,i.globeMatrix,s),Float32Array.from(r)},a.globeTileBounds=oo,a.globeTiltAtLngLat=Kd,a.globeToMercatorTransition=Al,a.globeUseCustomAntiAliasing=function(t,e,i){const r=Al(i.zoom),s=t.style.map._antialias,c=!!e.extStandardDerivatives,p=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===r&&!s&&!p&&c},a.identity=no,a.identity$1=Vp,a.invert=rh,a.isFullscreen=function(){return!!h.document.fullscreenElement||!!h.document.webkitFullscreenElement},a.isLngLatBehindGlobe=function(t,e){return Kd(t,e)>Math.PI/2*1.01},a.isMapAuthenticated=function(t){return se.has(t)},a.isMapboxURL=hn,a.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!cr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Zi,a.latLngToECEF=Tc,a.len=rm,a.length=nc,a.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},a.lngFromMercatorX=Fn,a.loadVectorTile=Mf,a.makeRequest=jn,a.mapValue=function(t,e,i,r,s){return yt((t-e)/(i-e)*(s-r)+r,r,s)},a.mercatorScale=wp,a.mercatorXfromLng=eo,a.mercatorYfromLat=to,a.mercatorZfromAltitude=ir,a.mul=im,a.mul$1=nm,a.multiply=pl,a.multiply$1=Dp,a.multiply$2=Op,a.nextPowerOfTwo=cn,a.normalize=Ki,a.normalize$1=om,a.normalize$2=Zp,a.number=Et,a.ortho=function(t,e,i,r,s,c,p){var f=1/(e-i),_=1/(r-s),g=1/(c-p);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*g,t[11]=0,t[12]=(e+i)*f,t[13]=(s+r)*_,t[14]=(p+c)*g,t[15]=1,t},a.pbf=xc,a.perspective=function(t,e,i,r,s){var c,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(t[10]=(s+r)*(c=1/(r-s)),t[14]=2*s*r*c):(t[10]=-1,t[14]=-2*r),t},a.pick=function(t,e){const i={};for(let r=0;r<e.length;r++){const s=e[r];s in t&&(i[s]=t[s])}return i},a.plugin=ie,a.pointGeometry=Oe,a.polygonContainsPoint=_a,a.polygonIntersectsBox=Mp,a.polygonIntersectsPolygon=Cp,a.polygonizeBounds=function(t,e,i=0,r=!0){const s=new Oe(i,i),c=t.sub(s),p=e.add(s),f=[c,new Oe(p.x,c.y),p,new Oe(c.x,p.y)];return r&&f.push(c.clone()),f},a.posAttributes=wc,a.postMapLoadEvent=q,a.postPerformanceEvent=Q,a.postTurnstileEvent=P,a.potpack=Th,a.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},a.radToDeg=li,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(t){return t({pluginStatus:U,pluginURL:j}),G.on("pluginStateChange",t),t},a.removeAuthState=function(t){se.delete(t)},a.renderColorRamp=dh,a.resample=Tp,a.rotateX=oh,a.rotateX$1=jp,a.rotateY=gu,a.rotateY$1=qp,a.rotateZ=function(t,e,i){var r=Math.sin(i),s=Math.cos(i),c=e[0],p=e[1],f=e[2],_=e[3],g=e[4],v=e[5],E=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*s+g*r,t[1]=p*s+v*r,t[2]=f*s+E*r,t[3]=_*s+C*r,t[4]=g*s-c*r,t[5]=v*s-p*r,t[6]=E*s-f*r,t[7]=C*s-_*r,t},a.rotateZ$1=function(t,e,i){i*=.5;var r=e[0],s=e[1],c=e[2],p=e[3],f=Math.sin(i),_=Math.cos(i);return t[0]=r*_+s*f,t[1]=s*_-r*f,t[2]=c*_+p*f,t[3]=p*_-c*f,t},a.scale=ga,a.scale$1=Up,a.scale$2=Un,a.scaleAndAdd=sc,a.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},a.setCacheLimits=function(t,e){Pr=t,yo=e},a.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},a.setRTLTextPlugin=function(t,e,i=!1){if(U===M||U===D||U===B)throw new Error("setRTLTextPlugin cannot be called multiple times.");j=Tt.resolveURL(t),U=M,V=e,F(),i||te()},a.smoothstep=Mr,a.spec=ve,a.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},a.storeAuthState=function(t,e){e?se.add(t):se.delete(t)},a.sub=Er,a.subtract=ah,a.symbolSize=i_,a.tileAABB=function(t,e,i,r,s,c,p,f,_){if("globe"===_.name)return function R_(t,e,i){const r=e/t.worldSize,s=t.globeMatrix;if(i.z<=1){const fe=oo(i).getCorners();return Jd(fe,s,r),en.fromPoints(fe)}const c=Ru(i),p=Dh(c);Jd(p,s,r);const f=Number.MAX_VALUE,_=[-f,-f,-f],g=[f,f,f];if(c.contains(t.center)){for(const Pe of p)rc(g,g,Pe),oc(_,_,Pe);_[2]=0;const fe=t.point,be=[fe.x*r,fe.y*r,0];return rc(g,g,be),oc(_,_,be),new en(g,_)}const v=[s[12]*r,s[13]*r,s[14]*r],E=c.getCenter(),C=yt(t.center.lat,-85.051129,io),k=yt(E.lat,-85.051129,io),z=eo(t.center.lng),L=to(C);let O=z-eo(E.lng);const H=L-to(k);O>.5?O-=1:O<-.5&&(O+=1);let ne=0;Math.abs(O)>Math.abs(H)?ne=O>=0?1:3:(ne=H>=0?0:2,sc(v,v,[s[4]*r,s[5]*r,s[6]*r],-Math.sin(vt(H>=0?c.getSouth():c.getNorth()))*jo));const W=p[ne],K=p[(ne+1)%4],oe=new L_(W,K,v),ee=[Ph(oe,0)||W[0],Ph(oe,1)||W[1],Ph(oe,2)||W[2]],_e=Al(t.zoom);if(_e>0){const fe=function({x:Pe,y:ye,z:we},Ce,ke,De,xe){const Ue=1/(1<<we);let nt=Pe*Ue,Ge=nt+Ue,Xe=ye*Ue,Ne=Xe+Ue,rt=0;const ut=(nt+Ge)/2-De;return ut>.5?rt=-1:ut<-.5&&(rt=1),nt=((nt+rt)*Ce-(De*=Ce))*ke+De,Ge=((Ge+rt)*Ce-De)*ke+De,Xe=(Xe*Ce-(xe*=Ce))*ke+xe,Ne=(Ne*Ce-xe)*ke+xe,[[nt,Ne,0],[Ge,Ne,0],[Ge,Xe,0],[nt,Xe,0]]}(i,e,t._pixelsPerMercatorPixel,z,L);for(let Pe=0;Pe<p.length;Pe++)va(p[Pe],fe[Pe],_e);const be=Uo([],fe[ne],fe[(ne+1)%4]);Un(be,be,.5),va(ee,be,_e)}for(const fe of p)rc(g,g,fe),oc(_,_,fe);return g[2]=Math.min(W[2],K[2]),rc(g,g,ee),oc(_,_,ee),new en(g,_)}(t,e,new Au(i,r,s));const g=ba({z:i,x:r,y:s},_);return new en([(c+g.x/g.scale)*e,e*(g.y/g.scale),p],[(c+g.x2/g.scale)*e,e*(g.y2/g.scale),f])},a.tileCornersToBounds=Ru,a.tileTransform=ba,a.transformMat3=function(t,e,i){var r=e[0],s=e[1],c=e[2];return t[0]=r*i[0]+s*i[3]+c*i[6],t[1]=r*i[1]+s*i[4]+c*i[7],t[2]=r*i[2]+s*i[5]+c*i[8],t},a.transformMat4=_i,a.transformMat4$1=ya,a.transformQuat=Fp,a.transitionTileAABBinECEF=Hd,a.translate=ic,a.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},a.triggerPluginCompletionEvent=Z,a.uniqueId=mo,a.updateGlobeVertexNormal=function(t,e,i,r,s){const c=5*e+2;t.float32[c+0]=i,t.float32[c+1]=r,t.float32[c+2]=s},a.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=t=>br(aa(t)),a.validateFog=t=>br(Gc(t)),a.validateLayer=t=>br(ql(t)),a.validateLight=t=>br(la(t)),a.validateSource=t=>br(tl(t)),a.validateStyle=$c,a.validateTerrain=t=>br(Gl(t)),a.values=pi,a.vectorTile=Tu,a.version=Cn,a.warnOnce=Jt,a.window=h,a.wrap=Gt}),zt(0,function(a){function h($){if("number"==typeof $||"boolean"==typeof $||"string"==typeof $||null==$)return JSON.stringify($);if(Array.isArray($)){let R="[";for(const q of $)R+=`${h(q)},`;return`${R}]`}let P="{";for(const R of Object.keys($).sort())P+=`${R}:${h($[R])},`;return`${P}}`}function Cn($){let P="";for(const R of a.refProperties)P+=`/${h($[R])}`;return P}class rn{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,R){for(const Y of P)this._layerConfigs[Y.id]=Y,(this._layers[Y.id]=a.createStyleLayer(Y)).compileFilter(),this.keyCache[Y.id]&&delete this.keyCache[Y.id];for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const q=function(Y,Q){const ue={};for(let se=0;se<Y.length;se++){const he=Q&&Q[Y[se].id]||Cn(Y[se]);Q&&(Q[Y[se].id]=he);let Ae=ue[he];Ae||(Ae=ue[he]=[]),Ae.push(Y[se])}const ce=[];for(const se in ue)ce.push(ue[se]);return ce}(a.values(this._layerConfigs),this.keyCache);for(const Y of q){const Q=Y.map(qe=>this._layers[qe.id]),ue=Q[0];if("none"===ue.visibility)continue;const ce=ue.source||"";let se=this.familiesBySource[ce];se||(se=this.familiesBySource[ce]={});const he=ue.sourceLayer||"_geojsonTileLayer";let Ae=se[he];Ae||(Ae=se[he]=[]),Ae.push(Q)}}}class lt{loadTile(P,R){const{uid:q,encoding:Y,rawImageData:Q,padding:ue,buildQuadTree:ce}=P,se=a.window.ImageBitmap&&Q instanceof a.window.ImageBitmap?this.getImageData(Q,ue):Q;R(null,new a.DEMData(q,se,Y,ue<1,ce))}getImageData(P,R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const q=this.offscreenCanvasContext.getImageData(-R,-R,P.width+2*R,P.height+2*R);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),q}}var _t=function $(P,R){var q,Y=P&&P.type;if("FeatureCollection"===Y)for(q=0;q<P.features.length;q++)$(P.features[q],R);else if("GeometryCollection"===Y)for(q=0;q<P.geometries.length;q++)$(P.geometries[q],R);else if("Feature"===Y)$(P.geometry,R);else if("Polygon"===Y)wi(P.coordinates,R);else if("MultiPolygon"===Y)for(q=0;q<P.coordinates.length;q++)wi(P.coordinates[q],R);return P};function wi($,P){if(0!==$.length){Ai($[0],P);for(var R=1;R<$.length;R++)Ai($[R],!P)}}function Ai($,P){for(var R=0,q=0,Y=0,Q=$.length,ue=Q-1;Y<Q;ue=Y++){var ce=($[Y][0]-$[ue][0])*($[ue][1]+$[Y][1]),se=R+ce;q+=Math.abs(R)>=Math.abs(ce)?R-se+ce:ce-se+R,R=se}R+q>=0!=!!P&&$.reverse()}const An=a.VectorTileFeature.prototype.toGeoJSON;class uo{constructor(P){this._feature=P,this.extent=a.EXTENT,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(1===this._feature.type){const P=[];for(const R of this._feature.geometry)P.push([new a.pointGeometry(R[0],R[1])]);return P}{const P=[];for(const R of this._feature.geometry){const q=[];for(const Y of R)q.push(new a.pointGeometry(Y[0],Y[1]));P.push(q)}return P}}toGeoJSON(P,R,q){return An.call(this,P,R,q)}}class ho{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=P.length,this._features=P}feature(P){return new uo(this._features[P])}}var on={exports:{}},or=a.pointGeometry,sn=a.vectorTile.VectorTileFeature,Oe=an;function an($,P){this.options=P||{},this.features=$,this.length=$.length}function sr($,P){this.id="number"==typeof $.id?$.id:void 0,this.type=$.type,this.rawGeometry=1===$.type?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=P||4096}an.prototype.feature=function($){return new sr(this.features[$],this.options.extent)},sr.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var P=0;P<$.length;P++){for(var R=$[P],q=[],Y=0;Y<R.length;Y++)q.push(new or(R[Y][0],R[Y][1]));this.geometry.push(q)}return this.geometry},sr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,P=1/0,R=-1/0,q=1/0,Y=-1/0,Q=0;Q<$.length;Q++)for(var ue=$[Q],ce=0;ce<ue.length;ce++){var se=ue[ce];P=Math.min(P,se.x),R=Math.max(R,se.x),q=Math.min(q,se.y),Y=Math.max(Y,se.y)}return[P,q,R,Y]},sr.prototype.toGeoJSON=sn.prototype.toGeoJSON;var $o=a.pbf,vt=Oe;function li($){var P=new $o;return function(R,q){for(var Y in R.layers)q.writeMessage(3,Xo,R.layers[Y])}($,P),P.finish()}function Xo($,P){var R;P.writeVarintField(15,$.version||1),P.writeStringField(1,$.name||""),P.writeVarintField(5,$.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<$.length;R++)q.feature=$.feature(R),P.writeMessage(2,po,q);var Y=q.keys;for(R=0;R<Y.length;R++)P.writeStringField(3,Y[R]);var Q=q.values;for(R=0;R<Q.length;R++)P.writeMessage(4,Gt,Q[R])}function po($,P){var R=$.feature;void 0!==R.id&&P.writeVarintField(1,R.id),P.writeMessage(2,Ir,$),P.writeVarintField(3,R.type),P.writeMessage(4,Mr,R)}function Ir($,P){var R=$.feature,q=$.keys,Y=$.values,Q=$.keycache,ue=$.valuecache;for(var ce in R.properties){var se=R.properties[ce],he=Q[ce];if(null!==se){void 0===he&&(q.push(ce),Q[ce]=he=q.length-1),P.writeVarint(he);var Ae=typeof se;"string"!==Ae&&"boolean"!==Ae&&"number"!==Ae&&(se=JSON.stringify(se));var qe=Ae+":"+se,Me=ue[qe];void 0===Me&&(Y.push(se),ue[qe]=Me=Y.length-1),P.writeVarint(Me)}}}function fo($,P){return(P<<3)+(7&$)}function yt($){return $<<1^$>>31}function Mr($,P){for(var R=$.loadGeometry(),q=$.type,Y=0,Q=0,ue=R.length,ce=0;ce<ue;ce++){var se=R[ce],he=1;1===q&&(he=se.length),P.writeVarint(fo(1,he));for(var Ae=3===q?se.length-1:se.length,qe=0;qe<Ae;qe++){1===qe&&1!==q&&P.writeVarint(fo(2,Ae-1));var Me=se[qe].x-Y,Ke=se[qe].y-Q;P.writeVarint(yt(Me)),P.writeVarint(yt(Ke)),Y+=Me,Q+=Ke}3===q&&P.writeVarint(fo(7,1))}}function Gt($,P){var R=typeof $;"string"===R?P.writeStringField(1,$):"boolean"===R?P.writeBooleanField(7,$):"number"===R&&($%1!=0?P.writeDoubleField(3,$):$<0?P.writeSVarintField(6,$):P.writeVarintField(5,$))}function Nn($,P,R,q,Y,Q){if(Y-q<=R)return;const ue=q+Y>>1;pi($,P,ue,q,Y,Q%2),Nn($,P,R,q,ue-1,Q+1),Nn($,P,R,ue+1,Y,Q+1)}function pi($,P,R,q,Y,Q){for(;Y>q;){if(Y-q>600){const he=Y-q+1,Ae=R-q+1,qe=Math.log(he),Me=.5*Math.exp(2*qe/3),Ke=.5*Math.sqrt(qe*Me*(he-Me)/he)*(Ae-he/2<0?-1:1);pi($,P,R,Math.max(q,Math.floor(R-Ae*Me/he+Ke)),Math.min(Y,Math.floor(R+(he-Ae)*Me/he+Ke)),Q)}const ue=P[2*R+Q];let ce=q,se=Y;for(Kt($,P,q,R),P[2*Y+Q]>ue&&Kt($,P,q,Y);ce<se;){for(Kt($,P,ce,se),ce++,se--;P[2*ce+Q]<ue;)ce++;for(;P[2*se+Q]>ue;)se--}P[2*q+Q]===ue?Kt($,P,q,se):(se++,Kt($,P,se,Y)),se<=R&&(q=se+1),R<=se&&(Y=se-1)}}function Kt($,P,R,q){kr($,R,q),kr(P,2*R,2*q),kr(P,2*R+1,2*q+1)}function kr($,P,R){const q=$[P];$[P]=$[R],$[R]=q}function mo($,P,R,q){const Y=$-R,Q=P-q;return Y*Y+Q*Q}on.exports=li,on.exports.fromVectorTileJs=li,on.exports.fromGeojsonVt=function($,P){P=P||{};var R={};for(var q in $)R[q]=new vt($[q].features,P),R[q].name=q,R[q].version=P.version,R[q].extent=P.extent;return li({layers:R})},on.exports.GeoJSONWrapper=vt;const Xi=$=>$[0],cn=$=>$[1];class ar{constructor(P,R=Xi,q=cn,Y=64,Q=Float64Array){this.nodeSize=Y,this.points=P;const ue=P.length<65536?Uint16Array:Uint32Array,ce=this.ids=new ue(P.length),se=this.coords=new Q(2*P.length);for(let he=0;he<P.length;he++)ce[he]=he,se[2*he]=R(P[he]),se[2*he+1]=q(P[he]);Nn(ce,se,Y,0,ce.length-1,0)}range(P,R,q,Y){return function(Q,ue,ce,se,he,Ae,qe){const Me=[0,Q.length-1,0],Ke=[];let He,Je;for(;Me.length;){const Qe=Me.pop(),pt=Me.pop(),Tt=Me.pop();if(pt-Tt<=qe){for(let Dt=Tt;Dt<=pt;Dt++)He=ue[2*Dt],Je=ue[2*Dt+1],He>=ce&&He<=he&&Je>=se&&Je<=Ae&&Ke.push(Q[Dt]);continue}const it=Math.floor((Tt+pt)/2);He=ue[2*it],Je=ue[2*it+1],He>=ce&&He<=he&&Je>=se&&Je<=Ae&&Ke.push(Q[it]);const Mt=(Qe+1)%2;(0===Qe?ce<=He:se<=Je)&&(Me.push(Tt),Me.push(it-1),Me.push(Mt)),(0===Qe?he>=He:Ae>=Je)&&(Me.push(it+1),Me.push(pt),Me.push(Mt))}return Ke}(this.ids,this.coords,P,R,q,Y,this.nodeSize)}within(P,R,q){return function(Y,Q,ue,ce,se,he){const Ae=[0,Y.length-1,0],qe=[],Me=se*se;for(;Ae.length;){const Ke=Ae.pop(),He=Ae.pop(),Je=Ae.pop();if(He-Je<=he){for(let Mt=Je;Mt<=He;Mt++)mo(Q[2*Mt],Q[2*Mt+1],ue,ce)<=Me&&qe.push(Y[Mt]);continue}const Qe=Math.floor((Je+He)/2),pt=Q[2*Qe],Tt=Q[2*Qe+1];mo(pt,Tt,ue,ce)<=Me&&qe.push(Y[Qe]);const it=(Ke+1)%2;(0===Ke?ue-se<=pt:ce-se<=Tt)&&(Ae.push(Je),Ae.push(Qe-1),Ae.push(it)),(0===Ke?ue+se>=pt:ce+se>=Tt)&&(Ae.push(Qe+1),Ae.push(He),Ae.push(it))}return qe}(this.ids,this.coords,P,R,q,this.nodeSize)}}const lr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$=>$},Wi=Math.fround||(Sn=new Float32Array(1),$=>(Sn[0]=+$,Sn[0]));var Sn;class zr{constructor(P){this.options=un(Object.create(lr),P),this.trees=new Array(this.options.maxZoom+1)}load(P){const{log:R,minZoom:q,maxZoom:Y,nodeSize:Q}=this.options;R&&console.time("total time");const ue=`prepare ${P.length} points`;R&&console.time(ue),this.points=P;let ce=[];for(let se=0;se<P.length;se++)P[se].geometry&&ce.push(_o(P[se],se));this.trees[Y+1]=new ar(ce,cr,go,Q,Float32Array),R&&console.timeEnd(ue);for(let se=Y;se>=q;se--){const he=+Date.now();ce=this._cluster(ce,se),this.trees[se]=new ar(ce,cr,go,Q,Float32Array),R&&console.log("z%d: %d clusters in %dms",se,ce.length,+Date.now()-he)}return R&&console.timeEnd("total time"),this}getClusters(P,R){let q=((P[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,P[1]));let Q=180===P[2]?180:((P[2]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)q=-180,Q=180;else if(q>Q){const Ae=this.getClusters([q,Y,180,ue],R),qe=this.getClusters([-180,Y,Q,ue],R);return Ae.concat(qe)}const ce=this.trees[this._limitZoom(R)],se=ce.range(wt(q),Hi(ue),wt(Q),Hi(Y)),he=[];for(const Ae of se){const qe=ce.points[Ae];he.push(qe.numPoints?Jt(qe):this.points[qe.index])}return he}getChildren(P){const R=this._getOriginId(P),q=this._getOriginZoom(P),Y="No cluster with the specified id.",Q=this.trees[q];if(!Q)throw new Error(Y);const ue=Q.points[R];if(!ue)throw new Error(Y);const ce=this.options.radius/(this.options.extent*Math.pow(2,q-1)),se=Q.within(ue.x,ue.y,ce),he=[];for(const Ae of se){const qe=Q.points[Ae];qe.parentId===P&&he.push(qe.numPoints?Jt(qe):this.points[qe.index])}if(0===he.length)throw new Error(Y);return he}getLeaves(P,R,q){const Y=[];return this._appendLeaves(Y,P,R=R||10,q=q||0,0),Y}getTile(P,R,q){const Y=this.trees[this._limitZoom(P)],Q=Math.pow(2,P),{extent:ue,radius:ce}=this.options,se=ce/ue,he=(q-se)/Q,Ae=(q+1+se)/Q,qe={features:[]};return this._addTileFeatures(Y.range((R-se)/Q,he,(R+1+se)/Q,Ae),Y.points,R,q,Q,qe),0===R&&this._addTileFeatures(Y.range(1-se/Q,he,1,Ae),Y.points,Q,q,Q,qe),R===Q-1&&this._addTileFeatures(Y.range(0,he,se/Q,Ae),Y.points,-1,q,Q,qe),qe.features.length?qe:null}getClusterExpansionZoom(P){let R=this._getOriginZoom(P)-1;for(;R<=this.options.maxZoom;){const q=this.getChildren(P);if(R++,1!==q.length)break;P=q[0].properties.cluster_id}return R}_appendLeaves(P,R,q,Y,Q){const ue=this.getChildren(R);for(const ce of ue){const se=ce.properties;if(se&&se.cluster?Q+se.point_count<=Y?Q+=se.point_count:Q=this._appendLeaves(P,se.cluster_id,q,Y,Q):Q<Y?Q++:P.push(ce),P.length===q)break}return Q}_addTileFeatures(P,R,q,Y,Q,ue){for(const ce of P){const se=R[ce],he=se.numPoints;let Ae,qe,Me;if(he)Ae=di(se),qe=se.x,Me=se.y;else{const Je=this.points[se.index];Ae=Je.properties,qe=wt(Je.geometry.coordinates[0]),Me=Hi(Je.geometry.coordinates[1])}const Ke={type:1,geometry:[[Math.round(this.options.extent*(qe*Q-q)),Math.round(this.options.extent*(Me*Q-Y))]],tags:Ae};let He;he?He=se.id:this.options.generateId?He=se.index:this.points[se.index].id&&(He=this.points[se.index].id),void 0!==He&&(Ke.id=He),ue.features.push(Ke)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(Math.floor(+P),this.options.maxZoom+1))}_cluster(P,R){const q=[],{radius:Y,extent:Q,reduce:ue,minPoints:ce}=this.options,se=Y/(Q*Math.pow(2,R));for(let he=0;he<P.length;he++){const Ae=P[he];if(Ae.zoom<=R)continue;Ae.zoom=R;const qe=this.trees[R+1],Me=qe.within(Ae.x,Ae.y,se),Ke=Ae.numPoints||1;let He=Ke;for(const Je of Me){const Qe=qe.points[Je];Qe.zoom>R&&(He+=Qe.numPoints||1)}if(He>Ke&&He>=ce){let Je=Ae.x*Ke,Qe=Ae.y*Ke,pt=ue&&Ke>1?this._map(Ae,!0):null;const Tt=(he<<5)+(R+1)+this.points.length;for(const it of Me){const Mt=qe.points[it];if(Mt.zoom<=R)continue;Mt.zoom=R;const Dt=Mt.numPoints||1;Je+=Mt.x*Dt,Qe+=Mt.y*Dt,Mt.parentId=Tt,ue&&(pt||(pt=this._map(Ae,!0)),ue(pt,this._map(Mt)))}Ae.parentId=Tt,q.push(Ti(Je/He,Qe/He,Tt,He,pt))}else if(q.push(Ae),He>1)for(const Je of Me){const Qe=qe.points[Je];Qe.zoom<=R||(Qe.zoom=R,q.push(Qe))}}return q}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,R){if(P.numPoints)return R?un({},P.properties):P.properties;const q=this.points[P.index].properties,Y=this.options.map(q);return R&&Y===q?un({},Y):Y}}function Ti($,P,R,q,Y){return{x:Wi($),y:Wi(P),zoom:1/0,id:R,parentId:-1,numPoints:q,properties:Y}}function _o($,P){const[R,q]=$.geometry.coordinates;return{x:Wi(wt(R)),y:Wi(Hi(q)),zoom:1/0,index:P,parentId:-1}}function Jt($){return{type:"Feature",id:$.id,properties:di($),geometry:{type:"Point",coordinates:[(P=$.x,360*(P-.5)),Wo($.y)]}};var P}function di($){const P=$.numPoints,R=P>=1e4?`${Math.round(P/1e3)}k`:P>=1e3?Math.round(P/100)/10+"k":P;return un(un({},$.properties),{cluster:!0,cluster_id:$.id,point_count:P,point_count_abbreviated:R})}function wt($){return $/360+.5}function Hi($){const P=Math.sin($*Math.PI/180),R=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return R<0?0:R>1?1:R}function Wo($){const P=(180-360*$)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function un($,P){for(const R in P)$[R]=P[R];return $}function cr($){return $.x}function go($){return $.y}function In($,P,R,q){for(var Y,Q=q,ue=R-P>>1,ce=R-P,se=$[P],he=$[P+1],Ae=$[R],qe=$[R+1],Me=P+3;Me<R;Me+=3){var Ke=Ho($[Me],$[Me+1],se,he,Ae,qe);if(Ke>Q)Y=Me,Q=Ke;else if(Ke===Q){var He=Math.abs(Me-ue);He<ce&&(Y=Me,ce=He)}}Q>q&&(Y-P>3&&In($,P,Y,q),$[Y+2]=Q,R-Y>3&&In($,Y,R,q))}function Ho($,P,R,q,Y,Q){var ue=Y-R,ce=Q-q;if(0!==ue||0!==ce){var se=(($-R)*ue+(P-q)*ce)/(ue*ue+ce*ce);se>1?(R=Y,q=Q):se>0&&(R+=ue*se,q+=ce*se)}return(ue=$-R)*ue+(ce=P-q)*ce}function Ei($,P,R,q){var Y={id:void 0===$?null:$,type:P,geometry:R,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var ue=Q.geometry,ce=Q.type;if("Point"===ce||"MultiPoint"===ce||"LineString"===ce)Vn(Q,ue);else if("Polygon"===ce||"MultiLineString"===ce)for(var se=0;se<ue.length;se++)Vn(Q,ue[se]);else if("MultiPolygon"===ce)for(se=0;se<ue.length;se++)for(var he=0;he<ue[se].length;he++)Vn(Q,ue[se][he])}(Y),Y}function Vn($,P){for(var R=0;R<P.length;R+=3)$.minX=Math.min($.minX,P[R]),$.minY=Math.min($.minY,P[R+1]),$.maxX=Math.max($.maxX,P[R]),$.maxY=Math.max($.maxY,P[R+1])}function Pr($,P,R,q){if(P.geometry){var Y=P.geometry.coordinates,Q=P.geometry.type,ue=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),ce=[],se=P.id;if(R.promoteId?se=P.properties[R.promoteId]:R.generateId&&(se=q||0),"Point"===Q)yo(Y,ce);else if("MultiPoint"===Q)for(var he=0;he<Y.length;he++)yo(Y[he],ce);else if("LineString"===Q)Mn(Y,ce,ue,!1);else if("MultiLineString"===Q){if(R.lineMetrics){for(he=0;he<Y.length;he++)Mn(Y[he],ce=[],ue,!1),$.push(Ei(se,"LineString",ce,P.properties));return}kn(Y,ce,ue,!1)}else if("Polygon"===Q)kn(Y,ce,ue,!0);else{if("MultiPolygon"!==Q){if("GeometryCollection"===Q){for(he=0;he<P.geometry.geometries.length;he++)Pr($,{id:se,geometry:P.geometry.geometries[he],properties:P.properties},R,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(he=0;he<Y.length;he++){var Ae=[];kn(Y[he],Ae,ue,!0),ce.push(Ae)}}$.push(Ei(se,Q,ce,P.properties))}}function yo($,P){P.push(Dr($[0])),P.push(zn($[1])),P.push(0)}function Mn($,P,R,q){for(var Y,Q,ue=0,ce=0;ce<$.length;ce++){var se=Dr($[ce][0]),he=zn($[ce][1]);P.push(se),P.push(he),P.push(0),ce>0&&(ue+=q?(Y*he-se*Q)/2:Math.sqrt(Math.pow(se-Y,2)+Math.pow(he-Q,2))),Y=se,Q=he}var Ae=P.length-3;P[2]=1,In(P,0,Ae,R),P[Ae+2]=1,P.size=Math.abs(ue),P.start=0,P.end=P.size}function kn($,P,R,q){for(var Y=0;Y<$.length;Y++){var Q=[];Mn($[Y],Q,R,q),P.push(Q)}}function Dr($){return $/360+.5}function zn($){var P=Math.sin($*Math.PI/180),R=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return R<0?0:R>1?1:R}function Si($,P,R,q,Y,Q,ue,ce){if(q/=P,Q>=(R/=P)&&ue<q)return $;if(ue<R||Q>=q)return null;for(var se=[],he=0;he<$.length;he++){var Ae=$[he],qe=Ae.geometry,Me=Ae.type,Ke=0===Y?Ae.minX:Ae.minY,He=0===Y?Ae.maxX:Ae.maxY;if(Ke>=R&&He<q)se.push(Ae);else if(!(He<R||Ke>=q)){var Je=[];if("Point"===Me||"MultiPoint"===Me)xo(qe,Je,R,q,Y);else if("LineString"===Me)ur(qe,Je,R,q,Y,!1,ce.lineMetrics);else if("MultiLineString"===Me)qn(qe,Je,R,q,Y,!1);else if("Polygon"===Me)qn(qe,Je,R,q,Y,!0);else if("MultiPolygon"===Me)for(var Qe=0;Qe<qe.length;Qe++){var pt=[];qn(qe[Qe],pt,R,q,Y,!0),pt.length&&Je.push(pt)}if(Je.length){if(ce.lineMetrics&&"LineString"===Me){for(Qe=0;Qe<Je.length;Qe++)se.push(Ei(Ae.id,Me,Je[Qe],Ae.tags));continue}"LineString"!==Me&&"MultiLineString"!==Me||(1===Je.length?(Me="LineString",Je=Je[0]):Me="MultiLineString"),"Point"!==Me&&"MultiPoint"!==Me||(Me=3===Je.length?"Point":"MultiPoint"),se.push(Ei(Ae.id,Me,Je,Ae.tags))}}}return se.length?se:null}function xo($,P,R,q,Y){for(var Q=0;Q<$.length;Q+=3){var ue=$[Q+Y];ue>=R&&ue<=q&&(P.push($[Q]),P.push($[Q+1]),P.push($[Q+2]))}}function ur($,P,R,q,Y,Q,ue){for(var ce,se,he=jn($),Ae=0===Y?Jo:Gn,qe=$.start,Me=0;Me<$.length-3;Me+=3){var Ke=$[Me],He=$[Me+1],Je=$[Me+2],Qe=$[Me+3],pt=$[Me+4],Tt=0===Y?Ke:He,it=0===Y?Qe:pt,Mt=!1;ue&&(ce=Math.sqrt(Math.pow(Ke-Qe,2)+Math.pow(He-pt,2))),Tt<R?it>R&&(se=Ae(he,Ke,He,Qe,pt,R),ue&&(he.start=qe+ce*se)):Tt>q?it<q&&(se=Ae(he,Ke,He,Qe,pt,q),ue&&(he.start=qe+ce*se)):vo(he,Ke,He,Je),it<R&&Tt>=R&&(se=Ae(he,Ke,He,Qe,pt,R),Mt=!0),it>q&&Tt<=q&&(se=Ae(he,Ke,He,Qe,pt,q),Mt=!0),!Q&&Mt&&(ue&&(he.end=qe+ce*se),P.push(he),he=jn($)),ue&&(qe+=ce)}var Dt=$.length-3;Ke=$[Dt],He=$[Dt+1],Je=$[Dt+2],(Tt=0===Y?Ke:He)>=R&&Tt<=q&&vo(he,Ke,He,Je),Dt=he.length-3,Q&&Dt>=3&&(he[Dt]!==he[0]||he[Dt+1]!==he[1])&&vo(he,he[0],he[1],he[2]),he.length&&P.push(he)}function jn($){var P=[];return P.size=$.size,P.start=$.start,P.end=$.end,P}function qn($,P,R,q,Y,Q){for(var ue=0;ue<$.length;ue++)ur($[ue],P,R,q,Y,Q,!1)}function vo($,P,R,q){$.push(P),$.push(R),$.push(q)}function Jo($,P,R,q,Y,Q){var ue=(Q-P)/(q-P);return $.push(Q),$.push(R+(Y-R)*ue),$.push(1),ue}function Gn($,P,R,q,Y,Q){var ue=(Q-R)/(Y-R);return $.push(P+(q-P)*ue),$.push(Q),$.push(1),ue}function $n($,P){for(var R=[],q=0;q<$.length;q++){var Y,Q=$[q],ue=Q.type;if("Point"===ue||"MultiPoint"===ue||"LineString"===ue)Y=Lr(Q.geometry,P);else if("MultiLineString"===ue||"Polygon"===ue){Y=[];for(var ce=0;ce<Q.geometry.length;ce++)Y.push(Lr(Q.geometry[ce],P))}else if("MultiPolygon"===ue)for(Y=[],ce=0;ce<Q.geometry.length;ce++){for(var se=[],he=0;he<Q.geometry[ce].length;he++)se.push(Lr(Q.geometry[ce][he],P));Y.push(se)}R.push(Ei(Q.id,ue,Y,Q.tags))}return R}function Lr($,P){var R=[];R.size=$.size,void 0!==$.start&&(R.start=$.start,R.end=$.end);for(var q=0;q<$.length;q+=3)R.push($[q]+P,$[q+1],$[q+2]);return R}function hr($,P){if($.transformed)return $;var R,q,Y,Q=1<<$.z,ue=$.x,ce=$.y;for(R=0;R<$.features.length;R++){var se=$.features[R],he=se.geometry,Ae=se.type;if(se.geometry=[],1===Ae)for(q=0;q<he.length;q+=2)se.geometry.push(hn(he[q],he[q+1],P,Q,ue,ce));else for(q=0;q<he.length;q++){var qe=[];for(Y=0;Y<he[q].length;Y+=2)qe.push(hn(he[q][Y],he[q][Y+1],P,Q,ue,ce));se.geometry.push(qe)}}return $.transformed=!0,$}function hn($,P,R,q,Y,Q){return[Math.round(R*($*q-Y)),Math.round(R*(P*q-Q))]}function Rr($,P,R,q,Y){for(var Q=P===Y.maxZoom?0:Y.tolerance/((1<<P)*Y.extent),ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:q,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<$.length;ce++){ue.numFeatures++,Yo(ue,$[ce],Q,Y);var se=$[ce].minX,he=$[ce].minY,Ae=$[ce].maxX,qe=$[ce].maxY;se<ue.minX&&(ue.minX=se),he<ue.minY&&(ue.minY=he),Ae>ue.maxX&&(ue.maxX=Ae),qe>ue.maxY&&(ue.maxY=qe)}return ue}function Yo($,P,R,q){var Y=P.geometry,Q=P.type,ue=[];if("Point"===Q||"MultiPoint"===Q)for(var ce=0;ce<Y.length;ce+=3)ue.push(Y[ce]),ue.push(Y[ce+1]),$.numPoints++,$.numSimplified++;else if("LineString"===Q)Br(ue,Y,$,R,!1,!1);else if("MultiLineString"===Q||"Polygon"===Q)for(ce=0;ce<Y.length;ce++)Br(ue,Y[ce],$,R,"Polygon"===Q,0===ce);else if("MultiPolygon"===Q)for(var se=0;se<Y.length;se++){var he=Y[se];for(ce=0;ce<he.length;ce++)Br(ue,he[ce],$,R,!0,0===ce)}if(ue.length){var Ae=P.tags||null;if("LineString"===Q&&q.lineMetrics){for(var qe in Ae={},P.tags)Ae[qe]=P.tags[qe];Ae.mapbox_clip_start=Y.start/Y.size,Ae.mapbox_clip_end=Y.end/Y.size}var Me={geometry:ue,type:"Polygon"===Q||"MultiPolygon"===Q?3:"LineString"===Q||"MultiLineString"===Q?2:1,tags:Ae};null!==P.id&&(Me.id=P.id),$.features.push(Me)}}function Br($,P,R,q,Y,Q){var ue=q*q;if(q>0&&P.size<(Y?ue:q))R.numPoints+=P.length/3;else{for(var ce=[],se=0;se<P.length;se+=3)(0===q||P[se+2]>ue)&&(R.numSimplified++,ce.push(P[se]),ce.push(P[se+1])),R.numPoints++;Y&&function(he,Ae){for(var qe=0,Me=0,Ke=he.length,He=Ke-2;Me<Ke;He=Me,Me+=2)qe+=(he[Me]-he[He])*(he[Me+1]+he[He+1]);if(qe>0===Ae)for(Me=0,Ke=he.length;Me<Ke/2;Me+=2){var Je=he[Me],Qe=he[Me+1];he[Me]=he[Ke-2-Me],he[Me+1]=he[Ke-1-Me],he[Ke-2-Me]=Je,he[Ke-1-Me]=Qe}}(ce,Q),$.push(ce)}}function pr($,P){var R=(P=this.options=function(Y,Q){for(var ue in Q)Y[ue]=Q[ue];return Y}(Object.create(this.options),P)).debug;if(R&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y,Q,ue,ce,se,he,q=function(Y,Q){var ue=[];if("FeatureCollection"===Y.type)for(var ce=0;ce<Y.features.length;ce++)Pr(ue,Y.features[ce],Q,ce);else Pr(ue,"Feature"===Y.type?Y:{geometry:Y},Q);return ue}($,P);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ce=Y=q,se=Si(Y,1,-1-(ue=(Q=P).buffer/Q.extent),ue,0,-1,2,Q),he=Si(Y,1,1-ue,2+ue,0,-1,2,Q),(se||he)&&(ce=Si(Y,1,-ue,1+ue,0,-1,2,Q)||[],se&&(ce=$n(se,1).concat(ce)),he&&(ce=ce.concat($n(he,-1)))),(q=ce).length&&this.splitTile(q,0,0,0),R&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ri($,P,R){return 32*((1<<$)*R+P)+$}function dr($,P){const R=$.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const q=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!q)return P(null,null);const Y=new ho(q.features);let Q=on.exports(Y);0===Q.byteOffset&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),P(null,{vectorTile:Y,rawData:Q.buffer})}pr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pr.prototype.splitTile=function($,P,R,q,Y,Q,ue){for(var ce=[$,P,R,q],se=this.options,he=se.debug;ce.length;){q=ce.pop(),R=ce.pop(),P=ce.pop(),$=ce.pop();var Ae=1<<P,qe=Ri(P,R,q),Me=this.tiles[qe];if(!Me&&(he>1&&console.time("creation"),Me=this.tiles[qe]=Rr($,P,R,q,se),this.tileCoords.push({z:P,x:R,y:q}),he)){he>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,R,q,Me.numFeatures,Me.numPoints,Me.numSimplified),console.timeEnd("creation"));var Ke="z"+P;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(Me.source=$,Y){if(P===se.maxZoom||P===Y)continue;var He=1<<Y-P;if(R!==Math.floor(Q/He)||q!==Math.floor(ue/He))continue}else if(P===se.indexMaxZoom||Me.numPoints<=se.indexMaxPoints)continue;if(Me.source=null,0!==$.length){he>1&&console.time("clipping");var Je,Qe,pt,Tt,it,Mt,Dt=.5*se.buffer/se.extent,Xn=.5-Dt,Pn=.5+Dt,ve=1+Dt;Je=Qe=pt=Tt=null,it=Si($,Ae,R-Dt,R+Pn,0,Me.minX,Me.maxX,se),Mt=Si($,Ae,R+Xn,R+ve,0,Me.minX,Me.maxX,se),$=null,it&&(Je=Si(it,Ae,q-Dt,q+Pn,1,Me.minY,Me.maxY,se),Qe=Si(it,Ae,q+Xn,q+ve,1,Me.minY,Me.maxY,se),it=null),Mt&&(pt=Si(Mt,Ae,q-Dt,q+Pn,1,Me.minY,Me.maxY,se),Tt=Si(Mt,Ae,q+Xn,q+ve,1,Me.minY,Me.maxY,se),Mt=null),he>1&&console.timeEnd("clipping"),ce.push(Je||[],P+1,2*R,2*q),ce.push(Qe||[],P+1,2*R,2*q+1),ce.push(pt||[],P+1,2*R+1,2*q),ce.push(Tt||[],P+1,2*R+1,2*q+1)}}},pr.prototype.getTile=function($,P,R){var q=this.options,Y=q.extent,Q=q.debug;if($<0||$>24)return null;var ue=1<<$,ce=Ri($,P=(P%ue+ue)%ue,R);if(this.tiles[ce])return hr(this.tiles[ce],Y);Q>1&&console.log("drilling down to z%d-%d-%d",$,P,R);for(var se,he=$,Ae=P,qe=R;!se&&he>0;)he--,Ae=Math.floor(Ae/2),qe=Math.floor(qe/2),se=this.tiles[Ri(he,Ae,qe)];return se&&se.source?(Q>1&&console.log("found parent tile z%d-%d-%d",he,Ae,qe),Q>1&&console.time("drilling down"),this.splitTile(se.source,he,Ae,qe,$,P,R),Q>1&&console.timeEnd("drilling down"),this.tiles[ce]?hr(this.tiles[ce],Y):null):null};class fr extends a.VectorTileWorkerSource{constructor(P,R,q,Y,Q){super(P,R,q,Y,dr),Q&&(this.loadGeoJSON=Q)}loadData(P,R){const q=P&&P.request,Y=q&&q.collectResourceTiming;this.loadGeoJSON(P,(Q,ue)=>{if(Q||!ue)return R(Q);if("object"!=typeof ue)return R(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));{_t(ue,!0);try{if(P.filter){const se=a.createExpression(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===se.result)throw new Error(se.value.map(Ae=>`${Ae.key}: ${Ae.message}`).join(", "));const he=ue.features.filter(Ae=>se.value.evaluate({zoom:0},Ae));ue={type:"FeatureCollection",features:he}}this._geoJSONIndex=P.cluster?new zr(function({superclusterOptions:se,clusterProperties:he}){if(!he||!se)return se;const Ae={},qe={},Me={accumulated:null,zoom:0},Ke={properties:null},He=Object.keys(he);for(const Je of He){const[Qe,pt]=he[Je],Tt=a.createExpression(pt),it=a.createExpression("string"==typeof Qe?[Qe,["accumulated"],["get",Je]]:Qe);Ae[Je]=Tt.value,qe[Je]=it.value}return se.map=Je=>{Ke.properties=Je;const Qe={};for(const pt of He)Qe[pt]=Ae[pt].evaluate(Me,Ke);return Qe},se.reduce=(Je,Qe)=>{Ke.properties=Qe;for(const pt of He)Me.accumulated=Je[pt],Je[pt]=qe[pt].evaluate(Me,Ke)},se}(P)).load(ue.features):new pr(se=ue,P.geojsonVtOptions)}catch(se){return R(se)}this.loaded={};const ce={};if(Y){const se=a.getPerformanceMeasurement(q);se&&(ce.resourceTiming={},ce.resourceTiming[P.source]=JSON.parse(JSON.stringify(se)))}R(null,ce)}var se})}reloadTile(P,R){const q=this.loaded;return q&&q[P.uid]?super.reloadTile(P,R):this.loadTile(P,R)}loadGeoJSON(P,R){if(P.request)a.getJSON(P.request,R);else{if("string"!=typeof P.data)return R(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));try{return R(null,JSON.parse(P.data))}catch{return R(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(P,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch(q){R(q)}}getClusterChildren(P,R){try{R(null,this._geoJSONIndex.getChildren(P.clusterId))}catch(q){R(q)}}getClusterLeaves(P,R){try{R(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch(q){R(q)}}}class pn{constructor(P){this.self=P,this.actor=new a.Actor(P,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:fr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,q)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=q},this.self.registerRTLTextPlugin=R=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=R.applyArabicShaping,a.plugin.processBidirectionalText=R.processBidirectionalText,a.plugin.processStyledBidirectionalText=R.processStyledBidirectionalText}}clearCaches(P,R,q){delete this.layerIndexes[P],delete this.availableImages[P],delete this.workerSources[P],delete this.demWorkerSources[P],q()}checkIfReady(P,R,q){q()}setReferrer(P,R){this.referrer=R}spriteLoaded(P,R){this.isSpriteLoaded[P]=R;for(const q in this.workerSources[P]){const Y=this.workerSources[P][q];for(const Q in Y)Y[Q]instanceof a.VectorTileWorkerSource&&(Y[Q].isSpriteLoaded=R,Y[Q].fire(new a.Event("isSpriteLoaded")))}}setImages(P,R,q){this.availableImages[P]=R;for(const Y in this.workerSources[P]){const Q=this.workerSources[P][Y];for(const ue in Q)Q[ue].availableImages=R}q()}enableTerrain(P,R,q){this.terrain=R,q()}setProjection(P,R){this.projections[P]=a.getProjection(R)}setLayers(P,R,q){this.getLayerIndex(P).replace(R),q()}updateLayers(P,R,q){this.getLayerIndex(P).update(R.layers,R.removedIds),q()}loadTile(P,R,q){const Y=this.enableTerrain?a.extend({enableTerrain:this.terrain},R):R;Y.projection=this.projections[P]||this.defaultProjection,this.getWorkerSource(P,R.type,R.source).loadTile(Y,q)}loadDEMTile(P,R,q){const Y=this.enableTerrain?a.extend({buildQuadTree:this.terrain},R):R;this.getDEMWorkerSource(P,R.source).loadTile(Y,q)}reloadTile(P,R,q){const Y=this.enableTerrain?a.extend({enableTerrain:this.terrain},R):R;Y.projection=this.projections[P]||this.defaultProjection,this.getWorkerSource(P,R.type,R.source).reloadTile(Y,q)}abortTile(P,R,q){this.getWorkerSource(P,R.type,R.source).abortTile(R,q)}removeTile(P,R,q){this.getWorkerSource(P,R.type,R.source).removeTile(R,q)}removeSource(P,R,q){if(!this.workerSources[P]||!this.workerSources[P][R.type]||!this.workerSources[P][R.type][R.source])return;const Y=this.workerSources[P][R.type][R.source];delete this.workerSources[P][R.type][R.source],void 0!==Y.removeSource?Y.removeSource(R,q):q()}loadWorkerSource(P,R,q){try{this.self.importScripts(R.url),q()}catch(Y){q(Y.toString())}}syncRTLPluginState(P,R,q){try{a.plugin.setState(R);const Y=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&null!=Y){this.self.importScripts(Y);const Q=a.plugin.isParsed();q(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),Q)}}catch(Y){q(Y.toString())}}getAvailableImages(P){let R=this.availableImages[P];return R||(R=[]),R}getLayerIndex(P){let R=this.layerIndexes[P];return R||(R=this.layerIndexes[P]=new rn),R}getWorkerSource(P,R,q){return this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][R]||(this.workerSources[P][R]={}),this.workerSources[P][R][q]||(this.workerSources[P][R][q]=new this.workerSourceTypes[R]({send:(Q,ue,ce,se,he,Ae)=>{this.actor.send(Q,ue,ce,P,he,Ae)},scheduler:this.actor.scheduler},this.getLayerIndex(P),this.getAvailableImages(P),this.isSpriteLoaded[P])),this.workerSources[P][R][q]}getDEMWorkerSource(P,R){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][R]||(this.demWorkerSources[P][R]=new lt),this.demWorkerSources[P][R]}enforceCacheSizeLimit(P,R){a.enforceCacheSizeLimit(R)}getWorkerPerformanceMetrics(P,R,q){q(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new pn(self)),pn}),zt(0,function(a){function h(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let o=0;o<l.length;o++)if(!h(l[o],n[o]))return!1;return!0}if("object"==typeof l&&null!==l&&null!==n){if("object"!=typeof n||Object.keys(l).length!==Object.keys(n).length)return!1;for(const o in l)if(!h(l[o],n[o]))return!1;return!0}return l===n}var Cn=rn;function rn(l){return n=l,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,d,m=new Blob([""],{type:"text/javascript"}),y=URL.createObjectURL(m);try{d=new Worker(y),u=!0}catch{u=!1}return d&&d.terminate(),URL.revokeObjectURL(y),u}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var u=document.createElement("canvas");u.width=u.height=1;var d=u.getContext("2d");if(!d)return!1;var m=d.getImageData(0,0,1,1);return m&&m.width===u.width}()||(void 0===lt[o=n&&n.failIfMajorPerformanceCaveat]&&(lt[o]=function(u){var d,y,b,w,m=(y=u,b=document.createElement("canvas"),(w=Object.create(rn.webGLContextAttributes)).failIfMajorPerformanceCaveat=y,b.getContext("webgl",w)||b.getContext("experimental-webgl",w));if(!m)return!1;try{d=m.createShader(m.VERTEX_SHADER)}catch{return!1}return!(!d||m.isContextLost())&&(m.shaderSource(d,"void main() {}"),m.compileShader(d),!0===m.getShaderParameter(d,m.COMPILE_STATUS))}(o)),!lt[o]||document.documentMode));var n,o}var lt={};function _t(l,n,o){const u=a.window.document.createElement(l);return void 0!==n&&(u.className=n),o&&o.appendChild(u),u}function wi(l,n,o){const u=a.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(const d of Object.keys(n))u.setAttributeNS(null,d,n[d]);return o&&o.appendChild(u),u}rn.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ai=a.window.document&&a.window.document.documentElement.style,An=Ai&&void 0!==Ai.userSelect?"userSelect":"WebkitUserSelect";let uo;function ho(){Ai&&An&&(uo=Ai[An],Ai[An]="none")}function on(){Ai&&An&&(Ai[An]=uo)}function or(l){l.preventDefault(),l.stopPropagation(),a.window.removeEventListener("click",or,!0)}function sn(){a.window.addEventListener("click",or,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",or,!0)},0)}function Oe(l,n){const o=l.getBoundingClientRect();return $o(l,o,n)}function an(l,n){const o=l.getBoundingClientRect(),u=[];for(let d=0;d<n.length;d++)u.push($o(l,o,n[d]));return u}function sr(l){return void 0!==a.window.InstallTrigger&&2===l.button&&l.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function $o(l,n,o){const u=l.offsetWidth===n.width?1:l.offsetWidth/n.width;return new a.pointGeometry((o.clientX-n.left)*u,(o.clientY-n.top)*u)}function vt(l,n){var o=n[0],u=n[1],d=n[2],m=n[3],y=o*m-d*u;return y?(l[0]=m*(y=1/y),l[1]=-u*y,l[2]=-d*y,l[3]=o*y,l):null}function li(l){const{userImage:n}=l;return!!(n&&n.render&&n.render())&&(l.data.replace(new Uint8Array(n.data.buffer)),!0)}class Xo extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:o,callback:u}of this.requestors)this._notify(o,u);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,o){this._validate(n,o)&&(this.images[n]=o)}_validate(n,o){let u=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new a.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),u=!1),u}_validateStretch(n,o){if(!n)return!0;let u=0;for(const d of n){if(d[0]<u||d[1]<d[0]||o<d[1])return!1;u=d[1]}return!0}_validateContent(n,o){return!(n&&(4!==n.length||n[0]<0||o.data.width<n[0]||n[1]<0||o.data.height<n[1]||n[2]<0||o.data.width<n[2]||n[3]<0||o.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,o){o.version=this.images[n].version+1,this.images[n]=o,this.updatedImages[n]=!0}removeImage(n){const o=this.images[n];delete this.images[n],delete this.patterns[n],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,o){let u=!0;if(!this.isLoaded())for(const d of n)this.images[d]||(u=!1);this.isLoaded()||u?this._notify(n,o):this.requestors.push({ids:n,callback:o})}_notify(n,o){const u={};for(const d of n){this.images[d]||this.fire(new a.Event("styleimagemissing",{id:d}));const m=this.images[d];m?u[d]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:Boolean(m.userImage&&m.userImage.render)}:a.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,u)}getPixelSize(){const{width:n,height:o}=this.atlasImage;return{width:n,height:o}}getPattern(n){const o=this.patterns[n],u=this.getImage(n);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},m=new a.ImagePosition(d,u);this.patterns[n]={bin:d,position:m}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const o=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(n,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const m in this.patterns)n.push(this.patterns[m].bin);const{w:o,h:u}=a.potpack(n),d=this.atlasImage;d.resize({width:o||1,height:u||1});for(const m in this.patterns){const{bin:y}=this.patterns[m],b=y.x+1,w=y.y+1,I=this.images[m].data,M=I.width,D=I.height;a.RGBAImage.copy(I,d,{x:0,y:0},{x:b,y:w},{width:M,height:D}),a.RGBAImage.copy(I,d,{x:0,y:D-1},{x:b,y:w-1},{width:M,height:1}),a.RGBAImage.copy(I,d,{x:0,y:0},{x:b,y:w+D},{width:M,height:1}),a.RGBAImage.copy(I,d,{x:M-1,y:0},{x:b-1,y:w},{width:1,height:D}),a.RGBAImage.copy(I,d,{x:0,y:0},{x:b+M,y:w},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const o of n){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.images[o];li(u)&&this.updateImage(o,u)}}}const po=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(l,n){return function([o,u,d]){const m=a.degToRad(u+90),y=a.degToRad(d);return{x:o*Math.cos(m)*Math.sin(y),y:o*Math.sin(m)*Math.sin(y),z:o*Math.cos(y),azimuthal:u,polar:d}}(l.expression.evaluate(n))}interpolate(l,n,o){return{x:a.number(l.x,n.x,o),y:a.number(l.y,n.y,o),z:a.number(l.z,n.z,o),azimuthal:a.number(l.azimuthal,n.azimuthal,o),polar:a.number(l.polar,n.polar,o)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),Ir="-transition";class fo extends a.Evented{constructor(n){super(),this._transitionable=new a.Transitionable(po),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,o={}){if(!this._validate(a.validateLight,n,o))for(const u in n){const d=n[u];a.endsWith(u,Ir)?this._transitionable.setTransition(u.slice(0,-Ir.length),d):this._transitionable.setValue(u,d)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,u){return(!u||!1!==u.validate)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const yt=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),Mr="-transition";class Gt extends a.Evented{constructor(n,o){super(),this._transitionable=new a.Transitionable(yt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(n){for(const o in n){const u=n[o];a.endsWith(o,Mr)?this._transitionable.setTransition(o.slice(0,-Mr.length),u):this._transitionable.setValue(o,u)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function Nn(l,n,o,u){const d=a.smoothstep(45,65,o),[m,y]=pi(l,u),b=a.length(n);let w=1-Math.min(1,Math.exp((b-m)/(y-m)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*d*l.alpha}function pi(l,n){const o=.5/Math.tan(.5*n);return[l.range[0]+o,l.range[1]+o]}const Kt=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])}),kr="-transition";class mo extends a.Evented{constructor(n,o){super(),this._transitionable=new a.Transitionable(Kt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const n=this._transform,o="globe"===n.projection.name,u=a.globeToMercatorTransition(n.zoom),d=this.properties.get("range"),m=[.5,3];return{range:o?[a.number(m[0],d[0],u),a.number(m[1],d[1],u)]:d,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,o={}){if(!this._validate(a.validateFog,n,o)){for(const u of Object.keys(a.spec.fog))n&&void 0===n[u]&&(n[u]=a.spec.fog[u].default);for(const u in n){const d=n[u];a.endsWith(u,kr)?this._transitionable.setTransition(u.slice(0,-kr.length),d):this._transitionable.setValue(u,d)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:a.smoothstep(45,65,n))*o.a}getOpacityAtLatLng(n,o){return this._transform.projection.supportsFog?function(u,d,m){const y=a.MercatorCoordinate.fromLngLat(d),b=m.elevation?m.elevation.getAtPointOrZero(y):0,w=[y.x,y.y,b];return a.transformMat4(w,w,m.mercatorFogMatrix),Nn(u,w,m.pitch,m._fov)}(this.state,n,o):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?pi(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,o,u){return(!u||!1!==u.validate)&&a.emitValidationErrors(this,n.call(a.validateStyle,a.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Xi{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const u=this.workerPool.acquire(this.id);for(let d=0;d<u.length;d++){const m=new Xi.Actor(u[d],o,this.id);m.name=`Worker ${d}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,u){a.asyncAll(this.actors,(d,m)=>{d.send(n,o,m)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function cn(l,n,o){return n*(a.EXTENT/(l.tileSize*Math.pow(2,o-l.tileID.overscaledZ)))}Xi.Actor=a.Actor;class ar{constructor(n,o,u,d){this.screenBounds=n,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(n,o){let u,d;if(n instanceof a.pointGeometry||"number"==typeof n[0]){const m=a.pointGeometry.convert(n);u=[m],d=o.isPointAboveHorizon(m)}else{const m=a.pointGeometry.convert(n[0]),y=a.pointGeometry.convert(n[1]);u=[m,y],d=a.polygonizeBounds(m,y).every(b=>o.isPointAboveHorizon(b))}return new ar(u,o.getCameraPoint(),d,o)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return a.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const o=this.screenBounds[0],u=1===this.screenBounds.length?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],d=a.polygonizeBounds(o,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<u.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?d[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(d[3]=this.cameraPoint)),a.bufferConvexPolygon(d,n)}bufferedCameraGeometryGlobe(n){const o=this.screenBounds[0],u=1===this.screenBounds.length?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],d=a.polygonizeBounds(o,u,n),m=this.cameraPoint.clone();switch(3*((m.y>o.y)+(m.y>u.y))+((m.x>o.x)+(m.x>u.x))){case 0:d[0]=m,d[4]=m.clone();break;case 1:d.splice(1,0,m);break;case 2:d[1]=m;break;case 3:d.splice(4,0,m);break;case 5:d.splice(2,0,m);break;case 6:d[3]=m;break;case 7:d.splice(3,0,m);break;case 8:d[2]=m}return d}containsTile(n,o,u,d=0){const m=n.queryPadding/o._pixelsPerMercatorPixel+1,y=u?this._bufferedCameraMercator(m,o):this._bufferedScreenMercator(m,o);let b=n.tileID.wrap+(y.unwrapped?d:0);const w=y.polygon.map(Z=>a.getTilePoint(n.tileTransform,Z,b));if(!a.polygonIntersectsBox(w,0,0,a.EXTENT,a.EXTENT))return;b=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?d:0);const I=this.screenGeometryMercator.polygon.map(Z=>a.getTileVec3(n.tileTransform,Z,b)),M=I.map(Z=>new a.pointGeometry(Z[0],Z[1])),D=o.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),B=a.getTileVec3(n.tileTransform,D,b),V=I.map(Z=>{const F=a.sub(Z,Z,B);return a.normalize(F,F),new a.Ray(B,F)}),U=cn(n,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:M,tilespaceRays:V,bufferedTilespaceGeometry:w,bufferedTilespaceBounds:(j=a.getBounds(w),j.min.x=a.clamp(j.min.x,0,a.EXTENT),j.min.y=a.clamp(j.min.y,0,a.EXTENT),j.max.x=a.clamp(j.max.x,0,a.EXTENT),j.max.y=a.clamp(j.max.y,0,a.EXTENT),j),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:U};var j}_bufferedScreenMercator(n,o){const u=Sn(n);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let d;return d="globe"===o.projection.name?this._projectAndResample(this.bufferedScreenGeometry(n),o):{polygon:this.bufferedScreenGeometry(n).map(m=>o.pointCoordinate3D(m)),unwrapped:!0},this._screenRaycastCache[u]=d,d}}_bufferedCameraMercator(n,o){const u=Sn(n);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let d;return d="globe"===o.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),o):{polygon:this.bufferedCameraGeometry(n).map(m=>o.pointCoordinate3D(m)),unwrapped:!0},this._cameraRaycastCache[u]=d,d}}_projectAndResample(n,o){const u=function(m,y){const b=a.multiply([],y.pixelMatrix,y.globeMatrix),w=[0,-a.GLOBE_RADIUS,0,1],I=[0,a.GLOBE_RADIUS,0,1],M=[0,0,0,1];a.transformMat4$1(w,w,b),a.transformMat4$1(I,I,b),a.transformMat4$1(M,M,b);const D=new a.pointGeometry(w[0]/w[3],w[1]/w[3]),B=new a.pointGeometry(I[0]/I[3],I[1]/I[3]),V=a.polygonContainsPoint(m,D)&&w[3]<M[3],U=a.polygonContainsPoint(m,B)&&I[3]<M[3];if(!V&&!U)return null;const j=function(re,pe,ge){for(let me=1;me<re.length;me++){const ze=Wi(pe.pointCoordinate3D(re[me-1]).x),le=Wi(pe.pointCoordinate3D(re[me]).x);if(ge<0){if(ze<le)return{idx:me,t:-ze/(le-1-ze)}}else if(le<ze)return{idx:me,t:(1-ze)/(le+1-ze)}}return null}(m,y,V?-1:1);if(!j)return null;const{idx:Z,t:F}=j;let G=Z>1?lr(m.slice(0,Z),y):[],N=Z<m.length?lr(m.slice(Z),y):[];G=G.map(re=>new a.pointGeometry(Wi(re.x),re.y)),N=N.map(re=>new a.pointGeometry(Wi(re.x),re.y));const te=[...G];0===te.length&&te.push(N[N.length-1]);const ie=a.number(te[te.length-1].y,(0===N.length?G[0]:N[0]).y,F);let J;return J=V?[new a.pointGeometry(0,ie),new a.pointGeometry(0,0),new a.pointGeometry(1,0),new a.pointGeometry(1,ie)]:[new a.pointGeometry(1,ie),new a.pointGeometry(1,1),new a.pointGeometry(0,1),new a.pointGeometry(0,ie)],te.push(...J),0===N.length?te.push(G[0]):te.push(...N),{polygon:te.map(re=>new a.MercatorCoordinate(re.x,re.y)),unwrapped:!1}}(n,o);if(u)return u;const d=function(m,y){let b=!1,w=-1/0,I=0;for(let D=0;D<m.length-1;D++)m[D].x>w&&(w=m[D].x,I=D);for(let D=0;D<m.length-1;D++){const B=(I+D)%(m.length-1),V=m[B],U=m[B+1];Math.abs(V.x-U.x)>.5&&(V.x<U.x?(V.x+=1,0===B&&(m[m.length-1].x+=1)):(U.x+=1,B+1===m.length-1&&(m[0].x+=1)),b=!0)}const M=a.mercatorXfromLng(y.center.lng);return b&&M<Math.abs(M-1)&&m.forEach(D=>{D.x-=1}),{polygon:m,unwrapped:b}}(lr(n,o).map(m=>new a.pointGeometry(Wi(m.x),m.y)),o);return{polygon:d.polygon.map(m=>new a.MercatorCoordinate(m.x,m.y)),unwrapped:d.unwrapped}}}function lr(l,n){return a.resample(l,o=>{const u=n.pointCoordinate3D(o);o.x=u.x,o.y=u.y},1/256)}function Wi(l){return l<0?1+l%1:l%1}function Sn(l){return 100*l|0}function zr(l,n,o,u,d){const m=function(y,b){if(y)return d(y);if(b){l.url&&b.tiles&&l.tiles&&delete l.tiles;const w=a.pick(a.extend(b,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(w.vectorLayers=b.vector_layers,w.vectorLayerIds=w.vectorLayers.map(I=>I.id)),w.tiles=n.canonicalizeTileset(w,l.url),d(null,w)}};return l.url?a.getJSON(n.transformRequest(n.normalizeSourceURL(l.url,null,o,u),a.ResourceType.Source),m):a.exported.frame(()=>m(null,l))}class Ti{constructor(n,o,u){this.bounds=a.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const o=Math.pow(2,n.z),u=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*o),d=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*o),m=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*o),y=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*o);return n.x>=u&&n.x<m&&n.y>=d&&n.y<y}}class _o{constructor(n,o,u){this.context=n;const d=n.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Jt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class di{constructor(n,o,u,d){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.context=n;const m=n.gl;this.buffer=m.createBuffer(),n.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,o){for(let u=0;u<this.attributes.length;u++){const d=o.attributes[this.attributes[u].name];void 0!==d&&n.enableVertexAttribArray(d)}}setVertexAttribPointers(n,o,u){for(let d=0;d<this.attributes.length;d++){const m=this.attributes[d],y=o.attributes[m.name];void 0!==y&&n.vertexAttribPointer(y,m.components,n[Jt[m.type]],!1,this.itemSize,m.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class wt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hi extends wt{getDefault(){return a.Color.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Wo extends wt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class un extends wt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class cr extends wt{getDefault(){return[!0,!0,!0,!0]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class go extends wt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class In extends wt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Ho extends wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const o=this.current;(n.func!==o.func||n.ref!==o.ref||n.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Ei extends wt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Vn extends wt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=n,this.dirty=!1}}class Pr extends wt{getDefault(){return[0,1]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class yo extends wt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=n,this.dirty=!1}}class Mn extends wt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class kn extends wt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.BLEND):o.disable(o.BLEND),this.current=n,this.dirty=!1}}class Dr extends wt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class zn extends wt{getDefault(){return a.Color.transparent}set(n){const o=this.current;(n.r!==o.r||n.g!==o.g||n.b!==o.b||n.a!==o.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Si extends wt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class xo extends wt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;n?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=n,this.dirty=!1}}class ur extends wt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class jn extends wt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class qn extends wt{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class vo extends wt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Jo extends wt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const o=this.current;(n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2]||n[3]!==o[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Gn extends wt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class $n extends wt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Lr extends wt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class hr extends wt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class hn extends wt{getDefault(){return null}set(n){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Rr extends wt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Yo extends wt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Br extends wt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class pr extends wt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ri extends wt{constructor(n,o){super(n),this.context=n,this.parent=o}getDefault(){return null}}class dr extends Ri{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class fr extends Ri{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class pn extends fr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ${constructor(n,o,u,d){this.context=n,this.width=o,this.height=u;const m=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new dr(n,m),d&&(this.depthAttachment=new fr(n,m))}destroy(){const n=this.context.gl,o=this.colorAttachment.get();if(o&&n.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&n.deleteRenderbuffer(u)}n.deleteFramebuffer(this.framebuffer)}}class P{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Hi(this),this.clearDepth=new Wo(this),this.clearStencil=new un(this),this.colorMask=new cr(this),this.depthMask=new go(this),this.stencilMask=new In(this),this.stencilFunc=new Ho(this),this.stencilOp=new Ei(this),this.stencilTest=new Vn(this),this.depthRange=new Pr(this),this.depthTest=new yo(this),this.depthFunc=new Mn(this),this.blend=new kn(this),this.blendFunc=new Dr(this),this.blendColor=new zn(this),this.blendEquation=new Si(this),this.cullFace=new xo(this),this.cullFaceSide=new ur(this),this.frontFace=new jn(this),this.program=new qn(this),this.activeTexture=new vo(this),this.viewport=new Jo(this),this.bindFramebuffer=new Gn(this),this.bindRenderbuffer=new $n(this),this.bindTexture=new Lr(this),this.bindVertexBuffer=new hr(this),this.bindElementBuffer=new hn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Rr(this),this.pixelStoreUnpack=new Yo(this),this.pixelStoreUnpackPremultiplyAlpha=new Br(this),this.pixelStoreUnpackFlipY=new pr(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,o){return new _o(this,n,o)}createVertexBuffer(n,o,u){return new di(this,n,o,u)}createRenderbuffer(n,o,u){const d=this.gl,m=d.createRenderbuffer();return this.bindRenderbuffer.set(m),d.renderbufferStorage(d.RENDERBUFFER,n,o,u),this.bindRenderbuffer.set(null),m}createFramebuffer(n,o,u){return new $(this,n,o,u)}clear({color:n,depth:o,stencil:u}){const d=this.gl;let m=0;n&&(m|=d.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==o&&(m|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),void 0!==u&&(m|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(m)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){h(n.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class R extends a.Evented{constructor(n,o,u,d){super(),this.id=n,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},o),a.extend(this,a.pick(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zr(this._options,this.map._requestManager,null,null,(n,o)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):o&&(a.extend(this,o),o.bounds&&(this.tileBounds=new Ti(o.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(o.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,o){const u=a.exported.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);n.request=a.getImage(this.map._requestManager.transformRequest(d,a.ResourceType.Tile),(m,y,b,w)=>(delete n.request,n.aborted?(n.state="unloaded",o(null)):m?(n.state="errored",o(m)):y?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:b,expires:w}),n.setTexture(y,this.map.painter),n.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(n,o,u){n.setTexture(o,u)}static unloadTileData(n,o){n.texture&&o.saveTileTexture(n.texture)}abortTile(n,o){n.request&&(n.request.cancel(),delete n.request),o()}unloadTile(n,o){n.texture&&this.map.painter.saveTileTexture(n.texture),o()}hasTransition(){return!1}}let q;function Y(l,n,o,u,d,m,y,b){const w=[l,o,d,n,u,m,1,1,1],I=[y,b,1],M=a.adjoint([],w),[D,B,V]=a.transformMat3(I,I,a.transpose(M,M));return a.multiply$1(w,[D,0,0,0,B,0,0,0,V],w)}class Q extends a.Evented{constructor(n,o,u,d){super(),this.id=n,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=o,this._dirty=!1}load(n,o){this._loaded=o||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(u,d)=>{if(this._imageRequest=null,this._loaded=!0,u)this.fire(new a.ErrorEvent(u));else if(d){const{HTMLImageElement:m}=a.window;this.image=d instanceof m?a.exported.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const o=n.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(u){let d=1/0,m=1/0,y=-1/0,b=-1/0;for(const D of u)d=Math.min(d,D.x),m=Math.min(m,D.y),y=Math.max(y,D.x),b=Math.max(b,D.y);const w=Math.max(y-d,b-m),I=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),M=Math.pow(2,I);return new a.CanonicalTileID(I,Math.floor((d+y)/2*M),Math.floor((m+b)/2*M))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const w in this.tiles){const I=this.tiles[w];"loaded"!==I.state&&(I.state="loaded",I.texture=this.texture)}if(this._boundsArray)return;const o=a.tileTransform(this.tileID,this.map.transform.projection),[u,d,m,y]=this.coordinates.map(w=>{const I=o.projection.project(w[0],w[1]);return a.getTilePoint(o,I)._round()});this.perspectiveTransform=function(w,I,M,D,B,V,U,j,Z,F){const G=Y(0,0,w,0,0,I,w,I),N=Y(M,D,B,V,U,j,Z,F);return a.multiply$1(N,a.adjoint(G,G),N),[N[6]/N[8]*w/a.EXTENT,N[7]/N[8]*I/a.EXTENT]}(this.width,this.height,u.x,u.y,d.x,d.y,y.x,y.y,m.x,m.y);const b=this._boundsArray=new a.StructArrayLayout4i8;b.emplaceBack(u.x,u.y,0,0),b.emplaceBack(d.x,d.y,a.EXTENT,0),b.emplaceBack(y.x,y.y,0,a.EXTENT),b.emplaceBack(m.x,m.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(b,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,o=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(n,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ue={vector:class extends a.Evented{constructor(l,n,o,u){if(super(),this.id=l,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(n,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(l){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=zr(this._options,this.map._requestManager,n,o,(u,d)=>{this._tileJSONRequest=null,this._loaded=!0,u?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),o&&2!==o.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new a.ErrorEvent(u))):d&&(a.extend(this,d),d.bounds&&(this.tileBounds=new Ti(d.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(d.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(u)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const l=this.map.style._getSourceCaches(this.id);for(const n of l)n.clearTiles()})}setSourceProperty(l){l(),this.reload()}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(l,n){const o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(o,a.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(u.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=n:l.request=l.actor.send("reloadTile",u,d.bind(this));else if(l.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",u,d.bind(this),void 0,!0);else{const m=a.loadVectorTile.call({deduped:this._deduped},u,(y,b)=>{y||!b?d.call(this,y):(u.data={cacheControl:b.cacheControl,expires:b.expires,rawData:b.rawData.slice(0)},l.actor&&l.actor.send("loadTile",u,d.bind(this),void 0,!0))},!0);l.request={cancel:m}}function d(m,y){return delete l.request,l.aborted?n(null):m&&404!==m.status?n(m):(y&&y.resourceTiming&&(l.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&l.setExpiryData(y),l.loadVectorData(y,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:R,"raster-dem":class extends R{constructor(l,n,o,u){super(l,n,o,u),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(l,n){const o=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(d,m){d&&(l.state="errored",n(d)),m&&(l.dem=m,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",n(null))}l.request=a.getImage(this.map._requestManager.transformRequest(o,a.ResourceType.Tile),function(d,m,y,b){if(delete l.request,l.aborted)l.state="unloaded",n(null);else if(d)l.state="errored",n(d);else if(m){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:y,expires:b});const w=a.window.ImageBitmap&&m instanceof a.window.ImageBitmap&&(null==q&&(q=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof a.window.createImageBitmap),q),I=1-(m.width-a.prevPowerOfTwo(m.width))/2;I<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const M=w?m:a.exported.getImageData(m,I),D={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:M,encoding:this.encoding,padding:I};l.actor&&"expired"!==l.state||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",D,u.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const n=l.canonical,o=Math.pow(2,n.z),u=(n.x-1+o)%o,d=0===n.x?l.wrap-1:l.wrap,m=(n.x+1+o)%o,y=n.x+1===o?l.wrap+1:l.wrap,b={};return b[new a.OverscaledTileID(l.overscaledZ,d,n.z,u,n.y).key]={backfilled:!1},b[new a.OverscaledTileID(l.overscaledZ,y,n.z,m,n.y).key]={backfilled:!1},n.y>0&&(b[new a.OverscaledTileID(l.overscaledZ,d,n.z,u,n.y-1).key]={backfilled:!1},b[new a.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},b[new a.OverscaledTileID(l.overscaledZ,y,n.z,m,n.y-1).key]={backfilled:!1}),n.y+1<o&&(b[new a.OverscaledTileID(l.overscaledZ,d,n.z,u,n.y+1).key]={backfilled:!1},b[new a.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},b[new a.OverscaledTileID(l.overscaledZ,y,n.z,m,n.y+1).key]={backfilled:!1}),b}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends a.Evented{constructor(l,n,o,u){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(u),this._data=n.data,this._options=a.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*d,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*d,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:a.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},n),this}getClusterChildren(l,n){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},n),this}getClusterLeaves(l,n,o,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:n,offset:o},u),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=a.extend({},this.workerOptions),n=this._data;"string"==typeof n?(l.request=this.map._requestManager.transformRequest(a.exported.resolveURL(n),a.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(o,u)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new a.ErrorEvent(o));else{const d={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&u&&u.resourceTiming&&u.resourceTiming[this.id]&&(d.resourceTiming=u.resourceTiming[this.id]),this.fire(new a.Event("data",d)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,n){const o=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(o,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(u,d)=>(delete l.request,l.unloadVectorData(),l.aborted?n(null):u?n(u):(l.loadVectorData(d,this.map.painter,"reloadTile"===o),n(null))),void 0,"loadTile"===o)}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Q{constructor(l,n,o,u){super(l,n,o,u),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const n of l.urls)this.urls.push(this.map._requestManager.transformRequest(n,a.ResourceType.Source).url);a.getVideo(this.urls,(n,o)=>{this._loaded=!0,n?this.fire(new a.ErrorEvent(n)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const n=this.video.seekable;l<n.start(0)||l>n.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const l=this.map.painter.context,n=l.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(l,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Q,canvas:class extends Q{constructor(l,n,o,u){super(l,n,o,u),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(d=>!Array.isArray(d)||2!==d.length||d.some(m=>"number"!=typeof m))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends a.Evented{constructor(l,n,o,u){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=n,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ti(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:n,y:o,z:u}=l.canonical;return this._implementation.hasTile({x:n,y:o,z:u})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,n){const{x:o,y:u,z:d}=l.tileID.canonical,m=new a.window.AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:o,y:u,z:d},{signal:m.signal})).then(function(y){return delete l.request,l.aborted?(l.state="unloaded",n(null)):void 0===y?(l.state="errored",n(null)):null===y?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",n(null)):(b=y)instanceof a.window.ImageData||b instanceof a.window.HTMLCanvasElement||b instanceof a.window.ImageBitmap||b instanceof a.window.HTMLImageElement?(this.loadTileData(l,y),l.state="loaded",void n(null)):(l.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var b}.bind(this)).catch(y=>{20!==y.code&&(l.state="errored",n(y))}),l.request.cancel=()=>m.abort()}loadTileData(l,n){R.loadTileData(l,n,this._map.painter)}unloadTileData(l){R.unloadTileData(l,this._map.painter)}unloadTile(l,n){if(this.unloadTileData(l),this._implementation.unloadTile){const{x:o,y:u,z:d}=l.tileID.canonical;this._implementation.unloadTile({x:o,y:u,z:d})}n()}abortTile(l,n){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ce=function(l,n,o,u){const d=new ue[n.type](l,n,o,u);if(d.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${d.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],d),d};function se(l,n){const o=a.identity([]);return a.scale(o,o,[.5*l.width,.5*-l.height,1]),a.translate(o,o,[1,-1,0]),a.multiply(o,o,l.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(o)}function he(l,n,o,u,d,m,y,b=!1){const w=l.tilesIn(u,y,b);w.sort(qe);const I=[];for(const D of w)I.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(n,o,l._state,D,d,m,se(l.transform,D.tile.tileID),b)});const M=function(D){const B={},V={};for(const U of D){const j=U.queryResults,Z=U.wrappedTileID,F=V[Z]=V[Z]||{};for(const G in j){const N=j[G],te=F[G]=F[G]||{},ie=B[G]=B[G]||[];for(const J of N)te[J.featureIndex]||(te[J.featureIndex]=!0,ie.push(J))}}return B}(I);for(const D in M)M[D].forEach(B=>{const V=B.feature,U=V.layer;U&&"background"!==U.type&&"sky"!==U.type&&(V.source=U.source,U["source-layer"]&&(V.sourceLayer=U["source-layer"]),V.state=void 0!==V.id?l.getFeatureState(U["source-layer"],V.id):{})});return M}function Ae(l,n){const o=l.getRenderableIds().map(m=>l.getTileByID(m)),u=[],d={};for(let m=0;m<o.length;m++){const y=o[m],b=y.tileID.canonical.key;d[b]||(d[b]=!0,y.querySourceFeatures(u,n))}return u}function qe(l,n){const o=l.tileID,u=n.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function Me(){return null!=da.workerClass?new da.workerClass:new a.window.Worker(da.workerUrl)}const Ke="mapboxgl_preloaded_worker_pool";class He{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<He.workerCount;)this.workers.push(new Me);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ke]}numActive(){return Object.keys(this.active).length}}let Je;function Qe(){return Je||(Je=new He),Je}function pt(l,n){const o={};for(const u in l)"ref"!==u&&(o[u]=l[u]);return a.refProperties.forEach(u=>{u in n&&(o[u]=n[u])}),o}function Tt(l){l=l.slice();const n=Object.create(null);for(let o=0;o<l.length;o++)n[l[o].id]=l[o];for(let o=0;o<l.length;o++)"ref"in l[o]&&(l[o]=pt(l[o],n[l[o].ref]));return l}He.workerCount=2;const it={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Mt(l,n,o){o.push({command:it.addSource,args:[l,n[l]]})}function Dt(l,n,o){n.push({command:it.removeSource,args:[l]}),o[l]=!0}function Xn(l,n,o,u){Dt(l,o,u),Mt(l,n,o)}function Pn(l,n,o){let u;for(u in l[o])if(l[o].hasOwnProperty(u)&&"data"!==u&&!h(l[o][u],n[o][u]))return!1;for(u in n[o])if(n[o].hasOwnProperty(u)&&"data"!==u&&!h(l[o][u],n[o][u]))return!1;return!0}function ve(l,n,o,u,d,m){let y;for(y in n=n||{},l=l||{})l.hasOwnProperty(y)&&(h(l[y],n[y])||o.push({command:m,args:[u,y,n[y],d]}));for(y in n)n.hasOwnProperty(y)&&!l.hasOwnProperty(y)&&(h(l[y],n[y])||o.push({command:m,args:[u,y,n[y],d]}))}function Ci(l){return l.id}function oi(l,n){return l[n.id]=n,l}class Wn{constructor(n,o){this.reset(n,o)}reset(n,o){this.points=n||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=a.clamp(n,0,1);let o=1,u=this._distances[o];const d=n*this.paddedLength+this.padding;for(;u<d&&o<this._distances.length;)u=this._distances[++o];const m=o-1,y=this._distances[m],b=u-y,w=b>0?(d-y)/b:0;return this.points[m].mult(1-w).add(this.points[o].mult(w))}}class Ca{constructor(n,o,u){const d=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(n/u),this.yCellCount=Math.ceil(o/u);for(let y=0;y<this.xCellCount*this.yCellCount;y++)d.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=o,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,o,u,d,m){this._forEachCell(o,u,d,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(m)}insertCircle(n,o,u,d){this._forEachCell(o-d,u-d,o+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(o),this.circles.push(u),this.circles.push(d)}_insertBoxCell(n,o,u,d,m,y){this.boxCells[m].push(y)}_insertCircleCell(n,o,u,d,m,y){this.circleCells[m].push(y)}_query(n,o,u,d,m,y){if(u<0||n>this.width||d<0||o>this.height)return!m&&[];const b=[];if(n<=0&&o<=0&&this.width<=u&&this.height<=d){if(m)return!0;for(let w=0;w<this.boxKeys.length;w++)b.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const I=this.circles[3*w],M=this.circles[3*w+1],D=this.circles[3*w+2];b.push({key:this.circleKeys[w],x1:I-D,y1:M-D,x2:I+D,y2:M+D})}return y?b.filter(y):b}return this._forEachCell(n,o,u,d,this._queryCell,b,{hitTest:m,seenUids:{box:{},circle:{}}},y),m?b.length>0:b}_queryCircle(n,o,u,d,m){const y=n-u,b=n+u,w=o-u,I=o+u;if(b<0||y>this.width||I<0||w>this.height)return!d&&[];const M=[];return this._forEachCell(y,w,b,I,this._queryCellCircle,M,{hitTest:d,circle:{x:n,y:o,radius:u},seenUids:{box:{},circle:{}}},m),d?M.length>0:M}query(n,o,u,d,m){return this._query(n,o,u,d,!1,m)}hitTest(n,o,u,d,m){return this._query(n,o,u,d,!0,m)}hitTestCircle(n,o,u,d){return this._queryCircle(n,o,u,!0,d)}_queryCell(n,o,u,d,m,y,b,w){const I=b.seenUids,M=this.boxCells[m];if(null!==M){const B=this.bboxes;for(const V of M)if(!I.box[V]){I.box[V]=!0;const U=4*V;if(n<=B[U+2]&&o<=B[U+3]&&u>=B[U+0]&&d>=B[U+1]&&(!w||w(this.boxKeys[V]))){if(b.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[V],x1:B[U],y1:B[U+1],x2:B[U+2],y2:B[U+3]})}}}const D=this.circleCells[m];if(null!==D){const B=this.circles;for(const V of D)if(!I.circle[V]){I.circle[V]=!0;const U=3*V;if(this._circleAndRectCollide(B[U],B[U+1],B[U+2],n,o,u,d)&&(!w||w(this.circleKeys[V]))){if(b.hitTest)return y.push(!0),!0;{const j=B[U],Z=B[U+1],F=B[U+2];y.push({key:this.circleKeys[V],x1:j-F,y1:Z-F,x2:j+F,y2:Z+F})}}}}}_queryCellCircle(n,o,u,d,m,y,b,w){const I=b.circle,M=b.seenUids,D=this.boxCells[m];if(null!==D){const V=this.bboxes;for(const U of D)if(!M.box[U]){M.box[U]=!0;const j=4*U;if(this._circleAndRectCollide(I.x,I.y,I.radius,V[j+0],V[j+1],V[j+2],V[j+3])&&(!w||w(this.boxKeys[U])))return y.push(!0),!0}}const B=this.circleCells[m];if(null!==B){const V=this.circles;for(const U of B)if(!M.circle[U]){M.circle[U]=!0;const j=3*U;if(this._circlesCollide(V[j],V[j+1],V[j+2],I.x,I.y,I.radius)&&(!w||w(this.circleKeys[U])))return y.push(!0),!0}}}_forEachCell(n,o,u,d,m,y,b,w){const I=this._convertToXCellCoord(n),M=this._convertToYCellCoord(o),D=this._convertToXCellCoord(u),B=this._convertToYCellCoord(d);for(let V=I;V<=D;V++)for(let U=M;U<=B;U++)if(m.call(this,n,o,u,d,this.xCellCount*U+V,y,b,w))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,o,u,d,m,y){const b=d-n,w=m-o,I=u+y;return I*I>b*b+w*w}_circleAndRectCollide(n,o,u,d,m,y,b){const w=(y-d)/2,I=Math.abs(n-(d+w));if(I>w+u)return!1;const M=(b-m)/2,D=Math.abs(o-(m+M));if(D>M+u)return!1;if(I<=w||D<=M)return!0;const B=I-w,V=D-M;return B*B+V*V<=u*u}}const dn=Math.tan(85*Math.PI/180);function Or(l,n,o,u,d,m,y){const b=a.create();if(o)if("globe"===m.name){const w=a.calculateGlobeLabelMatrix(d,n);a.multiply(b,b,w)}else{const w=vt([],y);b[0]=w[0],b[1]=w[1],b[4]=w[2],b[5]=w[3],u||a.rotateZ(b,b,d.angle)}else a.multiply(b,d.labelPlaneMatrix,l);return b}function Aa(l,n,o,u,d,m,y){const b=Or(l,n,o,u,d,m,y);return"globe"===m.name&&o||(b[2]=b[6]=b[10]=b[14]=0),b}function Fr(l,n,o,u,d,m,y){if(o){if("globe"===m.name){const b=Or(l,n,o,u,d,m,y);return a.invert(b,b),a.multiply(b,l,b),b}{const b=a.clone(l),w=a.identity([]);return w[0]=y[0],w[1]=y[1],w[4]=y[2],w[5]=y[3],a.multiply(b,b,w),u||a.rotateZ(b,b,-d.angle),b}}return d.glCoordMatrix}function Ve(l,n,o=0){const u=[l.x,l.y,o,1];o?a.transformMat4$1(u,u,n):Qo(u,u,n);const d=u[3];return{point:[u[0]/d,u[1]/d,u[2]/d],signedDistanceFromCamera:d}}function dt(l,n){const o=[l[0],l[1],l[2],1];a.transformMat4$1(o,o,n);const u=o[3];return{point:[o[0]/u,o[1]/u,o[2]/u],signedDistanceFromCamera:u}}function xt(l,n){return Math.min(.5+l/n*.5,1.5)}function fn(l,n){const o=l[0]/l[3],u=l[1]/l[3];return o>=-n[0]&&o<=n[0]&&u>=-n[1]&&u<=n[1]}function Ii(l,n,o,u,d,m,y,b,w,I){const M=o.transform,D=u?l.textSizeData:l.iconSizeData,B=a.evaluateSizeForZoom(D,o.transform.zoom),V="globe"===M.projection.name,U=[256/o.width*2+1,256/o.height*2+1],j=u?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;j.clear();let Z=null;V&&(Z=u?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const F=l.lineVertexArray,G=u?l.text.placedSymbolArray:l.icon.placedSymbolArray,N=o.transform.width/o.transform.height;let te=!1;for(let ie=0;ie<G.length;ie++){const J=G.get(ie);if(J.writingMode!==a.WritingMode.vertical||te||0!==ie&&G.get(ie-1).writingMode===a.WritingMode.horizontal||(te=!0),(J.hidden||J.writingMode===a.WritingMode.vertical)&&!te){Se(J.numGlyphs,j);continue}te=!1;const re=new a.pointGeometry(J.tileAnchorX,J.tileAnchorY),pe=w?w(re):[0,0,0],ge=M.projection.projectTilePoint(re.x,re.y,I.canonical),me=[ge.x+pe[0],ge.y+pe[1],ge.z+pe[2]],ze=[...me,1];if(a.transformMat4$1(ze,ze,n),!fn(ze,U)){Se(J.numGlyphs,j);continue}const le=xt(o.transform.cameraToCenterDistance,ze[3]),Ee=a.evaluateSizeForFeature(D,B,J),Te=y?Ee/le:Ee*le,de=Ve(new a.pointGeometry(me[0],me[1]),d,me[2]);if(de.signedDistanceFromCamera<=0){Se(J.numGlyphs,j);continue}let ae={};const Ze=y?null:w,Le=Ur(J,Te,!1,b,n,d,m,l.glyphOffsetArray,F,j,Z,de.point,re,ae,N,Ze,M.projection,I,y);te=Le.useVertical,Ze&&Le.needsFlipping&&(ae={}),(Le.notEnoughRoom||te||Le.needsFlipping&&Ur(J,Te,!0,b,n,d,m,l.glyphOffsetArray,F,j,Z,de.point,re,ae,N,Ze,M.projection,I,y).notEnoughRoom)&&Se(J.numGlyphs,j)}u?(l.text.dynamicLayoutVertexBuffer.updateData(j),Z&&l.text.globeExtVertexBuffer.updateData(Z)):(l.icon.dynamicLayoutVertexBuffer.updateData(j),Z&&l.icon.globeExtVertexBuffer.updateData(Z))}function gt(l,n,o,u,d,m,y,b,w,I,M,D,B,V,U,j){const Z=b.glyphStartIndex+b.numGlyphs,F=b.lineStartIndex,G=b.lineStartIndex+b.lineLength,N=n.getoffsetX(b.glyphStartIndex),te=n.getoffsetX(Z-1),ie=Nt(l*N,o,u,d,m,y,b.segment,F,G,w,I,M,D,B,!0,V,U,j);if(!ie)return null;const J=Nt(l*te,o,u,d,m,y,b.segment,F,G,w,I,M,D,B,!0,V,U,j);return J?{first:ie,last:J}:null}function Ji(l,n,o,u){return l.writingMode===a.WritingMode.horizontal&&Math.abs(o.y-n.y)>Math.abs(o.x-n.x)*u?{useVertical:!0}:l.writingMode===a.WritingMode.vertical?n.y<o.y?{needsFlipping:!0}:null:0!==l.flipState&&function(d,m,y){const b=(m.x-d.x)*y;return 0===b||Math.abs((m.y-d.y)/b)>dn}(n,o,u)?1===l.flipState?{needsFlipping:!0}:null:n.x>o.x?{needsFlipping:!0}:null}function Ur(l,n,o,u,d,m,y,b,w,I,M,D,B,V,U,j,Z,F,G){const N=n/24,te=l.lineOffsetX*N,ie=l.lineOffsetY*N;let J=[];if(l.numGlyphs>1){const re=l.glyphStartIndex+l.numGlyphs,pe=l.lineStartIndex,ge=l.lineStartIndex+l.lineLength,me=gt(N,b,te,ie,o,D,B,l,w,m,V,j,!1,Z,F,G);if(!me)return{notEnoughRoom:!0};const ze=dt(me.first.point,y).point,le=dt(me.last.point,y).point,Ee=new a.pointGeometry(ze[0],ze[1]),Te=new a.pointGeometry(le[0],le[1]);if(u&&!o){const de=Ji(l,Ee,Te,U);if(l.flipState=de&&de.needsFlipping?1:2,de)return de}J=[me.first];for(let de=l.glyphStartIndex+1;de<re-1;de++){const ae=Nt(N*b.getoffsetX(de),te,ie,o,D,B,l.segment,pe,ge,w,m,V,j,!1,!1,Z,F,G);if(!ae)return{notEnoughRoom:!0};J.push(ae)}J.push(me.last)}else{if(u&&!o){const pe=Ve(B,d).point,ge=l.lineStartIndex+l.segment+1,me=new a.pointGeometry(w.getx(ge),w.gety(ge)),ze=Ve(me,d),le=ze.signedDistanceFromCamera>0?ze.point:Vi(B,me,pe,1,d,void 0,Z,F.canonical),Ee=Ji(l,new a.pointGeometry(pe[0],pe[1]),new a.pointGeometry(le[0],le[1]),U);if(l.flipState=Ee&&Ee.needsFlipping?1:2,Ee)return Ee}const re=Nt(N*b.getoffsetX(l.glyphStartIndex),te,ie,o,D,B,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,w,m,V,j,!1,!1,Z,F,G);if(!re)return{notEnoughRoom:!0};J=[re]}if(M)for(const re of J)a.updateGlobeVertexNormal(M,I.length+0,re.up[0],re.up[1],re.up[2]),a.updateGlobeVertexNormal(M,I.length+1,re.up[0],re.up[1],re.up[2]),a.updateGlobeVertexNormal(M,I.length+2,re.up[0],re.up[1],re.up[2]),a.updateGlobeVertexNormal(M,I.length+3,re.up[0],re.up[1],re.up[2]),a.addDynamicAttributes(I,re.point[0],re.point[1],re.point[2],re.angle);else for(const re of J)a.addDynamicAttributes(I,re.point[0],re.point[1],re.point[2],re.angle);return{}}function Zr(l,n,o,u,d){const m=u.projectTilePoint(l.x,l.y,n);if(!d)return Ve(m,o,m.z);const y=d(l);return Ve(new a.pointGeometry(m.x+y[0],m.y+y[1]),o,m.z+y[2])}function Vi(l,n,o,u,d,m,y,b){const w=Zr(l.add(l.sub(n)._unit()),b,d,y,m).point,I=a.sub([],o,w);return a.scaleAndAdd([],o,I,u/a.length(I))}function Nt(l,n,o,u,d,m,y,b,w,I,M,D,B,V,U,j,Z,F){const G=u?l-n:l+n;let N=G>0?1:-1,te=0;u&&(N*=-1,te=Math.PI),N<0&&(te+=Math.PI);let ie=N>0?b+y:b+y+1,J=d,re=d,pe=0,ge=0;const me=Math.abs(G),ze=[],le=[];let Ee=m;const Te=()=>{const Be=ie-N;return 0===pe?m:new a.pointGeometry(I.getx(Be),I.gety(Be))},de=()=>{const Be=Te();return Vi(Be,Ee||Be,re,me-pe+1,M,B,j,Z.canonical)};for(;pe+ge<=me;){if(ie+=N,ie<b||ie>=w)return null;if(re=J,ze.push(J),V&&le.push(Ee||Te()),J=D[ie],void 0===J){Ee=new a.pointGeometry(I.getx(ie),I.gety(ie));const Be=Zr(Ee,Z.canonical,M,j,B);J=Be.signedDistanceFromCamera>0?D[ie]=Be.point:de()}else Ee=null;pe+=ge,ge=a.distance(re,J)}Ee=Ee||new a.pointGeometry(I.getx(ie),I.gety(ie));const ae=Te();U&&B&&(D[ie]=J=void 0===D[ie]?J:de(),ge=a.distance(re,J));const Ze=(me-pe)/ge,Le=Ee.sub(ae).mult(Ze)._add(ae),Fe=a.sub([],J,re),Re=a.scaleAndAdd([],re,Fe,Ze);let We=[0,0,1],ot=Fe[0],tt=Fe[1];if(F&&(We=j.upVector(Z.canonical,Le.x,Le.y),0!==We[0]||0!==We[1]||1!==We[2])){const Be=[1,0,0],at=[0,1,0];Be[0]=We[2],Be[1]=0,Be[2]=-We[0],a.cross(at,We,Be),a.normalize(Be,Be),a.normalize(at,at),ot=a.dot(Fe,Be),tt=a.dot(Fe,at)}if(o){const Be=a.cross([],We,Fe);a.normalize(Be,Be),a.scaleAndAdd(Re,Re,Be,o*N)}const Ye=te+Math.atan2(tt,ot);return ze.push(Re),V&&le.push(Le),{point:Re,angle:Ye,path:ze,tilePath:le,up:We}}const kl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Se(l,n){for(let o=0;o<l;o++){const u=n.length;n.resize(u+4),n.float32.set(kl,4*u)}}function Qo(l,n,o){const u=n[0],d=n[1];return l[0]=o[0]*u+o[4]*d+o[12],l[1]=o[1]*u+o[5]*d+o[13],l[3]=o[3]*u+o[7]*d+o[15],l}const $t=100;class Ls{constructor(n,o,u=new Ca(n.width+200,n.height+200,25),d=new Ca(n.width+200,n.height+200,25)){this.transform=n,this.grid=u,this.ignoredGrid=d,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+$t,this.screenBottomBoundary=n.height+$t,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=o}placeCollisionBox(n,o,u,d,m,y,b,w){let I=u.projectedAnchorX,M=u.projectedAnchorY,D=u.projectedAnchorZ;const B=u.elevation,V=u.tileID;if(B&&V){const ie=n.getProjection().upVector(V.canonical,u.tileAnchorX,u.tileAnchorY),J=n.getProjection().upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;I+=ie[0]*B*J,M+=ie[1]*B*J,D+=ie[2]*B*J}const U=this.projectAndGetPerspectiveRatio(b,[I,M,D],u.tileID,"globe"===n.projection.name||!!B||this.transform.pitch>0,n.getProjection()),j=y*U.perspectiveRatio,Z=(u.x1*o+d.x-u.padding)*j+U.point.x,F=(u.y1*o+d.y-u.padding)*j+U.point.y,G=(u.x2*o+d.x+u.padding)*j+U.point.x,N=(u.y2*o+d.y+u.padding)*j+U.point.y,te=U.perspectiveRatio<=.55||U.occluded;return!this.isInsideGrid(Z,F,G,N)||!m&&this.grid.hitTest(Z,F,G,N,w)||te?{box:[],offscreen:!1,occluded:U.occluded}:{box:[Z,F,G,N],offscreen:this.isOffscreen(Z,F,G,N),occluded:!1}}placeCollisionCircles(n,o,u,d,m,y,b,w,I,M,D,B,V,U,j){const Z=[],F=this.transform.elevation,G=F?F.getAtTileOffsetFunc(j,this.transform.center.lat,this.transform.worldSize,n.getProjection()):ae=>[0,0,0],N=new a.pointGeometry(u.tileAnchorX,u.tileAnchorY),te=n.getProjection().projectTilePoint(u.tileAnchorX,u.tileAnchorY,j.canonical),ie=G(N),J=[te.x+ie[0],te.y+ie[1],te.z+ie[2]],re="globe"===n.projection.name,pe=this.projectAndGetPerspectiveRatio(b,[J[0],J[1],J[2]],j,re||!!F||this.transform.pitch>0,n.getProjection()),{perspectiveRatio:ge}=pe,me=(D?y/ge:y*ge)/a.ONE_EM,ze=Ve(new a.pointGeometry(J[0],J[1]),w,J[2]).point,le=pe.signedDistanceFromCamera>0?gt(me,m,u.lineOffsetX*me,u.lineOffsetY*me,!1,ze,N,u,d,w,{},F&&!D?G:null,D&&!!F,n.getProjection(),j,D):null;let Ee=!1,Te=!1,de=!0;if(le&&!pe.occluded){const ae=.5*V*ge+U,Ze=new a.pointGeometry(-100,-100),Le=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Fe=new Wn,Re=le.first,We=le.last;let ot=[];for(let Be=Re.path.length-1;Be>=1;Be--)ot.push(Re.path[Be]);for(let Be=1;Be<We.path.length;Be++)ot.push(We.path[Be]);const tt=2.5*ae;if(I){const Be=ot.map(F&&!re?(at,ft)=>{const Ot=G(ft<Re.path.length-1?Re.tilePath[Re.path.length-1-ft]:We.tilePath[ft-Re.path.length+2]);return at[2]=Ot[2],dt(at,I)}:at=>dt(at,I));ot=Be.some(at=>at.signedDistanceFromCamera<=0)?[]:Be.map(at=>at.point)}let Ye=[];if(ot.length>0){const Be=ot.map(Lt=>new a.pointGeometry(Lt[0],Lt[1]));let at=1/0,ft=-1/0,Ot=1/0,Ft=-1/0;for(let Lt=0;Lt<Be.length;Lt++)at=Math.min(at,Be[Lt].x),Ot=Math.min(Ot,Be[Lt].y),ft=Math.max(ft,Be[Lt].x),Ft=Math.max(Ft,Be[Lt].y);Ye=at>=Ze.x&&ft<=Le.x&&Ot>=Ze.y&&Ft<=Le.y?[Be]:ft<Ze.x||at>Le.x||Ft<Ze.y||Ot>Le.y?[]:a.clipLine([Be],Ze.x,Ze.y,Le.x,Le.y)}for(const Be of Ye){Fe.reset(Be,.25*ae);let at=0;at=Fe.length<=.5*ae?1:Math.ceil(Fe.paddedLength/tt)+1;for(let ft=0;ft<at;ft++){const Ot=ft/Math.max(at-1,1),Ft=Fe.lerp(Ot),Lt=Ft.x+$t,vi=Ft.y+$t;Z.push(Lt,vi,ae,0);const qi=Lt-ae,er=vi-ae,Xt=Lt+ae,ii=vi+ae;if(de=de&&this.isOffscreen(qi,er,Xt,ii),Te=Te||this.isInsideGrid(qi,er,Xt,ii),!o&&this.grid.hitTestCircle(Lt,vi,ae,B)&&(Ee=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Ee,occluded:!1}}}}return{circles:!M&&Ee||!Te?[]:Z,offscreen:de,collisionDetected:Ee,occluded:pe.occluded}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const o=[];let u=1/0,d=1/0,m=-1/0,y=-1/0;for(const M of n){const D=new a.pointGeometry(M.x+$t,M.y+$t);u=Math.min(u,D.x),d=Math.min(d,D.y),m=Math.max(m,D.x),y=Math.max(y,D.y),o.push(D)}const b=this.grid.query(u,d,m,y).concat(this.ignoredGrid.query(u,d,m,y)),w={},I={};for(const M of b){const D=M.key;if(void 0===w[D.bucketInstanceId]&&(w[D.bucketInstanceId]={}),w[D.bucketInstanceId][D.featureIndex])continue;const B=[new a.pointGeometry(M.x1,M.y1),new a.pointGeometry(M.x2,M.y1),new a.pointGeometry(M.x2,M.y2),new a.pointGeometry(M.x1,M.y2)];a.polygonIntersectsPolygon(o,B)&&(w[D.bucketInstanceId][D.featureIndex]=!0,void 0===I[D.bucketInstanceId]&&(I[D.bucketInstanceId]=[]),I[D.bucketInstanceId].push(D.featureIndex))}return I}insertCollisionBox(n,o,u,d,m){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:m},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,o,u,d,m){const y=o?this.ignoredGrid:this.grid,b={bucketInstanceId:u,featureIndex:d,collisionGroupID:m};for(let w=0;w<n.length;w+=4)y.insertCircle(b,n[w],n[w+1],n[w+2])}projectAndGetPerspectiveRatio(n,o,u,d,m){const y=[o[0],o[1],o[2],1];let b=!1;if(o[2]||this.transform.pitch>0){a.transformMat4$1(y,y,n);const w="globe"===m.name;this.fogState&&u&&!w&&(b=function(I,M,D,B,V,U){const j=U.calculateFogTileMatrix(V),Z=[M,D,B];return a.transformMat4(Z,Z,j),Nn(I,Z,U.pitch,U._fov)}(this.fogState,o[0],o[1],o[2],u.toUnwrapped(),this.transform)>.9)}else Qo(y,y,n);return{point:new a.pointGeometry((y[0]/y[3]+1)/2*this.transform.width+$t,(-y[1]/y[3]+1)/2*this.transform.height+$t),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(m)/y[3]*.5,1.5),signedDistanceFromCamera:y[3],occluded:d&&y[2]>y[3]||b}}isOffscreen(n,o,u,d){return u<$t||n>=this.screenRightBoundary||d<$t||o>this.screenBottomBoundary}isInsideGrid(n,o,u,d){return u>=0&&n<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const n=a.identity([]);return a.translate(n,n,[-100,-100,0]),n}}function bo(l,n,o){const u=n.createTileMatrix(l,l.worldSize,o.toUnwrapped());return a.multiply(new Float32Array(16),l.projMatrix,u)}function Ko(l,n,o){if(n.projection.name===o.projection.name)return l.projMatrix;const u=o.clone();return u.setProjection(n.projection),bo(u,n.getProjection(),l)}function wo(l,n,o){return n.name===o.projection.name?l.projMatrix:bo(o,n,l)}class To{constructor(n,o,u,d){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?o:-o))):d&&u?1:0,this.placed=u}isHidden(){return 0===this.opacity&&!this.placed}}class mn{constructor(n,o,u,d,m,y=!1){this.text=new To(n?n.text:null,o,u,m),this.icon=new To(n?n.icon:null,o,d,m),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fi{constructor(n,o,u,d=!1){this.text=n,this.icon=o,this.skipFade=u,this.clipped=d}}class ri{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Eo{constructor(n,o,u,d,m){this.bucketInstanceId=n,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=m}}class es{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const o=++this.maxGroupID;this.collisionGroups[n]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[n]}}function Mi(l,n,o,u,d){const{horizontalAlign:m,verticalAlign:y}=a.getAnchorAlignment(l),b=-(m-.5)*n,w=-(y-.5)*o,I=a.evaluateVariableOffset(l,u);return new a.pointGeometry(b+I[0]*d,w+I[1]*d)}function Bi(l,n,o,u,d){const m=new a.pointGeometry(l,n);return o&&m._rotate(u?d:-d),m}class Sa{constructor(n,o,u,d,m){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Ls(this.transform,m),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new es(u),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,o,u,d){const m=u.getBucket(o),y=u.latestFeatureIndex;if(!m||!y||o.id!==m.layerIds[0])return;const b=m.layers[0].layout,w=u.collisionBoxArray,I=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),M=u.tileSize/a.EXTENT,D=u.tileID.toUnwrapped();this.transform.setProjection(m.projection);const B=(V=u.tileID,U=m.getProjection(),j=this.transform,U.name===this.projection?j.calculateProjMatrix(V.toUnwrapped()):bo(j,U,V));var V,U,j;const Z="map"===b.get("text-pitch-alignment"),F="map"===b.get("text-rotation-alignment");o.compileFilter();const G=o.dynamicFilter(),N=o.dynamicFilterNeedsFeature(),te=this.transform.calculatePixelsToTileUnitsMatrix(u),ie=Aa(B,u.tileID.canonical,Z,F,this.transform,m.getProjection(),te);let J=null;if(Z){const ge=Fr(B,u.tileID.canonical,Z,F,this.transform,m.getProjection(),te);J=a.multiply([],this.transform.labelPlaneMatrix,ge)}let re=null;G&&u.latestFeatureIndex&&(re={unwrappedTileID:D,dynamicFilter:G,dynamicFilterNeedsFeature:N,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[m.bucketInstanceId]=new Eo(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,u.tileID);const pe={bucket:m,layout:b,posMatrix:B,textLabelPlaneMatrix:ie,labelToScreenMatrix:J,clippingData:re,scale:I,textPixelRatio:M,holdingForFade:u.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(m.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(m.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(d)for(const ge of m.sortKeyRanges){const{sortKey:me,symbolInstanceStart:ze,symbolInstanceEnd:le}=ge;n.push({sortKey:me,symbolInstanceStart:ze,symbolInstanceEnd:le,parameters:pe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(n,o,u,d,m,y,b,w,I,M,D,B,V,U,j,Z,F,G){const N=[B.textOffset0,B.textOffset1],te=Mi(n,u,d,N,m),ie=this.collisionIndex.placeCollisionBox(U,m,o,Bi(te.x,te.y,y,b,this.transform.angle),D,w,I,M.predicate);if(Z){const J=U.getSymbolInstanceIconSize(G,this.transform.zoom,B.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(U,J,Z,Bi(te.x,te.y,y,b,this.transform.angle),D,w,I,M.predicate).box.length)return}if(ie.box.length>0){let J;return this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(J=this.prevPlacement.variableOffsets[B.crossTileID].anchor),this.variableOffsets[B.crossTileID]={textOffset:N,width:u,height:d,anchor:n,textScale:m,prevAnchor:J},this.markUsedJustification(U,n,B,j),U.allowVerticalPlacement&&(this.markUsedOrientation(U,j,B),this.placedOrientations[B.crossTileID]=j),{shift:te,placedGlyphBoxes:ie}}}placeLayerBucketPart(n,o,u,d){const{bucket:m,layout:y,posMatrix:b,textLabelPlaneMatrix:w,labelToScreenMatrix:I,clippingData:M,textPixelRatio:D,holdingForFade:B,collisionBoxArray:V,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:j,collisionGroup:Z}=n.parameters,F=y.get("text-optional"),G=y.get("icon-optional"),N=y.get("text-allow-overlap"),te=y.get("icon-allow-overlap"),ie="map"===y.get("text-rotation-alignment"),J="map"===y.get("text-pitch-alignment"),re="none"!==y.get("icon-text-fit"),pe="viewport-y"===y.get("symbol-z-order");this.transform.setProjection(m.projection);let ge=N&&(te||!m.hasIconData()||G),me=te&&(N||!m.hasTextData()||F);!m.collisionArrays&&V&&m.deserializeCollisionBoxes(V),u&&d&&m.updateCollisionDebugBuffers(this.transform.zoom,V);const ze=(le,Ee,Te)=>{if(M){const Xt={zoom:this.transform.zoom,pitch:this.transform.pitch};let ii=null;if(M.dynamicFilterNeedsFeature){const Pt=this.retainedQueryData[m.bucketInstanceId];ii=M.featureIndex.loadFeature({featureIndex:le.featureIndex,bucketIndex:Pt.bucketIndex,sourceLayerIndex:Pt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,M.dynamicFilter)(Xt,ii,this.retainedQueryData[m.bucketInstanceId].tileID.canonical,new a.pointGeometry(le.tileAnchorX,le.tileAnchorY),this.transform.calculateDistanceTileData(M.unwrappedTileID)))return this.placements[le.crossTileID]=new fi(!1,!1,!1,!0),void(o[le.crossTileID]=!0)}if(o[le.crossTileID])return;if(B)return void(this.placements[le.crossTileID]=new fi(!1,!1,!1));let de=!1,ae=!1,Ze=!0,Le=!1,Fe=!1,Re=null,We={box:null,offscreen:null,occluded:null},ot={box:null,offscreen:null,occluded:null},tt=null,Ye=null,Be=null,at=0,ft=0,Ot=0;Te.textFeatureIndex?at=Te.textFeatureIndex:le.useRuntimeCollisionCircles&&(at=le.featureIndex),Te.verticalTextFeatureIndex&&(ft=Te.verticalTextFeatureIndex);const Ft=Xt=>{Xt.tileID=this.retainedQueryData[m.bucketInstanceId].tileID,(this.transform.elevation||Xt.elevation)&&(Xt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[m.bucketInstanceId].tileID,Xt.tileAnchorX,Xt.tileAnchorY):0)},Lt=Te.textBox;if(Lt){Ft(Lt);const Xt=Pt=>{let ci=a.WritingMode.horizontal;if(m.allowVerticalPlacement&&!Pt&&this.prevPlacement){const Ui=this.prevPlacement.placedOrientations[le.crossTileID];Ui&&(this.placedOrientations[le.crossTileID]=Ui,ci=Ui,this.markUsedOrientation(m,ci,le))}return ci},ii=(Pt,ci)=>{if(m.allowVerticalPlacement&&le.numVerticalGlyphVertices>0&&Te.verticalTextBox){for(const Ui of m.writingModes)if(Ui===a.WritingMode.vertical?(We=ci(),ot=We):We=Pt(),We&&We.box&&We.box.length)break}else We=Pt()};if(y.get("text-variable-anchor")){let Pt=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[le.crossTileID]){const Vt=this.prevPlacement.variableOffsets[le.crossTileID];Pt.indexOf(Vt.anchor)>0&&(Pt=Pt.filter(Qi=>Qi!==Vt.anchor),Pt.unshift(Vt.anchor))}const ci=(Vt,Qi,Ro)=>{const Bn=m.getSymbolInstanceTextSize(U,le,this.transform.zoom,Ee),Gi=(Vt.x2-Vt.x1)*Bn+2*Vt.padding,ws=(Vt.y2-Vt.y1)*Bn+2*Vt.padding,Qr=re&&!te?Qi:null;Qr&&Ft(Qr);let ki={box:[],offscreen:!1,occluded:!1};const tr=N?2*Pt.length:Pt.length;for(let Kr=0;Kr<tr;++Kr){const On=this.attemptAnchorPlacement(Pt[Kr%Pt.length],Vt,Gi,ws,Bn,ie,J,D,b,Z,Kr>=Pt.length,le,Ee,m,Ro,Qr,U,j);if(On&&(ki=On.placedGlyphBoxes,ki&&ki.box&&ki.box.length)){de=!0,Re=On.shift;break}}return ki};ii(()=>ci(Lt,Te.iconBox,a.WritingMode.horizontal),()=>{const Vt=Te.verticalTextBox;return Vt&&Ft(Vt),m.allowVerticalPlacement&&!(We&&We.box&&We.box.length)&&le.numVerticalGlyphVertices>0&&Vt?ci(Vt,Te.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),We&&(de=We.box,Ze=We.offscreen,Le=We.occluded);const Ui=Xt(We&&We.box);if(!de&&this.prevPlacement){const Vt=this.prevPlacement.variableOffsets[le.crossTileID];Vt&&(this.variableOffsets[le.crossTileID]=Vt,this.markUsedJustification(m,Vt.anchor,le,Ui))}}else{const Pt=(ci,Ui)=>{const Vt=m.getSymbolInstanceTextSize(U,le,this.transform.zoom,Ee),Qi=this.collisionIndex.placeCollisionBox(m,Vt,ci,new a.pointGeometry(0,0),N,D,b,Z.predicate);return Qi&&Qi.box&&Qi.box.length&&(this.markUsedOrientation(m,Ui,le),this.placedOrientations[le.crossTileID]=Ui),Qi};ii(()=>Pt(Lt,a.WritingMode.horizontal),()=>{const ci=Te.verticalTextBox;return m.allowVerticalPlacement&&le.numVerticalGlyphVertices>0&&ci?(Ft(ci),Pt(ci,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Xt(We&&We.box&&We.box.length)}}if(tt=We,de=tt&&tt.box&&tt.box.length>0,Ze=tt&&tt.offscreen,Le=tt&&tt.occluded,le.useRuntimeCollisionCircles){const Xt=m.text.placedSymbolArray.get(le.centerJustifiedTextSymbolIndex>=0?le.centerJustifiedTextSymbolIndex:le.verticalPlacedTextSymbolIndex),ii=a.evaluateSizeForFeature(m.textSizeData,U,Xt),Pt=y.get("text-padding");Ye=this.collisionIndex.placeCollisionCircles(m,N,Xt,m.lineVertexArray,m.glyphOffsetArray,ii,b,w,I,u,J,Z.predicate,le.collisionCircleDiameter*ii/a.ONE_EM,Pt,this.retainedQueryData[m.bucketInstanceId].tileID),de=N||Ye.circles.length>0&&!Ye.collisionDetected,Ze=Ze&&Ye.offscreen,Le=Ye.occluded}if(Te.iconFeatureIndex&&(Ot=Te.iconFeatureIndex),Te.iconBox){const Xt=ii=>{Ft(ii);const Pt=re&&Re?Bi(Re.x,Re.y,ie,J,this.transform.angle):new a.pointGeometry(0,0),ci=m.getSymbolInstanceIconSize(j,this.transform.zoom,le.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(m,ci,ii,Pt,te,D,b,Z.predicate)};ot&&ot.box&&ot.box.length&&Te.verticalIconBox?(Be=Xt(Te.verticalIconBox),ae=Be.box.length>0):(Be=Xt(Te.iconBox),ae=Be.box.length>0),Ze=Ze&&Be.offscreen,Fe=Be.occluded}const vi=F||0===le.numHorizontalGlyphVertices&&0===le.numVerticalGlyphVertices,qi=G||0===le.numIconVertices;if(vi||qi?qi?vi||(ae=ae&&de):de=ae&&de:ae=de=ae&&de,de&&tt&&tt.box&&this.collisionIndex.insertCollisionBox(tt.box,y.get("text-ignore-placement"),m.bucketInstanceId,ot&&ot.box&&ft?ft:at,Z.ID),ae&&Be&&this.collisionIndex.insertCollisionBox(Be.box,y.get("icon-ignore-placement"),m.bucketInstanceId,Ot,Z.ID),Ye&&(de&&this.collisionIndex.insertCollisionCircles(Ye.circles,y.get("text-ignore-placement"),m.bucketInstanceId,at,Z.ID),u)){const Xt=m.bucketInstanceId;let ii=this.collisionCircleArrays[Xt];void 0===ii&&(ii=this.collisionCircleArrays[Xt]=new ri);for(let Pt=0;Pt<Ye.circles.length;Pt+=4)ii.circles.push(Ye.circles[Pt+0]),ii.circles.push(Ye.circles[Pt+1]),ii.circles.push(Ye.circles[Pt+2]),ii.circles.push(Ye.collisionDetected?1:0)}const er="globe"!==m.projection.name;ge=ge&&(er||!Le),me=me&&(er||!Fe),this.placements[le.crossTileID]=new fi(de||ge,ae||me,Ze||m.justReloaded),o[le.crossTileID]=!0};if(pe){const le=m.getSortedSymbolIndexes(this.transform.angle);for(let Ee=le.length-1;Ee>=0;--Ee){const Te=le[Ee];ze(m.symbolInstances.get(Te),Te,m.collisionArrays[Te])}}else for(let le=n.symbolInstanceStart;le<n.symbolInstanceEnd;le++)ze(m.symbolInstances.get(le),le,m.collisionArrays[le]);if(u&&m.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[m.bucketInstanceId];a.invert(le.invProjMatrix,b),le.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(n,o,u,d){let m;m=d===a.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(o)];const y=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:u.crossTileID)}markUsedOrientation(n,o,u){const d=o===a.WritingMode.horizontal||o===a.WritingMode.horizontalOnly?o:0,m=o===a.WritingMode.vertical?o:0,y=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex].filter(b=>-1!==b);for(const b of y)n.text.placedSymbolArray.get(b).placedOrientation=d;-1!==u.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const d=o?o.symbolFadeChange(n):1,m=o?o.opacities:{},y=o?o.variableOffsets:{},b=o?o.placedOrientations:{};for(const w in this.placements){const I=this.placements[w],M=m[w];M?(this.opacities[w]=new mn(M,d,I.text,I.icon,null,I.clipped),u=u||I.text!==M.text.placed||I.icon!==M.icon.placed):(this.opacities[w]=new mn(null,d,I.text,I.icon,I.skipFade,I.clipped),u=u||I.text||I.icon)}for(const w in m){const I=m[w];if(!this.opacities[w]){const M=new mn(I,d,!1,!1);M.isHidden()||(this.opacities[w]=M,u=u||I.text.placed||I.icon.placed)}}for(const w in y)this.variableOffsets[w]||!this.opacities[w]||this.opacities[w].isHidden()||(this.variableOffsets[w]=y[w]);for(const w in b)this.placedOrientations[w]||!this.opacities[w]||this.opacities[w].isHidden()||(this.placedOrientations[w]=b[w]);u?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:n)}updateLayerOpacities(n,o){const u={};for(const d of o){const m=d.getBucket(n);m&&d.latestFeatureIndex&&n.id===m.layerIds[0]&&this.updateBucketOpacities(m,u,d.collisionBoxArray)}}updateBucketOpacities(n,o,u){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const d=n.layers[0].layout,m=!!n.layers[0].dynamicFilter(),y=new mn(null,0,!1,!1,!0),b=d.get("text-allow-overlap"),w=d.get("icon-allow-overlap"),I=d.get("text-variable-anchor"),M="map"===d.get("text-rotation-alignment"),D="map"===d.get("text-pitch-alignment"),B="none"!==d.get("icon-text-fit"),V=new mn(null,0,b&&(w||!n.hasIconData()||d.get("icon-optional")),w&&(b||!n.hasTextData()||d.get("text-optional")),!0);!n.collisionArrays&&u&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(u);const U=(Z,F,G)=>{for(let N=0;N<F/4;N++)Z.opacityVertexArray.emplaceBack(G)};let j=0;for(let Z=0;Z<n.symbolInstances.length;Z++){const F=n.symbolInstances.get(Z),{numHorizontalGlyphVertices:G,numVerticalGlyphVertices:N,crossTileID:te}=F;let ie=this.opacities[te];o[te]?ie=y:ie||(ie=V,this.opacities[te]=ie),o[te]=!0;const J=G>0||N>0,re=F.numIconVertices>0,pe=this.placedOrientations[F.crossTileID],ge=pe===a.WritingMode.vertical,me=pe===a.WritingMode.horizontal||pe===a.WritingMode.horizontalOnly;if(!J&&!re||ie.isHidden()||j++,J){const ze=_n(ie.text);U(n.text,G,ge?Hn:ze),U(n.text,N,me?Hn:ze);const le=ie.text.isHidden();[F.rightJustifiedTextSymbolIndex,F.centerJustifiedTextSymbolIndex,F.leftJustifiedTextSymbolIndex].forEach(de=>{de>=0&&(n.text.placedSymbolArray.get(de).hidden=le||ge?1:0)}),F.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(F.verticalPlacedTextSymbolIndex).hidden=le||me?1:0);const Ee=this.variableOffsets[F.crossTileID];Ee&&this.markUsedJustification(n,Ee.anchor,F,pe);const Te=this.placedOrientations[F.crossTileID];Te&&(this.markUsedJustification(n,"left",F,Te),this.markUsedOrientation(n,Te,F))}if(re){const ze=_n(ie.icon);F.placedIconSymbolIndex>=0&&(U(n.icon,F.numIconVertices,ge?Hn:ze),n.icon.placedSymbolArray.get(F.placedIconSymbolIndex).hidden=ie.icon.isHidden()),F.verticalPlacedIconSymbolIndex>=0&&(U(n.icon,F.numVerticalIconVertices,me?Hn:ze),n.icon.placedSymbolArray.get(F.verticalPlacedIconSymbolIndex).hidden=ie.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const ze=n.collisionArrays[Z];if(ze){let le=new a.pointGeometry(0,0),Ee=!0;if(ze.textBox||ze.verticalTextBox){if(I){const de=this.variableOffsets[te];de?(le=Mi(de.anchor,de.width,de.height,de.textOffset,de.textScale),M&&le._rotate(D?this.transform.angle:-this.transform.angle)):Ee=!1}m&&(Ee=!ie.clipped),ze.textBox&&mr(n.textCollisionBox.collisionVertexArray,ie.text.placed,!Ee||ge,le.x,le.y),ze.verticalTextBox&&mr(n.textCollisionBox.collisionVertexArray,ie.text.placed,!Ee||me,le.x,le.y)}const Te=Ee&&Boolean(!me&&ze.verticalIconBox);ze.iconBox&&mr(n.iconCollisionBox.collisionVertexArray,ie.icon.placed,Te,B?le.x:0,B?le.y:0),ze.verticalIconBox&&mr(n.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Te,B?le.x:0,B?le.y:0)}}}if(n.fullyClipped=0===j,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Z=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Z.invProjMatrix,n.placementViewportMatrix=Z.viewportMatrix,n.collisionCircleArray=Z.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>n}setStale(){this.stale=!0}}function mr(l,n,o,u,d){l.emplaceBack(n?1:0,o?1:0,u||0,d||0),l.emplaceBack(n?1:0,o?1:0,u||0,d||0),l.emplaceBack(n?1:0,o?1:0,u||0,d||0),l.emplaceBack(n?1:0,o?1:0,u||0,d||0)}const ei=Math.pow(2,25),Co=Math.pow(2,24),Rs=Math.pow(2,17),Ao=Math.pow(2,16),yi=Math.pow(2,9),Bs=Math.pow(2,8),Os=Math.pow(2,1);function _n(l){if(0===l.opacity&&!l.placed)return 0;if(1===l.opacity&&l.placed)return 4294967295;const n=l.placed?1:0,o=Math.floor(127*l.opacity);return o*ei+n*Co+o*Rs+n*Ao+o*yi+n*Bs+o*Os+n}const Hn=0;class ts{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,o,u,d,m){const y=this._bucketParts;for(;this._currentTileIndex<n.length;)if(o.getBucketParts(y,d,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,w)=>b.sortKey-w.sortKey));this._currentPartIndex<y.length;){const b=y[this._currentPartIndex];if(o.placeLayerBucketPart(b,this._seenCrossTileIDs,u,0===b.symbolInstanceStart),this._currentPartIndex++,m())return!0}return!1}}class zl{constructor(n,o,u,d,m,y,b,w){this.placement=new Sa(n,m,y,b,w),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(n,o,u){const d=a.exported.now(),m=()=>{const y=a.exported.now()-d;return!this._forceFullPlacement&&y>2};for(;this._currentPlacementIndex>=0;){const y=o[n[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if("symbol"===y.type&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new ts(y)),this._inProgressLayer.continuePlacement(u[y.source],this.placement,this._showCollisionBoxes,y,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Fs=512/a.EXTENT/2;class Nr{constructor(n,o,u){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(let d=0;d<o.length;d++){const m=o.get(d),y=m.key;this.indexedSymbolInstances[y]||(this.indexedSymbolInstances[y]=[]),this.indexedSymbolInstances[y].push({crossTileID:m.crossTileID,coord:this.getScaledCoordinates(m,n)})}}getScaledCoordinates(n,o){const u=Fs/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*a.EXTENT+n.tileAnchorX)*u),y:Math.floor((o.canonical.y*a.EXTENT+n.tileAnchorY)*u)}}findMatches(n,o,u){const d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let m=0;m<n.length;m++){const y=n.get(m);if(y.crossTileID)continue;const b=this.indexedSymbolInstances[y.key];if(!b)continue;const w=this.getScaledCoordinates(y,o);for(const I of b)if(Math.abs(I.coord.x-w.x)<=d&&Math.abs(I.coord.y-w.y)<=d&&!u[I.crossTileID]){u[I.crossTileID]=!0,y.crossTileID=I.crossTileID;break}}}}class Pl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ia{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const o=Math.round((n-this.lng)/360);if(0!==o)for(const u in this.indexes){const d=this.indexes[u],m={};for(const y in d){const b=d[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+o),m[b.tileID.key]=b}this.indexes[u]=m}this.lng=n}addBucket(n,o,u){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let m=0;m<o.symbolInstances.length;m++)o.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const d=this.usedCrossTileIDs[n.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>n.overscaledZ)for(const b in y){const w=y[b];w.tileID.isChildOf(n)&&w.findMatches(o.symbolInstances,n,d)}else{const b=y[n.scaledTo(Number(m)).key];b&&b.findMatches(o.symbolInstances,n,d)}}for(let m=0;m<o.symbolInstances.length;m++){const y=o.symbolInstances.get(m);y.crossTileID||(y.crossTileID=u.generate(),d[y.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Nr(n,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(n,o){for(const u in o.indexedSymbolInstances)for(const d of o.indexedSymbolInstances[u])delete this.usedCrossTileIDs[n][d.crossTileID]}removeStaleBuckets(n){let o=!1;for(const u in this.indexes){const d=this.indexes[u];for(const m in d)n[d[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[m]),delete d[m],o=!0)}return o}}class Jn{constructor(){this.layerIndexes={},this.crossTileIDs=new Pl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,o,u,d){let m=this.layerIndexes[n.id];void 0===m&&(m=this.layerIndexes[n.id]=new Ia);let y=!1;const b={};"globe"!==d.name&&m.handleWrapJump(u);for(const w of o){const I=w.getBucket(n);I&&n.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(w.tileID,I,this.crossTileIDs)&&(y=!0),b[I.bucketInstanceId]=!0)}return m.removeStaleBuckets(b)&&(y=!0),y}pruneUnusedLayers(n){const o={};n.forEach(u=>{o[u]=!0});for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}const Yi=(l,n)=>a.emitValidationErrors(l,n&&n.filter(o=>"source.canvas"!==o.identifier)),is=a.pick(it,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Yn=a.pick(it,["setCenter","setZoom","setBearing","setPitch"]),Us={version:8,layers:[],sources:{}},ns={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class gn extends a.Evented{constructor(n,o={}){super(),this.map=n,this.dispatcher=new Xi(Qe(),this),this.imageManager=new Xo,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(n._requestManager,o.localFontFamily?a.LocalGlyphMode.all:o.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new Jn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const u=this;this._rtlTextPluginCallback=gn.registerForPluginStateChange(d=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(m,y)=>{if(a.triggerPluginCompletionEvent(m),y&&y.every(b=>b))for(const b in u._sourceCaches){const w=u._sourceCaches[b],I=w.getSource().type;"vector"!==I&&"geojson"!==I||w.reload()}})}),this.on("data",d=>{if("source"!==d.dataType||"metadata"!==d.sourceDataType)return;const m=this.getSource(d.sourceId);if(m&&m.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===m.id&&this._validateLayer(b)}})}loadURL(n,o={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const u="boolean"==typeof o.validate?o.validate:!a.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,o.accessToken);const d=this.map._requestManager.transformRequest(n,a.ResourceType.Style);this._request=a.getJSON(d,(m,y)=>{this._request=null,m?this.fire(new a.ErrorEvent(m)):y&&this._load(y,u)})}loadJSON(n,o={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(n,!1!==o.validate)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Us,!1)}_updateLayerCount(n,o){const u=o?1:-1;n.is3D()&&(this._num3DLayers+=u),"circle"===n.type&&(this._numCircleLayers+=u),"symbol"===n.type&&(this._numSymbolLayers+=u)}_load(n,o){if(o&&Yi(this,a.validateStyle(n)))return;this._loaded=!0,this.stylesheet=a.clone$1(n),this._updateMapProjection();for(const d in n.sources)this.addSource(d,n.sources[d],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const u=Tt(this.stylesheet.layers);this._order=u.map(d=>d.id),this._layers={},this._serializedLayers={};for(let d of u)d=a.createStyleLayer(d),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new fo(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(o,u,d){let m,y,b;const w=a.exported.devicePixelRatio>1?"@2x":"";let I=a.getJSON(u.transformRequest(u.normalizeSpriteURL(o,w,".json"),a.ResourceType.SpriteJSON),(B,V)=>{I=null,b||(b=B,m=V,D())}),M=a.getImage(u.transformRequest(u.normalizeSpriteURL(o,w,".png"),a.ResourceType.SpriteImage),(B,V)=>{M=null,b||(b=B,y=V,D())});function D(){if(b)d(b);else if(m&&y){const B=a.exported.getImageData(y),V={};for(const U in m){const{width:j,height:Z,x:F,y:G,sdf:N,pixelRatio:te,stretchX:ie,stretchY:J,content:re}=m[U],pe=new a.RGBAImage({width:j,height:Z});a.RGBAImage.copy(B,pe,{x:F,y:G},{x:0,y:0},{width:j,height:Z}),V[U]={data:pe,pixelRatio:te,sdf:N,stretchX:ie,stretchY:J,content:re}}d(null,V)}}return{cancel(){I&&(I.cancel(),I=null),M&&(M.cancel(),M=null)}}}(n,this.map._requestManager,(o,u)=>{if(this._spriteRequest=null,o)this.fire(new a.ErrorEvent(o));else if(u)for(const d in u)this.imageManager.addImage(d,u[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(n){const o=this.getSource(n.source);if(!o)return;const u=n.sourceLayer;u&&("geojson"===o.type||o.vectorLayerIds&&-1===o.vectorLayerIds.indexOf(u))&&this.fire(new a.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${o.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const o=[];for(const u of n){const d=this._layers[u];"custom"!==d.type&&o.push(d.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&ns[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const o=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(d.length||m.length)&&this._updateWorkerLayers(d,m);for(const y in this._updatedSources){const b=this._updatedSources[y];"reload"===b?this._reloadSource(y):"clear"===b&&this._clearSource(y)}this._updateTilesForChangedImages();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const u={};for(const d in this._sourceCaches){const m=this._sourceCaches[d];u[d]=m.used,m.used=!1}for(const d of this._order){const m=this._layers[d];if(m.recalculate(n,this._availableImages),!m.isHidden(n.zoom)){const b=this._getLayerSourceCache(m);b&&(b.used=!0)}const y=this.map.painter;if(y){const b=m.getProgramIds();if(!b)continue;const w=m.getProgramConfiguration(n.zoom);for(const I of b)y.useProgram(I,w)}}for(const d in u){const m=this._sourceCaches[d];u[d]!==m.used&&m.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:m.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Yi(this,a.validateStyle(n)))return!1;(n=a.clone$1(n)).layers=Tt(n.layers);const o=function(d,m){if(!d)return[{command:it.setStyle,args:[m]}];let y=[];try{if(!h(d.version,m.version))return[{command:it.setStyle,args:[m]}];h(d.center,m.center)||y.push({command:it.setCenter,args:[m.center]}),h(d.zoom,m.zoom)||y.push({command:it.setZoom,args:[m.zoom]}),h(d.bearing,m.bearing)||y.push({command:it.setBearing,args:[m.bearing]}),h(d.pitch,m.pitch)||y.push({command:it.setPitch,args:[m.pitch]}),h(d.sprite,m.sprite)||y.push({command:it.setSprite,args:[m.sprite]}),h(d.glyphs,m.glyphs)||y.push({command:it.setGlyphs,args:[m.glyphs]}),h(d.transition,m.transition)||y.push({command:it.setTransition,args:[m.transition]}),h(d.light,m.light)||y.push({command:it.setLight,args:[m.light]}),h(d.fog,m.fog)||y.push({command:it.setFog,args:[m.fog]}),h(d.projection,m.projection)||y.push({command:it.setProjection,args:[m.projection]});const b={},w=[];!function(D,B,V,U){let j;for(j in B=B||{},D=D||{})D.hasOwnProperty(j)&&(B.hasOwnProperty(j)||Dt(j,V,U));for(j in B)B.hasOwnProperty(j)&&(D.hasOwnProperty(j)?h(D[j],B[j])||("geojson"===D[j].type&&"geojson"===B[j].type&&Pn(D,B,j)?V.push({command:it.setGeoJSONSourceData,args:[j,B[j].data]}):Xn(j,B,V,U)):Mt(j,B,V))}(d.sources,m.sources,w,b);const I=[];d.layers&&d.layers.forEach(D=>{D.source&&b[D.source]?y.push({command:it.removeLayer,args:[D.id]}):I.push(D)});let M=d.terrain;M&&b[M.source]&&(y.push({command:it.setTerrain,args:[void 0]}),M=void 0),y=y.concat(w),h(M,m.terrain)||y.push({command:it.setTerrain,args:[m.terrain]}),function(D,B,V){B=B||[];const U=(D=D||[]).map(Ci),j=B.map(Ci),Z=D.reduce(oi,{}),F=B.reduce(oi,{}),G=U.slice(),N=Object.create(null);let te,ie,J,re,pe,ge,me;for(te=0,ie=0;te<U.length;te++)J=U[te],F.hasOwnProperty(J)?ie++:(V.push({command:it.removeLayer,args:[J]}),G.splice(G.indexOf(J,ie),1));for(te=0,ie=0;te<j.length;te++)J=j[j.length-1-te],G[G.length-1-te]!==J&&(Z.hasOwnProperty(J)?(V.push({command:it.removeLayer,args:[J]}),G.splice(G.lastIndexOf(J,G.length-ie),1)):ie++,ge=G[G.length-te],V.push({command:it.addLayer,args:[F[J],ge]}),G.splice(G.length-te,0,J),N[J]=!0);for(te=0;te<j.length;te++)if(J=j[te],re=Z[J],pe=F[J],!N[J]&&!h(re,pe))if(h(re.source,pe.source)&&h(re["source-layer"],pe["source-layer"])&&h(re.type,pe.type)){for(me in ve(re.layout,pe.layout,V,J,null,it.setLayoutProperty),ve(re.paint,pe.paint,V,J,null,it.setPaintProperty),h(re.filter,pe.filter)||V.push({command:it.setFilter,args:[J,pe.filter]}),h(re.minzoom,pe.minzoom)&&h(re.maxzoom,pe.maxzoom)||V.push({command:it.setLayerZoomRange,args:[J,pe.minzoom,pe.maxzoom]}),re)re.hasOwnProperty(me)&&"layout"!==me&&"paint"!==me&&"filter"!==me&&"metadata"!==me&&"minzoom"!==me&&"maxzoom"!==me&&(0===me.indexOf("paint.")?ve(re[me],pe[me],V,J,me.slice(6),it.setPaintProperty):h(re[me],pe[me])||V.push({command:it.setLayerProperty,args:[J,me,pe[me]]}));for(me in pe)pe.hasOwnProperty(me)&&!re.hasOwnProperty(me)&&"layout"!==me&&"paint"!==me&&"filter"!==me&&"metadata"!==me&&"minzoom"!==me&&"maxzoom"!==me&&(0===me.indexOf("paint.")?ve(re[me],pe[me],V,J,me.slice(6),it.setPaintProperty):h(re[me],pe[me])||V.push({command:it.setLayerProperty,args:[J,me,pe[me]]}))}else V.push({command:it.removeLayer,args:[J]}),ge=G[G.lastIndexOf(J)+1],V.push({command:it.addLayer,args:[pe,ge]})}(I,m.layers,y)}catch(b){console.warn("Unable to compute style diff:",b),y=[{command:it.setStyle,args:[m]}]}return y}(this.serialize(),n).filter(d=>!(d.command in Yn));if(0===o.length)return!1;const u=o.filter(d=>!(d.command in is));if(u.length>0)throw new Error(`Unimplemented: ${u.map(d=>d.command).join(", ")}.`);return o.forEach(d=>{"setTransition"!==d.command&&"setProjection"!==d.command&&this[d.command].apply(this,d.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,o){return this.getImage(n)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,o),this._afterImageUpdated(n),this)}updateImage(n,o){this.imageManager.updateImage(n,o)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,o,u={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(a.validateSource,`sources.${n}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const d=ce(n,o,this.dispatcher,this);d.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:d.serialize(),sourceId:n}));const m=y=>{const b=(y?"symbol:":"other:")+n,w=this._sourceCaches[b]=new a.SourceCache(b,d,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[n]=w,w.style=this,w.onAdd(this.map)};m(!1),"vector"!==o.type&&"geojson"!==o.type||m(!0),d.onAdd&&d.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const o=this.getSource(n);if(!o)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new a.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const u=this._getSourceCaches(n);for(const d of u)delete this._sourceCaches[d.id],delete this._updatedSources[d.id],d.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,o){this._checkLoaded(),this.getSource(n).setData(o),this._changed=!0}getSource(n){const o=this._getSourceCache(n);return o&&o.getSource()}_getSources(){const n=[];for(const o in this._otherSourceCaches){const u=this._getSourceCache(o);u&&n.push(u.getSource())}return n}addLayer(n,o,u={}){this._checkLoaded();const d=n.id;if(this.getLayer(d))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${d}" already exists on this map`)));let m;if("custom"===n.type){if(Yi(this,a.validateCustomStyleLayer(n)))return;m=a.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(d,n.source),n=a.clone$1(n),n=a.extend(n,{source:d})),this._validate(a.validateLayer,`layers.${d}`,n,{arrayIndex:-1},u))return;m=a.createStyleLayer(n),this._validateLayer(m),m.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0)}const y=o?this._order.indexOf(o):this._order.length;if(o&&-1===y)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(y,0,d),this._layerOrderChanged=!0,this._layers[d]=m;const b=this._getLayerSourceCache(m);if(this._removedLayers[d]&&m.source&&b&&"custom"!==m.type){const w=this._removedLayers[d];delete this._removedLayers[d],w.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",b.pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,o){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===o)return;const u=this._order.indexOf(n);this._order.splice(u,1);const d=o?this._order.indexOf(o):this._order.length;o&&-1===d?this.fire(new a.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(d,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const o=this._layers[n];if(!o)return void this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const u=this._order.indexOf(n);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=o,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const o in this._layers)if(this._layers[o].type===n)return!0;return!1}setLayerZoomRange(n,o,u){this._checkLoaded();const d=this.getLayer(n);d?d.minzoom===o&&d.maxzoom===u||(null!=o&&(d.minzoom=o),null!=u&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,o,u={}){this._checkLoaded();const d=this.getLayer(n);if(d){if(!h(d.filter,o))return null==o?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(a.validateFilter,`layers.${d.id}.filter`,o,{layerType:d.type},u)||(d.filter=a.clone$1(o),this._updateLayer(d)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const o=this.getLayer(n);return o&&a.clone$1(o.filter)}setLayoutProperty(n,o,u,d={}){this._checkLoaded();const m=this.getLayer(n);m?h(m.getLayoutProperty(o),u)||(m.setLayoutProperty(o,u,d),this._updateLayer(m)):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,o){const u=this.getLayer(n);if(u)return u.getLayoutProperty(o);this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,o,u,d={}){this._checkLoaded();const m=this.getLayer(n);m?h(m.getPaintProperty(o),u)||(m.setPaintProperty(o,u,d)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,o){const u=this.getLayer(n);return u&&u.getPaintProperty(o)}setFeatureState(n,o){this._checkLoaded();const u=n.source,d=n.sourceLayer,m=this.getSource(u);if(!m)return void this.fire(new a.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const y=m.type;if("geojson"===y&&d)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===y&&!d)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const b=this._getSourceCaches(u);for(const w of b)w.setFeatureState(d,n.id,o)}removeFeatureState(n,o){this._checkLoaded();const u=n.source,d=this.getSource(u);if(!d)return void this.fire(new a.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const m=d.type,y="vector"===m?n.sourceLayer:void 0;if("vector"===m&&!y)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const b=this._getSourceCaches(u);for(const w of b)w.removeFeatureState(y,n.id,o)}getFeatureState(n){this._checkLoaded();const o=n.source,u=n.sourceLayer,d=this.getSource(o);if(d){if("vector"!==d.type||u)return void 0===n.id&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(u,n.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const o in this._sourceCaches){const u=this._sourceCaches[o].getSource();n[u.id]||(n[u.id]=u.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},o=>void 0!==o)}_updateLayer(n){this._updatedLayers[n.id]=!0;const o=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&o&&"raster"!==o.getSource().type&&(this._updatedSources[n.source]="reload",o.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const o=y=>"fill-extrusion"===this._layers[y].type,u={},d=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(o(b)){u[b]=y;for(const w of n){const I=w[b];if(I)for(const M of I)d.push(M)}}}d.sort((y,b)=>b.intersectionZ-y.intersectionZ);const m=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(o(b))for(let w=d.length-1;w>=0;w--){const I=d[w].feature;if(u[I.layer.id]<y)break;m.push(I),d.pop()}else for(const w of n){const I=w[b];if(I)for(const M of I)m.push(M.feature)}}return m}queryRenderedFeatures(n,o,u){o&&o.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const d={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of o.layers){const I=this._layers[w];if(!I)return this.fire(new a.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];d[I.source]=!0}}const m=[];o.availableImages=this._availableImages;const y=o&&o.layers?o.layers.some(w=>{const I=this.getLayer(w);return I&&I.is3D()}):this.has3DLayers(),b=ar.createFromScreenPoints(n,u);for(const w in this._sourceCaches){const I=this._sourceCaches[w].getSource().id;o.layers&&!d[I]||m.push(he(this._sourceCaches[w],this._layers,this._serializedLayers,b,o,u,y,!!this.map._showQueryGeometry))}return this.placement&&m.push(function(w,I,M,D,B,V,U){const j={},Z=V.queryRenderedSymbols(D),F=[];for(const G of Object.keys(Z).map(Number))F.push(U[G]);F.sort(qe);for(const G of F){const N=G.featureIndex.lookupSymbolFeatures(Z[G.bucketInstanceId],I,G.bucketIndex,G.sourceLayerIndex,B.filter,B.layers,B.availableImages,w);for(const te in N){const ie=j[te]=j[te]||[],J=N[te];J.sort((re,pe)=>{const ge=G.featureSortOrder;if(ge){const me=ge.indexOf(re.featureIndex);return ge.indexOf(pe.featureIndex)-me}return pe.featureIndex-re.featureIndex});for(const re of J)ie.push(re)}}for(const G in j)j[G].forEach(N=>{const te=N.feature,ie=M(w[G]).getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=ie});return j}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),b.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(n,o){o&&o.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const u=this._getSourceCaches(n);let d=[];for(const m of u)d=d.concat(Ae(m,o));return d}addSourceType(n,o,u){return gn.getSourceType(n)?u(new Error(`A source type called "${n}" already exists.`)):(gn.setSourceType(n,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:o.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(n,o={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const y in n)if(!h(n[y],u[y])){d=!0;break}if(!d)return;const m=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,o),this.light.updateTransitions(m)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,o=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===o){if("object"==typeof n.source){const u="terrain-dem-src";this.addSource(u,n.source),n=a.clone$1(n),n=a.extend(n,{source:u})}if(this._validate(a.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode)this._createTerrain(n,o);else{const u=this.terrain,d=u.get();for(const m of Object.keys(a.spec.terrain))!n.hasOwnProperty(m)&&a.spec.terrain[m].default&&(n[m]=a.spec.terrain[m].default);for(const m in n)if(!h(n[m],d[m])){u.set(n),this.stylesheet.terrain=n;const y=this._setTransitionParameters({duration:0});u.updateTransitions(y);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const o=this.fog=new mo(n,this.map.transform);this.stylesheet.fog=n;const u=this._setTransitionParameters({duration:0});o.updateTransitions(u)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,u=o.get();0===Object.keys(n).length&&o.set(n);for(const d in n)if(!h(n[d],u[d])){o.set(n),this.stylesheet.fog=n;const m=this._setTransitionParameters({duration:0});o.updateTransitions(m);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:a.exported.now(),transition:a.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(u=>this.isLayerDraped(this._layers[u])),o=this._order.filter(u=>!this.isLayerDraped(this._layers[u]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...o)}_createTerrain(n,o){const u=this.terrain=new Gt(n,o);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const d=this._setTransitionParameters({duration:0});u.updateTransitions(d)}_force3DLayerUpdate(){for(const n in this._layers){const o=this._layers[n];"fill-extrusion"===o.type&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const o=this._layers[n];"symbol"===o.type&&this._updateLayer(o)}}_validate(n,o,u,d,m={}){return(!m||!1!==m.validate)&&Yi(this,n.call(a.validateStyle,a.extend({key:o,style:this.serialize(),value:u,styleSpec:a.spec},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const o=this._getSourceCaches(n);for(const u of o)u.clearTiles()}_reloadSource(n){const o=this._getSourceCaches(n);for(const u of o)u.resume(),u.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const o in this._sourceCaches)this._sourceCaches[o].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const o=this._sourceCaches[n];o.resume(),o.reload()}}_updatePlacement(n,o,u,d,m=!1){let y=!1,b=!1;const w={};for(const I of this._order){const M=this._layers[I];if("symbol"!==M.type)continue;if(!w[M.source]){const B=this._getLayerSourceCache(M);if(!B)continue;w[M.source]=B.getRenderableIds(!0).map(V=>B.getTileByID(V)).sort((V,U)=>U.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(U.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(M,w[M.source],n.center.lng,n.projection);y=y||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),m=m||this._layerOrderChanged||0===u,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(m||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),n.zoom))&&(this.pauseablePlacement=new zl(n,this._order,m,o,u,d,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,w),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const I of this._order){const M=this._layers[I];"symbol"===M.type&&this.placement.updateLayerOpacities(M,w[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,o,u){this.imageManager.getImages(o.icons,u),this._updateTilesForChangedImages();const d=m=>{m&&m.setDependencies(o.tileID.key,o.type,o.icons)};d(this._otherSourceCaches[o.source]),d(this._symbolSourceCaches[o.source])}getGlyphs(n,o,u){this.glyphManager.getGlyphs(o.stacks,u)}getResource(n,o,u){return a.makeRequest(o,u)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const o=[];return this._otherSourceCaches[n]&&o.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&o.push(this._symbolSourceCaches[n]),o}_isSourceCacheLoaded(n){const o=this._getSourceCaches(n);return 0===o.length?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):o.every(u=>u.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}gn.getSourceType=function(l){return ue[l]},gn.setSourceType=function(l,n){ue[l]=n},gn.registerForPluginStateChange=a.registerForPluginStateChange;var Ma="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",rs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ka="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Zs="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",So="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Ns={},Vs={};const _r=[];yn(Ma,_r),yn(ka,_r),yn(Zs,_r),yn(So,_r),Ns=At("",ka),Vs=At(So,Zs);const js=At("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Vr=Ma,os="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var qs={background:At("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:At("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:At("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:At("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:At("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:At("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:At("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:At("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:At("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:At("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:At("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:At("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:At("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:At("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:At("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:At("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:At("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:At("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:At("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:At("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:At("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:At("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:At("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:At("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:At("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:At("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",rs),skyboxGradient:At("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",rs),skyboxCapture:At("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:At("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:At("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function yn(l,n){const o=l.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let u of o)if(u=u.trim(),"#"===u[0]&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const d=u.split(" ");for(const m of d)n.includes(m)||n.push(m)}}function At(l,n){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),d={},m=[..._r];return yn(l,m),yn(n,m),{fragmentSource:l=l.replace(o,(y,b,w,I,M)=>(d[M]=!0,"define"===b?`\n#ifndef HAS_UNIFORM_u_${M}\nvarying ${w} ${I} ${M};\n#else\nuniform ${w} ${I} u_${M};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${M}\n    ${w} ${I} ${M} = u_${M};\n#endif\n`)),vertexSource:n=n.replace(o,(y,b,w,I,M)=>{const D="float"===I?"vec2":"vec4",B=M.match(/color/)?"color":D;return d[M]?"define"===b?`\n#ifndef HAS_UNIFORM_u_${M}\nuniform lowp float u_${M}_t;\nattribute ${w} ${D} a_${M};\nvarying ${w} ${I} ${M};\n#else\nuniform ${w} ${I} u_${M};\n#endif\n`:"vec4"===B?`\n#ifndef HAS_UNIFORM_u_${M}\n    ${M} = a_${M};\n#else\n    ${w} ${I} ${M} = u_${M};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${M}\n    ${M} = unpack_mix_${B}(a_${M}, u_${M}_t);\n#else\n    ${w} ${I} ${M} = u_${M};\n#endif\n`:"define"===b?`\n#ifndef HAS_UNIFORM_u_${M}\nuniform lowp float u_${M}_t;\nattribute ${w} ${D} a_${M};\n#else\nuniform ${w} ${I} u_${M};\n#endif\n`:"vec4"===B?`\n#ifndef HAS_UNIFORM_u_${M}\n    ${w} ${I} ${M} = a_${M};\n#else\n    ${w} ${I} ${M} = u_${M};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${M}\n    ${w} ${I} ${M} = unpack_mix_${B}(a_${M}, u_${M}_t);\n#else\n    ${w} ${I} ${M} = u_${M};\n#endif\n`}),staticAttributes:u,usedDefines:m}}class Io{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,o,u,d,m,y,b){this.context=n;let w=this.boundPaintVertexBuffers.length!==d.length;for(let M=0;!w&&M<d.length;M++)this.boundPaintVertexBuffers[M]!==d[M]&&(w=!0);let I=this.boundDynamicVertexBuffers.length!==b.length;for(let M=0;!I&&M<b.length;M++)this.boundDynamicVertexBuffers[M]!==b[M]&&(I=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||w||I||this.boundIndexBuffer!==m||this.boundVertexOffset!==y)this.freshBind(o,u,d,m,y,b);else{n.bindVertexArrayOES.set(this.vao);for(const M of b)M&&M.bind();m&&m.dynamicDraw&&m.bind()}}freshBind(n,o,u,d,m,y){let b;const w=n.numAttributes,I=this.context,M=I.gl;if(I.extVertexArrayObject)this.vao&&this.destroy(),this.vao=I.extVertexArrayObject.createVertexArrayOES(),I.bindVertexArrayOES.set(this.vao),b=0,this.boundProgram=n,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=m,this.boundDynamicVertexBuffers=y;else{b=I.currentNumAttributes||0;for(let D=w;D<b;D++)M.disableVertexAttribArray(D)}o.enableAttributes(M,n),o.bind(),o.setVertexAttribPointers(M,n,m);for(const D of u)D.enableAttributes(M,n),D.bind(),D.setVertexAttribPointers(M,n,m);for(const D of y)D&&(D.enableAttributes(M,n),D.bind(),D.setVertexAttribPointers(M,n,m));d&&d.bind(),I.currentNumAttributes=w}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ss(l,n){const o=Math.pow(2,n.canonical.z),u=n.canonical.y;return[new a.MercatorCoordinate(0,u/o).toLngLat().lat,new a.MercatorCoordinate(0,(u+1)/o).toLngLat().lat]}function as(l,n,o,u,d,m,y){const b=l.context,w=b.gl,I=o.fbo;if(!I)return;l.prepareDrawTile();const M=l.useProgram("hillshade");b.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,I.colorAttachment.get());const D=((j,Z,F,G)=>{const N=F.paint.get("hillshade-shadow-color"),te=F.paint.get("hillshade-highlight-color"),ie=F.paint.get("hillshade-accent-color");let J=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===F.paint.get("hillshade-illumination-anchor")&&(J-=j.transform.angle);const re=!j.options.moving;return{u_matrix:G||j.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),re),u_image:0,u_latrange:ss(0,Z.tileID),u_light:[F.paint.get("hillshade-exaggeration"),J],u_shadow:N,u_highlight:te,u_accent:ie}})(l,o,u,l.terrain?n.projMatrix:null);l.prepareDrawProgram(b,M,n.toUnwrapped());const{tileBoundsBuffer:B,tileBoundsIndexBuffer:V,tileBoundsSegments:U}=l.getTileBoundsBuffers(o);M.draw(b,w.TRIANGLES,d,m,y,a.CullFaceMode.disabled,D,u.id,B,V,U)}function ls(l,n,o){if(!n.needsDEMTextureUpload)return;const u=l.context,d=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||l.getTileTexture(o.stride);const m=o.getPixels();n.demTexture?n.demTexture.update(m,{premultiply:!1}):n.demTexture=new a.Texture(u,m,d.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function Gs(l,n,o,u,d,m){const y=l.context,b=y.gl;if(!n.dem)return;const w=n.dem;if(y.activeTexture.set(b.TEXTURE1),ls(l,n,w),!n.demTexture)return;n.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const I=w.dim;y.activeTexture.set(b.TEXTURE0);let M=n.fbo;if(!M){const U=new a.Texture(y,{width:I,height:I,data:null},b.RGBA);U.bind(b.LINEAR,b.CLAMP_TO_EDGE),M=n.fbo=y.createFramebuffer(I,I,!0),M.colorAttachment.set(U.texture)}y.bindFramebuffer.set(M.framebuffer),y.viewport.set([0,0,I,I]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:B,tileBoundsSegments:V}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(y,b.TRIANGLES,u,d,m,a.CullFaceMode.disabled,((U,j)=>{const Z=j.stride,F=a.create();return a.ortho(F,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(F,F,[0,-a.EXTENT,0]),{u_matrix:F,u_image:1,u_dimension:[Z,Z],u_zoom:U.overscaledZ,u_unpack:j.unpackVector}})(n.tileID,w),o.id,D,B,V),n.needsHillshadePrepare=!1}const cs=l=>({u_matrix:new a.UniformMatrix4f(l),u_image0:new a.Uniform1i(l),u_skirt_height:new a.Uniform1f(l)}),$s=(l,n)=>({u_matrix:l,u_image0:0,u_skirt_height:n}),us=(l,n,o,u,d,m,y,b,w,I,M,D,B,V)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:o,u_zoom_transition:d,u_merc_center:m,u_image0:0,u_frustum_tl:y,u_frustum_tr:b,u_frustum_br:w,u_frustum_bl:I,u_globe_pos:M,u_globe_radius:D,u_viewport:B,u_grid_matrix:V?Float32Array.from(V):new Float32Array(9)});function gr(l,n){return null!=l&&null!=n&&!(!l.hasData()||!n.hasData())&&null!=l.demTexture&&null!=n.demTexture&&l.tileID.key!==n.tileID.key}const Qn=new class{constructor(){this.operations={}}newMorphing(l,n,o,u,d){if(l in this.operations){const m=this.operations[l];m.to.tileID.key!==o.tileID.key&&(m.queued=o)}else this.operations[l]={startTime:u,phase:0,duration:d,from:n,to:o,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const n=this.operations[l];return{from:n.from,to:n.to,phase:n.phase}}update(l){for(const n in this.operations){const o=this.operations[n];for(o.phase=(l-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,l)){delete this.operations[n];break}}}_nextOp(l,n){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=n,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},jr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Et(l,n){const o=1<<l.z;return!n&&(0===l.x||l.x===o-1)||0===l.y||l.y===o-1}const qr=l=>({u_matrix:l});function Mo(l,n,o,u,d){if(d>0){const m=a.exported.now(),y=(m-l.timeAdded)/d,b=n?(m-n.timeAdded)/d:-1,w=o.getSource(),I=u.coveringZoomLevel({tileSize:w.tileSize,roundZoom:w.roundZoom}),M=!n||Math.abs(n.tileID.overscaledZ-I)>Math.abs(l.tileID.overscaledZ-I),D=M&&l.refreshedUponExpiration?1:a.clamp(M?y:1-b,0,1);return l.refreshedUponExpiration&&y>=1&&(l.refreshedUponExpiration=!1),n?{opacity:1,mix:1-D}:{opacity:D,mix:0}}return{opacity:1,mix:0}}class za extends a.SourceCache{constructor(n){const o={type:"raster-dem",maxzoom:n.transform.maxZoom},u=new Xi(Qe(),null),d=ce("mock-dem",o,u,n.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,o){n.state="loaded",o(null)}}class Pa extends a.SourceCache{constructor(n){const o=ce("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Xi(Qe(),null),n.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,o,u){if(n.freezeTileCoverage)return;this.transform=n;const d=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((m,y)=>{if(m[y.key]="",!this._tiles[y.key]){const b=new a.Tile(y,this._source.tileSize*y.overscaleFactor(),n.tileZoom);b.state="loaded",this._tiles[y.key]=b}return m},{});for(const m in this._tiles)m in d||(this.freeFBO(m),this._tiles[m].unloadVectorData(),delete this._tiles[m])}freeFBO(n){const o=this.proxyCachedFBO[n];if(void 0!==o){const u=Object.values(o);this.renderCachePool.push(...u),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hs extends a.OverscaledTileID{constructor(n,o,u){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=o,this.projMatrix=u}}class Da extends a.Elevation{constructor(n,o){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,d,m]=function(w){const I=new a.StructArrayLayout4i8,M=new a.StructArrayLayout3ui6,D=131;I.reserve(17161),M.reserve(33800);const B=a.EXTENT/128,V=a.EXTENT+B/2,U=V+B;for(let Z=-B;Z<U;Z+=B)for(let F=-B;F<U;F+=B){const G=F<0||F>V||Z<0||Z>V?24575:0,N=a.clamp(Math.round(F),0,a.EXTENT),te=a.clamp(Math.round(Z),0,a.EXTENT);I.emplaceBack(N+G,te,N,te)}const j=(Z,F)=>{const G=F*D+Z;M.emplaceBack(G+1,G,G+D),M.emplaceBack(G+D,G+D+1,G+1)};for(let Z=1;Z<129;Z++)for(let F=1;F<129;F++)j(F,Z);return[0,129].forEach(Z=>{for(let F=0;F<130;F++)j(F,Z),j(Z,F)}),[I,M,32768]}(),y=n.context;this.gridBuffer=y.createVertexBuffer(u,a.boundsAttributes.members),this.gridIndexBuffer=y.createIndexBuffer(d),this.gridSegments=a.SegmentVector.simpleSegment(0,0,u.length,d.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,u.length,m),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Pa(o.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,a.EXTENT,0,a.EXTENT,0,1);const b=y.gl;this._overlapStencilMode=new a.StencilMode({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new za(o.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,o,u){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const d=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(d.get("source")),this._exaggeration=d.get("exaggeration");const m=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const y=this.getScaledDemTileSize();this.sourceCache.update(o,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,m(),this._initializing=!0),m(),o.updateElevation(!u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&a.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=0===u._centerAltitude&&-1===this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(u.center),-1),this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=o.getIds().map(w=>{const I=o.getTileByID(w).tileID;return I.projMatrix=u.calculateProjMatrix(I.toUnwrapped()),I});(function(w,I){const M=I.transform.pointCoordinate(I.transform.getCameraPoint()),D=new a.pointGeometry(M.x,M.y);w.sort((B,V)=>{if(V.overscaledZ-B.overscaledZ)return V.overscaledZ-B.overscaledZ;const U=new a.pointGeometry(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),j=new a.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Z=D.mult(1<<B.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(U)-Z.distSqr(j)})})(d,this.painter),this._previousZoom=u.zoom;const m=this.proxyToSource||{};this.proxyToSource={},d.forEach(w=>{this.proxyToSource[w.key]={}}),this.terrainTileForTile={};const y=this._style._sourceCaches;for(const w in y){const I=y[w];if(!I.used||(I!==this.sourceCache&&this.resetTileLookupCache(I.id),this._setupProxiedCoordsForOrtho(I,n[w],m),I.usedForTerrain))continue;const M=n[w];I.getSource().reparseOverscaled&&this._assignTerrainTiles(M)}this.proxiedCoords[o.id]=d.map(w=>new hs(w,w.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(m),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const b={};this._visibleDemTiles=[];for(const w of this.proxyCoords){const I=this.terrainTileForTile[w.key];if(!I)continue;const M=I.tileID.key;M in b||(this._visibleDemTiles.push(I),b[M]=M)}}_assignTerrainTiles(n){this._initializing||n.forEach(o=>{if(this.terrainTileForTile[o.key])return;const u=this._findTileCoveringTileID(o,this.sourceCache);u&&(this.terrainTileForTile[o.key]=u)})}_prepareDEMTextures(){const n=this.painter.context,o=n.gl;for(const u in this.terrainTileForTile){const d=this.terrainTileForTile[u],m=d.dem;!m||d.demTexture&&!d.needsDEMTextureUpload||(n.activeTexture.set(o.TEXTURE1),ls(this.painter,d,m))}}_prepareDemTileUniforms(n,o,u,d){if(!o||null==o.demTexture)return!1;const m=n.tileID.canonical,y=Math.pow(2,o.tileID.canonical.z-m.z),b=d||"";return u[`u_dem_tl${b}`]=[m.x*y%1,m.y*y%1],u[`u_dem_scale${b}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,o=n.gl;if(!this._emptyDepthBufferTexture){const u=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(n,u,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const o=this._visibleDemTiles.reduce((u,d)=>{if(!d.dem)return u;const m=d.dem.tree.minimums[0];return m>0&&n++,u+m},0);return n?o/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,o=n.gl;n.activeTexture.set(o.TEXTURE2);const u=this._getLoadedAreaMinimum(),d=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(u,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let m=this._emptyDEMTexture;return m?m.update(d,{premultiply:!1}):m=this._emptyDEMTexture=new a.Texture(n,d,o.RGBA,{premultiply:!1}),m}setupElevationDraw(n,o,u){const d=this.painter.context,m=d.gl,y=(b=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(b),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var b;y.u_dem_size=this.sourceCache.getSource().tileSize,y.u_exaggeration=this.exaggeration();let w=null,I=null,M=1;if(u&&u.morphing&&this._useVertexMorphing){const D=u.morphing.srcDemTile,B=u.morphing.dstDemTile;M=u.morphing.phase,D&&B&&(this._prepareDemTileUniforms(n,D,y,"_prev")&&(I=D),this._prepareDemTileUniforms(n,B,y)&&(w=B))}if(I&&w?(d.activeTexture.set(m.TEXTURE2),w.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE,m.NEAREST),d.activeTexture.set(m.TEXTURE4),I.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE,m.NEAREST),y.u_dem_lerp=M):(w=this.terrainTileForTile[n.tileID.key],d.activeTexture.set(m.TEXTURE2),(this._prepareDemTileUniforms(n,w,y)?w.demTexture:this.emptyDEMTexture).bind(m.NEAREST,m.CLAMP_TO_EDGE)),d.activeTexture.set(m.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),this._depthFBO&&(y.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),y.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&w){const D=(1<<w.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=D}if(u&&u.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),o.setTerrainUniformValues(d,y),"globe"===this.painter.transform.projection.name){const D=this.globeUniformValues(this.painter.transform,n.tileID.canonical,u&&u.useDenormalizedUpVectorScale);o.setGlobeUniformValues(d,D)}}globeUniformValues(n,o,u){const d=n.projection;return{u_tile_tl_up:d.upVector(o,0,0),u_tile_tr_up:d.upVector(o,a.EXTENT,0),u_tile_br_up:d.upVector(o,a.EXTENT,a.EXTENT),u_tile_bl_up:d.upVector(o,0,a.EXTENT),u_tile_up_scale:u?a.GLOBE_METERS_TO_ECEF:d.upVectorScale(o,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const o=this.painter,u=this.painter.context;0!==n.length&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(d,m,y,b,w){if("globe"===d.transform.projection.name)!function(I,M,D,B,V){const U=I.context,j=U.gl;let Z,F;const G=I.options.showTerrainWireframe?2:0,N=I.transform,te=a.globeUseCustomAntiAliasing(I,U,N),ie=(de,ae)=>{if(F===de)return;const Ze=[jr[de],"PROJECTION_GLOBE_VIEW"];te&&Ze.push("CUSTOM_ANTIALIASING"),ae&&Ze.push(jr[G]),Z=I.useProgram("globeRaster",null,Ze),F=de},J=I.colorModeForRenderPass(),re=new a.DepthMode(j.LEQUAL,a.DepthMode.ReadWrite,I.depthRangeFor3D);Qn.update(V);const pe=a.calculateGlobeMercatorMatrix(N),ge=[a.mercatorXfromLng(N.center.lng),a.mercatorYfromLat(N.center.lat)],me=G?[!1,!0]:[!1],ze=I.globeSharedBuffers,le=[N.width*a.exported.devicePixelRatio,N.height*a.exported.devicePixelRatio],Ee=Float32Array.from(N.globeMatrix),Te={useDenormalizedUpVectorScale:!0};if(me.forEach(de=>{F=-1;const ae=de?j.LINES:j.TRIANGLES;for(const Ze of B){const Le=D.getTile(Ze),Fe=a.StencilMode.disabled,Re=M.prevTerrainTileForTile[Ze.key],We=M.terrainTileForTile[Ze.key];gr(Re,We)&&Qn.newMorphing(Ze.key,Re,We,V,250),U.activeTexture.set(j.TEXTURE0),Le.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const ot=Qn.getMorphValuesForProxy(Ze.key),tt=ot?1:0;ot&&a.extend$1(Te,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:a.easeCubicInOut(ot.phase)}});const Ye=a.tileCornersToBounds(Ze.canonical),Be=a.getLatitudinalLod(Ye.getCenter().lat),at=a.getGridMatrix(Ze.canonical,Ye,Be,N.worldSize/N._pixelsPerMercatorPixel),ft=a.globeNormalizeECEF(a.globeTileBounds(Ze.canonical)),Ot=us(N.projMatrix,Ee,pe,ft,a.globeToMercatorTransition(N.zoom),ge,N.frustumCorners.TL,N.frustumCorners.TR,N.frustumCorners.BR,N.frustumCorners.BL,N.globeCenterInViewSpace,N.globeRadius,le,at);if(ie(tt,de),M.setupElevationDraw(Le,Z,Te),I.prepareDrawProgram(U,Z,Ze.toUnwrapped()),ze){const[Ft,Lt,vi]=de?ze.getWirefameBuffers(I.context,Be):ze.getGridBuffers(Be);Z.draw(U,ae,re,Fe,J,a.CullFaceMode.backCCW,Ot,"globe_raster",Ft,Lt,vi)}}}),ze){const de=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&de.push("CUSTOM_ANTIALIASING"),Z=I.useProgram("globeRaster",null,de);for(const ae of B){const{x:Ze,y:Le,z:Fe}=ae.canonical,Re=0===Le,We=Le===(1<<Fe)-1,[ot,tt,Ye,Be]=ze.getPoleBuffers(Fe);if(Be&&(Re||We)){const at=D.getTile(ae);U.activeTexture.set(j.TEXTURE0),at.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let ft=a.globePoleMatrixForTile(Fe,Ze,N);const Ot=a.globeNormalizeECEF(a.globeTileBounds(ae.canonical)),Ft=(Lt,vi)=>Lt.draw(U,j.TRIANGLES,re,a.StencilMode.disabled,J,a.CullFaceMode.disabled,us(N.projMatrix,ft,ft,Ot,0,ge,N.frustumCorners.TL,N.frustumCorners.TR,N.frustumCorners.BR,N.frustumCorners.BL,N.globeCenterInViewSpace,N.globeRadius,le),"globe_pole_raster",vi,Ye,Be);M.setupElevationDraw(at,Z,Te),I.prepareDrawProgram(U,Z,ae.toUnwrapped()),Re&&Ft(Z,ot),We&&(ft=a.scale(a.create(),ft,[1,-1,1]),Ft(Z,tt))}}}}(d,m,y,b,w);else{const I=d.context,M=I.gl;let D,B;const V=d.options.showTerrainWireframe?2:0,U=(N,te)=>{if(B===N)return;const ie=[jr[N]];te&&ie.push(jr[V]),D=d.useProgram("terrainRaster",null,ie),B=N},j=d.colorModeForRenderPass(),Z=new a.DepthMode(M.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D);Qn.update(w);const F=d.transform,G=6*Math.pow(1.5,22-F.zoom)*m.exaggeration();(V?[!1,!0]:[!1]).forEach(N=>{B=-1;const te=N?M.LINES:M.TRIANGLES,[ie,J]=N?m.getWirefameBuffer():[m.gridIndexBuffer,m.gridSegments];for(const re of b){const pe=y.getTile(re),ge=a.StencilMode.disabled,me=m.prevTerrainTileForTile[re.key],ze=m.terrainTileForTile[re.key];gr(me,ze)&&Qn.newMorphing(re.key,me,ze,w,250),I.activeTexture.set(M.TEXTURE0),pe.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);const le=Qn.getMorphValuesForProxy(re.key),Ee=le?1:0;let Te;le&&(Te={morphing:{srcDemTile:le.from,dstDemTile:le.to,phase:a.easeCubicInOut(le.phase)}});const de=$s(re.projMatrix,Et(re.canonical,F.renderWorldCopies)?G/10:G);U(Ee,N),m.setupElevationDraw(pe,D,Te),d.prepareDrawProgram(I,D,re.toUnwrapped()),D.draw(I,te,Z,ge,j,a.CullFaceMode.backCCW,de,"terrain_raster",m.gridBuffer,ie,J)}})}}(o,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const o=this.painter,u=this.painter.context,d=this.proxySourceCache,m=this.proxiedCoords[d.id],y=this._drapedRenderBatches.shift(),b=[],w=o.style.order;let I=0;for(const M of m){const D=d.getTileByID(M.proxyTileKey),B=d.proxyCachedFBO[M.key]?d.proxyCachedFBO[M.key][n]:void 0,V=void 0!==B?d.renderCache[B]:this.pool[I++],U=void 0!==B;if(D.texture=V.tex,U&&!V.dirty){b.push(D.tileID);continue}let j;u.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(u.clear({color:a.Color.transparent,stencil:0}),V.dirty=!1);for(let Z=y.start;Z<=y.end;++Z){const F=o.style._layers[w[Z]];if(F.isHidden(o.transform.zoom))continue;const G=o.style._getLayerSourceCache(F),N=G?this.proxyToSource[M.key][G.id]:[M];if(!N)continue;const te=N;u.viewport.set([0,0,V.fb.width,V.fb.height]),j!==(G?G.id:null)&&(this._setupStencil(V,N,F,G),j=G?G.id:null),o.renderLayer(o,G,F,te)}this.renderedToTile?(V.dirty=!0,b.push(D.tileID)):U||--I,5===I&&(I=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,o.width,o.height]),y.end+1}postRender(){}renderCacheEfficiency(n){const o=n.order.length;if(0===o)return{efficiency:100};let u,d=0,m=0,y=!1;for(let b=0;b<o;++b){const w=n._layers[n.order[b]];this._style.isLayerDraped(w)?(y&&++d,++m):y||(y=!0,u=w.id)}return 0===m?{efficiency:100}:{efficiency:100*(1-d/m),firstUndrapedLayer:u}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{n=Math.min(n,o.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,o,u){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter(m=>m.dem).map(m=>{const y=m.tileID,b=1<<y.overscaledZ,{x:w,y:I}=y.canonical,M=w/b,D=(w+1)/b,B=I/b,V=(I+1)/b;return{minx:M,miny:B,maxx:D,maxy:V,t:m.dem.tree.raycastRoot(M,B,D,V,n,o,u),tile:m}});d.sort((m,y)=>(null!==m.t?m.t:Number.MAX_VALUE)-(null!==y.t?y.t:Number.MAX_VALUE));for(const m of d){if(null==m.t)return null;const y=m.tile.dem.tree.raycast(m.minx,m.miny,m.maxx,m.maxy,n,o,u);if(null!=y)return y}return null}_createFBO(){const n=this.painter.context,o=n.gl,u=this.drapeBufferSize;n.activeTexture.set(o.TEXTURE0);const d=new a.Texture(n,{width:u[0],height:u[1],data:null},o.RGBA);d.bind(o.LINEAR,o.CLAMP_TO_EDGE);const m=n.createFramebuffer(u[0],u[1],!1);return m.colorAttachment.set(d.texture),m.depthAttachment=new pn(n,m.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,m.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):m.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:m,tex:d,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const o=this._style._layers[n],u=o.isHidden(this.painter.transform.zoom),d=o.getCrossfadeParameters(),m=!!d&&1!==d.t,y=o.hasTransition();return"custom"!==o.type&&!u&&(m||y)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o]._source instanceof R){n=!0;break}if(n)for(let o=0;o<this._style.order.length;++o){const u=this._style._layers[this._style.order[o]],d=u.isHidden(this.painter.transform.zoom),m=this._style._getLayerSourceCache(u);if("raster"!==u.type||d||!m)continue;const y=u.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const w=this.proxyToSource[b.key][m.id];if(w)for(const I of w){const M=Mo(m.getTile(I),m.findLoadedParent(I,0),m,this.painter.transform,y);(1!==M.opacity||0!==M.mix)&&this._clearRenderCacheForTile(m.id,I)}}}}_setupDrapedRenderBatches(){const n=this._style.order,o=n.length;if(0===o)return;const u=[];let d,m=0,y=this._style._layers[n[m]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++m<o;)y=this._style._layers[n[m]];for(;m<o;++m){const b=this._style._layers[n[m]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?void 0===d&&(d=m):void 0!==d&&(u.push({start:d,end:m-1}),d=void 0))}void 0!==d&&u.push({start:d,end:m-1}),this._drapedRenderBatches=u}_setupRenderCache(n){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const y=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let b=0;b<y.length;++b){const w=Object.values(y[b]);o.renderCachePool.push(...w)}}return}this._clearRasterFadeFromRenderCache();const u=this.proxyCoords,d=this._tilesDirty;for(let y=u.length-1;y>=0;y--){const b=u[y];if(o.getTileByID(b.key),void 0!==o.proxyCachedFBO[b.key]){const w=n[b.key],I=this.proxyToSource[b.key];let M=0;for(const D in I){const B=I[D],V=w[D];if(!V||V.length!==B.length||B.some((U,j)=>U!==V[j]||d[D]&&d[D].hasOwnProperty(U.key))){M=-1;break}++M}for(const D in o.proxyCachedFBO[b.key])o.renderCache[o.proxyCachedFBO[b.key][D]].dirty=M<0||M!==Object.values(w).length}}const m=[...this._drapedRenderBatches];m.sort((y,b)=>b.end-b.start-(y.end-y.start));for(const y of m)for(const b of u){if(o.proxyCachedFBO[b.key])continue;let w=o.renderCachePool.pop();void 0===w&&o.renderCache.length<50&&(w=o.renderCache.length,o.renderCache.push(this._createFBO())),void 0!==w&&(o.proxyCachedFBO[b.key]={},o.proxyCachedFBO[b.key][y.start]=w,o.renderCache[w].dirty=!0)}this._tilesDirty={}}_setupStencil(n,o,u,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const m=this.painter.context,y=m.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let b;if(u.isTileClipped())b=o.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(m.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(n,o){const u=this.painter,d=this.painter.context,m=d.gl;u._tileClippingMaskIDs={},d.setColorMode(a.ColorMode.disabled),d.setDepthMode(a.DepthMode.disabled);const y=u.useProgram("clippingMask");for(const b of n){const w=u._tileClippingMaskIDs[b.key]=--o;y.draw(d,m.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:m.ALWAYS,mask:0},w,255,m.KEEP,m.KEEP,m.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,qr(b.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(n){const o=this.painter.transform;if(n.x<0||n.x>o.width||n.y<0||n.y>o.height)return null;const u=[n.x,n.y,1,1];a.transformMat4$1(u,u,o.pixelMatrixInverse),a.scale$1(u,u,1/u[3]),u[0]/=o.worldSize,u[1]/=o.worldSize;const d=o._camera.position,m=a.mercatorZfromAltitude(1,o.center.lat),y=[d[0],d[1],d[2]/m,0],b=a.subtract([],u.slice(0,3),y);a.normalize(b,b);const w=this.raycast(y,b,this._exaggeration);return null!==w&&w?(a.scaleAndAdd(y,y,b,w),y[3]=y[2],y[2]*=m,y):null}drawDepth(){const n=this.painter,o=n.context,u=this.proxySourceCache,d=Math.ceil(n.width),m=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===d&&this._depthFBO.height===m||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const y=o.gl,b=o.createFramebuffer(d,m,!0);o.activeTexture.set(y.TEXTURE0);const w=new a.Texture(o,{width:d,height:m,data:null},y.RGBA);w.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.colorAttachment.set(w.texture);const I=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,d,m);b.depthAttachment.set(I),this._depthFBO=b,this._depthTexture=w}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,d,m]),function(y,b,w,I){if("globe"===y.transform.projection.name)return;const M=y.context,D=M.gl;M.clear({depth:1});const B=y.useProgram("terrainDepth"),V=new a.DepthMode(D.LESS,a.DepthMode.ReadWrite,y.depthRangeFor3D);for(const U of I){const j=w.getTile(U),Z=$s(U.projMatrix,0);b.setupElevationDraw(j,B),B.draw(M,D.TRIANGLES,V,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,Z,"terrain_depth",b.gridBuffer,b.gridIndexBuffer,b.gridNoSkirtSegments)}}(n,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,o,u){if(n.getSource()instanceof Q)return this._setupProxiedCoordsForImageSource(n,o,u);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const d=this.proxiedCoords[n.id]=[],m=this.proxyCoords;for(let b=0;b<m.length;b++){const w=m[b],I=this._findTileCoveringTileID(w,n);if(I){const M=this._createProxiedId(w,I,u[w.key]&&u[w.key][n.id]);d.push(M),this.proxyToSource[w.key][n.id]=[M]}}let y=!1;for(let b=0;b<o.length;b++){const w=n.getTile(o[b]);if(!w||!w.hasData())continue;const I=this._findTileCoveringTileID(w.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==w.tileID.canonical.z){const M=this.proxyToSource[I.tileID.key][n.id],D=this._createProxiedId(I.tileID,w,u[I.tileID.key]&&u[I.tileID.key][n.id]);M?M.splice(M.length-1,0,D):this.proxyToSource[I.tileID.key][n.id]=[D],d.push(D),y=!0}}this._sourceTilesOverlap[n.id]=y}_setupProxiedCoordsForImageSource(n,o,u){if(!n.getSource().loaded())return;const d=this.proxiedCoords[n.id]=[],m=this.proxyCoords,y=n.getSource(),b=new a.pointGeometry(y.tileID.x,y.tileID.y)._div(1<<y.tileID.z),w=y.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((M,D)=>(M.min.x=Math.min(M.min.x,D.x-b.x),M.min.y=Math.min(M.min.y,D.y-b.y),M.max.x=Math.max(M.max.x,D.x-b.x),M.max.y=Math.max(M.max.y,D.y-b.y),M),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(M,D)=>{const B=M.wrap+M.canonical.x/(1<<M.canonical.z),V=M.canonical.y/(1<<M.canonical.z),U=a.EXTENT/(1<<M.canonical.z),j=D.wrap+D.canonical.x/(1<<D.canonical.z),Z=D.canonical.y/(1<<D.canonical.z);return B+U<j+w.min.x||B>j+w.max.x||V+U<Z+w.min.y||V>Z+w.max.y};for(let M=0;M<m.length;M++){const D=m[M];for(let B=0;B<o.length;B++){const V=n.getTile(o[B]);if(!V||!V.hasData()||I(D,V.tileID))continue;const U=this._createProxiedId(D,V,u[D.key]&&u[D.key][n.id]),j=this.proxyToSource[D.key][n.id];j?j.push(U):this.proxyToSource[D.key][n.id]=[U],d.push(U)}}}_createProxiedId(n,o,u){let d=this.orthoMatrix;if(u){const m=u.find(y=>y.key===o.tileID.key);if(m)return m}if(o.tileID.key!==n.key){const m=n.canonical.z-o.tileID.canonical.z;let y,b,w;d=a.create();const I=o.tileID.wrap-n.wrap<<n.overscaledZ;m>0?(y=a.EXTENT>>m,b=y*((o.tileID.canonical.x<<m)-n.canonical.x+I),w=y*((o.tileID.canonical.y<<m)-n.canonical.y)):(y=a.EXTENT<<-m,b=a.EXTENT*(o.tileID.canonical.x-(n.canonical.x+I<<-m)),w=a.EXTENT*(o.tileID.canonical.y-(n.canonical.y<<-m))),a.ortho(d,0,y,0,y,0,1),a.translate(d,d,[b,w,0])}return new hs(o.tileID,n.key,d)}_findTileCoveringTileID(n,o){let u=o.getTile(n);if(u&&u.hasData())return u;const d=this._findCoveringTileCache[o.id],m=d[n.key];if(u=m?o.getTileByID(m):null,u&&u.hasData()||null===m)return u;let y=u?u.tileID:n,b=y.overscaledZ;const w=o.getSource().minzoom,I=[];if(!m){const D=o.getSource().maxzoom;if(n.canonical.z>=D){const B=n.canonical.z-D;o.getSource().reparseOverscaled?(b=Math.max(n.canonical.z+2,o.transform.tileZoom),y=new a.OverscaledTileID(b,n.wrap,D,n.canonical.x>>B,n.canonical.y>>B)):0!==B&&(b=D,y=new a.OverscaledTileID(b,n.wrap,D,n.canonical.x>>B,n.canonical.y>>B))}y.key!==n.key&&(I.push(y.key),u=o.getTile(y))}const M=D=>{I.forEach(B=>{d[B]=D}),I.length=0};for(b-=1;b>=w&&(!u||!u.hasData());b--){u&&M(u.tileID.key);const D=y.calculateScaledKey(b);if(u=o.getTileByID(D),u&&u.hasData())break;const B=d[D];if(null===B)break;void 0===B?I.push(D):u=o.getTileByID(B)}return M(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,o){let u=this._tilesDirty[n];u||(u=this._tilesDirty[n]={}),u[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(o){let u=0;const d=new a.StructArrayLayout2ui4,m=131;for(let y=1;y<129;y++){for(let b=1;b<129;b++)u=y*m+b,d.emplaceBack(u,u+1),d.emplaceBack(u,u+m),d.emplaceBack(u+1,u+m),128===y&&d.emplaceBack(u+m,u+m+1);d.emplaceBack(u+1,u+1+m)}return d}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class La{static cacheKey(n,o,u,d){let m=`${o}${d?d.cacheKey:""}`;for(const y of u)n.usedDefines.includes(y)&&(m+=`/${y}`);return m}constructor(n,o,u,d,m,y){const b=n.gl;this.program=b.createProgram();const w=function(Z){const F=[];for(let G=0;G<Z.length;G++){if(null===Z[G])continue;const N=Z[G].split(" ");F.push(N.pop())}return F}(u.staticAttributes),I=d?d.getBinderAttributes():[],M=w.concat(I);let D=d?d.defines():[];D=D.concat(y.map(Z=>`#define ${Z}`));const B=D.concat(n.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(os):os,os,Vr,js.fragmentSource,Vs.fragmentSource,u.fragmentSource).join("\n"),V=D.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Vr,js.vertexSource,Vs.vertexSource,Ns.vertexSource,u.vertexSource).join("\n"),U=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(U,B),b.compileShader(U),b.attachShader(this.program,U);const j=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())this.failedToCreate=!0;else{b.shaderSource(j,V),b.compileShader(j),b.attachShader(this.program,j),this.attributes={},this.numAttributes=M.length;for(let Z=0;Z<this.numAttributes;Z++)M[Z]&&(b.bindAttribLocation(this.program,Z,M[Z]),this.attributes[M[Z]]=Z);b.linkProgram(this.program),b.deleteShader(j),b.deleteShader(U),this.fixedUniforms=m(n),this.binderUniforms=d?d.getUniforms(n):[],y.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new a.Uniform1i(Z=n),u_dem_prev:new a.Uniform1i(Z),u_dem_unpack:new a.Uniform4f(Z),u_dem_tl:new a.Uniform2f(Z),u_dem_scale:new a.Uniform1f(Z),u_dem_tl_prev:new a.Uniform2f(Z),u_dem_scale_prev:new a.Uniform1f(Z),u_dem_size:new a.Uniform1f(Z),u_dem_lerp:new a.Uniform1f(Z),u_exaggeration:new a.Uniform1f(Z),u_depth:new a.Uniform1i(Z),u_depth_size_inv:new a.Uniform2f(Z),u_meter_to_dem:new a.Uniform1f(Z),u_label_plane_matrix_inv:new a.UniformMatrix4f(Z)}),y.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new a.Uniform3f(Z),u_tile_tr_up:new a.Uniform3f(Z),u_tile_br_up:new a.Uniform3f(Z),u_tile_bl_up:new a.Uniform3f(Z),u_tile_up_scale:new a.Uniform1f(Z)}))(n)),y.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new a.UniformMatrix4f(Z),u_fog_range:new a.Uniform2f(Z),u_fog_color:new a.Uniform4f(Z),u_fog_horizon_blend:new a.Uniform1f(Z),u_fog_temporal_offset:new a.Uniform1f(Z),u_frustum_tl:new a.Uniform3f(Z),u_frustum_tr:new a.Uniform3f(Z),u_frustum_br:new a.Uniform3f(Z),u_frustum_bl:new a.Uniform3f(Z),u_globe_pos:new a.Uniform3f(Z),u_globe_radius:new a.Uniform1f(Z),u_globe_transition:new a.Uniform1f(Z),u_is_globe:new a.Uniform1i(Z),u_viewport:new a.Uniform2f(Z)}))(n))}var Z}setTerrainUniformValues(n,o){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in o)u[d]&&u[d].set(this.program,d,o[d])}}setGlobeUniformValues(n,o){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in o)u[d]&&u[d].set(this.program,d,o[d])}}setFogUniformValues(n,o){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in o)u[d].set(this.program,d,o[d])}}draw(n,o,u,d,m,y,b,w,I,M,D,B,V,U,j){const Z=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(u),n.setStencilMode(d),n.setColorMode(m),n.setCullFace(y);for(const G of Object.keys(this.fixedUniforms))this.fixedUniforms[G].set(this.program,G,b[G]);U&&U.setUniforms(this.program,n,this.binderUniforms,B,{zoom:V});const F={[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[o];for(const G of D.get()){const N=G.vaos||(G.vaos={});(N[w]||(N[w]=new Io)).bind(n,this,I,U?U.getPaintVertexBuffers():[],M,G.vertexOffset,j||[]),Z.drawElements(o,G.primitiveLength*F,Z.UNSIGNED_SHORT,G.primitiveOffset*F*2)}}}function Ra(l,n,o){const u=1/cn(o,1,n.transform.tileZoom),d=Math.pow(2,o.tileID.overscaledZ),m=o.tileSize*Math.pow(2,n.transform.tileZoom)/d,y=m*(o.tileID.canonical.x+o.tileID.wrap*d),b=m*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const Xs=a.create(),ps=(l,n,o,u,d,m,y,b,w,I,M)=>{const D=n.style.light,B=D.properties.get("position"),V=[B.x,B.y,B.z],U=a.create$1();"viewport"===D.properties.get("anchor")&&(a.fromRotation(U,-n.transform.angle),a.transformMat3(V,V,U));const j=D.properties.get("color"),Z=n.transform,F={u_matrix:l,u_lightpos:V,u_lightintensity:D.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+o,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Xs,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:d,u_edge_radius:m};return"globe"===Z.projection.name&&(F.u_tile_id=[y.canonical.x,y.canonical.y,1<<y.canonical.z],F.u_zoom_transition=w,F.u_inv_rot_matrix=M,F.u_merc_center=I,F.u_up_dir=Z.projection.upVector(new a.CanonicalTileID(0,0,0),I[0]*a.EXTENT,I[1]*a.EXTENT),F.u_height_lift=b),F},Ws=(l,n,o,u,d,m,y,b,w,I,M,D,B)=>{const V=ps(l,n,o,u,d,m,y,I,M,D,B),U={u_height_factor:-Math.pow(2,y.overscaledZ)/w.tileSize/8};return a.extend(V,Ra(b,n,w),U)},ds=l=>({u_matrix:l}),Hs=(l,n,o,u)=>a.extend(ds(l),Ra(o,n,u)),Ba=(l,n)=>({u_matrix:l,u_world:n}),Dl=(l,n,o,u,d)=>a.extend(Hs(l,n,o,u),{u_world:d}),ko=a.create(),zo=(l,n,o,u,d,m)=>{const y=l.transform,b="globe"===y.projection.name;let w;if("map"===m.paint.get("circle-pitch-alignment"))if(b){const M=a.globePixelsToTileUnits(y.zoom,n.canonical)*y._pixelsPerMercatorPixel;w=Float32Array.from([M,0,0,M])}else w=y.calculatePixelsToTileUnitsMatrix(o);else w=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:l.translatePosMatrix(n.projMatrix,o,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:ko,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){I.u_inv_rot_matrix=u,I.u_merc_center=d,I.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],I.u_zoom_transition=a.globeToMercatorTransition(y.zoom);const M=d[0]*a.EXTENT,D=d[1]*a.EXTENT;I.u_up_dir=y.projection.upVector(new a.CanonicalTileID(0,0,0),M,D)}return I},Oa=l=>{const n=[];return"map"===l.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===l.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},Po=(l,n,o,u)=>{const d=a.EXTENT/o.tileSize;return{u_matrix:l,u_camera_to_center_distance:n.getCameraToCenterDistance(u),u_extrude_scale:[n.pixelsToGLUnits[0]/d,n.pixelsToGLUnits[1]/d]}},fs=(l,n,o=1)=>({u_matrix:l,u_color:n,u_overlay:0,u_overlay_scale:o}),xn=a.create(),Gr=(l,n,o,u,d,m,y)=>{const b=l.transform,w="globe"===b.projection.name,I=w?a.globePixelsToTileUnits(b.zoom,n.canonical)*b._pixelsPerMercatorPixel:cn(o,1,m),M={u_matrix:n.projMatrix,u_extrude_scale:I,u_intensity:y,u_inv_rot_matrix:xn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(w){M.u_inv_rot_matrix=u,M.u_merc_center=d,M.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],M.u_zoom_transition=a.globeToMercatorTransition(b.zoom);const D=d[0]*a.EXTENT,B=d[1]*a.EXTENT;M.u_up_dir=b.projection.upVector(new a.CanonicalTileID(0,0,0),D,B)}return M},ms=(l,n,o,u,d,m,y,b)=>{const w=l.transform,I=w.calculatePixelsToTileUnitsMatrix(n),M={u_matrix:_s(l,n,o,d),u_pixels_to_tile_units:I,u_device_pixel_ratio:y,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:m,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:b};if(Fa(o)){const D=Ys(n,l.transform);M.u_texsize=n.lineAtlasTexture.size,M.u_scale=[D,u.fromScale,u.toScale],M.u_mix=u.t}return M},Js=(l,n,o,u,d,m)=>{const y=l.transform,b=Ys(n,y);return{u_matrix:_s(l,n,o,d),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:m,u_image:0,u_scale:[b,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ys(l,n){return 1/cn(l,1,n.tileZoom)}function _s(l,n,o,u){return l.translatePosMatrix(u||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function Fa(l){const n=l.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const Qs=(l,n,o,u,d,m)=>{return{u_matrix:l,u_tl_parent:n,u_scale_parent:o,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(b=d.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(y=d.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ll(d.paint.get("raster-hue-rotate")),u_perspective_transform:m};var y,b};function Ll(l){l*=Math.PI/180;const n=Math.sin(l),o=Math.cos(l);return[(2*o+1)/3,(-Math.sqrt(3)*n-o+1)/3,(Math.sqrt(3)*n-o+1)/3]}const Do=a.create(),Ua=(l,n,o,u,d,m,y,b,w,I,M,D,B,V,U,j)=>{const Z=d.transform,F={u_is_size_zoom_constant:+("constant"===l||"source"===l),u_is_size_feature_constant:+("constant"===l||"camera"===l),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:Z.width/Z.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:y,u_coord_matrix:b,u_is_text:+w,u_pitch_with_map:+u,u_texsize:I,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Do,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Do,u_up_vector:[0,-1,0]};return"globe"===j.name&&(F.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],F.u_zoom_transition=D,F.u_inv_rot_matrix=V,F.u_merc_center=B,F.u_camera_forward=Z._camera.forward(),F.u_ecef_origin=a.globeECEFOrigin(Z.globeMatrix,M.toUnwrapped()),F.u_tile_matrix=Float32Array.from(Z.globeMatrix),F.u_up_vector=U),F},gs=(l,n,o,u,d,m,y,b,w,I,M,D,B,V,U,j,Z)=>a.extend(Ua(l,n,o,u,d,m,y,b,w,I,D,B,V,U,j,Z),{u_gamma_scale:u?d.transform.cameraToCenterDistance*Math.cos(d.terrain?0:d.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+M}),Rl=(l,n,o,u,d,m,y,b,w,I,M,D,B,V,U,j)=>a.extend(gs(l,n,o,u,d,m,y,b,!0,w,!0,M,D,B,V,U,j),{u_texsize_icon:I,u_texture_icon:1}),Ks=(l,n,o)=>({u_matrix:l,u_opacity:n,u_color:o}),Bl=(l,n,o,u,d,m)=>a.extend(function(y,b,w,I){const M=w.imageManager.getPattern(y.from.toString()),D=w.imageManager.getPattern(y.to.toString()),{width:B,height:V}=w.imageManager.getPixelSize(),U=Math.pow(2,I.tileID.overscaledZ),j=I.tileSize*Math.pow(2,w.transform.tileZoom)/U,Z=j*(I.tileID.canonical.x+I.tileID.wrap*U),F=j*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[B,V],u_mix:b.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/cn(I,1,w.transform.tileZoom),u_pixel_coord_upper:[Z>>16,F>>16],u_pixel_coord_lower:[65535&Z,65535&F]}}(u,m,o,d),{u_matrix:l,u_opacity:n}),ys={fillExtrusion:l=>({u_matrix:new a.UniformMatrix4f(l),u_lightpos:new a.Uniform3f(l),u_lightintensity:new a.Uniform1f(l),u_lightcolor:new a.Uniform3f(l),u_vertical_gradient:new a.Uniform1f(l),u_opacity:new a.Uniform1f(l),u_edge_radius:new a.Uniform1f(l),u_ao:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_up_dir:new a.Uniform3f(l),u_height_lift:new a.Uniform1f(l)}),fillExtrusionPattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_lightpos:new a.Uniform3f(l),u_lightintensity:new a.Uniform1f(l),u_lightcolor:new a.Uniform3f(l),u_vertical_gradient:new a.Uniform1f(l),u_height_factor:new a.Uniform1f(l),u_edge_radius:new a.Uniform1f(l),u_ao:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_up_dir:new a.Uniform3f(l),u_height_lift:new a.Uniform1f(l),u_image:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_pixel_coord_upper:new a.Uniform2f(l),u_pixel_coord_lower:new a.Uniform2f(l),u_scale:new a.Uniform3f(l),u_fade:new a.Uniform1f(l),u_opacity:new a.Uniform1f(l)}),fill:l=>({u_matrix:new a.UniformMatrix4f(l)}),fillPattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_image:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_pixel_coord_upper:new a.Uniform2f(l),u_pixel_coord_lower:new a.Uniform2f(l),u_scale:new a.Uniform3f(l),u_fade:new a.Uniform1f(l)}),fillOutline:l=>({u_matrix:new a.UniformMatrix4f(l),u_world:new a.Uniform2f(l)}),fillOutlinePattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_world:new a.Uniform2f(l),u_image:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_pixel_coord_upper:new a.Uniform2f(l),u_pixel_coord_lower:new a.Uniform2f(l),u_scale:new a.Uniform3f(l),u_fade:new a.Uniform1f(l)}),circle:l=>({u_camera_to_center_distance:new a.Uniform1f(l),u_extrude_scale:new a.UniformMatrix2f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_up_dir:new a.Uniform3f(l)}),collisionBox:l=>({u_matrix:new a.UniformMatrix4f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_extrude_scale:new a.Uniform2f(l)}),collisionCircle:l=>({u_matrix:new a.UniformMatrix4f(l),u_inv_matrix:new a.UniformMatrix4f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_viewport_size:new a.Uniform2f(l)}),debug:l=>({u_color:new a.UniformColor(l),u_matrix:new a.UniformMatrix4f(l),u_overlay:new a.Uniform1i(l),u_overlay_scale:new a.Uniform1f(l)}),clippingMask:l=>({u_matrix:new a.UniformMatrix4f(l)}),heatmap:l=>({u_extrude_scale:new a.Uniform1f(l),u_intensity:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_up_dir:new a.Uniform3f(l)}),heatmapTexture:l=>({u_image:new a.Uniform1i(l),u_color_ramp:new a.Uniform1i(l),u_opacity:new a.Uniform1f(l)}),hillshade:l=>({u_matrix:new a.UniformMatrix4f(l),u_image:new a.Uniform1i(l),u_latrange:new a.Uniform2f(l),u_light:new a.Uniform2f(l),u_shadow:new a.UniformColor(l),u_highlight:new a.UniformColor(l),u_accent:new a.UniformColor(l)}),hillshadePrepare:l=>({u_matrix:new a.UniformMatrix4f(l),u_image:new a.Uniform1i(l),u_dimension:new a.Uniform2f(l),u_zoom:new a.Uniform1f(l),u_unpack:new a.Uniform4f(l)}),line:l=>({u_matrix:new a.UniformMatrix4f(l),u_pixels_to_tile_units:new a.UniformMatrix2f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_units_to_pixels:new a.Uniform2f(l),u_dash_image:new a.Uniform1i(l),u_gradient_image:new a.Uniform1i(l),u_image_height:new a.Uniform1f(l),u_texsize:new a.Uniform2f(l),u_scale:new a.Uniform3f(l),u_mix:new a.Uniform1f(l),u_alpha_discard_threshold:new a.Uniform1f(l),u_trim_offset:new a.Uniform2f(l)}),linePattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_texsize:new a.Uniform2f(l),u_pixels_to_tile_units:new a.UniformMatrix2f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_image:new a.Uniform1i(l),u_units_to_pixels:new a.Uniform2f(l),u_scale:new a.Uniform3f(l),u_fade:new a.Uniform1f(l),u_alpha_discard_threshold:new a.Uniform1f(l)}),raster:l=>({u_matrix:new a.UniformMatrix4f(l),u_tl_parent:new a.Uniform2f(l),u_scale_parent:new a.Uniform1f(l),u_fade_t:new a.Uniform1f(l),u_opacity:new a.Uniform1f(l),u_image0:new a.Uniform1i(l),u_image1:new a.Uniform1i(l),u_brightness_low:new a.Uniform1f(l),u_brightness_high:new a.Uniform1f(l),u_saturation_factor:new a.Uniform1f(l),u_contrast_factor:new a.Uniform1f(l),u_spin_weights:new a.Uniform3f(l),u_perspective_transform:new a.Uniform2f(l)}),symbolIcon:l=>({u_is_size_zoom_constant:new a.Uniform1i(l),u_is_size_feature_constant:new a.Uniform1i(l),u_size_t:new a.Uniform1f(l),u_size:new a.Uniform1f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_rotate_symbol:new a.Uniform1i(l),u_aspect_ratio:new a.Uniform1f(l),u_fade_change:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_label_plane_matrix:new a.UniformMatrix4f(l),u_coord_matrix:new a.UniformMatrix4f(l),u_is_text:new a.Uniform1i(l),u_pitch_with_map:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_camera_forward:new a.Uniform3f(l),u_tile_matrix:new a.UniformMatrix4f(l),u_up_vector:new a.Uniform3f(l),u_ecef_origin:new a.Uniform3f(l),u_texture:new a.Uniform1i(l)}),symbolSDF:l=>({u_is_size_zoom_constant:new a.Uniform1i(l),u_is_size_feature_constant:new a.Uniform1i(l),u_size_t:new a.Uniform1f(l),u_size:new a.Uniform1f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_rotate_symbol:new a.Uniform1i(l),u_aspect_ratio:new a.Uniform1f(l),u_fade_change:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_label_plane_matrix:new a.UniformMatrix4f(l),u_coord_matrix:new a.UniformMatrix4f(l),u_is_text:new a.Uniform1i(l),u_pitch_with_map:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_texture:new a.Uniform1i(l),u_gamma_scale:new a.Uniform1f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_tile_id:new a.Uniform3f(l),u_zoom_transition:new a.Uniform1f(l),u_inv_rot_matrix:new a.UniformMatrix4f(l),u_merc_center:new a.Uniform2f(l),u_camera_forward:new a.Uniform3f(l),u_tile_matrix:new a.UniformMatrix4f(l),u_up_vector:new a.Uniform3f(l),u_ecef_origin:new a.Uniform3f(l),u_is_halo:new a.Uniform1i(l)}),symbolTextAndIcon:l=>({u_is_size_zoom_constant:new a.Uniform1i(l),u_is_size_feature_constant:new a.Uniform1i(l),u_size_t:new a.Uniform1f(l),u_size:new a.Uniform1f(l),u_camera_to_center_distance:new a.Uniform1f(l),u_rotate_symbol:new a.Uniform1i(l),u_aspect_ratio:new a.Uniform1f(l),u_fade_change:new a.Uniform1f(l),u_matrix:new a.UniformMatrix4f(l),u_label_plane_matrix:new a.UniformMatrix4f(l),u_coord_matrix:new a.UniformMatrix4f(l),u_is_text:new a.Uniform1i(l),u_pitch_with_map:new a.Uniform1i(l),u_texsize:new a.Uniform2f(l),u_texsize_icon:new a.Uniform2f(l),u_texture:new a.Uniform1i(l),u_texture_icon:new a.Uniform1i(l),u_gamma_scale:new a.Uniform1f(l),u_device_pixel_ratio:new a.Uniform1f(l),u_is_halo:new a.Uniform1i(l)}),background:l=>({u_matrix:new a.UniformMatrix4f(l),u_opacity:new a.Uniform1f(l),u_color:new a.UniformColor(l)}),backgroundPattern:l=>({u_matrix:new a.UniformMatrix4f(l),u_opacity:new a.Uniform1f(l),u_image:new a.Uniform1i(l),u_pattern_tl_a:new a.Uniform2f(l),u_pattern_br_a:new a.Uniform2f(l),u_pattern_tl_b:new a.Uniform2f(l),u_pattern_br_b:new a.Uniform2f(l),u_texsize:new a.Uniform2f(l),u_mix:new a.Uniform1f(l),u_pattern_size_a:new a.Uniform2f(l),u_pattern_size_b:new a.Uniform2f(l),u_scale_a:new a.Uniform1f(l),u_scale_b:new a.Uniform1f(l),u_pixel_coord_upper:new a.Uniform2f(l),u_pixel_coord_lower:new a.Uniform2f(l),u_tile_units_to_pixels:new a.Uniform1f(l)}),terrainRaster:cs,terrainDepth:cs,skybox:l=>({u_matrix:new a.UniformMatrix4f(l),u_sun_direction:new a.Uniform3f(l),u_cubemap:new a.Uniform1i(l),u_opacity:new a.Uniform1f(l),u_temporal_offset:new a.Uniform1f(l)}),skyboxGradient:l=>({u_matrix:new a.UniformMatrix4f(l),u_color_ramp:new a.Uniform1i(l),u_center_direction:new a.Uniform3f(l),u_radius:new a.Uniform1f(l),u_opacity:new a.Uniform1f(l),u_temporal_offset:new a.Uniform1f(l)}),skyboxCapture:l=>({u_matrix_3f:new a.UniformMatrix3f(l),u_sun_direction:new a.Uniform3f(l),u_sun_intensity:new a.Uniform1f(l),u_color_tint_r:new a.Uniform4f(l),u_color_tint_m:new a.Uniform4f(l),u_luminance:new a.Uniform1f(l)}),globeRaster:l=>({u_proj_matrix:new a.UniformMatrix4f(l),u_globe_matrix:new a.UniformMatrix4f(l),u_normalize_matrix:new a.UniformMatrix4f(l),u_merc_matrix:new a.UniformMatrix4f(l),u_zoom_transition:new a.Uniform1f(l),u_merc_center:new a.Uniform2f(l),u_image0:new a.Uniform1i(l),u_grid_matrix:new a.UniformMatrix3f(l),u_frustum_tl:new a.Uniform3f(l),u_frustum_tr:new a.Uniform3f(l),u_frustum_br:new a.Uniform3f(l),u_frustum_bl:new a.Uniform3f(l),u_globe_pos:new a.Uniform3f(l),u_globe_radius:new a.Uniform1f(l),u_viewport:new a.Uniform2f(l)}),globeAtmosphere:l=>({u_frustum_tl:new a.Uniform3f(l),u_frustum_tr:new a.Uniform3f(l),u_frustum_br:new a.Uniform3f(l),u_frustum_bl:new a.Uniform3f(l),u_horizon:new a.Uniform1f(l),u_transition:new a.Uniform1f(l),u_fadeout_range:new a.Uniform1f(l),u_color:new a.Uniform4f(l),u_high_color:new a.Uniform4f(l),u_space_color:new a.Uniform4f(l),u_star_intensity:new a.Uniform1f(l),u_star_density:new a.Uniform1f(l),u_star_size:new a.Uniform1f(l),u_temporal_offset:new a.Uniform1f(l),u_horizon_angle:new a.Uniform1f(l),u_rotation_matrix:new a.UniformMatrix4f(l)})};let xs;function ea(l,n,o,u,d,m,y){const b=l.context,w=b.gl,I=l.transform,M=l.useProgram("collisionBox"),D=[];let B=0,V=0;for(let te=0;te<u.length;te++){const ie=u[te],J=n.getTile(ie),re=J.getBucket(o);if(!re)continue;const pe=Ko(ie,re,I);let ge=pe;0===d[0]&&0===d[1]||(ge=l.translatePosMatrix(pe,J,d,m));const me=y?re.textCollisionBox:re.iconCollisionBox,ze=re.collisionCircleArray;if(ze.length>0){const le=a.create(),Ee=ge;a.mul(le,re.placementInvProjMatrix,I.glCoordMatrix),a.mul(le,le,re.placementViewportMatrix),D.push({circleArray:ze,circleOffset:V,transform:Ee,invTransform:le,projection:re.getProjection()}),B+=ze.length/4,V=B}me&&(l.terrain&&l.terrain.setupElevationDraw(J,M),M.draw(b,w.LINES,a.DepthMode.disabled,a.StencilMode.disabled,l.colorModeForRenderPass(),a.CullFaceMode.disabled,Po(ge,I,J,re.getProjection()),o.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,null,I.zoom,null,[me.collisionVertexBuffer,me.collisionVertexBufferExt]))}if(!y||!D.length)return;const U=l.useProgram("collisionCircle"),j=new a.StructArrayLayout2f1f2i16;j.resize(4*B),j._trim();let Z=0;for(const te of D)for(let ie=0;ie<te.circleArray.length/4;ie++){const J=4*ie,re=te.circleArray[J+0],pe=te.circleArray[J+1],ge=te.circleArray[J+2],me=te.circleArray[J+3];j.emplace(Z++,re,pe,ge,me,0),j.emplace(Z++,re,pe,ge,me,1),j.emplace(Z++,re,pe,ge,me,2),j.emplace(Z++,re,pe,ge,me,3)}(!xs||xs.length<2*B)&&(xs=function(te){const ie=2*te,J=new a.StructArrayLayout3ui6;J.resize(ie),J._trim();for(let re=0;re<ie;re++){const pe=6*re;J.uint16[pe+0]=4*re+0,J.uint16[pe+1]=4*re+1,J.uint16[pe+2]=4*re+2,J.uint16[pe+3]=4*re+2,J.uint16[pe+4]=4*re+3,J.uint16[pe+5]=4*re+0}return J}(B));const F=b.createIndexBuffer(xs,!0),G=b.createVertexBuffer(j,a.collisionCircleLayout.members,!0);for(const te of D){const ie={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(N=I).getCameraToCenterDistance(te.projection),u_viewport_size:[N.width,N.height]};U.draw(b,w.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,l.colorModeForRenderPass(),a.CullFaceMode.disabled,ie,o.id,G,F,a.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,I.zoom)}var N;G.destroy(),F.destroy()}const ta=a.create();function $r(l,n,o,u,d,m){const{horizontalAlign:y,verticalAlign:b}=a.getAnchorAlignment(l),w=-(y-.5)*n,I=-(b-.5)*o,M=a.evaluateVariableOffset(l,u);return new a.pointGeometry((w/d+M[0])*m,(I/d+M[1])*m)}function Ol(l,n,o,u,d,m,y,b,w,I,M){const D=l.text.placedSymbolArray,B=l.text.dynamicLayoutVertexArray,V=l.icon.dynamicLayoutVertexArray,U={},j=wo(b,l.getProjection(),m),Z=m.elevation,F=l.getProjection().upVectorScale(b.canonical,m.center.lat,m.worldSize);B.clear();for(let G=0;G<D.length;G++){const N=D.get(G),te=l.allowVerticalPlacement&&!N.placedOrientation,ie=N.hidden||!N.crossTileID||te?null:u[N.crossTileID];if(ie){const J=new a.pointGeometry(N.tileAnchorX,N.tileAnchorY),re=l.getProjection().upVector(b.canonical,J.x,J.y),pe=Z?Z.getAtTileOffset(b,J.x,J.y):0,ge=dt([N.projectedAnchorX+pe*re[0]*F.metersToTile,N.projectedAnchorY+pe*re[1]*F.metersToTile,N.projectedAnchorZ+pe*re[2]*F.metersToTile],o?j:y),me=xt(m.getCameraToCenterDistance(l.getProjection()),ge.signedDistanceFromCamera);let ze=d.evaluateSizeForFeature(l.textSizeData,I,N)*me/a.ONE_EM;o&&(ze*=l.tilePixelRatio/w);const{width:le,height:Ee,anchor:Te,textOffset:de,textScale:ae}=ie,Ze=$r(Te,le,Ee,de,ae,ze);let Le;if(o){const Re=J.add(Ze),{x:We,y:ot,z:tt}=l.getProjection().projectTilePoint(Re.x,Re.y,b.canonical);Le=dt([We+pe*re[0]*F.metersToTile,ot+pe*re[1]*F.metersToTile,tt+pe*re[2]*F.metersToTile],y).point}else{const Re=n?Ze.rotate(-m.angle):Ze;Le=[ge.point[0]+Re.x,ge.point[1]+Re.y,0]}const Fe=l.allowVerticalPlacement&&N.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Re=0;Re<N.numGlyphs;Re++)a.addDynamicAttributes(B,Le[0],Le[1],Le[2],Fe);M&&N.associatedIconIndex>=0&&(U[N.associatedIconIndex]={shiftedAnchor:Le,angle:Fe})}else Se(N.numGlyphs,B)}if(M){V.clear();const G=l.icon.placedSymbolArray;for(let N=0;N<G.length;N++){const te=G.get(N);if(te.hidden)Se(te.numGlyphs,V);else{const ie=U[N];if(ie)for(let J=0;J<te.numGlyphs;J++)a.addDynamicAttributes(V,ie.shiftedAnchor[0],ie.shiftedAnchor[1],ie.shiftedAnchor[2],ie.angle);else Se(te.numGlyphs,V)}}l.icon.dynamicLayoutVertexBuffer.updateData(V)}l.text.dynamicLayoutVertexBuffer.updateData(B)}function Fl(l,n,o){return o.iconsInText&&n?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Za(l,n,o,u,d,m,y,b,w,I,M,D){const B=l.context,V=B.gl,U=l.transform,j="map"===b,Z="map"===w,F=j&&"point"!==o.layout.get("symbol-placement"),G=j&&!Z&&!F,N=void 0!==o.layout.get("symbol-sort-key").constantOr(1);let te=!1;const ie=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),J=[a.mercatorXfromLng(U.center.lng),a.mercatorYfromLat(U.center.lat)],re=o.layout.get("text-variable-anchor"),pe="globe"===U.projection.name,ge=[],me=[0,-1,0];let ze=me;!pe&&!U.mercatorFromTransition||j||(ze=function(le){const Ee=le._camera.getWorldToCamera(le.worldSize,1),Te=a.multiply([],Ee,le.globeMatrix);a.invert(Te,Te);const de=[0,0,0],ae=[0,1,0,0];return a.transformMat4$1(ae,ae,Te),de[0]=ae[0],de[1]=ae[1],de[2]=ae[2],a.normalize(de,de),de}(U));for(const le of u){const Ee=n.getTile(le),Te=Ee.getBucket(o);if(!Te||"mercator"===Te.projection.name&&pe)continue;const de=d?Te.text:Te.icon;if(!de||Te.fullyClipped||!de.segments.get().length)continue;const ae=de.programConfigurations.get(o.id),Ze=d||Te.sdfIcons,Le=d?Te.textSizeData:Te.iconSizeData,Fe=Z||0!==U.pitch,Re=a.evaluateSizeForZoom(Le,U.zoom);let We,ot,tt,Ye,Be=[0,0],at=null;if(d){if(ot=Ee.glyphAtlasTexture,tt=V.LINEAR,We=Ee.glyphAtlasTexture.size,Te.iconsInText){Be=Ee.imageAtlasTexture.size,at=Ee.imageAtlasTexture;const ki="composite"===Le.kind||"camera"===Le.kind;Ye=Fe||l.options.rotating||l.options.zooming||ki?V.LINEAR:V.NEAREST}}else{const ki=1!==o.layout.get("icon-size").constantOr(0)||Te.iconsNeedLinear;ot=Ee.imageAtlasTexture,tt=Ze||l.options.rotating||l.options.zooming||ki||Fe?V.LINEAR:V.NEAREST,We=Ee.imageAtlasTexture.size}const ft="globe"===Te.projection.name,Ot=ft?ze:me,Ft=ft?a.globeToMercatorTransition(U.zoom):0,Lt=wo(le,Te.getProjection(),U),vi=U.calculatePixelsToTileUnitsMatrix(Ee),qi=Or(Lt,Ee.tileID.canonical,Z,j,U,Te.getProjection(),vi),er=l.terrain&&Z&&F?a.invert(a.create(),qi):ta,Xt=Fr(Lt,Ee.tileID.canonical,Z,j,U,Te.getProjection(),vi),ii=re&&Te.hasTextData(),Pt="none"!==o.layout.get("icon-text-fit")&&ii&&Te.hasIconData();if(F){const ki=U.elevation,tr=ki?ki.getAtTileOffsetFunc(le,U.center.lat,U.worldSize,Te.getProjection()):On=>[0,0,0],Kr=Aa(Lt,Ee.tileID.canonical,Z,j,U,Te.getProjection(),vi);Ii(Te,Lt,l,d,Kr,Xt,Z,I,tr,le)}const ci=F||d&&re||Pt,Ui=l.translatePosMatrix(Lt,Ee,m,y),Vt=ci?ta:qi,Qi=l.translatePosMatrix(Xt,Ee,m,y,!0),Ro=Te.getProjection().createInversionMatrix(U,le.canonical),Bn=[];l.terrainRenderModeElevated()&&Z&&Bn.push("PITCH_WITH_MAP_TERRAIN"),ft&&Bn.push("PROJECTION_GLOBE_VIEW"),ci&&Bn.push("PROJECTED_POS_ON_VIEWPORT");const Gi=Ze&&0!==o.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1);let ws;ws=Ze?Te.iconsInText?Rl(Le.kind,Re,G,Z,l,Ui,Vt,Qi,We,Be,le,Ft,J,Ro,Ot,Te.getProjection()):gs(Le.kind,Re,G,Z,l,Ui,Vt,Qi,d,We,!0,le,Ft,J,Ro,Ot,Te.getProjection()):Ua(Le.kind,Re,G,Z,l,Ui,Vt,Qi,d,We,le,Ft,J,Ro,Ot,Te.getProjection());const Qr={program:l.useProgram(Fl(Ze,d,Te),ae,Bn),buffers:de,uniformValues:ws,atlasTexture:ot,atlasTextureIcon:at,atlasInterpolation:tt,atlasInterpolationIcon:Ye,isSDF:Ze,hasHalo:Gi,tile:Ee,labelPlaneMatrixInv:er};if(N&&Te.canOverlap){te=!0;const ki=de.segments.get();for(const tr of ki)ge.push({segments:new a.SegmentVector([tr]),sortKey:tr.sortKey,state:Qr})}else ge.push({segments:de.segments,sortKey:0,state:Qr})}te&&ge.sort((le,Ee)=>le.sortKey-Ee.sortKey);for(const le of ge){const Ee=le.state;if(l.terrain&&l.terrain.setupElevationDraw(Ee.tile,Ee.program,{useDepthForOcclusion:!pe,labelPlaneMatrixInv:Ee.labelPlaneMatrixInv}),B.activeTexture.set(V.TEXTURE0),Ee.atlasTexture.bind(Ee.atlasInterpolation,V.CLAMP_TO_EDGE),Ee.atlasTextureIcon&&(B.activeTexture.set(V.TEXTURE1),Ee.atlasTextureIcon&&Ee.atlasTextureIcon.bind(Ee.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Ee.isSDF){const Te=Ee.uniformValues;Ee.hasHalo&&(Te.u_is_halo=1,Na(Ee.buffers,le.segments,o,l,Ee.program,ie,M,D,Te)),Te.u_is_halo=0}Na(Ee.buffers,le.segments,o,l,Ee.program,ie,M,D,Ee.uniformValues)}}function Na(l,n,o,u,d,m,y,b,w){const I=u.context,M=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.globeExtVertexBuffer];d.draw(I,I.gl.TRIANGLES,m,y,b,a.CullFaceMode.disabled,w,o.id,l.layoutVertexBuffer,l.indexBuffer,n,o.paint,u.transform.zoom,l.programConfigurations.get(o.id),M)}function Va(l,n,o,u,d,m,y){const b=l.context.gl,w=o.paint.get("fill-pattern"),I=w&&w.constantOr(1),M=o.getCrossfadeParameters();let D,B,V,U,j;y?(B=I&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=b.LINES):(B=I?"fillPattern":"fill",D=b.TRIANGLES);for(const Z of u){const F=n.getTile(Z);if(I&&!F.patternsLoaded())continue;const G=F.getBucket(o);if(!G)continue;l.prepareDrawTile();const N=G.programConfigurations.get(o.id),te=l.useProgram(B,N);I&&(l.context.activeTexture.set(b.TEXTURE0),F.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),N.updatePaintBuffers(M));const ie=w.constantOr(null);if(ie&&F.imageAtlas){const re=F.imageAtlas,pe=re.patternPositions[ie.to.toString()],ge=re.patternPositions[ie.from.toString()];pe&&ge&&N.setConstantPatternPositions(pe,ge)}const J=l.translatePosMatrix(Z.projMatrix,F,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(y){U=G.indexBuffer2,j=G.segments2;const re=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[b.drawingBufferWidth,b.drawingBufferHeight];V="fillOutlinePattern"===B&&I?Dl(J,l,M,F,re):Ba(J,re)}else U=G.indexBuffer,j=G.segments,V=I?Hs(J,l,M,F):ds(J);l.prepareDrawProgram(l.context,te,Z.toUnwrapped()),te.draw(l.context,D,d,l.stencilModeForClipping(Z),m,a.CullFaceMode.disabled,V,o.id,G.layoutVertexBuffer,U,j,o.paint,l.transform.zoom,N)}}function ia(l,n,o,u,d,m,y){const b=l.context,w=b.gl,I=l.transform,M=o.paint.get("fill-extrusion-pattern"),D=M.constantOr(1),B=o.getCrossfadeParameters(),V=o.paint.get("fill-extrusion-opacity"),U=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],j=o.layout.get("fill-extrusion-edge-radius"),Z="globe"===I.projection.name?a.fillExtrusionHeightLift():0,F="globe"===I.projection.name,G=F?a.globeToMercatorTransition(I.zoom):0,N=[a.mercatorXfromLng(I.center.lng),a.mercatorYfromLat(I.center.lat)],te=[];F&&(te.push("PROJECTION_GLOBE_VIEW"),l.style.terrainSetForDrapingOnly()&&te.push("TERRAIN")),U[0]>0&&te.push("FAUX_AO");for(const ie of u){const J=n.getTile(ie),re=J.getBucket(o);if(!re||re.projection.name!==I.projection.name)continue;const pe=re.programConfigurations.get(o.id),ge=l.useProgram(D?"fillExtrusionPattern":"fillExtrusion",pe,te);if(l.terrain){const ae=l.terrain;if(l.style.terrainSetForDrapingOnly())ae.setupElevationDraw(J,ge,{useMeterToDem:!0});else{if(!re.enableTerrain)continue;if(ae.setupElevationDraw(J,ge,{useMeterToDem:!0}),na(b,n,ie,re,o,ae),!re.centroidVertexBuffer){const Ze=ge.attributes.a_centroid_pos;void 0!==Ze&&w.vertexAttrib2f(Ze,0,0)}}}D&&(l.context.activeTexture.set(w.TEXTURE0),J.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),pe.updatePaintBuffers(B));const me=M.constantOr(null);if(me&&J.imageAtlas){const ae=J.imageAtlas,Ze=ae.patternPositions[me.to.toString()],Le=ae.patternPositions[me.from.toString()];Ze&&Le&&pe.setConstantPatternPositions(Ze,Le)}const ze=l.translatePosMatrix(ie.projMatrix,J,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),le=I.projection.createInversionMatrix(I,ie.canonical),Ee=o.paint.get("fill-extrusion-vertical-gradient"),Te=D?Ws(ze,l,Ee,V,U,j,ie,B,J,Z,G,N,le):ps(ze,l,Ee,V,U,j,ie,Z,G,N,le);l.prepareDrawProgram(b,ge,ie.toUnwrapped());const de=[];l.terrain&&de.push(re.centroidVertexBuffer),F&&de.push(re.layoutVertexExtBuffer),ge.draw(b,b.gl.TRIANGLES,d,m,y,a.CullFaceMode.backCCW,Te,o.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,o.paint,l.transform.zoom,pe,de)}}function na(l,n,o,u,d,m){const y=[F=>{let G=F.canonical.x-1,N=F.wrap;return G<0&&(G=(1<<F.canonical.z)-1,N--),new a.OverscaledTileID(F.overscaledZ,N,F.canonical.z,G,F.canonical.y)},F=>{let G=F.canonical.x+1,N=F.wrap;return G===1<<F.canonical.z&&(G=0,N++),new a.OverscaledTileID(F.overscaledZ,N,F.canonical.z,G,F.canonical.y)},F=>new a.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,(0===F.canonical.y?1<<F.canonical.z:F.canonical.y)-1),F=>new a.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y===(1<<F.canonical.z)-1?0:F.canonical.y+1)],b=F=>{const G=n.getSource().minzoom,N=ie=>{const J=n.getTileByID(ie);if(J&&J.hasData())return J.getBucket(d)},te=[0,-1,1];for(const ie of te){if(F.overscaledZ+ie<G)continue;const J=N(F.calculateScaledKey(F.overscaledZ+ie));if(J)return J}},w=[0,0,0],I=(F,G)=>(w[0]=Math.min(F.min.y,G.min.y),w[1]=Math.max(F.max.y,G.max.y),w[2]=a.EXTENT-G.min.x>F.max.x?G.min.x-a.EXTENT:F.max.x,w),M=(F,G)=>(w[0]=Math.min(F.min.x,G.min.x),w[1]=Math.max(F.max.x,G.max.x),w[2]=a.EXTENT-G.min.y>F.max.y?G.min.y-a.EXTENT:F.max.y,w),D=[(F,G)=>I(F,G),(F,G)=>I(G,F),(F,G)=>M(F,G),(F,G)=>M(G,F)],B=new a.pointGeometry(0,0);let V,U,j;const Z=(F,G,N,te,ie)=>{const J=[[te?N:F,te?F:N,0],[te?N:G,te?G:N,0]],re=ie<0?a.EXTENT+ie:ie,pe=[te?re:(F+G)/2,te?(F+G)/2:re,0];return 0===N&&ie<0||0!==N&&ie>0?m.getForTilePoints(j,[pe],!0,U):J.push(pe),m.getForTilePoints(o,J,!0,V),Math.max(J[0][2],J[1][2],pe[2])/m.exaggeration()};for(let F=0;F<4;F++){const G=(F<2?1:5)-F,N=u.borders[F];if(0===N.length)continue;const te=j=y[F](o),ie=b(te);if(!(ie&&ie instanceof a.FillExtrusionBucket&&ie.enableTerrain)||u.borderDoneWithNeighborZ[F]===ie.canonical.z&&ie.borderDoneWithNeighborZ[G]===u.canonical.z||(U=m.findDEMTileFor(te),!U||!U.dem))continue;if(!V){const ge=m.findDEMTileFor(o);if(!ge||!ge.dem)return;V=ge}const J=ie.borders[G];let re=0;const pe=ie.borderDoneWithNeighborZ[G]!==u.canonical.z;if(u.canonical.z===ie.canonical.z){for(let ge=0;ge<N.length;ge++){const me=u.featuresOnBorder[N[ge]],ze=me.borders[F];let le;for(;re<J.length&&(le=ie.featuresOnBorder[J[re]],!(le.borders[G][1]>ze[0]+3));)pe&&ie.encodeCentroid(void 0,le,!1),re++;if(le&&re<J.length){const Ee=re;let Te=0;for(;!(le.borders[G][0]>ze[1]-3)&&(Te++,++re!==J.length);)le=ie.featuresOnBorder[J[re]];if(le=ie.featuresOnBorder[J[Ee]],me.intersectsCount()>1||le.intersectsCount()>1||1!==Te){1!==Te&&(re=Ee),u.encodeCentroid(void 0,me,!1),pe&&ie.encodeCentroid(void 0,le,!1);continue}const de=D[F](me,le),ae=F%2?a.EXTENT-1:0;B.x=Z(de[0],Math.min(a.EXTENT-1,de[1]),ae,F<2,de[2]),B.y=0,u.encodeCentroid(B,me,!1),pe&&ie.encodeCentroid(B,le,!1)}else u.encodeCentroid(void 0,me,!1)}u.borderDoneWithNeighborZ[F]=ie.canonical.z,u.needsCentroidUpdate=!0,pe&&(ie.borderDoneWithNeighborZ[G]=u.canonical.z,ie.needsCentroidUpdate=!0)}else{for(const ge of N)u.encodeCentroid(void 0,u.featuresOnBorder[ge],!1);if(pe){for(const ge of J)ie.encodeCentroid(void 0,ie.featuresOnBorder[ge],!1);ie.borderDoneWithNeighborZ[G]=u.canonical.z,ie.needsCentroidUpdate=!0}u.borderDoneWithNeighborZ[F]=ie.canonical.z,u.needsCentroidUpdate=!0}}(u.needsCentroidUpdate||!u.centroidVertexBuffer&&0!==u.centroidVertexArray.length)&&u.uploadCentroid(l)}const ra=new a.Color(1,0,0,1),ja=new a.Color(0,1,0,1),qa=new a.Color(0,0,1,1),Ga=new a.Color(1,0,1,1),vs=new a.Color(0,1,1,1);function yr(l,n,o){const u=l.context,d=l.transform,m=u.gl,y="globe"===d.projection.name,b=y?["PROJECTION_GLOBE_VIEW"]:null;let w=o.projMatrix;if(y&&a.globeToMercatorTransition(d.zoom)>0){const me=a.transitionTileAABBinECEF(o.canonical,d),ze=a.globeDenormalizeECEF(me);w=a.multiply(new Float32Array(16),d.globeMatrix,ze),a.multiply(w,d.projMatrix,w)}const I=l.useProgram("debug",null,b),M=n.getTileByID(o.key);l.terrain&&l.terrain.setupElevationDraw(M,I);const D=a.DepthMode.disabled,B=a.StencilMode.disabled,V=l.colorModeForRenderPass(),U="$debug";u.activeTexture.set(m.TEXTURE0),l.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),y?M._makeGlobeTileDebugBuffers(l.context,d):M._makeDebugTileBoundsBuffers(l.context,d.projection);const j=M._tileDebugBuffer||l.debugBuffer,Z=M._tileDebugIndexBuffer||l.debugIndexBuffer,F=M._tileDebugSegments||l.debugSegments;I.draw(u,m.LINE_STRIP,D,B,V,a.CullFaceMode.disabled,fs(w,a.Color.red),U,j,Z,F,null,null,null,[M._globeTileDebugBorderBuffer]);const G=M.latestRawTileData,N=Math.floor((G&&G.byteLength||0)/1024),te=n.getTile(o).tileSize,ie=512/Math.min(te,512)*(o.overscaledZ/d.zoom)*.5;let J=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(J+=` => ${o.overscaledZ}`),J+=` ${N}kb`,function(me,ze){me.initDebugOverlayCanvas();const le=me.debugOverlayCanvas,Ee=me.context.gl,Te=me.debugOverlayCanvas.getContext("2d");Te.clearRect(0,0,le.width,le.height),Te.shadowColor="white",Te.shadowBlur=2,Te.lineWidth=1.5,Te.strokeStyle="white",Te.textBaseline="top",Te.font="bold 36px Open Sans, sans-serif",Te.fillText(ze,5,5),Te.strokeText(ze,5,5),me.debugOverlayTexture.update(le),me.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}(l,J);const re=M._tileDebugTextBuffer||l.debugBuffer,pe=M._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,ge=M._tileDebugTextSegments||l.debugSegments;I.draw(u,m.TRIANGLES,D,B,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,fs(w,a.Color.transparent,ie),U,re,pe,ge,null,null,null,[M._globeTileDebugTextBuffer])}function Xr(l,n,o,u){Dn(l,0,n+o/2,l.transform.width,o,u)}function oa(l,n,o,u){Dn(l,n-o/2,0,o,l.transform.height,u)}function Dn(l,n,o,u,d,m){const y=l.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(n*a.exported.devicePixelRatio,o*a.exported.devicePixelRatio,u*a.exported.devicePixelRatio,d*a.exported.devicePixelRatio),y.clear({color:m}),b.disable(b.SCISSOR_TEST)}const Wr=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:$a}=Wr;function vn(l,n,o,u){l.emplaceBack(n,o,u)}class St{constructor(n){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,vn(this.vertexArray,-1,-1,1),vn(this.vertexArray,1,-1,1),vn(this.vertexArray,-1,1,1),vn(this.vertexArray,1,1,1),vn(this.vertexArray,-1,-1,-1),vn(this.vertexArray,1,-1,-1),vn(this.vertexArray,-1,1,-1),vn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,$a),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Ln(l,n,o,u,d,m){const y=l.gl,b=n.paint.get("sky-atmosphere-color"),w=n.paint.get("sky-atmosphere-halo-color"),I=n.paint.get("sky-atmosphere-sun-intensity"),M={u_matrix_3f:a.fromMat4(a.create$1(),u),u_sun_direction:d,u_sun_intensity:I,u_color_tint_r:[(U=b).r,U.g,U.b,U.a],u_color_tint_m:[(j=w).r,j.g,j.b,j.a],u_luminance:5e-5};var U,j;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+m,n.skyboxTexture,0),o.draw(l,y.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,M,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Ul=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xa{constructor(n){const o=new a.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const u=new a.StructArrayLayout3ui6;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(o,Ul.members),this.indexBuffer=n.createIndexBuffer(u),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Hr={symbol:function(l,n,o,u,d){if("translucent"!==l.renderPass)return;const m=a.StencilMode.disabled,y=l.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(b,w,I,M,D,B,V){const U=w.transform,j="map"===D,Z="map"===B;for(const F of b){const G=M.getTile(F),N=G.getBucket(I);if(!N||!N.text||!N.text.segments.get().length)continue;const te=a.evaluateSizeForZoom(N.textSizeData,U.zoom),ie=wo(F,N.getProjection(),U),J=U.calculatePixelsToTileUnitsMatrix(G),re=Or(ie,G.tileID.canonical,Z,j,U,N.getProjection(),J),pe="none"!==I.layout.get("icon-text-fit")&&N.hasIconData();if(te){const ge=Math.pow(2,U.zoom-G.tileID.overscaledZ);Ol(N,j,Z,V,a.symbolSize,U,re,F,ge,te,pe)}}}(u,l,o,n,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),d),0!==o.paint.get("icon-opacity").constantOr(1)&&Za(l,n,o,u,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),m,y),0!==o.paint.get("text-opacity").constantOr(1)&&Za(l,n,o,u,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),m,y),n.map.showCollisionBoxes&&(ea(l,n,o,u,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),ea(l,n,o,u,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(l,n,o,u){if("translucent"!==l.renderPass)return;const d=o.paint.get("circle-opacity"),m=o.paint.get("circle-stroke-width"),y=o.paint.get("circle-stroke-opacity"),b=void 0!==o.layout.get("circle-sort-key").constantOr(1);if(0===d.constantOr(1)&&(0===m.constantOr(1)||0===y.constantOr(1)))return;const w=l.context,I=w.gl,M=l.transform,D=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),B=a.StencilMode.disabled,V=l.colorModeForRenderPass(),U="globe"===M.projection.name,j=[a.mercatorXfromLng(M.center.lng),a.mercatorYfromLat(M.center.lat)],Z=[];for(let G=0;G<u.length;G++){const N=u[G],te=n.getTile(N),ie=te.getBucket(o);if(!ie||ie.projection.name!==M.projection.name)continue;const J=ie.programConfigurations.get(o.id),re=Oa(o);U&&re.push("PROJECTION_GLOBE_VIEW");const pe=l.useProgram("circle",J,re),ge=ie.layoutVertexBuffer,me=ie.globeExtVertexBuffer,ze=ie.indexBuffer,le=M.projection.createInversionMatrix(M,N.canonical),Ee={programConfiguration:J,program:pe,layoutVertexBuffer:ge,globeExtVertexBuffer:me,indexBuffer:ze,uniformValues:zo(l,N,te,le,j,o),tile:te};if(b){const Te=ie.segments.get();for(const de of Te)Z.push({segments:new a.SegmentVector([de]),sortKey:de.sortKey,state:Ee})}else Z.push({segments:ie.segments,sortKey:0,state:Ee})}b&&Z.sort((G,N)=>G.sortKey-N.sortKey);const F={useDepthForOcclusion:!U};for(const G of Z){const{programConfiguration:N,program:te,layoutVertexBuffer:ie,globeExtVertexBuffer:J,indexBuffer:re,uniformValues:pe,tile:ge}=G.state,me=G.segments;l.terrain&&l.terrain.setupElevationDraw(ge,te,F),l.prepareDrawProgram(w,te,ge.tileID.toUnwrapped()),te.draw(w,I.TRIANGLES,D,B,V,a.CullFaceMode.disabled,pe,o.id,ie,re,me,o.paint,M.zoom,N,[J])}},heatmap:function(l,n,o,u){if(0!==o.paint.get("heatmap-opacity"))if("offscreen"===l.renderPass){const d=l.context,m=d.gl,y=a.StencilMode.disabled,b=new a.ColorMode([m.ONE,m.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(V,U,j,Z){const F=V.gl,G=U.width*Z,N=U.height*Z;V.activeTexture.set(F.TEXTURE1),V.viewport.set([0,0,G,N]);let te=j.heatmapFbo;if(!te||te&&(te.width!==G||te.height!==N)){te&&te.destroy();const ie=F.createTexture();F.bindTexture(F.TEXTURE_2D,ie),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),te=j.heatmapFbo=V.createFramebuffer(G,N,!1),function(J,re,pe,ge,me,ze){const le=J.gl;le.texImage2D(le.TEXTURE_2D,0,le.RGBA,me,ze,0,le.RGBA,J.extRenderToTextureHalfFloat?J.extTextureHalfFloat.HALF_FLOAT_OES:le.UNSIGNED_BYTE,null),ge.colorAttachment.set(pe)}(V,0,ie,te,G,N)}else F.bindTexture(F.TEXTURE_2D,te.colorAttachment.get()),V.bindFramebuffer.set(te.framebuffer)})(d,l,o,"globe"===l.transform.projection.name?.5:.25),d.clear({color:a.Color.transparent});const w=l.transform,I="globe"===w.projection.name,M=I?["PROJECTION_GLOBE_VIEW"]:null,D=I?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,B=[a.mercatorXfromLng(w.center.lng),a.mercatorYfromLat(w.center.lat)];for(let V=0;V<u.length;V++){const U=u[V];if(n.hasRenderableParent(U))continue;const j=n.getTile(U),Z=j.getBucket(o);if(!Z||Z.projection.name!==w.projection.name)continue;const F=Z.programConfigurations.get(o.id),G=l.useProgram("heatmap",F,M),{zoom:N}=l.transform;l.terrain&&l.terrain.setupElevationDraw(j,G),l.prepareDrawProgram(d,G,U.toUnwrapped());const te=w.projection.createInversionMatrix(w,U.canonical);G.draw(d,m.TRIANGLES,a.DepthMode.disabled,y,b,D,Gr(l,U,j,te,B,N,o.paint.get("heatmap-intensity")),o.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,o.paint,l.transform.zoom,F,I?[Z.globeExtVertexBuffer]:null)}d.viewport.set([0,0,l.width,l.height])}else"translucent"===l.renderPass&&(l.context.setColorMode(l.colorModeForRenderPass()),function(d,m){const y=d.context,b=y.gl,w=m.heatmapFbo;if(!w)return;y.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,w.colorAttachment.get()),y.activeTexture.set(b.TEXTURE1);let I=m.colorRampTexture;I||(I=m.colorRampTexture=new a.Texture(y,m.colorRamp,b.RGBA)),I.bind(b.LINEAR,b.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(y,b.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:m.paint.get("heatmap-opacity")},m.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,m.paint,d.transform.zoom)}(l,o))},line:function(l,n,o,u){if("translucent"!==l.renderPass)return;const d=o.paint.get("line-opacity"),m=o.paint.get("line-width");if(0===d.constantOr(1)||0===m.constantOr(1))return;const y=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),b=l.colorModeForRenderPass(),w=l.terrain&&l.terrain.renderingToTexture?1:a.exported.devicePixelRatio,I=o.paint.get("line-dasharray"),M=I.constantOr(1),D=o.layout.get("line-cap"),B=o.paint.get("line-pattern"),V=B.constantOr(1),U=o.paint.get("line-gradient"),j=o.getCrossfadeParameters(),Z=V?"linePattern":"line",F=l.context,G=F.gl,N=(ie=>{const J=[];Fa(ie)&&J.push("RENDER_LINE_DASH"),ie.paint.get("line-gradient")&&J.push("RENDER_LINE_GRADIENT");const re=ie.paint.get("line-trim-offset");0===re[0]&&0===re[1]||J.push("RENDER_LINE_TRIM_OFFSET");const pe=ie.paint.get("line-pattern").constantOr(1),ge=1!==ie.paint.get("line-opacity").constantOr(1);return!pe&&ge&&J.push("RENDER_LINE_ALPHA_DISCARD"),J})(o);let te=N.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(te=!1);for(const ie of u){const J=n.getTile(ie);if(V&&!J.patternsLoaded())continue;const re=J.getBucket(o);if(!re)continue;l.prepareDrawTile();const pe=re.programConfigurations.get(o.id),ge=l.useProgram(Z,pe,N),me=B.constantOr(null);if(me&&J.imageAtlas){const Le=J.imageAtlas,Fe=Le.patternPositions[me.to.toString()],Re=Le.patternPositions[me.from.toString()];Fe&&Re&&pe.setConstantPatternPositions(Fe,Re)}const ze=I.constantOr(null),le=D.constantOr(null);if(!V&&ze&&le&&J.lineAtlas){const Le=J.lineAtlas,Fe=Le.getDash(ze.to,le),Re=Le.getDash(ze.from,le);Fe&&Re&&pe.setConstantPatternPositions(Fe,Re)}let[Ee,Te]=o.paint.get("line-trim-offset");("round"===le||"square"===le)&&Ee!==Te&&(0===Ee&&(Ee-=1),1===Te&&(Te+=1));const de=l.terrain?ie.projMatrix:null,ae=V?Js(l,J,o,j,de,w):ms(l,J,o,j,de,re.lineClipsArray.length,w,[Ee,Te]);if(U){const Le=re.gradients[o.id];let Fe=Le.texture;if(o.gradientVersion!==Le.version){let Re=256;if(o.stepInterpolant){const We=n.getSource().maxzoom,ot=ie.canonical.z===We?Math.ceil(1<<l.transform.maxZoom-ie.canonical.z):1;Re=a.clamp(a.nextPowerOfTwo(re.maxLineLength/a.EXTENT*1024*ot),256,F.maxTextureSize)}Le.gradient=a.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Re,image:Le.gradient||void 0,clips:re.lineClipsArray}),Le.texture?Le.texture.update(Le.gradient):Le.texture=new a.Texture(F,Le.gradient,G.RGBA),Le.version=o.gradientVersion,Fe=Le.texture}F.activeTexture.set(G.TEXTURE1),Fe.bind(o.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}M&&(F.activeTexture.set(G.TEXTURE0),J.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),pe.updatePaintBuffers(j)),V&&(F.activeTexture.set(G.TEXTURE0),J.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),pe.updatePaintBuffers(j)),l.prepareDrawProgram(F,ge,ie.toUnwrapped());const Ze=Le=>{ge.draw(F,G.TRIANGLES,y,Le,b,a.CullFaceMode.disabled,ae,o.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,o.paint,l.transform.zoom,pe,[re.layoutVertexBuffer2])};if(te){const Le=l.stencilModeForClipping(ie).ref;0===Le&&l.terrain&&F.clear({stencil:0});const Fe={func:G.EQUAL,mask:255};ae.u_alpha_discard_threshold=.8,Ze(new a.StencilMode(Fe,Le,255,G.KEEP,G.KEEP,G.INVERT)),ae.u_alpha_discard_threshold=0,Ze(new a.StencilMode(Fe,Le,255,G.KEEP,G.KEEP,G.KEEP))}else Ze(l.stencilModeForClipping(ie))}te&&(l.resetStencilClippingMasks(),l.terrain&&F.clear({stencil:0}))},fill:function(l,n,o,u){const d=o.paint.get("fill-color"),m=o.paint.get("fill-opacity");if(0===m.constantOr(1))return;const y=l.colorModeForRenderPass(),b=o.paint.get("fill-pattern"),w=l.opaquePassEnabledForLayer()&&!b.constantOr(1)&&1===d.constantOr(a.Color.transparent).a&&1===m.constantOr(0)?"opaque":"translucent";if(l.renderPass===w){const I=l.depthModeForSublayer(1,"opaque"===l.renderPass?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Va(l,n,o,u,I,y,!1)}if("translucent"===l.renderPass&&o.paint.get("fill-antialias")){const I=l.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Va(l,n,o,u,I,y,!0)}},"fill-extrusion":function(l,n,o,u){const d=o.paint.get("fill-extrusion-opacity");if(0!==d&&"translucent"===l.renderPass){const m=new a.DepthMode(l.context.gl.LEQUAL,a.DepthMode.ReadWrite,l.depthRangeFor3D);if(1!==d||o.paint.get("fill-extrusion-pattern").constantOr(1))ia(l,n,o,u,m,a.StencilMode.disabled,a.ColorMode.disabled),ia(l,n,o,u,m,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{const y=l.colorModeForRenderPass();ia(l,n,o,u,m,a.StencilMode.disabled,y)}}},hillshade:function(l,n,o,u){if("offscreen"!==l.renderPass&&"translucent"!==l.renderPass)return;const d=l.context,m=l.depthModeForSublayer(0,a.DepthMode.ReadOnly),y=l.colorModeForRenderPass(),b=l.terrain&&l.terrain.renderingToTexture,[w,I]="translucent"!==l.renderPass||b?[{},u]:l.stencilConfigForOverlap(u);for(const M of I){const D=n.getTile(M);if(D.needsHillshadePrepare&&"offscreen"===l.renderPass)Gs(l,D,o,m,a.StencilMode.disabled,y);else if("translucent"===l.renderPass){const B=b&&l.terrain?l.terrain.stencilModeForRTTOverlap(M):w[M.overscaledZ];as(l,M,D,o,m,B,y)}}d.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,n,o,u,d,m){if("translucent"!==l.renderPass||0===o.paint.get("raster-opacity")||!u.length)return;const y=l.context,b=y.gl,w=n.getSource(),I=l.useProgram("raster"),M=l.colorModeForRenderPass(),D=l.terrain&&l.terrain.renderingToTexture,[B,V]=w instanceof Q||D?[{},u]:l.stencilConfigForOverlap(u),U=V[V.length-1].overscaledZ,j=!l.options.moving;for(const Z of V){const F=D?a.DepthMode.disabled:l.depthModeForSublayer(Z.overscaledZ-U,1===o.paint.get("raster-opacity")?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,b.LESS),G=Z.toUnwrapped(),N=n.getTile(Z);if(D&&(!N||!N.hasData()))continue;const te=D?Z.projMatrix:l.transform.calculateProjMatrix(G,j),ie=l.terrain&&D?l.terrain.stencilModeForRTTOverlap(Z):B[Z.overscaledZ],J=m?0:o.paint.get("raster-fade-duration");N.registerFadeDuration(J);const re=n.findLoadedParent(Z,0),pe=Mo(N,re,n,l.transform,J);let ge,me;l.terrain&&l.terrain.prepareDrawTile();const ze="nearest"===o.paint.get("raster-resampling")?b.NEAREST:b.LINEAR;y.activeTexture.set(b.TEXTURE0),N.texture.bind(ze,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE1),re?(re.texture.bind(ze,b.CLAMP_TO_EDGE),ge=Math.pow(2,re.tileID.overscaledZ-N.tileID.overscaledZ),me=[N.tileID.canonical.x*ge%1,N.tileID.canonical.y*ge%1]):N.texture.bind(ze,b.CLAMP_TO_EDGE);const le=Qs(te,me||[0,0],ge||1,pe,o,w instanceof Q?w.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(y,I,G),w instanceof Q)w.boundsBuffer&&w.boundsSegments&&I.draw(y,b.TRIANGLES,F,a.StencilMode.disabled,M,a.CullFaceMode.disabled,le,o.id,w.boundsBuffer,l.quadTriangleIndexBuffer,w.boundsSegments);else{const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Te,tileBoundsSegments:de}=l.getTileBoundsBuffers(N);I.draw(y,b.TRIANGLES,F,ie,M,a.CullFaceMode.disabled,le,o.id,Ee,Te,de)}}l.resetStencilClippingMasks()},background:function(l,n,o,u){const d=o.paint.get("background-color"),m=o.paint.get("background-opacity");if(0===m)return;const y=l.context,b=y.gl,w=l.transform,I=w.tileSize,M=o.paint.get("background-pattern");if(l.isPatternMissing(M))return;const D=!M&&1===d.a&&1===m&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==D)return;const B=a.StencilMode.disabled,V=l.depthModeForSublayer(0,"opaque"===D?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),U=l.colorModeForRenderPass(),j=l.useProgram(M?"backgroundPattern":"background");let Z,F=u;F||(Z=l.getBackgroundTiles(),F=Object.values(Z).map(N=>N.tileID)),M&&(y.activeTexture.set(b.TEXTURE0),l.imageManager.bind(l.context));const G=o.getCrossfadeParameters();for(const N of F){const te=N.toUnwrapped(),ie=u?N.projMatrix:l.transform.calculateProjMatrix(te);l.prepareDrawTile();const J=n?n.getTile(N):Z?Z[N.key]:new a.Tile(N,I,w.zoom,l),re=M?Bl(ie,m,l,M,{tileID:N,tileSize:I},G):Ks(ie,m,d);l.prepareDrawProgram(y,j,te);const{tileBoundsBuffer:pe,tileBoundsIndexBuffer:ge,tileBoundsSegments:me}=l.getTileBoundsBuffers(J);j.draw(y,b.TRIANGLES,V,B,U,a.CullFaceMode.disabled,re,o.id,pe,ge,me)}},sky:function(l,n,o){const u=l.transform,d="mercator"===u.projection.name||"globe"===u.projection.name?1:a.smoothstep(7,8,u.zoom),m=o.paint.get("sky-opacity")*d;if(0===m)return;const y=l.context,b=o.paint.get("sky-type"),w=new a.DepthMode(y.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),I=l.frameCounter/1e3%1;"atmosphere"===b?"offscreen"===l.renderPass?o.needsSkyboxCapture(l)&&(function(M,D,B,V){const U=M.context,j=U.gl;let Z=D.skyboxFbo;if(!Z){Z=D.skyboxFbo=U.createFramebuffer(32,32,!1),D.skyboxGeometry=new St(U),D.skyboxTexture=U.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,D.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let te=0;te<6;++te)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(Z.framebuffer),U.viewport.set([0,0,32,32]);const F=D.getCenter(M,!0),G=M.useProgram("skyboxCapture"),N=new Float64Array(16);a.identity(N),a.rotateY(N,N,.5*-Math.PI),Ln(U,D,G,N,F,0),a.identity(N),a.rotateY(N,N,.5*Math.PI),Ln(U,D,G,N,F,1),a.identity(N),a.rotateX(N,N,.5*-Math.PI),Ln(U,D,G,N,F,2),a.identity(N),a.rotateX(N,N,.5*Math.PI),Ln(U,D,G,N,F,3),a.identity(N),Ln(U,D,G,N,F,4),a.identity(N),a.rotateY(N,N,Math.PI),Ln(U,D,G,N,F,5),U.viewport.set([0,0,M.width,M.height])}(l,o),o.markSkyboxValid(l)):"sky"===l.renderPass&&function(M,D,B,V,U){const j=M.context,Z=j.gl,F=M.transform,G=M.useProgram("skybox");j.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,D.skyboxTexture);const N={u_matrix:F.skyboxMatrix,u_sun_direction:D.getCenter(M,!1),u_cubemap:0,u_opacity:V,u_temporal_offset:U};M.prepareDrawProgram(j,G),G.draw(j,Z.TRIANGLES,B,a.StencilMode.disabled,M.colorModeForRenderPass(),a.CullFaceMode.backCW,N,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(l,o,w,m,I):"gradient"===b&&"sky"===l.renderPass&&function(M,D,B,V,U){const j=M.context,Z=j.gl,F=M.transform,G=M.useProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new St(j)),j.activeTexture.set(Z.TEXTURE0);let N=D.colorRampTexture;N||(N=D.colorRampTexture=new a.Texture(j,D.colorRamp,Z.RGBA)),N.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const te=(ie=F.skyboxMatrix,J=D.getCenter(M,!1),re=D.paint.get("sky-gradient-radius"),pe=V,ge=U,{u_matrix:ie,u_color_ramp:0,u_center_direction:J,u_radius:a.degToRad(re),u_opacity:pe,u_temporal_offset:ge});var ie,J,re,pe,ge;M.prepareDrawProgram(j,G),G.draw(j,Z.TRIANGLES,B,a.StencilMode.disabled,M.colorModeForRenderPass(),a.CullFaceMode.backCW,te,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(l,o,w,m,I)},debug:function(l,n,o){for(let u=0;u<o.length;u++)yr(l,n,o[u])},custom:function(l,n,o){const u=l.context,d=o.implementation;if(l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===l.renderPass){const m=d.prerender;m&&(l.setCustomLayerDefaults(),u.setColorMode(l.colorModeForRenderPass()),m.call(d,u.gl,l.transform.customLayerMatrix()),u.setDirty(),l.setBaseState())}else if("translucent"===l.renderPass){l.setCustomLayerDefaults(),u.setColorMode(l.colorModeForRenderPass()),u.setStencilMode(a.StencilMode.disabled);const m="3d"===d.renderingMode?new a.DepthMode(l.context.gl.LEQUAL,a.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,a.DepthMode.ReadOnly);u.setDepthMode(m),d.render(u.gl,l.transform.customLayerMatrix()),u.setDirty(),l.setBaseState(),u.bindFramebuffer.set(null)}}};class T{constructor(n,o){this.context=new P(n),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Jn,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,o){const u=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Da(this,n));const d=this._terrain;this.transform.elevation=u?d:null,d.update(n,this.transform,o)}_updateFog(n){const o=n.fog;if(!o||"globe"===this.transform.projection.name||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,d]=o.getFovAdjustedRange(this.transform._fov);if(u>d)return void(this.transform.fogCullDistSq=null);const m=u+.78*(d-u);this.transform.fogCullDistSq=m*m}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,o){if(this.width=n*a.exported.devicePixelRatio,this.height=o*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._layers[u].resize()}setup(){const n=this.context,o=new a.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(a.EXTENT,0),o.emplaceBack(0,a.EXTENT),o.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(o,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const u=new a.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(a.EXTENT,0),u.emplaceBack(0,a.EXTENT),u.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=n.createVertexBuffer(u,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const d=new a.StructArrayLayout2i4;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(d,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const m=new a.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(a.EXTENT,0,a.EXTENT,0),m.emplaceBack(0,a.EXTENT,0,a.EXTENT),m.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(m,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const y=new a.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(y);const b=new a.StructArrayLayout1ui2;for(const I of[0,1,3,2,0])b.emplaceBack(I);this.debugIndexBuffer=n.createIndexBuffer(b),this.emptyTexture=new a.Texture(n,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=a.create();const w=this.context.gl;this.stencilClearMode=new a.StencilMode({func:w.ALWAYS,mask:0},0,255,w.ZERO,w.ZERO,w.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new Xa(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,o=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,o.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,qr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,o,u){if(!o||this.currentStencilSource===o.id||!n.isTileClipped()||!u||0===u.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let b=!1;for(const w of u)if(void 0===this._tileClippingMaskIDs[w.key]){b=!0;break}if(!b)return}this.currentStencilSource=o.id;const d=this.context,m=d.gl;this.nextStencilID+u.length>256&&this.clearStencil(),d.setColorMode(a.ColorMode.disabled),d.setDepthMode(a.DepthMode.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of u){const w=o.getTile(b),I=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,{tileBoundsBuffer:M,tileBoundsIndexBuffer:D,tileBoundsSegments:B}=this.getTileBoundsBuffers(w);y.draw(d,m.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:m.ALWAYS,mask:0},I,255,m.KEEP,m.KEEP,m.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,qr(b.projMatrix),"$clipping",M,D,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,o=this.context.gl;return new a.StencilMode({func:o.NOTEQUAL,mask:255},n,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const o=this.context.gl;return new a.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(n){const o=this.context.gl,u=n.sort((y,b)=>b.overscaledZ-y.overscaledZ),d=u[u.length-1].overscaledZ,m=u[0].overscaledZ-d+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let b=0;b<m;b++)y[b+d]=new a.StencilMode({func:o.GEQUAL,mask:255},b+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=m,[y,u]}return[{[d]:a.StencilMode.disabled},u]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([n.CONSTANT_COLOR,n.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(n,o,u){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new a.DepthMode(u||this.context.gl.LEQUAL,o,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,o){this.style=n,this.options=o,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const u=this.style.order,d=this.style._sourceCaches;for(const w in d){const I=d[w];I.used&&I.prepare(this.context)}const m={},y={},b={};for(const w in d){const I=d[w];m[w]=I.getVisibleCoordinates(),y[w]=m[w].slice().reverse(),b[w]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let w=0;w<u.length;w++)if(this.style._layers[u[w]].is3D()){this.opaquePassCutoff=w;break}if(this.terrain&&(this.terrain.updateTileBinding(b),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),a.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const w of u){const I=this.style._layers[w],M=n._getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const D=M?y[M.id]:void 0;("custom"===I.type||I.isSky()||D&&D.length)&&this.renderLayer(this,M,I,D)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const w=this.style._layers[u[this.currentLayer]],I=n._getLayerSourceCache(w);if(w.isSky())continue;const M=I?y[I.id]:void 0;this._renderTileClippingMasks(w,I,M),this.renderLayer(this,I,w,M)}if(this.style.fog&&this.transform.projection.supportsFog&&function(w,I){const M=w.context,D=M.gl,B=w.transform,V=new a.DepthMode(D.LEQUAL,a.DepthMode.ReadOnly,[0,1]),U=w.useProgram("globeAtmosphere",null,"globe"===B.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),j=a.globeToMercatorTransition(B.zoom),Z=I.properties.get("color").toArray01(),F=I.properties.get("high-color").toArray01(),G=I.properties.get("space-color").toArray01PremultipliedAlpha(),N=a.identity$1([]);a.rotateY$1(N,N,-a.degToRad(B._center.lng)),a.rotateX$1(N,N,a.degToRad(B._center.lat)),a.rotateZ$1(N,N,B.angle),a.rotateX$1(N,N,-B._pitch);const te=a.fromQuat(new Float32Array(16),N),ie=a.mapValue(I.properties.get("star-intensity"),0,1,0,.25),J=5e-4,re=a.mapValue(I.properties.get("horizon-blend"),0,1,J,.25),pe=a.globeUseCustomAntiAliasing(w,M,B)&&re===J?B.worldSize/(2*Math.PI*1.025)-1:B.globeRadius,ge=w.frameCounter/1e3%1,me=a.length(B.globeCenterInViewSpace),ze=Math.sqrt(Math.pow(me,2)-Math.pow(pe,2)),le=Math.acos(ze/me),Ee={u_frustum_tl:B.frustumCorners.TL,u_frustum_tr:B.frustumCorners.TR,u_frustum_br:B.frustumCorners.BR,u_frustum_bl:B.frustumCorners.BL,u_horizon:B.frustumCorners.horizon,u_transition:j,u_fadeout_range:re,u_color:Z,u_high_color:F,u_space_color:G,u_star_intensity:ie,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ge,u_horizon_angle:le,u_rotation_matrix:te};w.prepareDrawProgram(M,U);const Te=w.atmosphereBuffer;Te&&U.draw(M,D.TRIANGLES,V,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,Ee,"skybox",Te.vertexBuffer,Te.indexBuffer,Te.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const w=this.style._layers[u[this.currentLayer]],I=n._getLayerSourceCache(w);w.isSky()&&this.renderLayer(this,I,w,I?y[I.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;){const w=this.style._layers[u[this.currentLayer]],I=n._getLayerSourceCache(w);if(w.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(w)){if(w.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const M=I?("symbol"===w.type?b:y)[I.id]:void 0;this._renderTileClippingMasks(w,I,I?m[I.id]:void 0),this.renderLayer(this,I,w,M),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let w=null;a.values(this.style._layers).forEach(I=>{const M=n._getLayerSourceCache(I);M&&!I.isHidden(this.transform.zoom)&&(!w||w.getSource().maxzoom<M.getSource().maxzoom)&&(w=M)}),w&&this.options.showTileBoundaries&&Hr.debug(this,w,w.getVisibleCoordinates())}this.options.showPadding&&function(w){const I=w.transform.padding;Xr(w,w.transform.height-(I.top||0),3,ra),Xr(w,I.bottom||0,3,ja),oa(w,I.left||0,3,qa),oa(w,w.transform.width-(I.right||0),3,Ga);const M=w.transform.centerPoint;var D,B,V,U;Dn(D=w,(B=M.x)-1,(V=w.transform.height-M.y)-10,2,20,U=vs),Dn(D,B-10,V-1,20,2,U)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,o,u,d){u.isHidden(this.transform.zoom)||("background"===u.type||"sky"===u.type||"custom"===u.type||d&&d.length)&&(this.id=u.id,this.gpuTimingStart(u),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(u.type)||Hr[u.type](n,o,u,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let u=this.gpuTimers[n.id];u||(u=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),u.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,u.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,o=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),n.beginQueryEXT(n.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const o={};for(const u in n){const d=n[u],m=this.context.extTimerQuery,y=m.getQueryObjectEXT(d.query,m.QUERY_RESULT_EXT)/1e6;m.deleteQueryEXT(d.query),o[u]=y}return o}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let u=0;for(const d of n)u+=o.getQueryObjectEXT(d,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(d);return u}translatePosMatrix(n,o,u,d,m){if(!u[0]&&!u[1])return n;const y=m?"map"===d?this.transform.angle:0:"viewport"===d?-this.transform.angle:0;if(y){const I=Math.sin(y),M=Math.cos(y);u=[u[0]*M-u[1]*I,u[0]*I+u[1]*M]}const b=[m?u[0]:cn(o,u[0],this.transform.zoom),m?u[1]:cn(o,u[1],this.transform.zoom),0],w=new Float32Array(16);return a.translate(w,n,b),w}saveTileTexture(n){const o=this._tileTextures[n.size[0]];o?o.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const o=this._tileTextures[n];return o&&o.length>0?o.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const o=this.imageManager.getPattern(n.from.toString()),u=this.imageManager.getPattern(n.to.toString());return!o||!u}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,o=this.style&&this.style.fog,u=[];return this.terrainRenderModeElevated()&&u.push("TERRAIN"),"globe"===this.transform.projection.name&&u.push("GLOBE"),o&&!n&&0!==o.getOpacity(this.transform.pitch)&&u.push("FOG"),n&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}useProgram(n,o,u){this.cache=this.cache||{};const d=u||[],m=this.currentGlobalDefines().concat(d),y=La.cacheKey(qs[n],n,m,o);return this.cache[y]||(this.cache[y]=new La(this.context,n,qs[n],o,ys[n],m)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,o,u){if(this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const m=d.getOpacity(this.transform.pitch),y=((b,w,I,M,D,B,V,U,j,Z,F)=>{const G=b.transform,N=w.properties.get("color").toArray01();N[3]=M;const te=b.frameCounter/1e3%1;return{u_fog_matrix:I?G.calculateFogTileMatrix(I):b.identityMat,u_fog_range:w.getFovAdjustedRange(G._fov),u_fog_color:N,u_fog_horizon_blend:w.properties.get("horizon-blend"),u_fog_temporal_offset:te,u_frustum_tl:D,u_frustum_tr:B,u_frustum_br:V,u_frustum_bl:U,u_globe_pos:j,u_globe_radius:Z,u_viewport:F,u_globe_transition:a.globeToMercatorTransition(G.zoom),u_is_globe:+("globe"===G.projection.name)}})(this,d,u,m,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);o.setFogUniformValues(n,y)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,o=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const d of u)o[d.key]=n[d.key]||new a.Tile(d,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class S{constructor(n=0,o=0,u=0,d=0){if(isNaN(n)||n<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=o,this.left=u,this.right=d}interpolate(n,o,u){return null!=o.top&&null!=n.top&&(this.top=a.number(n.top,o.top,u)),null!=o.bottom&&null!=n.bottom&&(this.bottom=a.number(n.bottom,o.bottom,u)),null!=o.left&&null!=n.left&&(this.left=a.number(n.left,o.left,u)),null!=o.right&&null!=n.right&&(this.right=a.number(n.right,o.right,u)),this}getCenter(n,o){const u=a.clamp((this.left+n-this.right)/2,0,n),d=a.clamp((this.top+o-this.bottom)/2,0,o);return new a.pointGeometry(u,d)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new S(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function x(l,n){const o=a.getColumn(l,3);a.fromQuat(l,n),a.setColumn(l,3,o)}function A(l,n){const o=a.identity$1([]);return a.rotateZ$1(o,o,-n),a.rotateX$1(o,o,-l),o}function X(l,n){const o=[l[0],l[1],0],u=[n[0],n[1],0];if(a.length(o)>=1e-15){const y=a.normalize([],o);a.scale$2(u,y,a.dot(u,y)),n[0]=u[0],n[1]=u[1]}const d=a.cross([],n,l);if(a.len(d)<1e-15)return null;const m=Math.atan2(-d[1],d[0]);return A(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),m)}class Ie{constructor(n,o){this.position=n,this.orientation=o}get position(){return this._position}set position(n){if(n){const o=n instanceof a.MercatorCoordinate?n:new a.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(o.x=a.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(n,o){if(this.orientation=null,!this.position)return;const u=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(n)):0,d=this.position,m=a.MercatorCoordinate.fromLngLat(n,u),y=[m.x-d.x,m.y-d.y,m.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=X(y,o)}setPitchBearing(n,o){this.orientation=A(a.degToRad(n),a.degToRad(-o))}}class et{constructor(n,o){this._transform=a.identity([]),this.orientation=o,this.position=n}get mercatorPosition(){const n=this.position;return new a.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=a.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var o;n&&a.setColumn(this._transform,3,[(o=n)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||a.identity$1([]),n&&x(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,o){this._orientation=A(n,o),x(this._transform,this._orientation)}forward(){const n=a.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=a.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=a.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,o){const u=new Float64Array(16);return a.invert(u,this.getWorldToCamera(n,o)),u}getWorldToCameraPosition(n,o,u){const d=this.position;a.scale$2(d,d,-n);const m=new Float64Array(16);return a.fromScaling(m,[u,u,u]),a.translate(m,m,d),m[10]*=o,m}getWorldToCamera(n,o){const u=new Float64Array(16),d=new Float64Array(4),m=this.position;return a.conjugate(d,this._orientation),a.scale$2(m,m,-n),a.fromQuat(u,d),a.translate(u,u,m),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=o,u[9]*=o,u[10]*=o,u[11]*=o,u}getCameraToClipPerspective(n,o,u,d){const m=new Float64Array(16);return a.perspective(m,n,o,u,d),m}getDistanceToElevation(n){const o=0===n?0:a.mercatorZfromAltitude(n,this.position[1]),u=this.forward();return(o-this.position[2])/u[2]}clone(){return new et([...this.position],[...this.orientation])}}function ti(l,n){const o=Rn(l.projection,l.zoom,l.width,l.height),u=function(m,y,b,w,I){const M=new a.LngLat(b.lng-180*Oi,b.lat),D=new a.LngLat(b.lng+180*Oi,b.lat),B=m.project(M.lng,M.lat),V=m.project(D.lng,D.lat),U=-Math.atan2(V.y-B.y,V.x-B.x),j=a.MercatorCoordinate.fromLngLat(b);j.y=a.clamp(j.y,-.999975,.999975);const Z=j.toLngLat(),F=m.project(Z.lng,Z.lat),G=a.MercatorCoordinate.fromLngLat(Z);G.x+=Oi;const N=G.toLngLat(),te=m.project(N.lng,N.lat),ie=je(te.x-F.x,te.y-F.y,U),J=a.MercatorCoordinate.fromLngLat(Z);J.y+=Oi;const re=J.toLngLat(),pe=m.project(re.lng,re.lat),ge=je(pe.x-F.x,pe.y-F.y,U),me=Math.abs(ie.x)/Math.abs(ge.y),ze=a.identity([]);a.rotateZ(ze,ze,-U*(1-(I?0:w)));const le=a.identity([]);return a.scale(le,le,[1,1-(1-me)*w,1]),le[4]=-ge.x/ge.y*w,a.rotateZ(le,le,U),a.multiply(le,ze,le),le}(l.projection,0,l.center,o,n),d=ji(l);return a.scale(u,u,[d,d,1]),u}function ji(l){const n=l.projection,o=Rn(l.projection,l.zoom,l.width,l.height),u=Jr(n,l.center),d=Jr(n,a.LngLat.convert(n.center));return Math.pow(2,u*o+(1-o)*d)}function Rn(l,n,o,u,d=1/0){const m=l.range;if(!m)return 0;const y=Math.min(d,Math.max(o,u)),b=Math.log(y/1024)/Math.LN2;return a.smoothstep(m[0]+b,m[1]+b,n)}const Oi=1/4e4;function Jr(l,n){const o=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),u=new a.LngLat(n.lng-180*Oi,o),d=new a.LngLat(n.lng+180*Oi,o),m=l.project(u.lng,o),y=l.project(d.lng,o),b=a.MercatorCoordinate.fromLngLat(u),w=a.MercatorCoordinate.fromLngLat(d),I=y.x-m.x,M=y.y-m.y,D=w.x-b.x,B=w.y-b.y,V=Math.sqrt((D*D+B*B)/(I*I+M*M));return Math.log(V)/Math.LN2}function je(l,n,o){const u=Math.cos(o),d=Math.sin(o);return{x:l*u-n*d,y:l*d+n*u}}class xi{constructor(n,o,u,d,m,y,b){this.tileSize=512,this._renderWorldCopies=void 0===m||m,this._minZoom=n||0,this._maxZoom=o||22,this._minPitch=u??0,this._maxPitch=d??60,this.setProjection(y),this.setMaxBounds(b),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new S,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new et,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new xi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const o=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||o)&&this._updateCameraOnTerrain(),(n||o)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const u=!h(o,this.getProjection());return u&&this._calcMatrices(),this.mercatorFromTransition=!1,u}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const o=n!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const o=-n*Math.PI/180;var u,d,m,y,b,w,I,M,D,B;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(u=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),d=this.rotationMatrix,y=this.angle,b=(m=this.rotationMatrix)[0],w=m[1],I=m[2],M=m[3],D=Math.sin(y),B=Math.cos(y),d[0]=b*B+I*D,d[1]=w*B+M*D,d[2]=b*-D+I*B,d[3]=w*-D+M*B)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const o=a.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=a.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const o=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let d=0,m=0;for(let y=0;y<o.length;y++){const b=new a.pointGeometry(o[y][0]*this.width,u+o[y][1]*(this.height-u)),w=n.pointCoordinate(b);if(!w)continue;const I=1/Math.hypot(w[0]-this._camera.position[0],w[1]-this._camera.position[1]);d+=w[3]*I,m+=I}return 0===m?NaN:d/m}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const n=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*o,d=this._mercatorZfromZoom(n),m=this._mercatorZfromZoom(this._maxZoom),y=Math.max(d-u,m);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let u;u=n.z<this._camera.position[2]?[o.x,o.y,o.z]:[n.x,n.y,n.z];const d=a.length(a.sub([],this._camera.position,u));return a.clamp(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let o=!1;if(n.orientation&&!a.exactEquals(n.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(n.orientation)),n.position){const u=[n.position.x,n.position.y,n.position.z];a.exactEquals$1(u,this._camera.position)||(this._setCameraPosition(u),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,o=new Ie;return o.position=new a.MercatorCoordinate(n[0],n[1],n[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(n){if(!a.length$1(n))return!1;a.normalize$1(n,n);const o=a.transformQuat([],[0,0,-1],n),u=a.transformQuat([],[0,-1,0],n);if(u[2]<0)return!1;const d=X(o,u);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(n){const o=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;n[2]=a.clamp(n[2],d/u,d/o),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,o,u){this._unmodified=!1,this._edgeInsets.interpolate(n,o,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const o=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(n){const o=[new a.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const u=this.pointCoordinate(new a.pointGeometry(0,0)),d=this.pointCoordinate(new a.pointGeometry(this.width,0)),m=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),y=this.pointCoordinate(new a.pointGeometry(0,this.height)),b=Math.floor(Math.min(u.x,d.x,m.x,y.x)),w=Math.floor(Math.max(u.x,d.x,m.x,y.x)),I=1;for(let M=b-I;M<=w+I;M++)0!==M&&o.push(new a.UnwrappedTileID(M,n))}return o}coveringTiles(n){let o=this.coveringZoomLevel(n);const u=o,d=this.elevation&&!n.isTerrainDEM,m="mercator"===this.projection.name;if(void 0!==n.minzoom&&o<n.minzoom)return[];void 0!==n.maxzoom&&o>n.maxzoom&&(o=n.maxzoom);const y=this.locationCoordinate(this.center),b=this.center.lat,w=1<<o,I=[w*y.x,w*y.y,0],M="globe"===this.projection.name,D=!M,B=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,D),V=M?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=w*a.mercatorZfromAltitude(1,this.center.lat),j=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),Z=[w*V.x,w*V.y,j*(D?1:U)],F=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),G=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,N=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,te=n.isTerrainDEM?-N:this._elevation?this._elevation.getMinElevationBelowMSL():0,ie=this.projection.isReprojectedInTileSpace?ji(this):1,J=ae=>{const Le=new a.MercatorCoordinate(ae.x+25e-6,ae.y,ae.z),Fe=new a.MercatorCoordinate(ae.x,ae.y+25e-6,ae.z),Re=ae.toLngLat(),We=Le.toLngLat(),ot=Fe.toLngLat(),tt=this.locationCoordinate(Re),Ye=this.locationCoordinate(We),Be=this.locationCoordinate(ot),at=Math.hypot(Ye.x-tt.x,Ye.y-tt.y),ft=Math.hypot(Be.x-tt.x,Be.y-tt.y);return Math.sqrt(at*ft)*ie/25e-6},re=ae=>{const Ze=N,Le=te;return{aabb:a.tileAABB(this,w,0,0,0,ae,Le,Ze,this.projection),zoom:0,x:0,y:0,minZ:Le,maxZ:Ze,wrap:ae,fullyVisible:!1}},pe=[];let ge=[];const me=o,ze=n.reparseOverscaled?u:o,le=ae=>ae*ae,Ee=le((j-this._centerAltitude)*U),Te=ae=>{if(!this._elevation||!ae.tileID||!m)return;const Ze=this._elevation.getMinMaxForTile(ae.tileID),Le=ae.aabb;Ze?(Le.min[2]=Ze.min,Le.max[2]=Ze.max,Le.center[2]=(Le.min[2]+Le.max[2])/2):(ae.shouldSplit=de(ae),ae.shouldSplit||(Le.min[2]=Le.max[2]=Le.center[2]=this._centerAltitude))},de=ae=>{if(ae.zoom<G)return!0;if(ae.zoom===me)return!1;if(null!=ae.shouldSplit)return ae.shouldSplit;const Ze=ae.aabb.distanceX(Z),Le=ae.aabb.distanceY(Z);let Fe=Ee,Re=1;if(M){Fe=le(ae.aabb.distanceZ(Z));const tt=Math.pow(2,ae.zoom),Ye=a.latFromMercatorY((ae.y+1)/tt),Be=a.latFromMercatorY(ae.y/tt),at=Math.min(Math.max(b,Ye),Be),ft=a.circumferenceAtLatitude(at)/a.circumferenceAtLatitude(b);if(Re=at===b?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ft/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&ae.zoom===me-1&&ft>=.9)return!0}else if(d&&(Fe=le(ae.aabb.distanceZ(Z)*U)),this.projection.isReprojectedInTileSpace&&u<=5){const tt=Math.pow(2,ae.zoom),Ye=J(new a.MercatorCoordinate((ae.x+.5)/tt,(ae.y+.5)/tt));Re=Ye>.85?1:Ye}const We=Ze*Ze+Le*Le+Fe;return We<le((1<<me-ae.zoom)*F*Re*((tt,Ye)=>{if(Ye*le(.707)<tt)return 1;const Be=Math.sqrt(Ye/tt);return Be/(1.4144271570014144+(Math.pow(1.1,Be-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Fe,Ee),We))};if(this.renderWorldCopies)for(let ae=1;ae<=3;ae++)pe.push(re(-ae)),pe.push(re(ae));for(pe.push(re(0));pe.length>0;){const ae=pe.pop(),Ze=ae.x,Le=ae.y;let Fe=ae.fullyVisible;if(!Fe){const Re=ae.aabb.intersects(B);if(0===Re)continue;Fe=2===Re}if(ae.zoom!==me&&de(ae))for(let Re=0;Re<4;Re++){const We=(Ze<<1)+Re%2,ot=(Le<<1)+(Re>>1),tt={aabb:m?ae.aabb.quadrant(Re):a.tileAABB(this,w,ae.zoom+1,We,ot,ae.wrap,ae.minZ,ae.maxZ,this.projection),zoom:ae.zoom+1,x:We,y:ot,wrap:ae.wrap,fullyVisible:Fe,tileID:void 0,shouldSplit:void 0,minZ:ae.minZ,maxZ:ae.maxZ};d&&!M&&(tt.tileID=new a.OverscaledTileID(ae.zoom+1===me?ze:ae.zoom+1,ae.wrap,ae.zoom+1,We,ot),Te(tt)),pe.push(tt)}else{const Re=ae.zoom===me?ze:ae.zoom;if(n.minzoom&&n.minzoom>Re)continue;const We=I[0]-(.5+Ze+(ae.wrap<<ae.zoom))*(1<<o-ae.zoom),ot=I[1]-.5-Le,tt=ae.tileID?ae.tileID:new a.OverscaledTileID(Re,ae.wrap,ae.zoom,Ze,Le);ge.push({tileID:tt,distanceSq:We*We+ot*ot})}}if(this.fogCullDistSq){const ae=this.fogCullDistSq,Ze=this.horizonLineFromTop();ge=ge.filter(Le=>{const Fe=[0,0,0,1],Re=[a.EXTENT,a.EXTENT,0,1],We=this.calculateFogTileMatrix(Le.tileID.toUnwrapped());a.transformMat4$1(Fe,Fe,We),a.transformMat4$1(Re,Re,We);const ot=a.getAABBPointSquareDist(Fe,Re);if(0===ot)return!0;let tt=!1;const Ye=this._elevation;if(Ye&&ot>ae&&0!==Ze){const Be=this.calculateProjMatrix(Le.tileID.toUnwrapped());let at;n.isTerrainDEM||(at=Ye.getMinMaxForTile(Le.tileID)),at||(at={min:te,max:N});const ft=a.furthestTileCorner(this.rotation),Ot=[ft[0]*a.EXTENT,ft[1]*a.EXTENT,at.max];a.transformMat4(Ot,Ot,Be),tt=(1-Ot[1])*this.height*.5<Ze}return ot<ae||tt})}return ge.sort((ae,Ze)=>ae.distanceSq-Ze.distanceSq).map(ae=>ae.tileID)}resize(n,o){this.width=n,this.height=o,this.pixelsToGLUnits=[2/n,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const o=a.clamp(n.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),u=this.projection.project(n.lng,o);return new a.pointGeometry(u.x*this.worldSize,u.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,o){let u,d;const m=this.centerPoint;if("globe"===this.projection.name){const b=this.worldSize;u=(o.x-m.x)/b,d=(o.y-m.y)/b}else{const b=this.pointCoordinate(o),w=this.pointCoordinate(m);u=b.x-w.x,d=b.y-w.y}const y=this.locationCoordinate(n);this.setLocation(new a.MercatorCoordinate(y.x-u,y.y-d))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,o){const u=o?a.mercatorZfromAltitude(o,n.lat):void 0,d=this.projection.project(n.lng,n.lat);return new a.MercatorCoordinate(d.x,d.y,u)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,o){const u=o??this._centerAltitude,d=[n.x,n.y,0,1],m=[n.x,n.y,1,1];a.transformMat4$1(d,d,this.pixelMatrixInverse),a.transformMat4$1(m,m,this.pixelMatrixInverse);const y=m[3];a.scale$1(d,d,1/d[3]),a.scale$1(m,m,1/y);const b=d[2],w=m[2];return{p0:d,p1:m,t:b===w?0:(u-b)/(w-b)}}screenPointToMercatorRay(n){const o=[n.x,n.y,0,1],u=[n.x,n.y,1,1];return a.transformMat4$1(o,o,this.pixelMatrixInverse),a.transformMat4$1(u,u,this.pixelMatrixInverse),a.scale$1(o,o,1/o[3]),a.scale$1(u,u,1/u[3]),o[2]=a.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,u[2]=a.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,a.scale$1(o,o,1/this.worldSize),a.scale$1(u,u,1/this.worldSize),new a.Ray([o[0],o[1],o[2]],a.normalize([],a.sub([],u,o)))}rayIntersectionCoordinate(n){const{p0:o,p1:u,t:d}=n,m=a.mercatorZfromAltitude(o[2],this._center.lat),y=a.mercatorZfromAltitude(u[2],this._center.lat);return new a.MercatorCoordinate(a.number(o[0],u[0],d)/this.worldSize,a.number(o[1],u[1],d)/this.worldSize,a.number(m,y,d))}pointCoordinate(n,o=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,o)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let o=this.projection.pointCoordinate3D(this,n.x,n.y);if(o)return new a.MercatorCoordinate(o[0],o[1],o[2]);let u=0,d=this.horizonLineFromTop();if(n.y>d)return this.pointCoordinate(n);const m=.02*d,y=n.clone();for(let b=0;b<10&&d-u>m;b++){y.y=a.number(u,d,.66);const w=this.projection.pointCoordinate3D(this,y.x,y.y);w?(d=y.y,o=w):u=y.y}return o?new a.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,o){const u=o&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,d=[n.x*this.worldSize,n.y*this.worldSize,u+n.toAltitude(),1];return a.transformMat4$1(d,d,this.pixelMatrix),d[3]>0?new a.pointGeometry(d[0]/d[3],d[1]/d[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:n,left:o}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,m=this.pointCoordinate3D(new a.pointGeometry(o,n)),y=this.pointCoordinate3D(new a.pointGeometry(d,n)),b=this.pointCoordinate3D(new a.pointGeometry(d,u)),w=this.pointCoordinate3D(new a.pointGeometry(o,u));let I=Math.min(m.x,w.x),M=Math.max(y.x,b.x),D=Math.min(m.y,y.y),B=Math.max(w.y,b.y);const V=Math.pow(2,-this.zoom)/16,U=(F,G,N,te)=>{const ie=(F+N)/2,J=(G+te)/2,re=new a.pointGeometry(ie,J),pe=this.pointCoordinate3D(re),ge=Math.max(0,I-pe.x,D-pe.y,pe.x-M,pe.y-B);I=Math.min(I,pe.x),M=Math.max(M,pe.x),D=Math.min(D,pe.y),B=Math.max(B,pe.y),ge>V&&(U(F,G,ie,J),U(ie,J,N,te))};U(o,n,d,n),U(d,n,d,u),U(d,u,o,u),U(o,u,o,n);const j=new a.LngLat(a.lngFromMercatorX(M),a.latFromMercatorY(D)),Z=new a.LngLat(a.lngFromMercatorX(I),a.latFromMercatorY(B));return new a.LngLatBounds(Z,j)}_getBounds(n,o){if("globe"===this.projection.name)return this._getGlobeBounds();const u=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),d=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),m=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),y=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let b=this.pointCoordinate(u,n),w=this.pointCoordinate(d,n);const I=this.pointCoordinate(m,o),M=this.pointCoordinate(y,o),D=(B,V)=>(V.y-B.y)/(V.x-B.x);return b.y>1&&w.y>=0?b=new a.MercatorCoordinate((1-M.y)/D(M,b)+M.x,1):b.y<0&&w.y<=1&&(b=new a.MercatorCoordinate(-M.y/D(M,b)+M.x,0)),w.y>1&&b.y>=0?w=new a.MercatorCoordinate((1-I.y)/D(I,w)+I.x,1):w.y<0&&b.y<=1&&(w=new a.MercatorCoordinate(-I.y/D(I,w)+I.x,0)),(new a.LngLatBounds).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(w)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(I))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBounds(0,0);const o=n.visibleDemTiles.reduce((u,d)=>{if(d.dem){const m=d.dem.tree;u.min=Math.min(u.min,m.minimums[0]),u.max=Math.max(u.max,m.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBounds(o.min*n.exaggeration(),o.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,u=this.height/2-o*(1-this._horizonShift);return n?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,o){return this.projection.createTileMatrix(this,o,n)}calculateDistanceTileData(n){const o=n.key,u=this._distanceTileDataCache;if(u[o])return u[o];const d=n.canonical,m=1/this.height,y=this.cameraWorldSize/this.zoomScale(d.z),b=(d.x+Math.pow(2,d.z)*n.wrap)*y,w=d.y*y,I=this.point,M=this.angle,D=Math.sin(-M),B=-Math.cos(-M);return u[o]={bearing:[D,B],center:[(I.x-b)*m,(I.y-w)*m],scale:y/a.EXTENT*m},u[o]}calculateFogTileMatrix(n){const o=n.key,u=this._fogTileMatrixCache;if(u[o])return u[o];const d=this.projection.createTileMatrix(this,this.cameraWorldSize,n);return a.multiply(d,this.worldToFogMatrix,d),u[o]=new Float32Array(d),u[o]}calculateProjMatrix(n,o=!1){const u=n.key,d=o?this._alignedProjMatrixCache:this._projMatrixCache;if(d[u])return d[u];const m=this.calculatePosMatrix(n,this.worldSize);return a.multiply(m,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,m),d[u]=new Float32Array(m),d[u]}calculatePixelsToTileUnitsMatrix(n){const o=n.tileID.key,u=this._pixelsToTileUnitsCache;if(u[o])return u[o];const d=function(m,y){const{scale:b}=m.tileTransform,w=b*a.EXTENT/(m.tileSize*Math.pow(2,y.zoom-m.tileID.overscaledZ+m.tileID.canonical.z));return I=new Float32Array(4),B=(M=y.inverseAdjustmentMatrix)[1],V=M[2],U=M[3],Z=(D=[w,w])[1],I[0]=M[0]*(j=D[0]),I[1]=B*j,I[2]=V*Z,I[3]=U*Z,I;var I,M,D,B,V,U,j,Z}(n,this);return u[o]=d,u[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const n=this._elevation;this._updateCameraState();const o=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),d=this._camera.forward(),m=a.mercatorZfromAltitude(1,this._center.lat);u[2]/=m,d[2]/=m,a.normalize(d,d);const y=n.raycast(u,d,n.exaggeration());if(y){const b=a.scaleAndAdd([],u,d,y),w=new a.MercatorCoordinate(b[0],b[1],a.mercatorZfromAltitude(b[2],a.latFromMercatorY(b[1]))),I=(w.z+a.length([w.x-u[0],w.y-u[1],w.z-u[2]*m]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(I),this._centerAltitude=w.toAltitude(),this._center=this.coordinateLocation(w),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const o=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(o),d=n.getAtPointOrZero(new a.MercatorCoordinate(...u)),m=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),y=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*d;if(y<m){const b=this.locationCoordinate(this._center,this._centerAltitude),w=[b.x-u[0],b.y-u[1],b.z-u[2]],I=a.length(w);w[2]-=(m-y)/this._pixelsPerMercatorPixel;const M=a.length(w);if(0===M)return;a.scale$2(w,w,I/M*this._pixelsPerMercatorPixel),this._camera.position=[b.x-w[0],b.y-w[1],b.z*this._pixelsPerMercatorPixel-w[2]],this._camera.orientation=X(w,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const B=this.center;return B.lat=a.clamp(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(B.lng=a.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:u,y:d}=this.point;let m=0,y=u,b=d;const w=this.width/2,I=this.height/2,M=this.worldMinY*this.scale,D=this.worldMaxY*this.scale;if(d-I<M&&(b=M+I),d+I>D&&(b=D-I),D-M<this.height&&(m=Math.max(m,this.height/(D-M)),b=(D+M)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,U=this.worldSize/2-(B+V)/2;y=(u+U+this.worldSize)%this.worldSize-U,y-w<B&&(y=B+w),y+w>V&&(y=V-w),V-B<this.width&&(m=Math.max(m,this.width/(V-B)),y=(V+B)/2)}y===u&&b===d||(this.center=this.unproject(new a.pointGeometry(y,b))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,o=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const u=Rn(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,u),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const d=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?o:1),m=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);m[8]=2*-n.x/this.width,m[9]=2*n.y/this.height;let y=a.mul([],m,d);if(this.projection.isReprojectedInTileSpace){const ie=this.locationCoordinate(this.center),J=a.identity([]);a.translate(J,J,[ie.x*this.worldSize,ie.y*this.worldSize,0]),a.multiply(J,J,ti(this)),a.translate(J,J,[-ie.x*this.worldSize,-ie.y*this.worldSize,0]),a.multiply(y,y,J),this.inverseAdjustmentMatrix=function(re){const pe=ti(re,!0);return vt([],[pe[0],pe[1],pe[4],pe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],y,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=y,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const b=a.invert([],m);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(b,this.horizonLineFromTop(),this.height);const w=new Float32Array(16);a.identity(w),a.scale(w,w,[1,-1,1]),a.rotateX(w,w,this._pitch),a.rotateZ(w,w,this.angle);const I=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),M=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;I[8]=2*-n.x/this.width,I[9]=2*(n.y+M)/this.height,this.skyboxMatrix=a.multiply(w,I,w);const D=this.point,B=D.x,V=D.y,U=this.width%2/2,j=this.height%2/2,Z=Math.cos(this.angle),F=Math.sin(this.angle),G=B-Math.round(B)+Z*U+F*j,N=V-Math.round(V)+Z*j+F*U,te=new Float64Array(y);if(a.translate(te,te,[G>.5?G-1:G,N>.5?N-1:N,0]),this.alignedProjMatrix=te,y=a.create(),a.scale(y,y,[this.width/2,-this.height/2,1]),a.translate(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=a.create(),a.scale(y,y,[1,-1,1]),a.translate(y,y,[-1,-1,0]),a.scale(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},y=a.invert(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=y,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(ie,ie,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=y;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,o=this.cameraPixelsPerMeter,u=this._camera.position,d=1/this.height/this._pixelsPerMercatorPixel,m=[n,n,o];a.scale$2(m,m,d),a.scale$2(u,u,-1),a.multiply$2(u,u,m);const y=a.create();a.translate(y,y,u),a.scale(y,y,m),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,o,d)}_computeCameraPosition(n){const o=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),d=this.point,m=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-n/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-u[0]*m,d.y/this.worldSize-u[1]*m,n/this.worldSize*this._centerAltitude-u[2]*m]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],d=n[2];let m=1;this.projection.wrap&&(this.center=this.center.wrap()),d>0&&(m=Math.min((o-u)/d,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,n,m),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,o=this._camera.forward(),{pitch:u,bearing:d}=this._camera.getPitchBearing(),m=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),b=Math.max((n[2]-m)/Math.cos(u),y),w=this._zoomFromMercatorZ(b);a.scaleAndAdd(n,n,o,b),this._pitch=a.clamp(u,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(d,-Math.PI,Math.PI),this._setZoom(a.clamp(w,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){const o=y=>{const b=this.getCameraToCenterDistance(this.projection,y);return this.scaleZoom(b/(n*this.tileSize))};let u,d=o(this.zoom),m=Math.abs(d-o(d));for(;u!==m;)d=o(d),u=m,m=Math.abs(d-o(d));return d}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,o){const u=Math.min(n.x,o.x),d=Math.max(n.x,o.x),m=Math.min(n.y,o.y),y=Math.max(n.y,o.y);if(m<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const b=[new a.pointGeometry(u,m),new a.pointGeometry(d,y),new a.pointGeometry(u,y),new a.pointGeometry(d,m)],w=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const M of b){const D=this.pointRayIntersection(M);if(D.t<0)return!0;const B=this.rayIntersectionCoordinate(D);if(B.x<w||B.y<0||B.x>I||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,o){const u=a.length(a.sub([],this._camera.position,n)),d=this._zoomFromMercatorZ(u)+o;return u-this._mercatorZfromZoom(d)}getCameraPoint(){if("globe"===this.projection.name){const n=function(o,u){const d=[o[0],o[1],o[2],1];a.transformMat4$1(d,d,u);const m=Math.max(d[3],1e-6);return[d[0]/m,d[1]/m,d[2]/m,m]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,n))}}getCameraToCenterDistance(n,o=this.zoom){const u=Rn(n,o,this.width,this.height,1024),d=n.pixelSpaceConversion(this.center.lat,this.worldSize,u);return.5/Math.tan(.5*this._fov)*this.height*d}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&a.multiply(n,n,this.globeMatrix),n}}function Zl(l,n){let o=!1,u=null;const d=()=>{u=null,o&&(l(),u=setTimeout(d,n),o=!1)};return()=>(o=!0,u||d(),u)}class Bc{constructor(n){this._hashName=n&&encodeURIComponent(n),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Zl(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,a.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const o=Nl(n);if(this._hashName){const u=this._hashName;let d=!1;const m=a.window.location.hash.slice(1).split("&").map(y=>{const b=y.split("=")[0];return b===u?(d=!0,`${b}=${o}`):y}).filter(y=>y);return d||m.push(`${u}=${o}`),`#${m.join("&")}`}return`#${o}`}_getCurrentHash(){const n=a.window.location.hash.replace("#","");if(this._hashName){let o;return n.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(o=u)}),(o&&o[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(u=>isNaN(u))){const u=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(o[3]||0):n.getBearing();return n.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,n)}}function Nl(l,n){const o=l.getCenter(),u=Math.round(100*l.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,d),y=Math.round(o.lng*m)/m,b=Math.round(o.lat*m)/m,w=l.getBearing(),I=l.getPitch();let M=n?`/${y}/${b}/${u}`:`${u}/${b}/${y}`;return(w||I)&&(M+="/"+Math.round(10*w)/10),I&&(M+=`/${Math.round(I)}`),M}const xr={linearity:.3,easing:a.bezier(0,0,.3,1)},Oc=a.extend({deceleration:2500,maxSpeed:1400},xr),Wa=a.extend({deceleration:20,maxSpeed:1400},xr),Vl=a.extend({deceleration:1e3,maxSpeed:360},xr),Ha=a.extend({deceleration:1e3,maxSpeed:90},xr);class Fc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,o=a.exported.now();for(;n.length>0&&o-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)o.zoom+=m.zoomDelta||0,o.bearing+=m.bearingDelta||0,o.pitch+=m.pitchDelta||0,m.panDelta&&o.pan._add(m.panDelta),m.around&&(o.around=m.around),m.pinchAround&&(o.pinchAround=m.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){const m=vr(o.pan.mag(),u,a.extend({},Oc,n||{}));d.offset=o.pan.mult(m.amount/o.pan.mag()),d.center=this._map.transform.center,sa(d,m)}if(o.zoom){const m=vr(o.zoom,u,Wa);d.zoom=this._map.transform.zoom+m.amount,sa(d,m)}if(o.bearing){const m=vr(o.bearing,u,Vl);d.bearing=this._map.transform.bearing+a.clamp(m.amount,-179,179),sa(d,m)}if(o.pitch){const m=vr(o.pitch,u,Ha);d.pitch=this._map.transform.pitch+m.amount,sa(d,m)}if(d.zoom||d.bearing){const m=void 0===o.pinchAround?o.around:o.pinchAround;d.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.noMoveStart=!0,d}}function sa(l,n){(!l.duration||l.duration<n.duration)&&(l.duration=n.duration,l.easing=n.easing)}function vr(l,n,o){const{maxSpeed:u,linearity:d,deceleration:m}=o,y=a.clamp(l*d/(n/1e3),-u,u),b=Math.abs(y)/(m*d);return{easing:o.easing,duration:1e3*b,amount:y*(b/2)}}class ln extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,u,d={}){const m=Oe(o.getCanvasContainer(),u),y=o.unproject(m);super(n,a.extend({point:m,lngLat:y,originalEvent:u},d)),this._defaultPrevented=!1,this.target=o}}class Ja extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,u){const d="touchend"===n?u.changedTouches:u.touches,m=an(o.getCanvasContainer(),d),y=m.map(w=>o.unproject(w)),b=m.reduce((w,I,M,D)=>w.add(I.div(D.length)),new a.pointGeometry(0,0));super(n,{points:m,point:b,lngLats:y,lngLat:o.unproject(b),originalEvent:u}),this._defaultPrevented=!1}}class Uc extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,o,u){super(n,{originalEvent:u}),this._defaultPrevented=!1}}class Ya{constructor(n,o){this._map=n,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Uc(n.type,this._map,n))}mousedown(n,o){return this._mousedownPos=o,this._firePreventable(new ln(n.type,this._map,n))}mouseup(n){this._map.fire(new ln(n.type,this._map,n))}preclick(n){const o=a.extend({},n);o.type="preclick",this._map.fire(new ln(o.type,this._map,o))}click(n,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(n),this._map.fire(new ln(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new ln(n.type,this._map,n))}mouseover(n){this._map.fire(new ln(n.type,this._map,n))}mouseout(n){this._map.fire(new ln(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Ja(n.type,this._map,n))}touchmove(n){this._map.fire(new Ja(n.type,this._map,n))}touchend(n){this._map.fire(new Ja(n.type,this._map,n))}touchcancel(n){this._map.fire(new Ja(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jl{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new ln(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new ln(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zc{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,o){this.isEnabled()&&n.shiftKey&&0===n.button&&(ho(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(n,o){if(!this._active)return;const u=o,d=this._startPos,m=this._lastPos;if(!d||!m||m.equals(u)||!this._box&&u.dist(d)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=_t("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const y=Math.min(d.x,u.x),b=Math.max(d.x,u.x),w=Math.min(d.y,u.y),I=Math.max(d.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${w}px)`,this._box.style.width=b-y+"px",this._box.style.height=I-w+"px")})}mouseupWindow(n,o){if(!this._active)return;const u=this._startPos,d=o;if(u&&0===n.button){if(this.reset(),sn(),u.x!==d.x||u.y!==d.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:m=>m.fitScreenCoordinates(u,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),on(),delete this._startPos,delete this._lastPos}_fireEvent(n,o){return this._map.fire(new a.Event(n,{originalEvent:o}))}}function Qa(l,n){const o={};for(let u=0;u<l.length;u++)o[l[u].identifier]=n[u];return o}class Ka{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=n.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const m=new a.pointGeometry(0,0);for(const y of d)m._add(y);return m.div(d.length)}(o),this.touches=Qa(u,o)))}touchmove(n,o,u){if(this.aborted||!this.centroid)return;const d=Qa(u,o);for(const m in this.touches){const y=this.touches[m],b=d[m];(!b||b.dist(y)>30)&&(this.aborted=!0)}}touchend(n,o,u){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===u.length){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class aa{constructor(n){this.singleTap=new Ka(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,o,u){this.singleTap.touchstart(n,o,u)}touchmove(n,o,u){this.singleTap.touchmove(n,o,u)}touchend(n,o,u){const d=this.singleTap.touchend(n,o,u);if(d){const m=n.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(d)<30;if(m&&y||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Nc{constructor(){this._zoomIn=new aa({numTouches:1,numTaps:2}),this._zoomOut=new aa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,o,u){this._zoomIn.touchstart(n,o,u),this._zoomOut.touchstart(n,o,u)}touchmove(n,o,u){this._zoomIn.touchmove(n,o,u),this._zoomOut.touchmove(n,o,u)}touchend(n,o,u){const d=this._zoomIn.touchend(n,o,u),m=this._zoomOut.touchend(n,o,u);return d?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(d)},{originalEvent:n})}):m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(m)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vc={0:1,2:2};class el{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,o){return!1}_move(n,o){return{}}mousedown(n,o){if(this._lastPoint)return;const u=sr(n);this._correctButton(n,u)&&(this._lastPoint=o,this._eventButton=u)}mousemoveWindow(n,o){const u=this._lastPoint;if(u)if(n.preventDefault(),null!=this._eventButton&&function(d,m){const y=Vc[m];return void 0===d.buttons||(d.buttons&y)!==y}(n,this._eventButton))this.reset();else if(this._moved||!(o.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(u,o)}mouseupWindow(n){this._lastPoint&&sr(n)===this._eventButton&&(this._moved&&sn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jc extends el{mousedown(n,o){super.mousedown(n,o),this._lastPoint&&(this._active=!0)}_correctButton(n,o){return 0===o&&!n.ctrlKey}_move(n,o){return{around:o,panDelta:o.sub(n)}}}class ql extends el{_correctButton(n,o){return 0===o&&n.ctrlKey||2===o}_move(n,o){const u=.8*(o.x-n.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(n){n.preventDefault()}}class Lo extends el{_correctButton(n,o){return 0===o&&n.ctrlKey||2===o}_move(n,o){const u=-.5*(o.y-n.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(n){n.preventDefault()}}class qc{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(n,o,u){return this._calculateTransform(n,o,u)}touchmove(n,o,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===u.length&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,o,u)}}touchend(n,o,u){this._calculateTransform(n,o,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,o,u){u.length>0&&(this._active=!0);const d=Qa(u,o),m=new a.pointGeometry(0,0),y=new a.pointGeometry(0,0);let b=0;for(const I in d){const M=d[I],D=this._touches[I];D&&(m._add(M),y._add(M.sub(D)),b++,d[I]=M)}if(this._touches=d,b<this._minTouches||!y.mag())return;const w=y.div(b);return this._sum._add(w),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:w}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=_t("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class tl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,o,u){return{}}touchstart(n,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(n,o,u){const d=this._firstTwoTouches;if(!d)return;n.preventDefault();const[m,y]=d,b=la(u,o,m),w=la(u,o,y);if(!b||!w)return;const I=this._aroundCenter?null:b.add(w).div(2);return this._move([b,w],I,n)}touchend(n,o,u){if(!this._firstTwoTouches)return;const[d,m]=this._firstTwoTouches,y=la(u,o,d),b=la(u,o,m);y&&b||(this._active&&sn(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function la(l,n,o){for(let u=0;u<l.length;u++)if(l[u].identifier===o)return n[u]}function Gl(l,n){return Math.log(l/n)/Math.LN2}class Gc extends tl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,o){const u=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Gl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gl(this._distance,u),pinchAround:o}}}function $l(l,n){return 180*l.angleWith(n)/Math.PI}class Fi extends tl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,o){const u=this._vector;if(this._vector=n[0].sub(n[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$l(this._vector,u),pinchAround:o}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const o=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const d=$l(n,u);return Math.abs(d)<o}}function Xl(l){return Math.abs(l.y)>Math.abs(l.x)}class $c extends tl{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Xl(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,o,u){const d=this._lastPoints;if(!d)return;const m=n[0].sub(d[0]),y=n[1].sub(d[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(m,y,u.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5})}gestureBeginsVertically(n,o,u){if(void 0!==this._valid)return this._valid;const d=n.mag()>=2,m=o.mag()>=2;if(!d&&!m)return;if(!d||!m)return null==this._firstMove&&(this._firstMove=u),u-this._firstMove<100&&void 0;const y=n.y>0==o.y>0;return Xl(n)&&Xl(o)&&y}}const $u={panStep:100,bearingStep:15,pitchStep:10};class Xu{constructor(){const n=$u;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let o=0,u=0,d=0,m=0,y=0;switch(n.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:n.shiftKey?u=-1:(n.preventDefault(),m=-1);break;case 39:n.shiftKey?u=1:(n.preventDefault(),m=1);break;case 38:n.shiftKey?d=1:(n.preventDefault(),y=-1);break;case 40:n.shiftKey?d=-1:(n.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:b=>{const w=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:br,zoom:o?Math.round(w)+o*(n.shiftKey?2:1):w,bearing:b.getBearing()+u*this._bearingStep,pitch:b.getPitch()+d*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:b.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function br(l){return l*(2-l)}const Wl=4.000244140625;class bs{constructor(n,o){this._map=n,this._el=n.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=n.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const u=a.exported.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,0!==o&&o%Wl==0?this._type="wheel":0!==o&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),n.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=n,this._delta-=o,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Oe(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;"wheel"===this._type&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const w="wheel"===this._type&&Math.abs(this._delta)>Wl?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&0!==I&&(I=1/I);const M=o(),D=Math.pow(2,M),B="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):D;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(B*I))),"wheel"===this._type&&(this._startZoom=M,this._easing=this._smoothOutEasing(200)),this._delta=0}const u="number"==typeof this._targetZoom?this._targetZoom:o(),d=this._startZoom,m=this._easing;let y,b=!1;if("wheel"===this._type&&d&&m){const w=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),I=m(w);y=a.number(d,u,I),w<1?this._frameId||(this._frameId=!0):b=!0}else y=u,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:y-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let o=a.ease;if(this._prevEase){const u=this._prevEase,d=(a.exported.now()-u.start)/u.duration,m=u.easing(d+.01)-u.easing(d),y=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-y*y);o=a.bezier(y,b,.25,1)}return this._prevEase={start:a.exported.now(),duration:n,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=_t("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Kn{constructor(n,o){this._clickZoom=n,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class il{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,o){return n.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(n.shiftKey?-1:1),around:u.unproject(o)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $e{constructor(){this._tap=new aa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,o,u){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=o[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(n,o,u))}touchmove(n,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=o[0],m=d.y-this._swipePoint.y;return this._swipePoint=d,n.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(n,o,u)}touchend(n,o,u){this._tapTime?this._swipePoint&&0===u.length&&this.reset():this._tap.touchend(n,o,u)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xc{constructor(n,o,u){this._el=n,this._mousePan=o,this._touchPan=u}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wc{constructor(n,o,u){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=o,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ca{constructor(n,o,u,d){this._el=n,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Yr=l=>l.zoom||l.drag||l.pitch||l.rotate;class Hc extends a.Event{}class Jc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,o){const u=a.sub([],o,n);this.radius=a.length(u[2]<0?a.div([],u,this.constants):[u[0],u[1],0])}projectRay(n){a.div(n,n,this.constants),a.normalize(n,n),a.mul$1(n,n,this.constants);const o=a.scale$2([],n,this.radius);if(o[2]>0){const u=a.scale$2([],[0,0,1],a.dot(o,[0,0,1])),d=a.scale$2([],a.normalize([],[o[0],o[1],0]),this.radius),m=a.add([],o,a.scale$2([],a.sub([],a.add([],d,u),o),2));o[0]=m[0],o[1]=m[1]}return o}}function ua(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Yc{constructor(n,o){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fc(n),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Jc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),a.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[d,m,y]of this._listeners)d.addEventListener(m,d===a.window.document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[n,o,u]of this._listeners)n.removeEventListener(o,n===a.window.document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(n){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new Ya(o,n));const d=o.boxZoom=new Zc(o,n);this._add("boxZoom",d);const m=new Nc,y=new il;o.doubleClickZoom=new Kn(y,m),this._add("tapZoom",m),this._add("clickZoom",y);const b=new $e;this._add("tapDragZoom",b);const w=o.touchPitch=new $c(o);this._add("touchPitch",w);const I=new ql(n),M=new Lo(n);o.dragRotate=new Wc(n,I,M),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);const D=new jc(n),B=new qc(o,n);o.dragPan=new Xc(u,D,B),this._add("mousePan",D),this._add("touchPan",B,["touchZoom","touchRotate"]);const V=new Fi,U=new Gc;o.touchZoomRotate=new ca(u,U,V,b),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new jl(o));const j=o.scrollZoom=new bs(o,this);this._add("scrollZoom",j,["mousePan"]);const Z=o.keyboard=new Xu;this._add("keyboard",Z);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[F]&&o[F].enable(n[F])}_add(n,o,u){this._handlers.push({handlerName:n,handler:o,allowed:u}),this._handlersById[n]=o}stop(n){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yr(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,o,u){for(const d in n)if(d!==u&&(!o||o.indexOf(d)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const o=[];for(const u of n)this._el.contains(u.target)&&o.push(u);return o}handleEvent(n,o){this._updatingCamera=!0;const u="renderFrame"===n.type,d=u?void 0:n,m={needsRenderFrame:!1},y={},b={},w=n.touches?this._getMapTouches(n.touches):void 0,I=w?an(this._el,w):u?void 0:Oe(this._el,n);for(const{handlerName:B,handler:V,allowed:U}of this._handlers){if(!V.isEnabled())continue;let j;this._blockedByActive(b,U,B)?V.reset():V[o||n.type]&&(j=V[o||n.type](n,I,w),this.mergeHandlerResult(m,y,j,B,d),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||V.isActive())&&(b[B]=V)}const M={};for(const B in this._previousActiveHandlers)b[B]||(M[B]=d);this._previousActiveHandlers=b,(Object.keys(M).length||ua(m))&&(this._changes.push([m,y,M]),this._triggerRenderFrame()),(Object.keys(b).length||ua(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=m;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))}mergeHandlerResult(n,o,u,d,m){if(!u)return;a.extend(n,u);const y={handlerName:d,originalEvent:u.originalEvent||m};void 0!==u.zoomDelta&&(o.zoom=y),void 0!==u.panDelta&&(o.drag=y),void 0!==u.pitchDelta&&(o.pitch=y),void 0!==u.bearingDelta&&(o.rotate=y)}_applyChanges(){const n={},o={},u={};for(const[d,m,y]of this._changes)d.panDelta&&(n.panDelta=(n.panDelta||new a.pointGeometry(0,0))._add(d.panDelta)),d.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+d.pitchDelta),void 0!==d.around&&(n.around=d.around),void 0!==d.aroundCoord&&(n.aroundCoord=d.aroundCoord),void 0!==d.pinchAround&&(n.pinchAround=d.pinchAround),d.noInertia&&(n.noInertia=d.noInertia),a.extend(o,m),a.extend(u,y);this._updateMapTransform(n,o,u),this._changes=[]}_updateMapTransform(n,o,u){const d=this._map,m=d.transform,y=G=>[G.x,G.y,G.z];if((G=>{const N=this._eventsInProgress.drag;return N&&!this._handlersById[N.handlerName].isActive()})()&&!ua(n)){const G=m.zoom;m.cameraElevationReference="sea",m.recenterOnTerrain(),m.cameraElevationReference="ground",G!==m.zoom&&this._map._update(!0)}if(!ua(n))return void this._fireEvents(o,u,!0);let{panDelta:b,zoomDelta:w,bearingDelta:I,pitchDelta:M,around:D,aroundCoord:B,pinchAround:V}=n;void 0!==V&&(D=V),(G=>o.drag&&!this._eventsInProgress.drag)()&&D&&(this._dragOrigin=y(m.pointCoordinate3D(D)),this._trackingEllipsoid.setup(m._camera.position,this._dragOrigin)),m.cameraElevationReference="sea",d._stop(!0),D=D||d.transform.centerPoint,I&&(m.bearing+=I),M&&(m.pitch+=M),m._updateCameraState();const U=[0,0,0];if(b)if("mercator"===m.projection.name){const G=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(D).dir),N=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(D.sub(b)).dir);U[0]=N[0]-G[0],U[1]=N[1]-G[1]}else{const G=m.pointCoordinate(D);if("globe"===m.projection.name){b=b.rotate(-m.angle);const N=m._pixelsPerMercatorPixel/m.worldSize;U[0]=-b.x*a.mercatorScale(a.latFromMercatorY(G.y))*N,U[1]=-b.y*a.mercatorScale(m.center.lat)*N}else{const N=m.pointCoordinate(D.sub(b));G&&N&&(U[0]=N.x-G.x,U[1]=N.y-G.y)}}const j=m.zoom,Z=[0,0,0];if(w){const G=y(B||m.pointCoordinate3D(D)),N={dir:a.normalize([],a.sub([],G,m._camera.position))};if(N.dir[2]<0){const te=m.zoomDeltaToMovement(G,w);a.scale$2(Z,N.dir,te)}}const F=a.add(U,U,Z);m._translateCameraConstrained(F),w&&Math.abs(m.zoom-j)>1e-4&&m.recenterOnTerrain(),m.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(o,u,!0)}_fireEvents(n,o,u){const d=Yr(this._eventsInProgress),m=Yr(n),y={};for(const M in n){const{originalEvent:D}=n[M];this._eventsInProgress[M]||(y[`${M}start`]=D),this._eventsInProgress[M]=n[M]}!d&&m&&this._fireEvent("movestart",m.originalEvent);for(const M in y)this._fireEvent(M,y[M]);m&&this._fireEvent("move",m.originalEvent);for(const M in n){const{originalEvent:D}=n[M];this._fireEvent(M,D)}const b={};let w;for(const M in this._eventsInProgress){const{handlerName:D,originalEvent:B}=this._eventsInProgress[M];this._handlersById[D].isActive()||(delete this._eventsInProgress[M],w=o[D]||B,b[`${M}end`]=w)}for(const M in b)this._fireEvent(M,b[M]);const I=Yr(this._eventsInProgress);if(u&&(d||m)&&!I){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=B=>0!==B&&-this._bearingSnap<B&&B<this._bearingSnap;M?(D(M.bearing||this._map.getBearing())&&(M.bearing=0),this._map.easeTo(M,{originalEvent:w})):(this._map.fire(new a.Event("moveend",{originalEvent:w})),D(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,o){this._map.fire(new a.Event(n,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Hc("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Hl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Qc extends a.Evented{constructor(n,o){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=o.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,o){return this.jumpTo({center:n},o)}panBy(n,o,u){return n=a.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,a.extend({offset:n},o),u)}panTo(n,o,u){return this.easeTo(a.extend({center:n},o),u)}getZoom(){return this.transform.zoom}setZoom(n,o){return this.jumpTo({zoom:n},o),this}zoomTo(n,o,u){return this.easeTo(a.extend({zoom:n},o),u)}zoomIn(n,o){return this.zoomTo(this.getZoom()+1,n,o),this}zoomOut(n,o){return this.zoomTo(this.getZoom()-1,n,o),this}getBearing(){return this.transform.bearing}setBearing(n,o){return this.jumpTo({bearing:n},o),this}getPadding(){return this.transform.padding}setPadding(n,o){return this.jumpTo({padding:n},o),this}rotateTo(n,o,u){return this.easeTo(a.extend({bearing:n},o),u)}resetNorth(n,o){return this.rotateTo(0,a.extend({duration:1e3},n),o),this}resetNorthPitch(n,o){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},n),o),this}snapToNorth(n,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,o):this}getPitch(){return this.transform.pitch}setPitch(n,o){return this.jumpTo({pitch:n},o),this}cameraForBounds(n,o){n=a.LngLatBounds.convert(n);const u=o&&o.bearing||0,d=n.getNorthWest(),m=n.getSouthEast();return this._cameraForBounds(this.transform,d,m,u,o)}_extendCameraOptions(n){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=a.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const u=n.padding;n.padding={top:u,bottom:u,right:u,left:u}}return n.padding=a.extend(o,n.padding),n}_minimumAABBFrustumDistance(n,o){const u=o.max[0]-o.min[0],d=o.max[1]-o.min[1];return u/d>n.aspect?u/(2*Math.tan(.5*n.fovX)*n.aspect):d/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,o,u,d,m){const y=n.clone(),b=this._extendCameraOptions(m);y.bearing=d;const w=a.LngLat.convert(o),I=a.LngLat.convert(u),M=.5*(w.lat+I.lat),D=.5*(w.lng+I.lng),B=a.latLngToECEF(M,D),V=a.normalize([],B),U=a.normalize([],a.cross([],V,[0,1,0])),j=a.cross([],U,V),Z=[U[0],U[1],U[2],0,j[0],j[1],j[2],0,V[0],V[1],V[2],0,0,0,0,1],F=[B,a.latLngToECEF(w.lat,w.lng),a.latLngToECEF(I.lat,w.lng),a.latLngToECEF(I.lat,I.lng),a.latLngToECEF(w.lat,I.lng),a.latLngToECEF(M,w.lng),a.latLngToECEF(M,I.lng),a.latLngToECEF(w.lat,D),a.latLngToECEF(I.lat,D)];let G=a.Aabb.fromPoints(F.map(Le=>[a.dot(U,Le),a.dot(j,Le),a.dot(V,Le)]));const N=a.transformMat4([],G.center,Z);0===a.squaredLength(N)&&a.set(N,0,0,1),a.normalize(N,N),a.scale$2(N,N,a.GLOBE_RADIUS),y.center=a.ecefToLatLng(N);const te=y.getWorldToCameraMatrix(),ie=a.invert(new Float64Array(16),te);G=a.Aabb.applyTransform(G,a.multiply([],te,Z)),a.transformMat4(N,N,te);const J=.5*(G.max[2]-G.min[2]),re=this._minimumAABBFrustumDistance(y,G),pe=a.scale$2([],[0,0,1],J),ge=a.add(pe,N,pe),me=re+(0===y.pitch?0:a.distance(N,ge)),ze=y.globeCenterInViewSpace,le=a.sub([],N,[ze[0],ze[1],ze[2]]);a.normalize(le,le),a.scale$2(le,le,me);const Ee=a.add([],N,le);a.transformMat4(Ee,Ee,ie);const Te=a.earthRadius/a.GLOBE_RADIUS,de=a.length(Ee),ae=a.mercatorZfromAltitude(de*Te-a.earthRadius,0),Ze=Math.min(y.zoomFromMercatorZAdjusted(ae),b.maxZoom);return Ze>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(y.setProjection({name:"mercator"}),y.zoom=Ze,this._cameraForBounds(y,o,u,d,m)):{center:y.center,zoom:Ze,bearing:d}}queryTerrainElevation(n,o){const u=this.transform.elevation;return u?(o=a.extend({},{exaggerated:!0},o),u.getAtPoint(a.MercatorCoordinate.fromLngLat(n),null,o.exaggerated)):null}_cameraForBounds(n,o,u,d,m){if("globe"===n.projection.name)return this._cameraForBoundsOnGlobe(n,o,u,d,m);const y=n.clone(),b=this._extendCameraOptions(m),w=y.padding;y.bearing=d;const I=a.LngLat.convert(o),M=a.LngLat.convert(u),D=new a.LngLat(I.lng,M.lat),B=new a.LngLat(M.lng,I.lat),V=y.project(I),U=y.project(M),j=this.queryTerrainElevation(I),Z=this.queryTerrainElevation(M),F=this.queryTerrainElevation(D),G=this.queryTerrainElevation(B),N=[[V.x,V.y,Math.min(j||0,Z||0,F||0,G||0)],[U.x,U.y,Math.max(j||0,Z||0,F||0,G||0)]];let te=a.Aabb.fromPoints(N);const ie=y.getWorldToCameraMatrix(),J=a.invert(new Float64Array(16),ie);te=a.Aabb.applyTransform(te,ie);const re=a.sub([],te.max,te.min),pe=w.left||0,ge=w.right||0,me=w.bottom||0,ze=w.top||0,{left:le,right:Ee,top:Te,bottom:de}=b.padding,ae=.5*(pe+ge),Ze=.5*(ze+me),Le=Math.min(y.scaleZoom(y.scale*Math.min((y.width-(pe+ge+le+Ee))/re[0],(y.height-(me+ze+de+Te))/re[1])),b.maxZoom),Fe=y.scale/y.zoomScale(Le);te=new a.Aabb([te.min[0]-(le+ae)*Fe,te.min[1]-(de+Ze)*Fe,te.min[2]],[te.max[0]+(Ee+ae)*Fe,te.max[1]+(Te+Ze)*Fe,te.max[2]]);const Re=.5*re[2],We=this._minimumAABBFrustumDistance(y,te),ot=[0,0,1,0];a.transformMat4$1(ot,ot,ie),a.normalize$2(ot,ot);const tt=a.scale$2([],ot,We+Re),Ye=a.add([],te.center,tt),Be=("number"==typeof b.offset.x&&"number"==typeof b.offset.y?new a.pointGeometry(b.offset.x,b.offset.y):a.pointGeometry.convert(b.offset)).rotate(-a.degToRad(d));te.center[0]-=Be.x*Fe,te.center[1]+=Be.y*Fe,a.transformMat4(te.center,te.center,J),a.transformMat4(Ye,Ye,J);const at=[te.center[0],te.center[1],Ye[2]*y.pixelsPerMeter];a.scale$2(at,at,1/y.worldSize);const ft=a.lngFromMercatorX(at[0]),Ot=a.latFromMercatorY(at[1]),Ft=Math.min(y._zoomFromMercatorZ(at[2]),b.maxZoom),Lt=new a.LngLat(ft,Ot);return y.mercatorFromTransition&&Ft<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(y.setProjection({name:"globe"}),y.zoom=Ft,this._cameraForBounds(y,o,u,d,m)):{center:Lt,zoom:Ft,bearing:d}}fitBounds(n,o,u){const d=this.cameraForBounds(n,o);return this._fitInternal(d,o,u)}fitScreenCoordinates(n,o,u,d,m){const y=a.pointGeometry.convert(n),b=a.pointGeometry.convert(o),w=new a.pointGeometry(Math.min(y.x,b.x),Math.min(y.y,b.y)),I=new a.pointGeometry(Math.max(y.x,b.x),Math.max(y.y,b.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(y,b))return this;const M=this.transform.pointLocation3D(w),D=this.transform.pointLocation3D(I),B=this.transform.pointLocation3D(new a.pointGeometry(w.x,I.y)),V=this.transform.pointLocation3D(new a.pointGeometry(I.x,w.y)),U=[Math.min(M.lng,D.lng,B.lng,V.lng),Math.min(M.lat,D.lat,B.lat,V.lat)],j=[Math.max(M.lng,D.lng,B.lng,V.lng),Math.max(M.lat,D.lat,B.lat,V.lat)],Z=this._cameraForBounds(this.transform,U,j,u,d);return this._fitInternal(Z,d,m)}_fitInternal(n,o,u){return n?(delete(o=a.extend(n,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(n,o){this.stop();const u=n.preloadOnly?this.transform.clone():this.transform;let d=!1,m=!1,y=!1;return"zoom"in n&&u.zoom!==+n.zoom&&(d=!0,u.zoom=+n.zoom),void 0!==n.center&&(u.center=a.LngLat.convert(n.center)),"bearing"in n&&u.bearing!==+n.bearing&&(m=!0,u.bearing=+n.bearing),"pitch"in n&&u.pitch!==+n.pitch&&(y=!0,u.pitch=+n.pitch),null==n.padding||u.isPaddingEqual(n.padding)||(u.padding=n.padding),n.preloadOnly?(this._preloadTiles(u),this):(this.fire(new a.Event("movestart",o)).fire(new a.Event("move",o)),d&&this.fire(new a.Event("zoomstart",o)).fire(new a.Event("zoom",o)).fire(new a.Event("zoomend",o)),m&&this.fire(new a.Event("rotatestart",o)).fire(new a.Event("rotate",o)).fire(new a.Event("rotateend",o)),y&&this.fire(new a.Event("pitchstart",o)).fire(new a.Event("pitch",o)).fire(new a.Event("pitchend",o)),this.fire(new a.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Hl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,o){const u=this.transform;if(!u.projection.supportsFreeCamera)return a.warnOnce(Hl),this;this.stop();const d=u.zoom,m=u.pitch,y=u.bearing;u.setFreeCameraOptions(n);const b=d!==u.zoom,w=m!==u.pitch,I=y!==u.bearing;return this.fire(new a.Event("movestart",o)).fire(new a.Event("move",o)),b&&this.fire(new a.Event("zoomstart",o)).fire(new a.Event("zoom",o)).fire(new a.Event("zoomend",o)),I&&this.fire(new a.Event("rotatestart",o)).fire(new a.Event("rotate",o)).fire(new a.Event("rotateend",o)),w&&this.fire(new a.Event("pitchstart",o)).fire(new a.Event("pitch",o)).fire(new a.Event("pitchend",o)),this.fire(new a.Event("moveend",o)),this}easeTo(n,o){this._stop(!1,n.easeId),(!1===(n=a.extend({offset:[0,0],duration:500,easing:a.ease},n)).animate||!n.essential&&a.exported.prefersReducedMotion)&&(n.duration=0);const u=this.transform,d=this.getZoom(),m=this.getBearing(),y=this.getPitch(),b=this.getPadding(),w="zoom"in n?+n.zoom:d,I="bearing"in n?this._normalizeBearing(n.bearing,m):m,M="pitch"in n?+n.pitch:y,D="padding"in n?n.padding:u.padding,B=a.pointGeometry.convert(n.offset);let V,U,j;if("globe"===u.projection.name){const ge=a.MercatorCoordinate.fromLngLat(u.center),me=B.rotate(-u.angle);ge.x+=me.x/u.worldSize,ge.y+=me.y/u.worldSize;const ze=ge.toLngLat(),le=a.LngLat.convert(n.center||ze);this._normalizeCenter(le),V=u.centerPoint.add(me),U=new a.pointGeometry(ge.x,ge.y).mult(u.worldSize),j=new a.pointGeometry(a.mercatorXfromLng(le.lng),a.mercatorYfromLat(le.lat)).mult(u.worldSize).sub(U)}else{V=u.centerPoint.add(B);const ge=u.pointLocation(V),me=a.LngLat.convert(n.center||ge);this._normalizeCenter(me),U=u.project(ge),j=u.project(me).sub(U)}const Z=u.zoomScale(w-d);let F,G;n.around&&(F=a.LngLat.convert(n.around),G=u.locationPoint(F));const N=this._zooming||w!==d,te=this._rotating||m!==I,ie=this._pitching||M!==y,J=!u.isPaddingEqual(D),re=ge=>me=>{if(N&&(ge.zoom=a.number(d,w,me)),te&&(ge.bearing=a.number(m,I,me)),ie&&(ge.pitch=a.number(y,M,me)),J&&(ge.interpolatePadding(b,D,me),V=ge.centerPoint.add(B)),F)ge.setLocationAtPoint(F,G);else{const ze=ge.zoomScale(ge.zoom-d),le=w>d?Math.min(2,Z):Math.max(.5,Z),Ee=Math.pow(le,1-me),Te=ge.unproject(U.add(j.mult(me*Ee)).mult(ze));ge.setLocationAtPoint(ge.renderWorldCopies?Te.wrap():Te,V)}return n.preloadOnly||this._fireMoveEvents(o),ge};if(n.preloadOnly){const ge=this._emulate(re,n.duration,u);return this._preloadTiles(ge),this}const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=N,this._rotating=te,this._pitching=ie,this._padding=J,this._easeId=n.easeId,this._prepareEase(o,n.noMoveStart,pe),this._ease(re(u),ge=>{u.recenterOnTerrain(),this._afterEase(o,ge)},n),this}_prepareEase(n,o,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||u.moving||this.fire(new a.Event("movestart",n)),this._zooming&&!u.zooming&&this.fire(new a.Event("zoomstart",n)),this._rotating&&!u.rotating&&this.fire(new a.Event("rotatestart",n)),this._pitching&&!u.pitching&&this.fire(new a.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new a.Event("move",n)),this._zooming&&this.fire(new a.Event("zoom",n)),this._rotating&&this.fire(new a.Event("rotate",n)),this._pitching&&this.fire(new a.Event("pitch",n))}_afterEase(n,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,d=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new a.Event("zoomend",n)),d&&this.fire(new a.Event("rotateend",n)),m&&this.fire(new a.Event("pitchend",n)),this.fire(new a.Event("moveend",n))}flyTo(n,o){if(!n.essential&&a.exported.prefersReducedMotion){const Fe=a.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Fe,o)}this.stop(),n=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},n);const u=this.transform,d=this.getZoom(),m=this.getBearing(),y=this.getPitch(),b=this.getPadding(),w="zoom"in n?a.clamp(+n.zoom,u.minZoom,u.maxZoom):d,I="bearing"in n?this._normalizeBearing(n.bearing,m):m,M="pitch"in n?+n.pitch:y,D="padding"in n?n.padding:u.padding,B=u.zoomScale(w-d),V=a.pointGeometry.convert(n.offset);let U=u.centerPoint.add(V);const j=u.pointLocation(U),Z=a.LngLat.convert(n.center||j);this._normalizeCenter(Z);const F=u.project(j),G=u.project(Z).sub(F);let N=n.curve;const te=Math.max(u.width,u.height),ie=te/B,J=G.mag();if("minZoom"in n){const Fe=a.clamp(Math.min(n.minZoom,d,w),u.minZoom,u.maxZoom),Re=te/u.zoomScale(Fe-d);N=Math.sqrt(Re/J*2)}const re=N*N;function pe(Fe){const Re=(ie*ie-te*te+(Fe?-1:1)*re*re*J*J)/(2*(Fe?ie:te)*re*J);return Math.log(Math.sqrt(Re*Re+1)-Re)}function ge(Fe){return(Math.exp(Fe)-Math.exp(-Fe))/2}function me(Fe){return(Math.exp(Fe)+Math.exp(-Fe))/2}const ze=pe(0);let le=function(Fe){return me(ze)/me(ze+N*Fe)},Ee=function(Fe){return te*((me(ze)*(ge(Re=ze+N*Fe)/me(Re))-ge(ze))/re)/J;var Re},Te=(pe(1)-ze)/N;if(Math.abs(J)<1e-6||!isFinite(Te)){if(Math.abs(te-ie)<1e-6)return this.easeTo(n,o);const Fe=ie<te?-1:1;Te=Math.abs(Math.log(ie/te))/N,Ee=function(){return 0},le=function(Re){return Math.exp(Fe*N*Re)}}n.duration="duration"in n?+n.duration:1e3*Te/("screenSpeed"in n?+n.screenSpeed/N:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const de=m!==I,ae=M!==y,Ze=!u.isPaddingEqual(D),Le=Fe=>Re=>{const We=Re*Te,ot=1/le(We);Fe.zoom=1===Re?w:d+Fe.scaleZoom(ot),de&&(Fe.bearing=a.number(m,I,Re)),ae&&(Fe.pitch=a.number(y,M,Re)),Ze&&(Fe.interpolatePadding(b,D,Re),U=Fe.centerPoint.add(V));const tt=1===Re?Z:Fe.unproject(F.add(G.mult(Ee(We))).mult(ot));return Fe.setLocationAtPoint(Fe.renderWorldCopies?tt.wrap():tt,U),Fe._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(o),Fe};if(n.preloadOnly){const Fe=this._emulate(Le,n.duration,u);return this._preloadTiles(Fe),this}return this._zooming=!0,this._rotating=de,this._pitching=ae,this._padding=Ze,this._prepareEase(o,!1),this._ease(Le(u),()=>this._afterEase(o),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,o)}if(!n){const u=this.handlers;u&&u.stop(!1)}return this}_ease(n,o,u){!1===u.animate||0===u.duration?(n(1),o()):(this._easeStart=a.exported.now(),this._easeOptions=u,this._onEaseFrame=n,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,o){n=a.wrap(n,-180,180);const u=Math.abs(n-o);return Math.abs(n-360-o)<u&&(n-=360),Math.abs(n+360-o)<u&&(n+=360),n}_normalizeCenter(n){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const u=n.lng-o.center.lng;n.lng+=u>180?-360:u<-180?360:0}_emulate(n,o,u){const d=Math.ceil(15*o/1e3),m=[],y=n(u.clone());for(let b=0;b<=d;b++){const w=y(b/d);m.push(w.clone())}return m}}class Jl{constructor(n={}){this.options=n,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const o=this.options&&this.options.compact;return this._map=n,this._container=_t("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=_t("button","mapboxgl-ctrl-attrib-button",this._container),_t("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=_t("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===o&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,o){const u=this._map._getUIString(`AttributionControl.${o}`);n.setAttribute("aria-label",u),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(n){const u=o.reduce((d,m,y)=>(m.value&&(d+=`${m.key}=${m.value}${y<o.length-1?"&":""}`),d),"?");n.href=`${a.config.FEEDBACK_URL}/${u}#${Nl(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const o=this._map.style._sourceCaches;for(const d in o){const m=o[d];if(m.used){const y=m.getSource();y.attribution&&n.indexOf(y.attribution)<0&&n.push(y.attribution)}}n.sort((d,m)=>d.length-m.length),n=n.filter((d,m)=>{for(let y=m+1;y<n.length;y++)if(n[y].indexOf(d)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const u=n.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,n.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ha{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=_t("div","mapboxgl-ctrl");const o=_t("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const o in n){const u=n[o].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const o=n[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class nl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const o=++this._id;return this._queue.push({callback:n,id:o,cancelled:!1}),o}remove(n){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const d of u)if(d.id===n)return void(d.cancelled=!0)}run(n=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function pa(l,n,o){if(l=new a.LngLat(l.lng,l.lat),n){const u=new a.LngLat(l.lng-360,l.lat),d=new a.LngLat(l.lng+360,l.lat),m=360*Math.ceil(Math.abs(l.lng-o.center.lng)/360),y=o.locationPoint(l).distSqr(n),b=n.x<0||n.y<0||n.x>o.width||n.y>o.height;o.locationPoint(u).distSqr(n)<y&&(b||Math.abs(u.lng-o.center.lng)<m)?l=u:o.locationPoint(d).distSqr(n)<y&&(b||Math.abs(d.lng-o.center.lng)<m)&&(l=d)}for(;Math.abs(l.lng-o.center.lng)>180;){const u=o.locationPoint(l);if(u.x>=0&&u.y>=0&&u.x<=o.width&&u.y<=o.height)break;l.lng>o.center.lng?l.lng-=360:l.lng+=360}return l}const rl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ol extends a.Evented{constructor(n,o){if(super(),(n instanceof a.window.HTMLElement||o)&&(n=a.extend({element:n},o)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=a.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=_t("div");const d=41,m=27,y=wi("svg",{display:"block",height:d*this._scale+"px",width:m*this._scale+"px",viewBox:`0 0 ${m} ${d}`},this._element),b=wi("radialGradient",{id:"shadowGradient"},wi("defs",{},y));wi("stop",{offset:"10%","stop-opacity":.4},b),wi("stop",{offset:"100%","stop-opacity":.05},b),wi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},y),wi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},y),wi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},y),wi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},y),this._offset=a.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()});const u=this._element.classList;for(const d in rl)u.remove(`mapboxgl-marker-anchor-${d}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=a.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const o=n.code,u=n.charCode||n.keyCode;"Space"!==o&&"Enter"!==o&&32!==u&&13!==u||this.togglePopup()}_onMapClick(n){const o=n.originalEvent.target,u=this._element;this._popup&&(o===u||u.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,o=this._pos;if(!n||!o)return!1;const u=n.unproject(o),d=n.getFreeCameraOptions();if(!d.position)return!1;const m=d.position.toLngLat();return m.distanceTo(u)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const o=this._pos;if(!o||o.x<0||o.x>n.transform.width||o.y<0||o.y>n.transform.height)return void this._clearFadeTimer();const u=n.unproject(o);let d;n._showingGlobe()&&a.isLngLatBehindGlobe(n.transform,this._lngLat)?d=0:(d=1-n._queryFogOpacity(u),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(d*=this._occludedOpacity)),this._element.style.opacity=`${d}`,this._element.style.pointerEvents=d>0?"auto":"none",this._popup&&this._popup._setOpacity(d),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${n.x}px,${n.y}px)\n            ${rl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${o.x}px,${o.y}px)\n        `}_calculateXYTransform(){const n=this._pos,o=this._map,u=this.getPitchAlignment();if(!o||!n||"map"!==u)return"";if(!o._showingGlobe()){const w=o.getPitch();return w?`rotateX(${w}deg)`:""}const d=a.radToDeg(a.globeTiltAtLngLat(o.transform,this._lngLat)),m=n.sub(a.globeCenterToScreenPoint(o.transform)),y=Math.abs(m.x)+Math.abs(m.y);if(0===y)return"";const b=d/y;return`rotateX(${-m.y*b}deg) rotateY(${m.x*b}deg)`}_calculateZTransform(){const n=this._pos,o=this._map;if(!o||!n)return"";let u=0;const d=this.getRotationAlignment();if("map"===d)if(o._showingGlobe()){const m=o.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),y=o.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(m);u=a.radToDeg(Math.atan2(y.y,y.x))-90}else u=-o.getBearing();else if("horizon"===d){const m=a.smoothstep(4,6,o.getZoom()),y=a.globeCenterToScreenPoint(o.transform);y.y+=m*o.transform.height;const b=n.sub(y),w=a.radToDeg(Math.atan2(b.y,b.x));u=(w>90?w-270:w+90)*(1-m)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(n){a.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=pa(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),!0===n?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=a.pointGeometry.convert(n),this._update(),this}_onMove(n){const o=this._map;if(!o)return;const u=this._pointerdownPos,d=this._positionDelta;if(u&&d){if(!this._isDragging){const m=this._clickTolerance||o._clickTolerance;if(n.point.dist(u)<m)return;this._isDragging=!0}this._pos=n.point.sub(d),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(n){const o=this._map,u=this._pos;o&&u&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(u),this._pointerdownPos=n.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const o=this._map;return o&&(n?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Kc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},eu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yl(l=new a.pointGeometry(0,0),n="bottom"){if("number"==typeof l){const o=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(n){case"top":return new a.pointGeometry(0,l);case"top-left":return new a.pointGeometry(o,o);case"top-right":return new a.pointGeometry(-o,o);case"bottom":return new a.pointGeometry(0,-l);case"bottom-left":return new a.pointGeometry(o,-o);case"bottom-right":return new a.pointGeometry(-o,-o);case"left":return new a.pointGeometry(l,0);case"right":return new a.pointGeometry(-l,0)}return new a.pointGeometry(0,0)}return l instanceof a.pointGeometry||Array.isArray(l)?a.pointGeometry.convert(l):a.pointGeometry.convert(l[n]||[0,0])}class tu{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const o=a.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,o,u){this._start=this.getValue(o),this._end=n,this._startTime=o,this._endTime=o+u}}const iu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ql={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function sl(l){l.parentNode&&l.parentNode.removeChild(l)}const nu={showCompass:!0,showZoom:!0,visualizePitch:!1};class ru{constructor(n,o,u=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new ql({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,u&&(this.mousePitch=new Lo({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(n,o){this.mouseRotate.mousedown(n,o),this.mousePitch&&this.mousePitch.mousedown(n,o),ho()}move(n,o){const u=this.map,d=this.mouseRotate.mousemoveWindow(n,o),m=d&&d.bearingDelta;if(m&&u.setBearing(u.getBearing()+m),this.mousePitch){const y=this.mousePitch.mousemoveWindow(n,o),b=y&&y.pitchDelta;b&&u.setPitch(u.getPitch()+b)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){on(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(a.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Oe(this.element,n)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Oe(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=an(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=an(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ou={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Kl={maxWidth:100,unit:"metric"};function su(l,n,o){const u=al(n),d=u/n,m={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[o];this._map._requestDomTask(()=>{this._container.style.width=l*d+"px",this._container.innerHTML=`${u}&nbsp;${m}`})}function al(l){const n=Math.pow(10,`${Math.floor(l)}`.length-1);let o=l/n;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(u){const d=Math.pow(10,Math.ceil(-Math.log(u)/Math.LN10));return Math.round(u*d)/d}(o),n*o}const da={version:a.version,supported:Cn,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Qc{constructor(l){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),null!=(l=a.extend({},Ql,l)).minZoom&&null!=l.maxZoom&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=l.minPitch&&null!=l.maxPitch&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=l.minPitch&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=l.maxPitch&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(l.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new xi(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new nl,this._domRenderTaskQueue=new nl,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},iu,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new tu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,"string"==typeof l.container){if(this._container=a.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==a.window&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Yc(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new Bc("string"==typeof l.hash&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,a.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new Jl({customAttribution:l.customAttribution})),this._logoControl=new ha,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new a.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new a.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(l,n){if(void 0===n&&(n=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=l.onAdd(this);this._controls.push(l);const u=this._controlPositions[n];return-1!==n.indexOf("bottom")?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(l);return n>-1&&this._controls.splice(n,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),this.fire(new a.Event("resize",l)),n&&this.fire(new a.Event("moveend",l)),this}getBounds(){return"globe"===this.transform.projection.name&&a.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(a.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return"auto"===l?a.window.navigator.language:Array.isArray(l)?0===l.length?void 0:l.map(n=>"auto"===n?a.window.navigator.language:n):l}setLanguage(l){const n=this._parseLanguage(l);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(l){return this._lazyInitEmptyStyle(),l?"string"==typeof l&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const l=this.transform,n=l.projection.name;let o;"globe"===n&&l.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(l.setMercatorFromTransition(),o=!0):"mercator"===n&&l.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(l.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,n){return this._updateProjection(l||n||{name:"mercator"})}_updateProjection(l){let n;if(n="globe"===l.name&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(l){return this.transform.locationPoint3D(a.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(a.pointGeometry.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(l,n,o){if("mouseenter"===l||"mouseover"===l){let u=!1;const d=y=>{const b=n.filter(I=>this.getLayer(I)),w=b.length?this.queryRenderedFeatures(y.point,{layers:b}):[];w.length?u||(u=!0,o.call(this,new ln(l,this,y.originalEvent,{features:w}))):u=!1},m=()=>{u=!1};return{layers:new Set(n),listener:o,delegates:{mousemove:d,mouseout:m}}}if("mouseleave"===l||"mouseout"===l){let u=!1;const d=y=>{const b=n.filter(w=>this.getLayer(w));(b.length?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?u=!0:u&&(u=!1,o.call(this,new ln(l,this,y.originalEvent)))},m=y=>{u&&(u=!1,o.call(this,new ln(l,this,y.originalEvent)))};return{layers:new Set(n),listener:o,delegates:{mousemove:d,mouseout:m}}}{const u=d=>{const m=n.filter(b=>this.getLayer(b)),y=m.length?this.queryRenderedFeatures(d.point,{layers:m}):[];y.length&&(d.features=y,o.call(this,d),delete d.features)};return{layers:new Set(n),listener:o,delegates:{[l]:u}}}}on(l,n,o){if(void 0===o)return super.on(l,n);Array.isArray(n)||(n=[n]);const u=this._createDelegatedListener(l,n,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(l,n,o){if(void 0===o)return super.once(l,n);Array.isArray(n)||(n=[n]);const u=this._createDelegatedListener(l,n,o);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(l,n,o){if(void 0===o)return super.off(l,n);n=new Set(Array.isArray(n)?n:[n]);const u=(m,y)=>{if(m.size!==y.size)return!1;for(const b of m)if(!y.has(b))return!1;return!0},d=this._delegatedListeners?this._delegatedListeners[l]:void 0;return d&&(m=>{for(let y=0;y<m.length;y++){const b=m[y];if(b.listener===o&&u(b.layers,n)){for(const w in b.delegates)this.off(w,b.delegates[w]);return m.splice(y,1),this}}})(d),this}queryRenderedFeatures(l,n){return this.style?(void 0!==n||void 0===l||l instanceof a.pointGeometry||Array.isArray(l)||(n=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(l,n){return this.style.querySourceFeatures(l,n)}setStyle(l,n){return!1!==(n=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(l,n))}_getUIString(l){const n=this._locale[l];if(null==n)throw new Error(`Missing UI string '${l}'`);return n}_updateStyle(l,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new gn(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof l?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new gn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,n){if("string"==typeof l){const o=this._requestManager.normalizeStyleURL(l),u=this._requestManager.transformRequest(o,a.ResourceType.Style);a.getJSON(u,(d,m)=>{d?this.fire(new a.ErrorEvent(d)):m&&this._updateDiff(m,n)})}else"object"==typeof l&&this._updateDiff(l,n)}_updateDiff(l,n){try{this.style.setState(l)&&this._update(!0)}catch(o){a.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(l,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(l,n){return this._lazyInitEmptyStyle(),this.style.addSource(l,n),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const n in l){const o=l[n]._tiles;for(const u in o){const d=o[u];if("loaded"!==d.state&&"errored"!==d.state)return!1}}return!0}addSourceType(l,n,o){this._lazyInitEmptyStyle(),this.style.addSourceType(l,n,o)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,n,{pixelRatio:o=1,sdf:u=!1,stretchX:d,stretchY:m,content:y}={}){if(this._lazyInitEmptyStyle(),n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap){const{width:b,height:w,data:I}=a.exported.getImageData(n);this.style.addImage(l,{data:new a.RGBAImage({width:b,height:w},I),pixelRatio:o,stretchX:d,stretchY:m,content:y,sdf:u,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:b,height:w}=n,I=n;this.style.addImage(l,{data:new a.RGBAImage({width:b,height:w},new Uint8Array(I.data)),pixelRatio:o,stretchX:d,stretchY:m,content:y,sdf:u,version:0,userImage:I}),I.onAdd&&I.onAdd(this,l)}}updateImage(l,n){const o=this.style.getImage(l);if(!o)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap?a.exported.getImageData(n):n,{width:d,height:m}=u;void 0!==d&&void 0!==m?d===o.data.width&&m===o.data.height?(o.data.replace(u.data,!(n instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&n instanceof a.window.ImageBitmap)),this.style.updateImage(l,o)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${d}, ${m})\n                must be that same as the previous version of the image\n                (${o.data.width}, ${o.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,n){a.getImage(this._requestManager.transformRequest(l,a.ResourceType.Image),(o,u)=>{n(o,u instanceof a.window.HTMLImageElement?a.exported.getImageData(u):u)})}listImages(){return this.style.listImages()}addLayer(l,n){return this._lazyInitEmptyStyle(),this.style.addLayer(l,n),this._update(!0)}moveLayer(l,n){return this.style.moveLayer(l,n),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,n,o){return this.style.setLayerZoomRange(l,n,o),this._update(!0)}setFilter(l,n,o={}){return this.style.setFilter(l,n,o),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,n,o,u={}){return this.style.setPaintProperty(l,n,o,u),this._update(!0)}getPaintProperty(l,n){return this.style.getPaintProperty(l,n)}setLayoutProperty(l,n,o,u={}){return this.style.setLayoutProperty(l,n,o,u),this._update(!0)}getLayoutProperty(l,n){return this.style.getLayoutProperty(l,n)}setLight(l,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(l),this.transform):0}setFeatureState(l,n){return this.style.setFeatureState(l,n),this._update()}removeFeatureState(l,n){return this.style.removeFeatureState(l,n),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let o,u,d,m=this._container;for(;m&&(!u||!d);){const y=a.window.getComputedStyle(m).transform;y&&"none"!==y&&(o=y.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&"0"!==o[0]&&"1"!==o[0]&&(u=o[0]),o[3]&&"0"!==o[3]&&"1"!==o[3]&&(d=o[3])),m=m.parentElement}this._containerWidth=u?Math.abs(l/u):l,this._containerHeight=d?Math.abs(n/d):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=_t("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=_t("div","mapboxgl-canvas-container",l);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=_t("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=_t("div","mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{u[d]=_t("div",`mapboxgl-ctrl-${d}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,n){const o=a.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(l),this._canvas.height=o*Math.ceil(n),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${n}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const n=this._markers.indexOf(l);-1!==n&&this._markers.splice(n,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const n=this._popups.indexOf(l);-1!==n&&this._popups.splice(n,1)}_setupPainter(){const l=a.extend({},Cn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);n?(a.storeAuthState(n,!0),this.painter=new T(n,this.transform),this.on("data",o=>{"source"===o.dataType&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(n)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let n;const o=this.painter.context.extTimerQuery,u=a.exported.now();if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();let d=!1;const m=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,I=this.transform.pitch,M=a.exported.now();this.style.zoomHistory.update(w,M);const D=new a.EvaluationParameters(w,{now:M,fadeDuration:m,pitch:I,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),B=D.crossFadingFactor();1===B&&B===this._crossFadingFactor||(d=!0,this._crossFadingFactor=B),this.style.update(D)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(u),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,m,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const w=a.exported.now()-u;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout(()=>{const I=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),this.fire(new a.Event("gpu-timing-frame",{cpuTime:w,gpuTime:I})),a.window.performance.mark("frame-gpu",{startTime:u,detail:{gpuTime:I}})},50)}if(this.listens("gpu-timing-layer")){const w=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(w);this.fire(new a.Event("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const w=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(w);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:I}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(b||this._repaint)this.triggerRepaint();else{const w=!this.isMoving()&&this.loaded();if(w&&(y=this._updateAverageElevation(u,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),w&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const n of this._markers)l&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!l||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(l,n=!1){const o=u=>(this.transform.averageElevation=u,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&o(0);if((n||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const u=this.transform.averageElevation;let d=this.transform.sampleAverageElevation(),m=!1;this.transform.elevation&&(m=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(d)?d=0:this._averageElevationLastSampledAt=l;const y=Math.abs(u-d);if(y>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(d),o(d);this._averageElevation.easeTo(d,l,300)}else if(y>1e-4)return this._averageElevation.jumpTo(d),o(d)}return!!this._averageElevation.isEasing(l)&&o(this._averageElevation.getValue(l))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===a.AUTH_ERR_MSG||401===l.status)){const n=this.painter.context.gl;a.storeAuthState(n,!1),this._logoControl instanceof ha&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const o=this.painter.context.gl,u=o.createFramebuffer();function d(m){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,m,0);const y=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,y),y}return o.bindFramebuffer(o.FRAMEBUFFER,u),this._canvasPixelComparison(d(l),n.canvasCopies.map(d),n.timeStamps)}_canvasPixelComparison(l,n,o){let u=o[1]-o[0];const d=l.length/4;for(let m=0;m<n.length;m++){const y=n[m];let b=0;for(let w=0;w<y.length;w+=4)y[w]===l[w]&&y[w+1]===l[w+1]&&y[w+2]===l[w+2]&&y[w+3]===l[w+3]&&(b+=1);u+=(o[m+2]-o[m+1])*(1-b/d)}return u}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==a.window&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),sl(this._canvasContainer),sl(this._controlContainer),sl(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=a.exported.frame(n=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(n)}))}_preloadTiles(l){const n=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(n,(o,u)=>o._preloadTiles(l,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){"hidden"===a.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,l&&this._update())}_setCacheLimits(l,n){a.setCacheLimits(l,n)}get version(){return a.version}},NavigationControl:class{constructor(l){this.options=a.extend({},nu,l),this._container=_t("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),_t("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),_t("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:n}):o.resetNorth({},{originalEvent:n}))}),this._compassIcon=_t("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const n=l.getZoom(),o=n===l.getMaxZoom(),u=n===l.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ru(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,n){const o=_t("button",l,this._container);return o.type="button",o.addEventListener("click",n),o}_setButtonTitle(l,n){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${n}`);l.setAttribute("aria-label",o),l.firstElementChild&&l.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends a.Evented{constructor(l){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},ou,l),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Zl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=_t("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const n=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,l(o)};void 0!==this._supportsGeolocation?l(this._supportsGeolocation):void 0!==a.window.navigator.permissions?a.window.navigator.permissions.query({name:"geolocation"}).then(o=>n("denied"!==o.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(l){const n=this._map.getMaxBounds(),o=l.coords;return!!n&&(o.longitude<n.getWest()||o.longitude>n.getEast()||o.latitude<n.getSouth()||o.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(l),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",l)),this._finish()}}_updateCamera(l){const n=new a.LngLat(l.coords.longitude,l.coords.latitude),o=l.coords.accuracy,u=this._map.getBearing(),d=a.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(o),d,{geolocateSource:!0})}_updateMarker(l){if(l){const n=new a.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,n=a.mercatorZfromAltitude(1,l._center.lat)*l.worldSize,o=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(1===l.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===l.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=_t("button","mapboxgl-ctrl-geolocate",this._container),_t("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===l){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_t("div","mapboxgl-user-location"),this._dotElement.appendChild(_t("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(_t("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ol({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=_t("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ol({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:!0===l.absolute&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==a.window.DeviceMotionEvent&&"function"==typeof a.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Jl,ScaleControl:class{constructor(l){this.options=a.extend({},Kl,l),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=su.bind(this)),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,n=this._map,o=n._containerHeight/2,u=n._containerWidth/2-l/2,d=n.unproject([u,o]),m=n.unproject([u+l,o]),y=d.distanceTo(m);if("imperial"===this.options.unit){const b=3.2808*y;b>5280?this._setScale(l,b/5280,"mile"):this._setScale(l,b,"foot")}else"nautical"===this.options.unit?this._setScale(l,y/1852,"nautical-mile"):y>=1e3?this._setScale(l,y/1e3,"kilometer"):this._setScale(l,y,"meter")}_setScale(l,n,o){const u=al(n),d=u/n;this._map._requestDomTask(()=>{this._container.style.width=l*d+"px",this._container.innerHTML="nautical-mile"!==o?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:o}).format(u):`${u}&nbsp;nm`})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=_t("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof a.window.HTMLElement?this._container=l.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=_t("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=_t("button","mapboxgl-ctrl-fullscreen",this._controlContainer);_t("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(l){super(),this.options=a.extend(Object.create(Kc),l),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=a.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(a.window.document.createTextNode(l))}setHTML(l){const n=a.window.document.createDocumentFragment(),o=a.window.document.createElement("body");let u;for(o.innerHTML=l;u=o.firstChild,u;)n.appendChild(u);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=_t("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(l),this.options.closeButton){const o=this._closeButton=_t("button","mapboxgl-popup-close-button",n);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let n;return this._classList.delete(l)?n=!1:(this._classList.add(l),n=!0),this._updateClassList(),n}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const n=this._map,o=this._container,u=this._pos;if(!n||!o||!u)return"bottom";const d=o.offsetWidth,m=o.offsetHeight,y=u.x<d/2,b=u.x>n.transform.width-d/2;if(u.y+l<m)return y?"top-left":b?"top-right":"top";if(u.y>n.transform.height-m){if(y)return"bottom-left";if(b)return"bottom-right"}return y?"left":b?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),l.className=n.join(" ")}_update(l){const n=this._map,o=this._content;if(!n||!this._lngLat&&!this._trackPointer||!o)return;let u=this._container;if(u||(u=this._container=_t("div","mapboxgl-popup",n.getContainer()),this._tip=_t("div","mapboxgl-popup-tip",u),u.appendChild(o)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pa(this._lngLat,this._pos,n.transform)),!this._trackPointer||l){const d=this._pos=this._trackPointer&&l?l:n.project(this._lngLat),m=Yl(this.options.offset),y=this._anchor=this._getAnchor(m.y),b=Yl(this.options.offset,y),w=d.add(b).round();n._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${rl[y]} translate(${w.x}px,${w.y}px)`)})}if(!this._marker&&n._showingGlobe()){const d=a.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(eu);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:ol,Style:gn,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Ie,Evented:a.Evented,config:a.config,prewarm:function(){Qe().acquire(Ke)},clearPrewarmedResources:function(){const l=Je;l&&(l.isPreloaded()&&1===l.numActive()?(l.release(Ke),Je=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(l){a.config.ACCESS_TOKEN=l},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(l){a.config.API_URL=l},get workerCount(){return He.workerCount},set workerCount(l){He.workerCount=l},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){a.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){a.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return da}),Ds}()}}]);